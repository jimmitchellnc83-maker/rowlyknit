{"version":3,"mappings":"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AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;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","names":["useAuthStore","create","persist","set","get","email","password","rememberMe","response","axios","user","accessToken","data","error","token","state","PWAInstallPrompt","deferredPrompt","setDeferredPrompt","useState","showPrompt","setShowPrompt","useEffect","handleBeforeInstallPrompt","e","handleInstall","outcome","handleDismiss","dismissedUntil","jsxs","jsx","FiX","FiDownload","OfflineIndicator","isOnline","setIsOnline","showBanner","setShowBanner","handleOnline","handleOffline","Fragment","FiWifi","FiWifiOff","GlobalSearch","isOpen","setIsOpen","query","setQuery","results","setResults","loading","setLoading","inputRef","useRef","navigate","useNavigate","handleKeyDown","timer","performSearch","searchQuery","projects","patterns","yarn","recipients","tools","searchResults","p","y","r","t","toast","handleResultClick","result","getTypeColor","type","FiSearch","useThemeStore","newTheme","applyTheme","theme","root","ThemeToggle","toggleTheme","FiMoon","FiSun","instanceOfAny","object","constructors","c","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","transactionDoneMap","transformCache","reverseTransformCache","promisifyRequest","request","promise","resolve","reject","unlisten","success","wrap","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","target","prop","receiver","value","replaceTraps","callback","wrapFunction","func","args","unwrap","transformCachableValue","newValue","openDB","name","version","blocked","upgrade","blocking","terminated","openPromise","event","db","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","method","storeName","oldTraps","advanceMethodProps","methodMap","advanceResults","ittrProxiedCursorToOriginalProxy","cursorIteratorTraps","cachedFunc","iterate","cursor","proxiedCursor","isIteratorProp","DB_NAME","DB_VERSION","dbInstance","initDB","oldVersion","newVersion","transaction","counterStore","syncStore","sessionStore","noteStore","getDB","cachePattern","pattern","getPatternFromCache","patternId","getAllCachedPatterns","cachePDF","blob","getPDFFromCache","cacheCounter","counter","synced","getCounterFromCache","counterId","getProjectCountersFromCache","projectId","addToSyncQueue","item","getSyncQueue","getUnsyncedItems","markSyncItemComplete","id","incrementSyncRetry","deleteSyncItem","cacheProject","project","getProjectFromCache","cacheSession","session","getSessionFromCache","sessionId","getProjectSessionsFromCache","s","cacheNote","note","getNoteFromCache","noteId","getUnsyncedNotes","clearCache","stores","store","getCacheSize","MAX_RETRIES","RETRY_DELAY","SyncManager","status","listener","pending","failed","unsyncedItems","delay","config","queue","__vitePreload","m","ms","syncManager","SyncIndicator","syncStatus","setSyncStatus","showDetails","setShowDetails","failedItems","setFailedItems","React","unsubscribe","handleManualSync","handleRetryFailed","handleShowDetails","items","getStatusColor","getStatusIcon","FiRefreshCw","FiAlertCircle","FiCloud","FiCheckCircle","FiCloudOff","getStatusText","index","ConflictResolver","conflicts","onResolve","onResolveAll","expandedConflict","setExpandedConflict","resolving","setResolving","handleResolve","conflictId","resolution","handleResolveAll","toggleExpand","renderValue","getResourceTypeLabel","FiAlertTriangle","conflict","isExpanded","isResolving","FiChevronUp","FiChevronDown","MainLayout","logout","location","useLocation","setConflicts","handleLogout","handleResolveConflict","prev","handleResolveAllConflicts","navigation","FiHome","FiBarChart2","FiFolder","FiBook","FiPackage","FiTool","FiUsers","mainNavigation","Icon","isActive","Link","FiUser","FiLogOut","Outlet","AuthLayout","Dashboard","stats","setStats","recentProjects","setRecentProjects","lowStockYarn","setLowStockYarn","fetchDashboardData","projectsRes","patternsRes","yarnRes","recipientsRes","recentProjectsRes","allYarnRes","lowStock","quickActions","stat","action","currentQty","threshold","percentRemaining","FiPlus","Projects","setProjects","showCreateModal","setShowCreateModal","formData","setFormData","fetchProjects","handleCreateProject","handleDeleteProject","formatDate","dateString","FiClock","FiCalendar","FiTrash2","PhotoGallery","photos","onDelete","selectedIndex","setSelectedIndex","zoom","setZoom","openLightbox","closeLightbox","goToPrevious","goToNext","handleDownload","photo","link","handleZoomIn","handleZoomOut","selectedPhoto","FiZoomIn","FiChevronLeft","FiChevronRight","FiZoomOut","FileUpload","onUpload","accept","maxSize","selectedFile","setSelectedFile","preview","setPreview","uploading","setUploading","dragActive","setDragActive","fileInputRef","handleFileSelect","file","reader","handleInputChange","handleDrop","handleDrag","handleUpload","handleCancel","FiUpload","COUNTER_COLORS","INCREMENT_PATTERNS","CounterForm","parentCounterId","existingCounters","onSave","onCancel","setName","setType","currentValue","setCurrentValue","targetValue","setTargetValue","incrementBy","minValue","setMinValue","maxValue","setMaxValue","displayColor","setDisplayColor","notes","setNotes","incrementPattern","setIncrementPattern","customIncrement","setCustomIncrement","autoReset","setAutoReset","selectedParentId","setSelectedParentId","parentCounter","availableParents","handleSubmit","color","HierarchicalCounterCard","isPrimary","mode","onIncrement","onEdit","expanded","setExpanded","percentage","showButtons","hasChildren","FiMinus","FiLink","child","CounterHierarchy","onCounterChange","counters","setCounters","allCounters","setAllCounters","incrementing","setIncrementing","setMode","showForm","setShowForm","editingCounter","setEditingCounter","parentForNewCounter","setParentForNewCounter","fetchCounters","hierarchyRes","flatRes","handleIncrement","amount","u","handleCreateCounter","counterData","handleUpdateCounter","handleDeleteCounter","primaryCounters","SessionTimer","currentSession","onStartSession","onEndSession","onPauseSession","getCurrentCounterValues","elapsedTime","setElapsedTime","isRunning","setIsRunning","showEndModal","setShowEndModal","endNotes","setEndNotes","mood","setMood","intervalRef","startTime","now","handleStart","handlePause","handleStop","handleConfirmEnd","formatTime","seconds","hours","minutes","secs","FiPause","FiSquare","FiPlay","SessionHistory","sessions","onDeleteSession","expandedSession","setExpandedSession","formatDuration","calculateRowsPerHour","getMoodEmoji","getMoodColor","totalDuration","sum","totalRows","averageRowsPerHour","rowsPerHour","format","FiTrendingUp","FiMapPin","startValue","endValue","diff","ProjectTimer","milestones","totalTimeSeconds","completedRows","onAddMilestone","onUpdateMilestone","onDeleteMilestone","showAddModal","setShowAddModal","_editingMilestone","_setEditingMilestone","newMilestone","setNewMilestone","calculateEstimatedCompletion","estimatedHours","days","handleAddMilestone","handleCompleteMilestone","milestone","progressPercentage","FiCircle","a","b","isCompleted","milestoneProgress","SessionManager","setCurrentSession","setSessions","setMilestones","activeTab","setActiveTab","fetchSessions","fetchMilestones","checkActiveSession","handleStartSession","newSession","handleEndSession","handleDeleteSession","handleUpdateMilestone","milestoneId","updates","updatedMilestone","handleDeleteMilestone","WebSocketContext","createContext","WebSocketProvider","children","socket","setSocket","isConnected","setIsConnected","socketRef","newSocket","io","reason","joinProject","useCallback","leaveProject","emitCounterUpdate","emitCounterIncrement","emitCounterDecrement","emitCounterReset","onCounterUpdate","offCounterUpdate","useWebSocket","context","useContext","AudioNotes","onSaveNote","onDeleteNote","onUpdateTranscription","isRecording","setIsRecording","recordingTime","setRecordingTime","playingNoteId","setPlayingNoteId","editingNoteId","setEditingNoteId","editTranscription","setEditTranscription","mediaRecorderRef","audioChunksRef","recordingIntervalRef","recordingTimeRef","audioElementsRef","recordingMimeTypeRef","audio","getSupportedMimeType","types","startRecording","stream","mimeType","options","mediaRecorder","actualMimeType","audioBlob","track","duration","stopRecording","playAudio","currentAudio","handleDeleteNote","startEditTranscription","saveTranscription","cancelEditTranscription","mins","FiMic","formatDistanceToNow","FiCheck","FiEdit2","key","COLORS","LINE_WIDTHS","HandwrittenNotes","pageNumber","initialData","canvasRef","containerRef","isDrawing","setIsDrawing","currentPath","setCurrentPath","paths","setPaths","undoStack","setUndoStack","redoStack","setRedoStack","tool","setTool","setColor","lineWidth","setLineWidth","showColorPicker","setShowColorPicker","showWidthPicker","setShowWidthPicker","canvas","container","rect","ctx","img","path","i","getCanvasPoint","clientX","clientY","startDrawing","point","draw","lastPoint","endDrawing","newPath","handleUndo","previousState","handleRedo","nextState","handleClear","handleExport","imageData","FiRotateCcw","FiRotateCw","FiEdit3","FiTrash","FiDroplet","width","TEMPLATE_INFO","StructuredMemoTemplates","memos","onSaveMemo","onDeleteMemo","showNewMemoModal","setShowNewMemoModal","selectedTemplate","setSelectedTemplate","handleOpenNewMemo","templateType","handleSaveMemo","handleDeleteMemo","memoId","exportMemo","memo","text","renderMemoAsText","url","title","date","content","gauge","fit","finish","renderTemplateForm","renderMemoCard","info","FiFileText","ALERT_TYPES","PRIORITIES","CATEGORIES","FiBell","FiRepeat","FiFlag","DISPLAY_STYLES","MagicMarkerManager","currentRow","markers","setMarkers","showModal","setShowModal","fetchMarkers","handleCreate","triggerCondition","resetForm","handleToggle","markerId","handleSnooze","handleComplete","handleDelete","getTriggerDescription","marker","condition","desc","getPriorityClass","priority","pr","isMarkerRelevantNow","offset","sortedMarkers","aRelevant","bRelevant","priorityOrder","aPriority","bPriority","relevantMarkers","isRelevant","isSnoozed","FiToggleRight","FiToggleLeft","cat","LoadingSpinner","size","fullScreen","className","sizeClasses","textSizeClasses","spinner","FiLoader","pdfjs.GlobalWorkerOptions","PatternPreview","selectedPattern","setSelectedPattern","patternFiles","setPatternFiles","numPages","setNumPages","setPageNumber","scale","setScale","fetchPatternFiles","firstPdf","f","files","handlePatternChange","handleFileChange","fileId","onDocumentLoadSuccess","previousPage","nextPage","zoomIn","zoomOut","pdfFiles","FiExternalLink","Document","Page","ProjectDetail","useParams","setProject","setPhotos","showEditModal","setShowEditModal","knittingMode","setKnittingMode","showKnittingVoiceNotes","setShowKnittingVoiceNotes","showKnittingHistory","setShowKnittingHistory","audioNotes","setAudioNotes","structuredMemos","setStructuredMemos","notesTab","setNotesTab","editingNotes","setEditingNotes","notesText","setNotesText","showAddPatternModal","setShowAddPatternModal","showUploadPatternModal","setShowUploadPatternModal","showAddYarnModal","setShowAddYarnModal","showAddToolModal","setShowAddToolModal","availablePatterns","setAvailablePatterns","availableYarn","setAvailableYarn","availableTools","setAvailableTools","availableRecipients","setAvailableRecipients","selectedPatternId","setSelectedPatternId","selectedYarnId","setSelectedYarnId","yarnQuantity","setYarnQuantity","selectedToolId","setSelectedToolId","uploadingPattern","setUploadingPattern","newPatternData","setNewPatternData","patternFile","setPatternFile","fetchProject","fetchPhotos","fetchAvailableItems","fetchAudioNotes","projectData","toolsRes","handleUpdate","handleEditNotes","handleSaveNotes","handleCancelNotes","handleAddPattern","handleRemovePattern","handleUploadPattern","newPattern","fileFormData","handleAddYarn","handleRemoveYarn","yarnId","handleAddTool","handleRemoveTool","toolId","fetchStructuredMemos","handleSaveAudioNote","durationSeconds","transcription","handleDeleteAudioNote","handleUpdateAudioTranscription","handleSaveStructuredMemo","handleDeleteStructuredMemo","handleToggleKnittingMode","counterValues","handlePhotoUpload","handlePhotoDelete","photoId","getYarnPercentage","remaining","total","selectedRecipient","FiArrowLeft","FiEyeOff","FiEye","FiImage","isLowStock","pp","pt","BOOKMARK_COLORS","BookmarkManager","currentPage","currentZoom","onJumpToBookmark","bookmarks","setBookmarks","editingBookmark","setEditingBookmark","fetchBookmarks","params","handleCreateBookmark","handleUpdateBookmark","handleDeleteBookmark","bookmarkId","handleQuickBookmark","openCreateModal","openEditModal","bookmark","FiBookmark","HIGHLIGHT_COLORS","PatternHighlighter","highlights","setHighlights","startPos","setStartPos","currentRect","setCurrentRect","selectedColor","setSelectedColor","opacity","setOpacity","showControls","setShowControls","fetchHighlights","drawHighlights","highlight","getMousePos","handleMouseDown","pos","handleMouseMove","height","handleMouseUp","saveHighlight","coordinates","handleClearAll","h","MARKER_COLORS","RowMarker","onPositionChange","position","setPosition","setHeight","isDragging","setIsDragging","isResizing","setIsResizing","isLocked","setIsLocked","isVisible","setIsVisible","dragStart","setDragStart","newX","newY","handleResizeStart","handleResize","newHeight","FiMove","ZOOM_LEVELS","PatternViewer","fileUrl","filename","onClose","fullscreen","setCurrentPage","zoomIndex","setZoomIndex","rotation","setRotation","searchText","setSearchText","showSearch","setShowSearch","_isFullscreen","setIsFullscreen","showBookmarks","setShowBookmarks","showRowMarker","setShowRowMarker","showHighlighter","setShowHighlighter","zoomLevel","onDocumentLoadError","handleRotate","handleNextPage","handlePrevPage","handlePageJump","page","toggleFullscreen","handleJumpToBookmark","zoomIdx","z","handleFullscreenChange","FiMaximize","PDFCollation","setPatterns","selectedPatterns","setSelectedPatterns","addDividers","setAddDividers","dividerText","setDividerText","collationResult","setCollationResult","setError","fetchPatterns","err","handlePatternToggle","handleMoveUp","newOrder","handleMoveDown","handleCollate","getPatternName","formatFileSize","bytes","Patterns","showCollationModal","setShowCollationModal","editingPattern","setEditingPattern","uploadingFiles","setUploadingFiles","handleCreatePattern","uploadedCount","handleEditClick","handleUpdatePattern","handleDeletePattern","getDifficultyColor","difficulty","PatternFileUpload","onDownload","description","setDescription","viewingFile","setViewingFile","acceptedTypes","fileName","hasValidExtension","ext","hasValidMimeType","fileSizeMB","getFileIcon","fileType","FiFile","PatternDetail","setPattern","setFiles","selectedPdfFile","setSelectedPdfFile","fetchPattern","pdfFile","axiosError","handleFileUpload","formDataObj","handleFileDownload","handleFileDelete","FiGrid","YarnStash","setYarn","editingYarn","setEditingYarn","yarnPhotos","setYarnPhotos","uploadingPhoto","setUploadingPhoto","fetchYarn","handleCreateYarn","handleUpdateYarn","handleDeleteYarn","getWeightColor","weight","Tools","setTools","editingTool","setEditingTool","fetchTools","handleCreateTool","handleUpdateTool","handleDeleteTool","Recipients","setRecipients","editingRecipient","setEditingRecipient","fetchRecipients","handleCreateRecipient","recipient","handleUpdateRecipient","handleDeleteRecipient","Profile","remainingHours","StatCard","label","icon","sublabel","ActivityGraph","formatTooltipDate","dateStr","formatAxisDate","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","Line","RecentProjectsList","Stats","timePeriod","setTimePeriod","fetchStats","periodLabels","period","FiLayers","FiAward","Login","setEmail","setPassword","setRememberMe","isLoading","setIsLoading","login","message","Register","ForgotPassword","ResetPassword","VerifyEmail","NotFound","PrivateRoute","isAuthenticated","Navigate","PublicRoute","App","Routes","Route","ErrorBoundary","Component","errorInfo","csrfToken","fetchCsrfToken","getCsrfToken","unsafeMethods","originalRequest","retryError","retryCount","retryAfter","registrations","registration","cacheNames","cacheName","queryClient","QueryClient","rootElement","ReactDOM","QueryClientProvider","BrowserRouter","ToastContainer"],"ignoreList":[6],"sources":["../../src/stores/authStore.ts","../../src/components/PWAInstallPrompt.tsx","../../src/components/OfflineIndicator.tsx","../../src/components/GlobalSearch.tsx","../../src/stores/themeStore.ts","../../src/components/ThemeToggle.tsx","../../node_modules/idb/build/index.js","../../src/utils/offline/db.ts","../../src/utils/offline/syncManager.tsx","../../src/components/offline/SyncIndicator.tsx","../../src/components/offline/ConflictResolver.tsx","../../src/components/layouts/MainLayout.tsx","../../src/components/layouts/AuthLayout.tsx","../../src/pages/Dashboard.tsx","../../src/pages/Projects.tsx","../../src/components/PhotoGallery.tsx","../../src/components/FileUpload.tsx","../../src/components/counters/CounterForm.tsx","../../src/components/counters/CounterHierarchy.tsx","../../src/components/sessions/SessionTimer.tsx","../../src/components/sessions/SessionHistory.tsx","../../src/components/sessions/ProjectTimer.tsx","../../src/components/sessions/SessionManager.tsx","../../src/contexts/WebSocketContext.tsx","../../src/components/notes/AudioNotes.tsx","../../src/components/notes/HandwrittenNotes.tsx","../../src/components/notes/StructuredMemoTemplates.tsx","../../src/components/magic-markers/MagicMarkerManager.tsx","../../src/components/LoadingSpinner.tsx","../../src/components/PatternPreview.tsx","../../src/pages/ProjectDetail.tsx","../../src/components/patterns/BookmarkManager.tsx","../../src/components/patterns/PatternHighlighter.tsx","../../src/components/patterns/RowMarker.tsx","../../src/components/patterns/PatternViewer.tsx","../../src/components/patterns/PDFCollation.tsx","../../src/pages/Patterns.tsx","../../src/components/PatternFileUpload.tsx","../../src/pages/PatternDetail.tsx","../../src/pages/YarnStash.tsx","../../src/pages/Tools.tsx","../../src/pages/Recipients.tsx","../../src/pages/Profile.tsx","../../src/pages/Stats.tsx","../../src/pages/auth/Login.tsx","../../src/pages/auth/Register.tsx","../../src/pages/auth/ForgotPassword.tsx","../../src/pages/auth/ResetPassword.tsx","../../src/pages/auth/VerifyEmail.tsx","../../src/pages/NotFound.tsx","../../src/App.tsx","../../src/components/ErrorBoundary.tsx","../../src/lib/axios.ts","../../src/main.tsx"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport axios from 'axios'; // Uses globally configured axios from lib/axios\n\ninterface User {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  emailVerified: boolean;\n}\n\ninterface AuthState {\n  user: User | null;\n  accessToken: string | null;\n  isAuthenticated: boolean;\n  login: (email: string, password: string, rememberMe?: boolean) => Promise<void>;\n  register: (data: any) => Promise<void>;\n  logout: () => Promise<void>;\n  setUser: (user: User) => void;\n  setToken: (token: string) => void;\n  checkAuth: () => Promise<void>;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set, get) => ({\n      user: null,\n      accessToken: null,\n      isAuthenticated: false,\n\n      login: async (email: string, password: string, rememberMe?: boolean) => {\n        const response = await axios.post('/api/auth/login', {\n          email,\n          password,\n          rememberMe,\n        });\n\n        const { user, accessToken } = response.data.data;\n\n        set({\n          user,\n          accessToken,\n          isAuthenticated: true,\n        });\n\n        // Set axios default header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n      },\n\n      register: async (data: any) => {\n        await axios.post('/api/auth/register', data);\n      },\n\n      logout: async () => {\n        try {\n          await axios.post('/api/auth/logout');\n        } catch (error) {\n          console.error('Logout error:', error);\n        } finally {\n          set({\n            user: null,\n            accessToken: null,\n            isAuthenticated: false,\n          });\n\n          delete axios.defaults.headers.common['Authorization'];\n        }\n      },\n\n      setUser: (user: User) => {\n        set({ user });\n      },\n\n      setToken: (token: string) => {\n        set({ accessToken: token });\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      },\n\n      checkAuth: async () => {\n        const { accessToken } = get();\n\n        if (!accessToken) {\n          return;\n        }\n\n        try {\n          axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n\n          const response = await axios.get('/api/auth/profile');\n          const { user } = response.data.data;\n\n          set({\n            user,\n            isAuthenticated: true,\n          });\n        } catch (error) {\n          console.error('Auth check failed:', error);\n          set({\n            user: null,\n            accessToken: null,\n            isAuthenticated: false,\n          });\n\n          delete axios.defaults.headers.common['Authorization'];\n        }\n      },\n    }),\n    {\n      name: 'rowly-auth',\n      partialize: (state) => ({\n        user: state.user,\n        accessToken: state.accessToken,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n);\n\n// Initialize auth on app load - TEMPORARILY DISABLED FOR DEBUGGING\n// This was causing blank page issues\n// Only run checkAuth in browser environment after hydration\n// if (typeof window !== 'undefined') {\n//   // Delay checkAuth to avoid blocking initial render\n//   // Only run if we have a token in storage\n//   setTimeout(() => {\n//     const state = useAuthStore.getState();\n//     if (state.accessToken) {\n//       state.checkAuth().catch((error) => {\n//         console.error('checkAuth failed on initialization:', error);\n//       });\n//     }\n//   }, 500); // Delay to ensure React is fully mounted\n// }\n","import { useState, useEffect } from 'react';\nimport { FiDownload, FiX } from 'react-icons/fi';\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\nexport default function PWAInstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n\n  useEffect(() => {\n    const handleBeforeInstallPrompt = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n\n      // Check if user has dismissed the prompt before\n      const dismissed = localStorage.getItem('pwa-install-dismissed');\n      if (!dismissed) {\n        setShowPrompt(true);\n      }\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    };\n  }, []);\n\n  const handleInstall = async () => {\n    if (!deferredPrompt) return;\n\n    // Show the install prompt\n    await deferredPrompt.prompt();\n\n    // Wait for the user's response\n    const { outcome } = await deferredPrompt.userChoice;\n\n    if (outcome === 'accepted') {\n      console.log('User accepted the install prompt');\n    } else {\n      console.log('User dismissed the install prompt');\n    }\n\n    // Clear the deferred prompt\n    setDeferredPrompt(null);\n    setShowPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    // Remember dismissal for 30 days\n    const dismissedUntil = Date.now() + (30 * 24 * 60 * 60 * 1000);\n    localStorage.setItem('pwa-install-dismissed', dismissedUntil.toString());\n  };\n\n  if (!showPrompt || !deferredPrompt) {\n    return null;\n  }\n\n  return (\n    <div\n      className=\"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-purple-200 dark:border-purple-700 p-6 z-50 animate-slide-up\"\n      role=\"dialog\"\n      aria-labelledby=\"pwa-install-title\"\n      aria-describedby=\"pwa-install-description\"\n    >\n      <button\n        onClick={handleDismiss}\n        className=\"absolute top-2 right-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition\"\n        aria-label=\"Dismiss install prompt\"\n      >\n        <FiX className=\"h-5 w-5\" aria-hidden=\"true\" />\n      </button>\n\n      <div className=\"flex items-start gap-4\">\n        <div className=\"flex-shrink-0\">\n          <div className=\"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center\">\n            <FiDownload className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" aria-hidden=\"true\" />\n          </div>\n        </div>\n\n        <div className=\"flex-1\">\n          <h3\n            id=\"pwa-install-title\"\n            className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-1\"\n          >\n            Install Rowly App\n          </h3>\n          <p\n            id=\"pwa-install-description\"\n            className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\"\n          >\n            Install Rowly on your device for quick access and offline use!\n          </p>\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={handleInstall}\n              className=\"flex-1 px-4 py-2 bg-purple-600 dark:bg-purple-700 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition font-medium\"\n              aria-label=\"Install Rowly app\"\n            >\n              Install\n            </button>\n            <button\n              onClick={handleDismiss}\n              className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\n              aria-label=\"Dismiss for now\"\n            >\n              Not now\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiWifiOff, FiWifi } from 'react-icons/fi';\n\nexport default function OfflineIndicator() {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [showBanner, setShowBanner] = useState(false);\n\n  useEffect(() => {\n    const handleOnline = () => {\n      setIsOnline(true);\n      setShowBanner(true);\n      setTimeout(() => setShowBanner(false), 3000);\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      setShowBanner(true);\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  if (!showBanner && isOnline) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ${\n        showBanner ? 'translate-y-0' : '-translate-y-full'\n      }`}\n      role=\"status\"\n      aria-live=\"polite\"\n      aria-atomic=\"true\"\n    >\n      <div\n        className={`px-4 py-3 text-center text-white font-medium ${\n          isOnline ? 'bg-green-600' : 'bg-orange-600'\n        }`}\n      >\n        <div className=\"flex items-center justify-center gap-2\">\n          {isOnline ? (\n            <>\n              <FiWifi className=\"h-5 w-5\" aria-hidden=\"true\" />\n              <span>Back online! Your changes will sync automatically.</span>\n            </>\n          ) : (\n            <>\n              <FiWifiOff className=\"h-5 w-5\" aria-hidden=\"true\" />\n              <span>You're offline. Changes will sync when you reconnect.</span>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { FiSearch, FiX } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface SearchResult {\n  id: string;\n  type: 'project' | 'pattern' | 'yarn' | 'recipient' | 'tool';\n  title: string;\n  subtitle?: string;\n  url: string;\n}\n\nexport default function GlobalSearch() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<SearchResult[]>([]);\n  const [loading, setLoading] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const navigate = useNavigate();\n\n  // Keyboard shortcut: Cmd/Ctrl + K\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n        e.preventDefault();\n        setIsOpen(true);\n      }\n      if (e.key === 'Escape') {\n        setIsOpen(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  // Focus input when modal opens\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isOpen]);\n\n  // Search debounced\n  useEffect(() => {\n    if (!query.trim()) {\n      setResults([]);\n      return;\n    }\n\n    const timer = setTimeout(async () => {\n      await performSearch(query);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [query]);\n\n  const performSearch = async (searchQuery: string) => {\n    setLoading(true);\n    try {\n      const [projects, patterns, yarn, recipients, tools] = await Promise.all([\n        axios.get(`/api/projects?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { projects: [] } } })),\n        axios.get(`/api/patterns?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { patterns: [] } } })),\n        axios.get(`/api/yarn?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { yarn: [] } } })),\n        axios.get(`/api/recipients?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { recipients: [] } } })),\n        axios.get(`/api/tools?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { tools: [] } } })),\n      ]);\n\n      const searchResults: SearchResult[] = [];\n\n      // Projects\n      projects.data.data.projects?.slice(0, 5).forEach((p: any) => {\n        searchResults.push({\n          id: p.id,\n          type: 'project',\n          title: p.name,\n          subtitle: p.description || p.status,\n          url: `/projects/${p.id}`,\n        });\n      });\n\n      // Patterns\n      patterns.data.data.patterns?.slice(0, 3).forEach((p: any) => {\n        searchResults.push({\n          id: p.id,\n          type: 'pattern',\n          title: p.name,\n          subtitle: p.designer || p.pattern_type,\n          url: '/patterns',\n        });\n      });\n\n      // Yarn\n      yarn.data.data.yarn?.slice(0, 3).forEach((y: any) => {\n        searchResults.push({\n          id: y.id,\n          type: 'yarn',\n          title: `${y.brand} ${y.name}`,\n          subtitle: `${y.color_name || ''} - ${y.weight || ''}`,\n          url: '/yarn',\n        });\n      });\n\n      // Recipients\n      recipients.data.data.recipients?.slice(0, 2).forEach((r: any) => {\n        searchResults.push({\n          id: r.id,\n          type: 'recipient',\n          title: r.name,\n          subtitle: r.relationship,\n          url: '/recipients',\n        });\n      });\n\n      // Tools\n      tools.data.data.tools?.slice(0, 2).forEach((t: any) => {\n        searchResults.push({\n          id: t.id,\n          type: 'tool',\n          title: t.name,\n          subtitle: t.tool_type,\n          url: '/tools',\n        });\n      });\n\n      setResults(searchResults);\n    } catch (error) {\n      console.error('Search error:', error);\n      toast.error('Search failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleResultClick = (result: SearchResult) => {\n    navigate(result.url);\n    setIsOpen(false);\n    setQuery('');\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'project': return 'bg-purple-100 text-purple-800';\n      case 'pattern': return 'bg-blue-100 text-blue-800';\n      case 'yarn': return 'bg-pink-100 text-pink-800';\n      case 'recipient': return 'bg-green-100 text-green-800';\n      case 'tool': return 'bg-orange-100 text-orange-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (!isOpen) {\n    return (\n      <button\n        onClick={() => setIsOpen(true)}\n        className=\"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition\"\n        aria-label=\"Open global search\"\n        title=\"Search (K)\"\n      >\n        <FiSearch className=\"h-4 w-4\" />\n        <span>Search</span>\n        <kbd className=\"hidden sm:inline-block px-2 py-0.5 text-xs font-semibold text-gray-500 bg-gray-200 border border-gray-300 rounded\">\n          K\n        </kbd>\n      </button>\n    );\n  }\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20 px-4\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Global search\"\n      onClick={(e) => {\n        if (e.target === e.currentTarget) {\n          setIsOpen(false);\n          setQuery('');\n        }\n      }}\n    >\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[60vh] flex flex-col\">\n        {/* Search Input */}\n        <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center gap-3\">\n            <FiSearch className=\"h-5 w-5 text-gray-400\" aria-hidden=\"true\" />\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Search projects, patterns, yarn, and more...\"\n              className=\"flex-1 outline-none text-lg bg-transparent text-gray-900 dark:text-gray-100\"\n              aria-label=\"Search input\"\n              autoComplete=\"off\"\n            />\n            <button\n              onClick={() => {\n                setIsOpen(false);\n                setQuery('');\n              }}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              aria-label=\"Close search\"\n            >\n              <FiX className=\"h-5 w-5\" aria-hidden=\"true\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Results */}\n        <div\n          className=\"flex-1 overflow-y-auto p-2\"\n          role=\"region\"\n          aria-live=\"polite\"\n          aria-label=\"Search results\"\n        >\n          {loading && (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\" role=\"status\">\n              Searching...\n            </div>\n          )}\n\n          {!loading && query && results.length === 0 && (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\" role=\"status\">\n              No results found\n            </div>\n          )}\n\n          {!loading && results.length > 0 && (\n            <div className=\"space-y-1\" role=\"list\">\n              {results.map((result) => (\n                <button\n                  key={`${result.type}-${result.id}`}\n                  onClick={() => handleResultClick(result)}\n                  className=\"w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition flex items-center justify-between\"\n                  role=\"listitem\"\n                  aria-label={`${result.type}: ${result.title}${result.subtitle ? ` - ${result.subtitle}` : ''}`}\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium text-gray-900 dark:text-gray-100\">{result.title}</div>\n                    {result.subtitle && (\n                      <div className=\"text-sm text-gray-500 dark:text-gray-400\">{result.subtitle}</div>\n                    )}\n                  </div>\n                  <span className={`px-2 py-1 text-xs font-medium rounded ${getTypeColor(result.type)}`}>\n                    {result.type}\n                  </span>\n                </button>\n              ))}\n            </div>\n          )}\n\n          {!loading && !query && (\n            <div className=\"py-8 text-center text-gray-500 dark:text-gray-400\">\n              <p className=\"mb-2\">Start typing to search</p>\n              <p className=\"text-sm\">Projects, patterns, yarn, recipients, and tools</p>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between\">\n          <span>Press ESC to close</span>\n          <span>K to open</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\ntype Theme = 'light' | 'dark';\n\ninterface ThemeState {\n  theme: Theme;\n  toggleTheme: () => void;\n  setTheme: (theme: Theme) => void;\n}\n\nexport const useThemeStore = create<ThemeState>()(\n  persist(\n    (set) => ({\n      theme: 'light',\n\n      toggleTheme: () => {\n        set((state) => {\n          const newTheme = state.theme === 'light' ? 'dark' : 'light';\n          applyTheme(newTheme);\n          return { theme: newTheme };\n        });\n      },\n\n      setTheme: (theme: Theme) => {\n        applyTheme(theme);\n        set({ theme });\n      },\n    }),\n    {\n      name: 'rowly-theme',\n      onRehydrateStorage: () => (state) => {\n        // Apply theme after rehydration\n        if (state?.theme) {\n          applyTheme(state.theme);\n        }\n      },\n    }\n  )\n);\n\n// Helper function to apply theme to document\nfunction applyTheme(theme: Theme) {\n  // Guard against SSR or early module execution before DOM is ready\n  if (typeof window === 'undefined' || typeof document === 'undefined') {\n    return;\n  }\n\n  const root = document.documentElement;\n  if (!root) {\n    return;\n  }\n\n  if (theme === 'dark') {\n    root.classList.add('dark');\n  } else {\n    root.classList.remove('dark');\n  }\n}\n\n// Initialize theme on load - only if DOM is ready\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  // Use requestAnimationFrame to ensure DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      const { theme } = useThemeStore.getState();\n      applyTheme(theme);\n    });\n  } else {\n    // DOM is already ready\n    const { theme } = useThemeStore.getState();\n    applyTheme(theme);\n  }\n}\n","import { FiSun, FiMoon } from 'react-icons/fi';\nimport { useThemeStore } from '../stores/themeStore';\n\nexport default function ThemeToggle() {\n  const { theme, toggleTheme } = useThemeStore();\n\n  return (\n    <button\n      onClick={toggleTheme}\n      className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200\"\n      aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}\n      title={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}\n    >\n      {theme === 'light' ? (\n        <FiMoon className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" />\n      ) : (\n        <FiSun className=\"w-5 h-5 text-yellow-500\" />\n      )}\n    </button>\n  );\n}\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n","// @ts-nocheck\nimport { openDB, DBSchema, IDBPDatabase } from 'idb';\n\ninterface RowlyOfflineDB extends DBSchema {\n  patterns: {\n    key: string;\n    value: {\n      id: string;\n      name: string;\n      file_url: string;\n      data: any;\n      cached_at: string;\n    };\n  };\n  'pdf-cache': {\n    key: string;\n    value: {\n      patternId: string;\n      blob: Blob;\n      cached_at: string;\n    };\n  };\n  counters: {\n    key: string;\n    value: {\n      id: string;\n      project_id: string;\n      value: number;\n      updated_at: number;\n      synced: boolean;\n    };\n  };\n  'sync-queue': {\n    key: number;\n    value: {\n      id?: number;\n      type: string;\n      endpoint: string;\n      method: 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n      data: any;\n      timestamp: number;\n      synced: boolean;\n      retries: number;\n    };\n    autoIncrement: true;\n  };\n  projects: {\n    key: string;\n    value: {\n      id: string;\n      data: any;\n      cached_at: string;\n    };\n  };\n  sessions: {\n    key: string;\n    value: {\n      id: string;\n      project_id: string;\n      data: any;\n      cached_at: string;\n      synced: boolean;\n    };\n  };\n  notes: {\n    key: string;\n    value: {\n      id: string;\n      type: 'audio' | 'handwritten' | 'structured';\n      data: any;\n      cached_at: string;\n      synced: boolean;\n    };\n  };\n}\n\nconst DB_NAME = 'rowly-offline';\nconst DB_VERSION = 1;\n\nlet dbInstance: IDBPDatabase<RowlyOfflineDB> | null = null;\n\nexport const initDB = async (): Promise<IDBPDatabase<RowlyOfflineDB>> => {\n  if (dbInstance) return dbInstance;\n    // @ts-ignore\n\n  dbInstance = await openDB<RowlyOfflineDB>(DB_NAME, DB_VERSION, {\n    upgrade(db, oldVersion, newVersion, transaction) {\n      // Pattern files\n      if (!db.objectStoreNames.contains('patterns')) {\n        db.createObjectStore('patterns', { keyPath: 'id' });\n      }\n\n      // PDF cache\n      if (!db.objectStoreNames.contains('pdf-cache')) {\n        db.createObjectStore('pdf-cache', { keyPath: 'patternId' });\n      }\n\n      // Counters\n      if (!db.objectStoreNames.contains('counters')) {\n        const counterStore = db.createObjectStore('counters', { keyPath: 'id' });\n        // @ts-ignore - IndexedDB typing complexity\n        counterStore.createIndex('project_id', 'project_id');\n        // @ts-ignore - IndexedDB typing complexity\n        counterStore.createIndex('synced', 'synced');\n      }\n\n      // Sync queue\n      if (!db.objectStoreNames.contains('sync-queue')) {\n        const syncStore = db.createObjectStore('sync-queue', {\n          keyPath: 'id',\n          autoIncrement: true,\n        });\n        // @ts-ignore - IndexedDB typing complexity\n        syncStore.createIndex('synced', 'synced');\n        // @ts-ignore - IndexedDB typing complexity\n        syncStore.createIndex('timestamp', 'timestamp');\n      }\n\n      // Projects\n      if (!db.objectStoreNames.contains('projects')) {\n        db.createObjectStore('projects', { keyPath: 'id' });\n      }\n\n      // Sessions\n      if (!db.objectStoreNames.contains('sessions')) {\n        const sessionStore = db.createObjectStore('sessions', { keyPath: 'id' });\n        // @ts-ignore - IndexedDB typing complexity\n        sessionStore.createIndex('project_id', 'project_id');\n        // @ts-ignore - IndexedDB typing complexity\n        sessionStore.createIndex('synced', 'synced');\n      }\n\n      // Notes\n      if (!db.objectStoreNames.contains('notes')) {\n        const noteStore = db.createObjectStore('notes', { keyPath: 'id' });\n        // @ts-ignore - IndexedDB typing complexity\n        noteStore.createIndex('type', 'type');\n        // @ts-ignore - IndexedDB typing complexity\n        noteStore.createIndex('synced', 'synced');\n      }\n    },\n  });\n\n  return dbInstance;\n};\n\nexport const getDB = async (): Promise<IDBPDatabase<RowlyOfflineDB>> => {\n  if (!dbInstance) {\n    return initDB();\n  }\n  return dbInstance;\n};\n\n// Pattern operations\nexport const cachePattern = async (pattern: any) => {\n  const db = await getDB();\n  await db.put('patterns', {\n    id: pattern.id,\n    name: pattern.name,\n    file_url: pattern.file_url,\n    data: pattern,\n    cached_at: new Date().toISOString(),\n  });\n};\n\nexport const getPatternFromCache = async (patternId: string) => {\n  const db = await getDB();\n  return db.get('patterns', patternId);\n};\n\nexport const getAllCachedPatterns = async () => {\n  const db = await getDB();\n  return db.getAll('patterns');\n};\n\n// PDF cache operations\nexport const cachePDF = async (patternId: string, blob: Blob) => {\n  const db = await getDB();\n  await db.put('pdf-cache', {\n    patternId,\n    blob,\n    cached_at: new Date().toISOString(),\n  });\n};\n\nexport const getPDFFromCache = async (patternId: string) => {\n  const db = await getDB();\n  return db.get('pdf-cache', patternId);\n};\n\n// Counter operations\nexport const cacheCounter = async (counter: any, synced = true) => {\n  const db = await getDB();\n  await db.put('counters', {\n    id: counter.id,\n    project_id: counter.project_id,\n    value: counter.current_value,\n    updated_at: Date.now(),\n    synced,\n  });\n};\n\nexport const getCounterFromCache = async (counterId: string) => {\n  const db = await getDB();\n  return db.get('counters', counterId);\n};\n\nexport const getProjectCountersFromCache = async (projectId: string) => {\n      // @ts-ignore\n  const db = await getDB();\n  const index = db.transaction('counters').store.index('project_id');\n      // @ts-ignore\n  return index.getAll(projectId);\n};\n\n// Sync queue operations\nexport const addToSyncQueue = async (item: {\n  type: string;\n  endpoint: string;\n  method: 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n  data: any;\n}) => {\n  const db = await getDB();\n  await db.add('sync-queue', {\n    ...item,\n    timestamp: Date.now(),\n    synced: false,\n    retries: 0,\n  });\n};\n\nexport const getSyncQueue = async () => {\n  const db = await getDB();\n  return db.getAll('sync-queue');\n};\n\nexport const getUnsyncedItems = async () => {\n      // @ts-ignore\n  const db = await getDB();\n  const index = db.transaction('sync-queue').store.index('synced');\n      // @ts-ignore\n  return index.getAll(false);\n};\n\nexport const markSyncItemComplete = async (id: number) => {\n  const db = await getDB();\n  const item = await db.get('sync-queue', id);\n  if (item) {\n    await db.put('sync-queue', { ...item, synced: true });\n  }\n};\n\nexport const incrementSyncRetry = async (id: number) => {\n  const db = await getDB();\n  const item = await db.get('sync-queue', id);\n  if (item) {\n    await db.put('sync-queue', { ...item, retries: item.retries + 1 });\n  }\n};\n\nexport const deleteSyncItem = async (id: number) => {\n  const db = await getDB();\n  await db.delete('sync-queue', id);\n};\n\n// Project operations\nexport const cacheProject = async (project: any) => {\n  const db = await getDB();\n  await db.put('projects', {\n    id: project.id,\n    data: project,\n    cached_at: new Date().toISOString(),\n  });\n};\n\nexport const getProjectFromCache = async (projectId: string) => {\n  const db = await getDB();\n  return db.get('projects', projectId);\n};\n\n// Session operations\nexport const cacheSession = async (session: any, synced = true) => {\n  const db = await getDB();\n  await db.put('sessions', {\n    id: session.id,\n    project_id: session.project_id,\n    data: session,\n    cached_at: new Date().toISOString(),\n    synced,\n  });\n};\n\nexport const getSessionFromCache = async (sessionId: string) => {\n  const db = await getDB();\n  return db.get('sessions', sessionId);\n};\n\nexport const getProjectSessionsFromCache = async (projectId: string) => {\n      // @ts-ignore\n  const db = await getDB();\n  const index = db.transaction('sessions').store.index('project_id');\n      // @ts-ignore\n  const sessions = await index.getAll(projectId);\n  return sessions.map((s) => s.data);\n};\n\n// Note operations\nexport const cacheNote = async (note: any, type: 'audio' | 'handwritten' | 'structured', synced = true) => {\n  const db = await getDB();\n  await db.put('notes', {\n    id: note.id,\n    type,\n    data: note,\n    cached_at: new Date().toISOString(),\n    synced,\n  });\n};\n\nexport const getNoteFromCache = async (noteId: string) => {\n  const db = await getDB();\n  return db.get('notes', noteId);\n};\n\nexport const getUnsyncedNotes = async () => {\n      // @ts-ignore\n  const db = await getDB();\n  const index = db.transaction('notes').store.index('synced');\n      // @ts-ignore\n  return index.getAll(false);\n};\n\n// Clear all cache\nexport const clearCache = async () => {\n  const db = await getDB();\n  const stores = ['patterns', 'pdf-cache', 'counters', 'projects', 'sessions', 'notes'];\n\n  for (const store of stores) {\n    await db.clear(store as any);\n  }\n};\n\n// Get cache size estimate\nexport const getCacheSize = async (): Promise<number> => {\n  if ('storage' in navigator && 'estimate' in navigator.storage) {\n    const estimate = await navigator.storage.estimate();\n    return estimate.usage || 0;\n  }\n  return 0;\n};\n","import React from 'react';\nimport axios from 'axios';\nimport {\n  getUnsyncedItems,\n  markSyncItemComplete,\n  incrementSyncRetry,\n  deleteSyncItem,\n  getSyncQueue,\n} from './db';\n\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY = 2000; // Start with 2 seconds\n\nexport interface SyncStatus {\n  isSyncing: boolean;\n  pendingCount: number;\n  failedCount: number;\n  lastSyncTime?: Date;\n}\n\nclass SyncManager {\n  private isSyncing = false;\n  private syncListeners: Set<(status: SyncStatus) => void> = new Set();\n\n  constructor() {\n    // Listen for online/offline events\n    window.addEventListener('online', () => this.handleOnline());\n    window.addEventListener('offline', () => this.handleOffline());\n  }\n\n  /**\n   * Subscribe to sync status updates\n   */\n  onSyncStatusChange(callback: (status: SyncStatus) => void) {\n    this.syncListeners.add(callback);\n    return () => this.syncListeners.delete(callback);\n  }\n\n  /**\n   * Notify all listeners of sync status change\n   */\n  private notifyListeners(status: SyncStatus) {\n    this.syncListeners.forEach((listener) => listener(status));\n  }\n\n  /**\n   * Get current sync status\n   */\n  async getSyncStatus(): Promise<SyncStatus> {\n    const queue = await getSyncQueue();\n    const pending = queue.filter((item) => !item.synced);\n    const failed = pending.filter((item) => item.retries >= MAX_RETRIES);\n\n    return {\n      isSyncing: this.isSyncing,\n      pendingCount: pending.length,\n      failedCount: failed.length,\n      lastSyncTime: undefined, // Could track this in localStorage\n    };\n  }\n\n  /**\n   * Handle when device comes online\n   */\n  private async handleOnline() {\n    console.log('Device is online, starting sync...');\n    await this.processSyncQueue();\n  }\n\n  /**\n   * Handle when device goes offline\n   */\n  private handleOffline() {\n    console.log('Device is offline');\n    this.isSyncing = false;\n  }\n\n  /**\n   * Process the sync queue\n   */\n  async processSyncQueue(): Promise<void> {\n    if (this.isSyncing) {\n      console.log('Sync already in progress');\n      return;\n    }\n\n    if (!navigator.onLine) {\n      console.log('Device is offline, skipping sync');\n      return;\n    }\n\n    this.isSyncing = true;\n    this.notifyListeners(await this.getSyncStatus());\n\n    try {\n      const unsyncedItems = await getUnsyncedItems();\n      console.log(`Processing ${unsyncedItems.length} unsynced items`);\n\n      for (const item of unsyncedItems) {\n        // Skip items that have exceeded max retries\n        if (item.retries >= MAX_RETRIES) {\n          console.error(`Item ${item.id} has exceeded max retries, skipping`);\n          continue;\n        }\n\n        try {\n          await this.syncItem(item);\n          await markSyncItemComplete(item.id!);\n          console.log(`Successfully synced item ${item.id}`);\n        } catch (error) {\n          console.error(`Failed to sync item ${item.id}:`, error);\n          await incrementSyncRetry(item.id!);\n\n          // Exponential backoff\n          const delay = RETRY_DELAY * Math.pow(2, item.retries);\n          await this.sleep(delay);\n        }\n      }\n\n      // Notify listeners that sync is complete\n      this.notifyListeners(await this.getSyncStatus());\n    } catch (error) {\n      console.error('Error processing sync queue:', error);\n    } finally {\n      this.isSyncing = false;\n    }\n  }\n\n  /**\n   * Sync a single item\n   */\n  private async syncItem(item: any): Promise<void> {\n    const config = {\n      method: item.method,\n      url: item.endpoint,\n      data: item.data,\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    await axios(config);\n  }\n\n  /**\n   * Manually trigger sync\n   */\n  async sync(): Promise<void> {\n    return this.processSyncQueue();\n  }\n\n  /**\n   * Clear sync queue (useful for debugging/testing)\n   */\n  async clearQueue(): Promise<void> {\n    const queue = await getSyncQueue();\n    for (const item of queue) {\n      if (item.id) {\n        await deleteSyncItem(item.id);\n      }\n    }\n    this.notifyListeners(await this.getSyncStatus());\n  }\n\n  /**\n   * Get failed sync items (exceeded max retries)\n   */\n  async getFailedItems() {\n    const queue = await getSyncQueue();\n    return queue.filter((item) => !item.synced && item.retries >= MAX_RETRIES);\n  }\n\n  /**\n   * Retry failed items\n   */\n  async retryFailed(): Promise<void> {\n    const failed = await this.getFailedItems();\n    for (const item of failed) {\n      if (item.id) {\n        // Reset retries to 0\n        const db = await import('./db').then((m) => m.getDB());\n        await db.put('sync-queue', { ...item, retries: 0 });\n      }\n    }\n    await this.processSyncQueue();\n  }\n\n  /**\n   * Sleep utility\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\n// Singleton instance\nexport const syncManager = new SyncManager();\n\n/**\n * React hook for sync status\n */\n      // Cleanup\n      // @ts-ignore - cleanup function return type\nexport const useSyncStatus = (callback: (status: SyncStatus) => void) => {\n    // @ts-ignore\n  React.useEffect(() => {\n    const unsubscribe = syncManager.onSyncStatusChange(callback);\n\n    // Get initial status\n    syncManager.getSyncStatus().then(callback);\n\n    return unsubscribe;\n  }, [callback]);\n};\n","// @ts-nocheck\nimport React, { useState, useCallback } from 'react';\nimport { FiCloud, FiCloudOff, FiRefreshCw, FiAlertCircle, FiCheckCircle, FiX } from 'react-icons/fi';\nimport { syncManager, SyncStatus } from '../../utils/offline/syncManager';\n\nexport const SyncIndicator: React.FC = () => {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [syncStatus, setSyncStatus] = useState<SyncStatus>({\n    isSyncing: false,\n    pendingCount: 0,\n    failedCount: 0,\n  });\n  const [showDetails, setShowDetails] = useState(false);\n  const [failedItems, setFailedItems] = useState<any[]>([]);\n\n  // Update online status\n  React.useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  // Subscribe to sync status updates\n  React.useEffect(() => {\n    const unsubscribe = syncManager.onSyncStatusChange((status) => {\n      setSyncStatus(status);\n    });\n\n    // Get initial status\n    syncManager.getSyncStatus().then(setSyncStatus);\n\n    return () => {\n      if (typeof unsubscribe === 'function') {\n        unsubscribe();\n      }\n    };\n  }, []);\n\n  const handleManualSync = async () => {\n    try {\n      await syncManager.sync();\n    } catch (error) {\n      console.error('Manual sync failed:', error);\n    }\n  };\n\n  const handleRetryFailed = async () => {\n    try {\n      await syncManager.retryFailed();\n      setShowDetails(false);\n    } catch (error) {\n      console.error('Retry failed:', error);\n    }\n  };\n\n  const handleShowDetails = async () => {\n    setShowDetails(true);\n    const items = await syncManager.getFailedItems();\n    setFailedItems(items);\n  };\n\n  // Determine indicator color and icon\n  const getStatusColor = () => {\n    if (!isOnline) return 'text-gray-500';\n    if (syncStatus.failedCount > 0) return 'text-red-600';\n    if (syncStatus.pendingCount > 0) return 'text-yellow-600';\n    return 'text-green-600';\n  };\n\n  const getStatusIcon = () => {\n    if (!isOnline) return <FiCloudOff className=\"w-5 h-5\" />;\n    if (syncStatus.isSyncing) return <FiRefreshCw className=\"w-5 h-5 animate-spin\" />;\n    if (syncStatus.failedCount > 0) return <FiAlertCircle className=\"w-5 h-5\" />;\n    if (syncStatus.pendingCount > 0) return <FiCloud className=\"w-5 h-5\" />;\n    return <FiCheckCircle className=\"w-5 h-5\" />;\n  };\n\n  const getStatusText = () => {\n    if (!isOnline) return 'Offline';\n    if (syncStatus.isSyncing) return 'Syncing...';\n    if (syncStatus.failedCount > 0)\n      return `${syncStatus.failedCount} failed`;\n    if (syncStatus.pendingCount > 0)\n      return `${syncStatus.pendingCount} pending`;\n    return 'Synced';\n  };\n\n  return (\n    <>\n      {/* Sync Indicator Button */}\n      <button\n        onClick={isOnline ? handleManualSync : undefined}\n        className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${\n          isOnline\n            ? 'hover:bg-gray-100 dark:hover:bg-gray-700'\n            : 'cursor-not-allowed opacity-70'\n        }`}\n        title={isOnline ? 'Click to sync now' : 'Device is offline'}\n      >\n        <span className={getStatusColor()}>{getStatusIcon()}</span>\n        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n          {getStatusText()}\n        </span>\n      </button>\n\n      {/* Failed Items Details Link */}\n      {syncStatus.failedCount > 0 && (\n        <button\n          onClick={handleShowDetails}\n          className=\"text-xs text-red-600 hover:text-red-700 dark:text-red-400 underline ml-2\"\n        >\n          View failed items\n        </button>\n      )}\n\n      {/* Failed Items Modal */}\n      {showDetails && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[80vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n                <FiAlertCircle className=\"w-6 h-6 text-red-600\" />\n                Sync Conflicts\n              </h3>\n              <button\n                onClick={() => setShowDetails(false)}\n                className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\n              >\n                <FiX className=\"w-6 h-6\" />\n              </button>\n            </div>\n\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n              The following changes could not be synced after {3} attempts. You can retry\n              syncing or resolve them manually.\n            </p>\n\n            {failedItems.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                <FiCheckCircle className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                <p>No failed items</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3 mb-6\">\n                {failedItems.map((item, index) => (\n                  <div\n                    key={item.id || index}\n                    className=\"border border-red-200 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900/20\"\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div>\n                        <div className=\"font-medium text-gray-900 dark:text-white\">\n                          {item.type}\n                        </div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          {item.method} {item.endpoint}\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-red-600 dark:text-red-400\">\n                        {item.retries} retries\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n                      Timestamp: {new Date(item.timestamp).toLocaleString()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setShowDetails(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Close\n              </button>\n              <button\n                onClick={handleRetryFailed}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                Retry All\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiAlertTriangle, FiChevronDown, FiChevronUp } from 'react-icons/fi';\n\nexport interface DataConflict {\n  id: string;\n  resourceType: 'counter' | 'session' | 'note' | 'project';\n  resourceId: string;\n  localValue: any;\n  serverValue: any;\n  lastSyncedValue?: any;\n  field: string;\n  timestamp: number;\n}\n\ninterface ConflictResolverProps {\n  conflicts: DataConflict[];\n  onResolve: (conflictId: string, resolution: 'local' | 'server' | 'merge') => Promise<void>;\n  onResolveAll: (resolution: 'local' | 'server') => Promise<void>;\n}\n\nexport const ConflictResolver: React.FC<ConflictResolverProps> = ({\n  conflicts,\n  onResolve,\n  onResolveAll,\n}) => {\n  const [expandedConflict, setExpandedConflict] = useState<string | null>(null);\n  const [resolving, setResolving] = useState<string | null>(null);\n\n  if (conflicts.length === 0) {\n    return null;\n  }\n\n  const handleResolve = async (conflictId: string, resolution: 'local' | 'server' | 'merge') => {\n    setResolving(conflictId);\n    try {\n      await onResolve(conflictId, resolution);\n    } catch (error) {\n      console.error('Failed to resolve conflict:', error);\n      alert('Failed to resolve conflict');\n    } finally {\n      setResolving(null);\n    }\n  };\n\n  const handleResolveAll = async (resolution: 'local' | 'server') => {\n    if (\n      !confirm(\n        `Are you sure you want to use ${resolution === 'local' ? 'local' : 'server'} version for all conflicts?`\n      )\n    ) {\n      return;\n    }\n\n    try {\n      await onResolveAll(resolution);\n    } catch (error) {\n      console.error('Failed to resolve all conflicts:', error);\n      alert('Failed to resolve conflicts');\n    }\n  };\n\n  const toggleExpand = (conflictId: string) => {\n    setExpandedConflict(expandedConflict === conflictId ? null : conflictId);\n  };\n\n  const renderValue = (value: any): string => {\n    if (typeof value === 'object') {\n      return JSON.stringify(value, null, 2);\n    }\n    return String(value);\n  };\n\n  const getResourceTypeLabel = (type: string): string => {\n    switch (type) {\n      case 'counter':\n        return 'Counter';\n      case 'session':\n        return 'Session';\n      case 'note':\n        return 'Note';\n      case 'project':\n        return 'Project';\n      default:\n        return type;\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-2 border-orange-500\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <FiAlertTriangle className=\"w-6 h-6 text-orange-600\" />\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Sync Conflicts Detected\n        </h3>\n      </div>\n\n      <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n        {conflicts.length} conflict{conflicts.length !== 1 ? 's' : ''} found between your local\n        changes and the server. Please review and resolve each conflict.\n      </p>\n\n      {/* Bulk Actions */}\n      <div className=\"flex gap-3 mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n        <button\n          onClick={() => handleResolveAll('local')}\n          className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm\"\n        >\n          Use Local for All\n        </button>\n        <button\n          onClick={() => handleResolveAll('server')}\n          className=\"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors text-sm\"\n        >\n          Use Server for All\n        </button>\n      </div>\n\n      {/* Conflict List */}\n      <div className=\"space-y-3\">\n        {conflicts.map((conflict) => {\n          const isExpanded = expandedConflict === conflict.id;\n          const isResolving = resolving === conflict.id;\n\n          return (\n            <div\n              key={conflict.id}\n              className=\"border border-orange-200 dark:border-orange-800 rounded-lg overflow-hidden\"\n            >\n              {/* Conflict Header */}\n              <button\n                onClick={() => toggleExpand(conflict.id)}\n                className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors\"\n              >\n                <div className=\"flex items-center gap-3 text-left\">\n                  <FiAlertTriangle className=\"w-5 h-5 text-orange-600 flex-shrink-0\" />\n                  <div>\n                    <div className=\"font-medium text-gray-900 dark:text-white\">\n                      {getResourceTypeLabel(conflict.resourceType)} - {conflict.field}\n                    </div>\n                    <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                      ID: {conflict.resourceId.slice(0, 8)}...\n                    </div>\n                  </div>\n                </div>\n                {isExpanded ? (\n                  <FiChevronUp className=\"w-5 h-5 text-gray-400\" />\n                ) : (\n                  <FiChevronDown className=\"w-5 h-5 text-gray-400\" />\n                )}\n              </button>\n\n              {/* Conflict Details */}\n              {isExpanded && (\n                <div className=\"px-4 py-4 bg-orange-50 dark:bg-orange-900/20 border-t border-orange-200 dark:border-orange-800\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                    {/* Local Version */}\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Your Local Version\n                      </div>\n                      <div className=\"bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-800\">\n                        <pre className=\"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap\">\n                          {renderValue(conflict.localValue)}\n                        </pre>\n                      </div>\n                    </div>\n\n                    {/* Server Version */}\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Server Version\n                      </div>\n                      <div className=\"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700\">\n                        <pre className=\"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap\">\n                          {renderValue(conflict.serverValue)}\n                        </pre>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Last Synced Value (if available) */}\n                  {conflict.lastSyncedValue && (\n                    <div className=\"mb-4\">\n                      <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Last Synced Value (for reference)\n                      </div>\n                      <div className=\"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700\">\n                        <pre className=\"text-xs text-gray-500 dark:text-gray-400 overflow-x-auto whitespace-pre-wrap\">\n                          {renderValue(conflict.lastSyncedValue)}\n                        </pre>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Resolution Actions */}\n                  <div className=\"flex gap-3\">\n                    <button\n                      onClick={() => handleResolve(conflict.id, 'local')}\n                      disabled={isResolving}\n                      className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors\"\n                    >\n                      {isResolving ? 'Resolving...' : 'Use Local'}\n                    </button>\n                    <button\n                      onClick={() => handleResolve(conflict.id, 'server')}\n                      disabled={isResolving}\n                      className=\"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors\"\n                    >\n                      {isResolving ? 'Resolving...' : 'Use Server'}\n                    </button>\n                  </div>\n\n                  <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-3\">\n                    Conflict detected at:{' '}\n                    {new Date(conflict.timestamp).toLocaleString()}\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","import { useState } from 'react';\nimport { Outlet, Link, useNavigate, useLocation } from 'react-router-dom';\nimport { useAuthStore } from '../../stores/authStore';\nimport GlobalSearch from '../GlobalSearch';\nimport ThemeToggle from '../ThemeToggle';\nimport { SyncIndicator } from '../offline/SyncIndicator';\nimport { ConflictResolver, DataConflict } from '../offline/ConflictResolver';\nimport {\n  FiHome,\n  FiFolder,\n  FiBook,\n  FiPackage,\n  FiTool,\n  FiUsers,\n  FiUser,\n  FiLogOut,\n  FiBarChart2\n} from 'react-icons/fi';\n\nexport default function MainLayout() {\n  const { user, logout } = useAuthStore();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [conflicts, setConflicts] = useState<DataConflict[]>([]);\n\n  const handleLogout = async () => {\n    await logout();\n    navigate('/login');\n  };\n\n  const handleResolveConflict = async (conflictId: string, resolution: 'local' | 'server' | 'merge') => {\n    // Remove resolved conflict from state\n    setConflicts(prev => prev.filter(c => c.id !== conflictId));\n    // In a real app, this would sync the resolution to the server\n    console.log(`Resolved conflict ${conflictId} with ${resolution}`);\n  };\n\n  const handleResolveAllConflicts = async (resolution: 'local' | 'server') => {\n    setConflicts([]);\n    console.log(`Resolved all conflicts with ${resolution}`);\n  };\n\n  const navigation = [\n    { name: 'Dashboard', href: '/dashboard', icon: FiHome, shortName: 'Home' },\n    { name: 'Stats', href: '/stats', icon: FiBarChart2, shortName: 'Stats' },\n    { name: 'Projects', href: '/projects', icon: FiFolder, shortName: 'Projects' },\n    { name: 'Patterns', href: '/patterns', icon: FiBook, shortName: 'Patterns' },\n    { name: 'Yarn Stash', href: '/yarn', icon: FiPackage, shortName: 'Stash' },\n    { name: 'Tools', href: '/tools', icon: FiTool, shortName: 'Tools' },\n    { name: 'Recipients', href: '/recipients', icon: FiUsers, shortName: 'Recipients' },\n  ];\n\n  const mainNavigation = navigation.slice(0, 5); // First 5 for mobile bottom nav\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200 pb-20 md:pb-0\">\n      {/* Desktop Sidebar - Hidden on mobile */}\n      <aside className=\"hidden md:fixed md:inset-y-0 md:left-0 md:w-64 md:block bg-white dark:bg-gray-800 shadow-lg transition-colors duration-200\">\n        <div className=\"flex flex-col h-full\">\n          {/* Logo */}\n          <div className=\"flex items-center justify-between px-4 h-16 bg-purple-600 dark:bg-purple-700\">\n            <h1 className=\"text-2xl font-bold text-white\">Rowly</h1>\n            <ThemeToggle />\n          </div>\n\n          {/* Search */}\n          <div className=\"px-4 py-3\">\n            <GlobalSearch />\n          </div>\n\n          {/* Navigation */}\n          <nav className=\"flex-1 overflow-y-auto py-4\" aria-label=\"Main navigation\">\n            {navigation.map((item) => {\n              const Icon = item.icon;\n              const isActive = location.pathname === item.href;\n              return (\n                <Link\n                  key={item.name}\n                  to={item.href}\n                  className={`flex items-center px-6 py-3 text-sm font-medium transition ${\n                    isActive\n                      ? 'bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 border-r-4 border-purple-600 dark:border-purple-400'\n                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-purple-600 dark:hover:text-purple-400'\n                  }`}\n                  aria-label={item.name}\n                  aria-current={isActive ? 'page' : undefined}\n                >\n                  <Icon className=\"mr-3 h-5 w-5\" aria-hidden=\"true\" />\n                  {item.name}\n                </Link>\n              );\n            })}\n          </nav>\n\n          {/* User section */}\n          <div className=\"border-t border-gray-200 dark:border-gray-700 p-4\">\n            <div className=\"flex items-center mb-3\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"h-10 w-10 rounded-full bg-purple-600 dark:bg-purple-700 flex items-center justify-center text-white font-semibold\">\n                  {user?.firstName?.[0]}{user?.lastName?.[0]}\n                </div>\n              </div>\n              <div className=\"ml-3 flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100 truncate\">\n                  {user?.firstName} {user?.lastName}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">{user?.email}</p>\n              </div>\n            </div>\n\n            <Link\n              to=\"/profile\"\n              className=\"flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg mb-2 transition\"\n            >\n              <FiUser className=\"mr-2 h-4 w-4\" />\n              Profile\n            </Link>\n\n            <button\n              onClick={handleLogout}\n              className=\"w-full flex items-center px-3 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\n            >\n              <FiLogOut className=\"mr-2 h-4 w-4\" />\n              Logout\n            </button>\n          </div>\n        </div>\n      </aside>\n\n      {/* Mobile Bottom Navigation */}\n      <nav className=\"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 md:hidden z-40\" aria-label=\"Main navigation\">\n        <div className=\"flex justify-around items-center h-20\">\n          {mainNavigation.map((item) => {\n            const Icon = item.icon;\n            const isActive = location.pathname === item.href;\n            return (\n              <Link\n                key={item.name}\n                to={item.href}\n                className={`flex flex-col items-center justify-center flex-1 h-full min-w-0 ${\n                  isActive\n                    ? 'text-purple-600 dark:text-purple-400'\n                    : 'text-gray-600 dark:text-gray-400'\n                }`}\n                aria-label={item.name}\n                aria-current={isActive ? 'page' : undefined}\n              >\n                <Icon className=\"h-7 w-7 mb-1\" aria-hidden=\"true\" />\n                <span className=\"text-xs font-medium truncate\">{item.shortName}</span>\n              </Link>\n            );\n          })}\n        </div>\n      </nav>\n\n      {/* Main content */}\n      <div className=\"md:ml-64\">\n        {/* Sync Indicator - Fixed position */}\n        <div className=\"fixed top-4 right-4 z-50\">\n          <SyncIndicator />\n        </div>\n\n        {/* Conflict Resolver - Top of content area */}\n        {conflicts.length > 0 && (\n          <div className=\"p-4 md:p-6 lg:p-8 pb-0\">\n            <ConflictResolver\n              conflicts={conflicts}\n              onResolve={handleResolveConflict}\n              onResolveAll={handleResolveAllConflicts}\n            />\n          </div>\n        )}\n\n        <main className=\"p-4 md:p-6 lg:p-8\">\n          <Outlet />\n        </main>\n      </div>\n    </div>\n  );\n}\n","import { Outlet } from 'react-router-dom';\nimport ThemeToggle from '../ThemeToggle';\n\nexport default function AuthLayout() {\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center transition-colors duration-200\">\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle />\n      </div>\n      <div className=\"max-w-md w-full px-4\">\n        <Outlet />\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FiFolder, FiBook, FiPackage, FiUsers, FiPlus, FiAlertCircle } from 'react-icons/fi';\nimport { useAuthStore } from '../stores/authStore';\nimport axios from 'axios';\n\nexport default function Dashboard() {\n  const { user } = useAuthStore();\n  const [stats, setStats] = useState([\n    {\n      name: 'Active Projects',\n      value: '0',\n      icon: FiFolder,\n      href: '/projects',\n      color: 'bg-purple-500',\n    },\n    {\n      name: 'Patterns',\n      value: '0',\n      icon: FiBook,\n      href: '/patterns',\n      color: 'bg-blue-500',\n    },\n    {\n      name: 'Yarn Skeins',\n      value: '0',\n      icon: FiPackage,\n      href: '/yarn',\n      color: 'bg-green-500',\n    },\n    {\n      name: 'Recipients',\n      value: '0',\n      icon: FiUsers,\n      href: '/recipients',\n      color: 'bg-orange-500',\n    },\n  ]);\n  const [loading, setLoading] = useState(true);\n  const [recentProjects, setRecentProjects] = useState<any[]>([]);\n  const [lowStockYarn, setLowStockYarn] = useState<any[]>([]);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, []);\n\n  const fetchDashboardData = async () => {\n    try {\n      const [projectsRes, patternsRes, yarnRes, recipientsRes, recentProjectsRes, allYarnRes] = await Promise.all([\n        axios.get('/api/projects/stats'),\n        axios.get('/api/patterns/stats'),\n        axios.get('/api/yarn/stats'),\n        axios.get('/api/recipients/stats'),\n        axios.get('/api/projects?limit=5'),\n        axios.get('/api/yarn'),\n      ]);\n\n      setStats([\n        {\n          name: 'Active Projects',\n          value: String(projectsRes.data.data.stats.active_count || 0),\n          icon: FiFolder,\n          href: '/projects',\n          color: 'bg-purple-500',\n        },\n        {\n          name: 'Patterns',\n          value: String(patternsRes.data.data.stats.total_count || 0),\n          icon: FiBook,\n          href: '/patterns',\n          color: 'bg-blue-500',\n        },\n        {\n          name: 'Yarn Skeins',\n          value: String(yarnRes.data.data.stats.total_skeins || 0),\n          icon: FiPackage,\n          href: '/yarn',\n          color: 'bg-green-500',\n        },\n        {\n          name: 'Recipients',\n          value: String(recipientsRes.data.data.stats.total_count || 0),\n          icon: FiUsers,\n          href: '/recipients',\n          color: 'bg-orange-500',\n        },\n      ]);\n\n      setRecentProjects(recentProjectsRes.data.data.projects || []);\n\n      // Filter yarn items with low stock alerts\n      const allYarn = allYarnRes.data.data.yarn || [];\n      const lowStock = allYarn.filter((y: any) => {\n        if (!y.low_stock_alert || !y.low_stock_threshold) return false;\n        const currentQuantity = y.quantity_remaining || y.skeins || 0;\n        return currentQuantity <= y.low_stock_threshold;\n      });\n      setLowStockYarn(lowStock);\n    } catch (error) {\n      console.error('Error fetching dashboard data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const quickActions = [\n    {\n      name: 'New Project',\n      description: 'Start tracking a new knitting project',\n      href: '/projects',\n      icon: FiFolder,\n      color: 'text-purple-600 bg-purple-50 hover:bg-purple-100',\n    },\n    {\n      name: 'Add Pattern',\n      description: 'Save a new knitting pattern',\n      href: '/patterns',\n      icon: FiBook,\n      color: 'text-blue-600 bg-blue-50 hover:bg-blue-100',\n    },\n    {\n      name: 'Add Yarn',\n      description: 'Add yarn to your stash',\n      href: '/yarn',\n      icon: FiPackage,\n      color: 'text-green-600 bg-green-50 hover:bg-green-100',\n    },\n  ];\n\n  return (\n    <div>\n      {/* Welcome Section */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n          Welcome back, {user?.firstName}!\n        </h1>\n        <p className=\"text-gray-600\">\n          Here's what's happening with your knitting projects today.\n        </p>\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n        {loading ? (\n          <div className=\"col-span-full text-center py-8\">\n            <div className=\"text-gray-500\">Loading statistics...</div>\n          </div>\n        ) : (\n          stats.map((stat) => {\n            const Icon = stat.icon;\n            return (\n              <Link\n                key={stat.name}\n                to={stat.href}\n                className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">{stat.name}</p>\n                    <p className=\"text-3xl font-bold text-gray-900 mt-2\">{stat.value}</p>\n                  </div>\n                  <div className={`${stat.color} p-3 rounded-lg`}>\n                    <Icon className=\"h-6 w-6 text-white\" />\n                  </div>\n                </div>\n              </Link>\n            );\n          })\n        )}\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"mb-8\">\n        <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Quick Actions</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link\n                key={action.name}\n                to={action.href}\n                className={`${action.color} rounded-lg p-6 transition`}\n              >\n                <div className=\"flex items-start\">\n                  <div className=\"flex-shrink-0\">\n                    <Icon className=\"h-6 w-6\" />\n                  </div>\n                  <div className=\"ml-4\">\n                    <h3 className=\"text-sm font-semibold\">{action.name}</h3>\n                    <p className=\"text-xs mt-1 opacity-75\">{action.description}</p>\n                  </div>\n                </div>\n              </Link>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Low Stock Alerts */}\n      {!loading && lowStockYarn.length > 0 && (\n        <div className=\"mb-8\">\n          <div className=\"bg-orange-50 border-l-4 border-orange-500 rounded-lg p-6\">\n            <div className=\"flex items-start mb-4\">\n              <FiAlertCircle className=\"h-6 w-6 text-orange-600 mr-3 flex-shrink-0\" />\n              <div>\n                <h2 className=\"text-xl font-bold text-orange-900 mb-1\">\n                  Low Stock Alerts\n                </h2>\n                <p className=\"text-sm text-orange-700\">\n                  The following yarn items are running low and need restocking:\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              {lowStockYarn.map((yarn) => {\n                const currentQty = yarn.quantity_remaining || yarn.skeins || 0;\n                const threshold = yarn.low_stock_threshold || 0;\n                const percentRemaining = threshold > 0 ? (currentQty / threshold) * 100 : 0;\n\n                return (\n                  <Link\n                    key={yarn.id}\n                    to=\"/yarn\"\n                    className=\"flex items-center justify-between p-4 bg-white rounded-lg hover:shadow-md transition\"\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <h3 className=\"font-semibold text-gray-900\">\n                          {yarn.brand} {yarn.name}\n                        </h3>\n                        <span className=\"text-sm font-medium text-orange-600\">\n                          {currentQty} / {threshold} {yarn.unit}\n                        </span>\n                      </div>\n\n                      {/* Progress bar */}\n                      <div className=\"w-full bg-gray-200 rounded-full h-2 mb-2\">\n                        <div\n                          className=\"bg-orange-500 h-2 rounded-full transition-all\"\n                          style={{ width: `${Math.min(100, percentRemaining)}%` }}\n                        />\n                      </div>\n\n                      <div className=\"flex items-center text-sm text-gray-600\">\n                        <FiPackage className=\"mr-2 h-4 w-4\" />\n                        {yarn.color && <span className=\"mr-3\">Color: {yarn.color}</span>}\n                        {yarn.weight && <span>Weight: {yarn.weight}</span>}\n                      </div>\n                    </div>\n                  </Link>\n                );\n              })}\n            </div>\n\n            <div className=\"mt-4 pt-4 border-t border-orange-200\">\n              <Link\n                to=\"/yarn\"\n                className=\"text-sm font-medium text-orange-700 hover:text-orange-800 flex items-center\"\n              >\n                View all yarn in stash\n                <span className=\"ml-2\"></span>\n              </Link>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Recent Activity */}\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Recent Projects</h2>\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-500\">Loading recent projects...</div>\n          </div>\n        ) : recentProjects.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <FiFolder className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <p className=\"text-gray-500 mb-4\">No projects yet</p>\n            <Link\n              to=\"/projects\"\n              className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n            >\n              <FiPlus className=\"mr-2 h-4 w-4\" />\n              Create Your First Project\n            </Link>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {recentProjects.map((project) => (\n              <Link\n                key={project.id}\n                to={`/projects/${project.id}`}\n                className=\"flex items-center justify-between p-4 hover:bg-gray-50 rounded-lg transition\"\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"bg-purple-100 p-3 rounded-lg\">\n                    <FiFolder className=\"h-5 w-5 text-purple-600\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900\">{project.name}</h3>\n                    <p className=\"text-sm text-gray-500\">\n                      {project.type && (\n                        <span className=\"capitalize\">{project.type}</span>\n                      )}\n                      {project.status && (\n                        <span className=\"ml-2 capitalize\">{project.status}</span>\n                      )}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"text-sm text-gray-500\">\n                  {new Date(project.created_at).toLocaleDateString()}\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FiPlus, FiTrash2, FiCalendar, FiClock } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string;\n  project_type: string;\n  status: string;\n  start_date: string;\n  target_completion_date: string;\n  completion_date: string;\n  created_at: string;\n}\n\nexport default function Projects() {\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    projectType: 'sweater',\n    startDate: new Date().toISOString().split('T')[0],\n    targetCompletionDate: '',\n  });\n\n  useEffect(() => {\n    fetchProjects();\n  }, []);\n\n  const fetchProjects = async () => {\n    try {\n      const response = await axios.get('/api/projects');\n      setProjects(response.data.data.projects);\n    } catch (error: any) {\n      console.error('Error fetching projects:', error);\n      toast.error('Failed to load projects');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateProject = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    try {\n      await axios.post('/api/projects', formData);\n      toast.success('Project created successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        name: '',\n        description: '',\n        projectType: 'sweater',\n        startDate: new Date().toISOString().split('T')[0],\n        targetCompletionDate: '',\n      });\n      fetchProjects();\n    } catch (error: any) {\n      console.error('Error creating project:', error);\n      toast.error(error.response?.data?.message || 'Failed to create project');\n    }\n  };\n\n  const handleDeleteProject = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/projects/${id}`);\n      toast.success('Project deleted successfully');\n      fetchProjects();\n    } catch (error: any) {\n      console.error('Error deleting project:', error);\n      toast.error('Failed to delete project');\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active':\n        return 'bg-green-100 text-green-800';\n      case 'completed':\n        return 'bg-blue-100 text-blue-800';\n      case 'paused':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'planned':\n        return 'bg-gray-100 text-gray-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return 'Not set';\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading projects...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Projects</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your knitting projects</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          New Project\n        </button>\n      </div>\n\n      {/* Projects Grid */}\n      {projects.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiClock className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No projects yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking your knitting projects</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Create Your First Project\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {projects.map((project) => (\n            <div\n              key={project.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <h3 className=\"text-lg font-semibold text-gray-900 flex-1\">\n                  {project.name}\n                </h3>\n                <span\n                  className={`px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(\n                    project.status\n                  )}`}\n                >\n                  {project.status || 'active'}\n                </span>\n              </div>\n\n              {project.description && (\n                <p className=\"text-gray-600 text-sm mb-4 line-clamp-2\">\n                  {project.description}\n                </p>\n              )}\n\n              <div className=\"space-y-2 mb-4\">\n                {project.project_type && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Type:</span> {project.project_type}\n                  </div>\n                )}\n                {project.start_date && (\n                  <div className=\"flex items-center text-sm text-gray-500\">\n                    <FiCalendar className=\"mr-2 h-4 w-4\" />\n                    Started: {formatDate(project.start_date)}\n                  </div>\n                )}\n                {project.target_completion_date && (\n                  <div className=\"flex items-center text-sm text-gray-500\">\n                    <FiClock className=\"mr-2 h-4 w-4\" />\n                    Due: {formatDate(project.target_completion_date)}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                <Link\n                  to={`/projects/${project.id}`}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition text-center text-sm font-medium\"\n                >\n                  View Details\n                </Link>\n                <button\n                  onClick={() => handleDeleteProject(project.id, project.name)}\n                  className=\"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition\"\n                  title=\"Delete project\"\n                >\n                  <FiTrash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Project Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Create New Project</h2>\n            </div>\n\n            <form onSubmit={handleCreateProject} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Project Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Cozy Winter Sweater\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Describe your project...\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Project Type\n                </label>\n                <select\n                  value={formData.projectType}\n                  onChange={(e) => setFormData({ ...formData, projectType: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                >\n                  <option value=\"sweater\">Sweater</option>\n                  <option value=\"scarf\">Scarf</option>\n                  <option value=\"hat\">Hat</option>\n                  <option value=\"blanket\">Blanket</option>\n                  <option value=\"socks\">Socks</option>\n                  <option value=\"shawl\">Shawl</option>\n                  <option value=\"toy\">Toy/Amigurumi</option>\n                  <option value=\"other\">Other</option>\n                </select>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Start Date\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={formData.startDate}\n                    onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Target Completion\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={formData.targetCompletionDate}\n                    onChange={(e) =>\n                      setFormData({ ...formData, targetCompletionDate: e.target.value })\n                    }\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Create Project\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { FiX, FiChevronLeft, FiChevronRight, FiTrash2, FiDownload, FiZoomIn, FiZoomOut } from 'react-icons/fi';\n\ninterface Photo {\n  id: string;\n  filename: string;\n  thumbnail_path: string;\n  file_path: string;\n  caption?: string;\n  created_at: string;\n}\n\ninterface PhotoGalleryProps {\n  photos: Photo[];\n  onDelete?: (photoId: string) => void;\n}\n\nexport default function PhotoGallery({ photos, onDelete }: PhotoGalleryProps) {\n  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);\n  const [zoom, setZoom] = useState(1);\n\n  const openLightbox = (index: number) => {\n    setSelectedIndex(index);\n    setZoom(1);\n  };\n\n  const closeLightbox = () => {\n    setSelectedIndex(null);\n    setZoom(1);\n  };\n\n  const goToPrevious = () => {\n    if (selectedIndex !== null && selectedIndex > 0) {\n      setSelectedIndex(selectedIndex - 1);\n      setZoom(1);\n    }\n  };\n\n  const goToNext = () => {\n    if (selectedIndex !== null && selectedIndex < photos.length - 1) {\n      setSelectedIndex(selectedIndex + 1);\n      setZoom(1);\n    }\n  };\n\n  const handleDownload = (photo: Photo) => {\n    const link = document.createElement('a');\n    link.href = photo.file_path;\n    link.download = photo.filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const handleZoomIn = () => {\n    setZoom(prev => Math.min(prev + 0.25, 3));\n  };\n\n  const handleZoomOut = () => {\n    setZoom(prev => Math.max(prev - 0.25, 0.5));\n  };\n\n  // Keyboard navigation\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (selectedIndex === null) return;\n\n    switch (e.key) {\n      case 'Escape':\n        closeLightbox();\n        break;\n      case 'ArrowLeft':\n        goToPrevious();\n        break;\n      case 'ArrowRight':\n        goToNext();\n        break;\n      case '+':\n      case '=':\n        handleZoomIn();\n        break;\n      case '-':\n      case '_':\n        handleZoomOut();\n        break;\n    }\n  };\n\n  if (photos.length === 0) {\n    return (\n      <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n        <p className=\"text-gray-500\">No photos yet. Upload your first photo!</p>\n      </div>\n    );\n  }\n\n  const selectedPhoto = selectedIndex !== null ? photos[selectedIndex] : null;\n\n  return (\n    <>\n      {/* Photo Grid */}\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n        {photos.map((photo, index) => (\n          <div\n            key={photo.id}\n            className=\"relative group cursor-pointer aspect-square overflow-hidden rounded-lg bg-gray-100\"\n            onClick={() => openLightbox(index)}\n          >\n            <img\n              src={photo.thumbnail_path}\n              alt={photo.caption || `Photo ${index + 1}`}\n              className=\"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110\"\n            />\n\n            {/* Hover Overlay */}\n            <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center\">\n              <FiZoomIn className=\"text-white opacity-0 group-hover:opacity-100 transition-opacity h-8 w-8\" />\n            </div>\n\n            {/* Delete Button */}\n            {onDelete && (\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  if (confirm('Are you sure you want to delete this photo?')) {\n                    onDelete(photo.id);\n                  }\n                }}\n                className=\"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700\"\n              >\n                <FiTrash2 className=\"h-4 w-4\" />\n              </button>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Lightbox Modal */}\n      {selectedPhoto && (\n        <div\n          className=\"fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center\"\n          onClick={closeLightbox}\n          onKeyDown={handleKeyDown}\n          tabIndex={0}\n        >\n          {/* Close Button */}\n          <button\n            onClick={closeLightbox}\n            className=\"absolute top-4 right-4 p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10\"\n            aria-label=\"Close\"\n          >\n            <FiX className=\"h-8 w-8\" />\n          </button>\n\n          {/* Previous Button */}\n          {selectedIndex! > 0 && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                goToPrevious();\n              }}\n              className=\"absolute left-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10\"\n              aria-label=\"Previous\"\n            >\n              <FiChevronLeft className=\"h-8 w-8\" />\n            </button>\n          )}\n\n          {/* Next Button */}\n          {selectedIndex! < photos.length - 1 && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                goToNext();\n              }}\n              className=\"absolute right-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10\"\n              aria-label=\"Next\"\n            >\n              <FiChevronRight className=\"h-8 w-8\" />\n            </button>\n          )}\n\n          {/* Image Container */}\n          <div\n            className=\"relative max-w-7xl max-h-full p-4 flex items-center justify-center\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <img\n              src={selectedPhoto.file_path}\n              alt={selectedPhoto.caption || 'Photo'}\n              className=\"max-w-full max-h-[80vh] object-contain rounded-lg\"\n              style={{ transform: `scale(${zoom})`, transition: 'transform 0.2s' }}\n            />\n          </div>\n\n          {/* Controls */}\n          <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-4 bg-black bg-opacity-75 px-6 py-3 rounded-full z-10\">\n            {/* Zoom Out */}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleZoomOut();\n              }}\n              disabled={zoom <= 0.5}\n              className=\"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              aria-label=\"Zoom out\"\n            >\n              <FiZoomOut className=\"h-5 w-5\" />\n            </button>\n\n            {/* Zoom Indicator */}\n            <span className=\"text-white text-sm font-medium min-w-[60px] text-center\">\n              {Math.round(zoom * 100)}%\n            </span>\n\n            {/* Zoom In */}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleZoomIn();\n              }}\n              disabled={zoom >= 3}\n              className=\"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              aria-label=\"Zoom in\"\n            >\n              <FiZoomIn className=\"h-5 w-5\" />\n            </button>\n\n            {/* Download */}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleDownload(selectedPhoto);\n              }}\n              className=\"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition\"\n              aria-label=\"Download\"\n            >\n              <FiDownload className=\"h-5 w-5\" />\n            </button>\n\n            {/* Counter */}\n            <span className=\"text-white text-sm\">\n              {selectedIndex! + 1} / {photos.length}\n            </span>\n          </div>\n\n          {/* Caption */}\n          {selectedPhoto.caption && (\n            <div className=\"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 px-6 py-2 rounded-full max-w-2xl\">\n              <p className=\"text-white text-sm text-center\">{selectedPhoto.caption}</p>\n            </div>\n          )}\n        </div>\n      )}\n    </>\n  );\n}\n","import { useState, useRef } from 'react';\nimport { FiUpload, FiX } from 'react-icons/fi';\n\ninterface FileUploadProps {\n  onUpload: (file: File) => Promise<void>;\n  accept?: string;\n  maxSize?: number; // in MB\n}\n\nexport default function FileUpload({\n  onUpload,\n  accept = 'image/jpeg,image/jpg,image/png,image/webp',\n  maxSize = 10,\n}: FileUploadProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = (file: File) => {\n    // Validate file type\n    if (!accept.split(',').some(type => file.type.match(type.trim()))) {\n      alert(`Invalid file type. Accepted types: ${accept}`);\n      return;\n    }\n\n    // Validate file size\n    const fileSizeMB = file.size / (1024 * 1024);\n    if (fileSizeMB > maxSize) {\n      alert(`File size exceeds ${maxSize}MB limit`);\n      return;\n    }\n\n    setSelectedFile(file);\n\n    // Generate preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreview(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true);\n    } else if (e.type === 'dragleave') {\n      setDragActive(false);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    try {\n      await onUpload(selectedFile);\n      // Reset after successful upload\n      setSelectedFile(null);\n      setPreview(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } catch (error) {\n      console.error('Upload error:', error);\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setSelectedFile(null);\n    setPreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Drop Zone */}\n      <div\n        onDragEnter={handleDrag}\n        onDragLeave={handleDrag}\n        onDragOver={handleDrag}\n        onDrop={handleDrop}\n        className={`relative border-2 border-dashed rounded-lg p-6 transition-colors ${\n          dragActive\n            ? 'border-purple-500 bg-purple-50'\n            : 'border-gray-300 hover:border-gray-400'\n        }`}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept={accept}\n          onChange={handleInputChange}\n          className=\"hidden\"\n        />\n\n        {!preview ? (\n          <div className=\"text-center\">\n            <FiUpload className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <div className=\"space-y-2\">\n              <button\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n                className=\"text-purple-600 hover:text-purple-700 font-medium\"\n              >\n                Click to upload\n              </button>\n              <span className=\"text-gray-600\"> or drag and drop</span>\n            </div>\n            <p className=\"text-sm text-gray-500 mt-2\">\n              PNG, JPG, or WebP up to {maxSize}MB\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {/* Preview */}\n            <div className=\"relative\">\n              <img\n                src={preview}\n                alt=\"Preview\"\n                className=\"max-w-full max-h-64 mx-auto rounded-lg object-contain\"\n              />\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                className=\"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition\"\n              >\n                <FiX className=\"h-4 w-4\" />\n              </button>\n            </div>\n\n            {/* File Info */}\n            <div className=\"text-sm text-gray-600\">\n              <p className=\"font-medium\">{selectedFile?.name}</p>\n              <p className=\"text-xs text-gray-500\">\n                {((selectedFile?.size || 0) / 1024 / 1024).toFixed(2)} MB\n              </p>\n            </div>\n\n            {/* Upload Button */}\n            <div className=\"flex space-x-2\">\n              <button\n                type=\"button\"\n                onClick={handleUpload}\n                disabled={uploading}\n                className=\"flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {uploading ? 'Uploading...' : 'Upload Photo'}\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                disabled={uploading}\n                className=\"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","// @ts-nocheck\nimport { useState } from 'react';\nimport { FiX } from 'react-icons/fi';\nimport type { Counter, IncrementPattern } from '../../types/counter.types';\n\ninterface CounterFormProps {\n  projectId: string;\n  counter?: Counter | null;\n  parentCounterId?: string | null;\n  existingCounters?: Counter[];\n  onSave: (data: Partial<Counter>) => void;\n  onCancel: () => void;\n}\n\nconst COUNTER_COLORS = [\n  '#3B82F6', // Blue\n  '#8B5CF6', // Purple\n  '#10B981', // Green\n  '#F59E0B', // Amber\n  '#EF4444', // Red\n  '#EC4899', // Pink\n  '#6366F1', // Indigo\n  '#14B8A6', // Teal\n];\n\nconst INCREMENT_PATTERNS: { value: string; label: string; description: string }[] = [\n  { value: 'simple', label: 'Simple (+1 each)', description: 'Standard counting, +1 per row' },\n  { value: 'every_n_garter', label: 'Garter Stitch Ridges', description: '+1 every 2 rows (ridge counting)' },\n  { value: 'every_n_cable', label: 'Cable Repeats', description: '+1 every 4 rows (cable pattern)' },\n  { value: 'custom', label: 'Custom Pattern', description: 'Define your own increment pattern' },\n];\n\nexport default function CounterForm({ counter, parentCounterId, existingCounters, onSave, onCancel }: CounterFormProps) {\n  const [name, setName] = useState(counter?.name || '');\n  const [type, setType] = useState(counter?.type || 'rows');\n  const [currentValue, setCurrentValue] = useState(counter?.current_value || 0);\n  const [targetValue, setTargetValue] = useState(counter?.target_value || '');\n  const [incrementBy] = useState(counter?.increment_by || 1);\n  const [minValue, setMinValue] = useState(counter?.min_value || 0);\n  const [maxValue, setMaxValue] = useState(counter?.max_value || '');\n  const [displayColor, setDisplayColor] = useState(counter?.display_color || COUNTER_COLORS[0]);\n  const [notes, setNotes] = useState(counter?.notes || '');\n  const [incrementPattern, setIncrementPattern] = useState(counter?.increment_pattern?.type || 'simple');\n  const [customIncrement, setCustomIncrement] = useState(counter?.increment_pattern?.increment || 1);\n  const [autoReset, setAutoReset] = useState(counter?.auto_reset || false);\n  const [selectedParentId, setSelectedParentId] = useState(parentCounterId || counter?.parent_counter_id || '');\n\n  // Get parent counter name for display\n  const parentCounter = selectedParentId && existingCounters\n    ? existingCounters.find(c => c.id === selectedParentId)\n    : null;\n\n  // Get available parent counters (exclude self and own children)\n  const availableParents = existingCounters?.filter(c =>\n    c.id !== counter?.id && !c.parent_counter_id\n  ) || [];\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    let pattern: IncrementPattern | undefined;\n\n    switch (incrementPattern) {\n      case 'simple':\n        pattern = { type: 'simple' };\n        break;\n      case 'every_n': // garter pattern\n        pattern = {\n          type: 'every_n',\n          rule: 'every_n_rows',\n          n: 2,\n          increment: 1,\n          description: 'Garter stitch ridge counting'\n        };\n        break;\n      case 'every_n_cable':\n        pattern = {\n          type: 'every_n',\n          rule: 'every_n_rows',\n          n: 4,\n          increment: 1,\n          description: 'Cable pattern repeat'\n        };\n        break;\n      case 'custom':\n        pattern = {\n          type: 'custom_fixed',\n          increment: customIncrement,\n          description: `Custom: +${customIncrement} per action`\n        };\n        break;\n    }\n\n    // Backend expects camelCase field names\n    const data: any = {\n      name,\n      type: type as any,\n      currentValue: currentValue,\n      targetValue: targetValue ? Number(targetValue) : undefined,\n      incrementBy: incrementBy,\n      minValue: minValue,\n      maxValue: maxValue ? Number(maxValue) : undefined,\n      displayColor: displayColor,\n      notes,\n      incrementPattern: pattern,\n      parentCounterId: selectedParentId || null,\n      autoReset: autoReset,\n    };\n\n    onSave(data);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between\">\n          <h2 className=\"text-xl font-bold text-gray-900\">\n            {counter ? 'Edit Counter' : 'Create Counter'}\n          </h2>\n          <button\n            onClick={onCancel}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition\"\n          >\n            <FiX className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n          {/* Basic Info */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Counter Name *\n            </label>\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              placeholder=\"e.g., Main Row Counter\"\n              required\n            />\n          </div>\n\n          {/* Counter Type */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Counter Type\n            </label>\n            <select\n              value={type}\n              onChange={(e) => setType(e.target.value as any)}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n            >\n              <option value=\"rows\">Row Counter</option>\n              <option value=\"stitches\">Stitch Counter</option>\n              <option value=\"repeats\">Repeat Counter</option>\n              <option value=\"custom\">Custom Counter</option>\n            </select>\n          </div>\n\n          {/* Values */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Current Value\n              </label>\n              <input\n                type=\"number\"\n                value={currentValue}\n                onChange={(e) => setCurrentValue(Number(e.target.value))}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Target Value (optional)\n              </label>\n              <input\n                type=\"number\"\n                value={targetValue}\n                onChange={(e) => setTargetValue(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n                placeholder=\"No limit\"\n              />\n            </div>\n          </div>\n\n          {/* Min/Max Values */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Minimum Value\n              </label>\n              <input\n                type=\"number\"\n                value={minValue}\n                onChange={(e) => setMinValue(Number(e.target.value))}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Maximum Value (optional)\n              </label>\n              <input\n                type=\"number\"\n                value={maxValue}\n                onChange={(e) => setMaxValue(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n                placeholder=\"No limit\"\n              />\n            </div>\n          </div>\n\n          {/* Increment Pattern */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Increment Pattern\n            </label>\n            <div className=\"space-y-2\">\n              {INCREMENT_PATTERNS.map((pattern) => (\n                <label\n                  key={pattern.value}\n                  className=\"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\"\n                >\n                  <input\n                    type=\"radio\"\n                    name=\"incrementPattern\"\n                    value={pattern.value}\n                    checked={incrementPattern === pattern.value}\n                    onChange={(e) => setIncrementPattern(e.target.value as any)}\n                    className=\"mt-1\"\n                  />\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{pattern.label}</div>\n                    <div className=\"text-sm text-gray-500\">{pattern.description}</div>\n                  </div>\n                </label>\n              ))}\n            </div>\n\n            {incrementPattern === 'custom' && (\n              <div className=\"mt-3\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Custom Increment Value\n                </label>\n                <input\n                  type=\"number\"\n                  value={customIncrement}\n                  onChange={(e) => setCustomIncrement(Number(e.target.value))}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n                  min=\"1\"\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Color Selection */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Counter Color\n            </label>\n            <div className=\"flex gap-2 flex-wrap\">\n              {COUNTER_COLORS.map((color) => (\n                <button\n                  key={color}\n                  type=\"button\"\n                  onClick={() => setDisplayColor(color)}\n                  className={`w-10 h-10 rounded-lg border-2 transition ${\n                    displayColor === color ? 'border-gray-900 scale-110' : 'border-gray-200'\n                  }`}\n                  style={{ backgroundColor: color }}\n                />\n              ))}\n            </div>\n          </div>\n\n          {/* Notes */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Notes (optional)\n            </label>\n            <textarea\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              rows={3}\n              placeholder=\"Add any notes or reminders for this counter...\"\n            />\n          </div>\n\n          {/* Link to Parent Counter */}\n          {availableParents.length > 0 && (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Link to Parent Counter (optional)\n              </label>\n              <select\n                value={selectedParentId}\n                onChange={(e) => setSelectedParentId(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              >\n                <option value=\"\">None (Primary Counter)</option>\n                {availableParents.map((p) => (\n                  <option key={p.id} value={p.id}>\n                    {p.name}\n                  </option>\n                ))}\n              </select>\n              {selectedParentId && (\n                <p className=\"text-sm text-gray-500 mt-1\">\n                  This counter will update when \"{parentCounter?.name}\" is incremented in Linked Mode.\n                </p>\n              )}\n            </div>\n          )}\n\n          {/* Auto-Reset Toggle */}\n          {selectedParentId && (\n            <div className=\"flex items-start gap-3 p-4 bg-blue-50 rounded-lg\">\n              <input\n                type=\"checkbox\"\n                id=\"autoReset\"\n                checked={autoReset}\n                onChange={(e) => setAutoReset(e.target.checked)}\n                className=\"mt-1 h-4 w-4 text-purple-600 rounded focus:ring-purple-500\"\n              />\n              <label htmlFor=\"autoReset\" className=\"flex-1\">\n                <span className=\"block text-sm font-medium text-gray-900\">\n                  Auto-reset when target reached\n                </span>\n                <span className=\"block text-sm text-gray-500\">\n                  When this counter reaches its target value, it will automatically reset to the minimum value.\n                  Great for tracking pattern repeats!\n                </span>\n              </label>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-3 pt-4 border-t border-gray-200\">\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              className=\"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition\"\n            >\n              {counter ? 'Update Counter' : 'Create Counter'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiMinus, FiLink, FiRefreshCw, FiChevronRight, FiChevronDown } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport type { Counter, IncrementMode, CounterUpdateResult } from '../../types/counter.types';\nimport CounterForm from './CounterForm';\n\ninterface CounterHierarchyProps {\n  projectId: string;\n  onCounterChange?: () => void;\n}\n\ninterface HierarchicalCounterCardProps {\n  counter: Counter;\n  isPrimary: boolean;\n  mode: IncrementMode;\n  onIncrement: (id: string, amount: number) => void;\n  onEdit: (counter: Counter) => void;\n  onDelete: (id: string) => void;\n  loading: boolean;\n}\n\nfunction HierarchicalCounterCard({\n  counter,\n  isPrimary,\n  mode,\n  onIncrement,\n  onEdit,\n  onDelete,\n  loading\n}: HierarchicalCounterCardProps) {\n  const [expanded, setExpanded] = useState(true);\n  const percentage = counter.target_value\n    ? Math.round((counter.current_value / counter.target_value) * 100)\n    : null;\n\n  const showButtons = isPrimary || mode === 'independent';\n  const hasChildren = counter.children && counter.children.length > 0;\n\n  return (\n    <div className={`${isPrimary ? '' : 'ml-6 border-l-2 border-purple-200 dark:border-purple-800 pl-4'}`}>\n      <div\n        className={`bg-white dark:bg-gray-800 rounded-xl shadow-md p-4 mb-3 transition-all ${\n          isPrimary\n            ? 'border-l-4 border-purple-600'\n            : 'border-l-2 border-blue-400 dark:border-blue-600'\n        }`}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"flex items-center gap-2\">\n            {hasChildren && (\n              <button\n                onClick={() => setExpanded(!expanded)}\n                className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\n              >\n                {expanded ? (\n                  <FiChevronDown className=\"h-4 w-4 text-gray-500\" />\n                ) : (\n                  <FiChevronRight className=\"h-4 w-4 text-gray-500\" />\n                )}\n              </button>\n            )}\n            <span className=\"text-xl\">{isPrimary ? '' : ''}</span>\n            <h3 className=\"font-semibold text-gray-900 dark:text-white\">{counter.name}</h3>\n            {counter.auto_reset && (\n              <span className=\"text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full flex items-center gap-1\">\n                <FiRefreshCw className=\"h-3 w-3\" />\n                Auto-reset\n              </span>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {hasChildren && (\n              <span className=\"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded\">\n                {counter.children!.length} linked\n              </span>\n            )}\n            <button\n              onClick={() => onEdit(counter)}\n              className=\"text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 p-1\"\n            >\n              Edit\n            </button>\n          </div>\n        </div>\n\n        {/* Value Display */}\n        <div className=\"flex items-baseline gap-2 mb-3\">\n          <span className=\"text-4xl font-bold text-purple-600 dark:text-purple-400\">\n            {counter.current_value.toLocaleString()}\n          </span>\n          {counter.target_value && (\n            <>\n              <span className=\"text-2xl text-gray-400\">/</span>\n              <span className=\"text-2xl text-gray-500 dark:text-gray-400\">\n                {counter.target_value.toLocaleString()}\n              </span>\n            </>\n          )}\n        </div>\n\n        {/* Progress Bar */}\n        {percentage !== null && (\n          <div className=\"mb-4\">\n            <div className=\"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n              <div\n                className=\"h-full bg-purple-600 dark:bg-purple-500 transition-all duration-300 ease-out\"\n                style={{ width: `${Math.min(percentage, 100)}%` }}\n              />\n            </div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 text-right\">\n              {percentage}% complete\n            </p>\n          </div>\n        )}\n\n        {/* Increment/Decrement Buttons */}\n        {showButtons && (\n          <div className=\"flex gap-3\">\n            <button\n              onClick={() => onIncrement(counter.id, -1)}\n              disabled={loading || counter.current_value <= (counter.min_value || 0)}\n              className=\"flex-1 h-12 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600\n                       text-gray-700 dark:text-gray-200 rounded-lg transition flex items-center justify-center\n                       disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <FiMinus className=\"h-6 w-6\" />\n            </button>\n            <button\n              onClick={() => onIncrement(counter.id, counter.increment_by || 1)}\n              disabled={loading}\n              className=\"flex-1 h-12 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition\n                       flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <FiPlus className=\"h-6 w-6\" />\n            </button>\n          </div>\n        )}\n\n        {/* Non-primary counter in linked mode - show value only */}\n        {!showButtons && (\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 text-center py-2\">\n            <FiLink className=\"inline h-4 w-4 mr-1\" />\n            Updates with parent counter\n          </p>\n        )}\n      </div>\n\n      {/* Render Children */}\n      {expanded && hasChildren && (\n        <div className=\"space-y-2\">\n          {counter.children!.map((child) => (\n            <HierarchicalCounterCard\n              key={child.id}\n              counter={child}\n              isPrimary={false}\n              mode={mode}\n              onIncrement={onIncrement}\n              onEdit={onEdit}\n              onDelete={onDelete}\n              loading={loading}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function CounterHierarchy({ projectId, onCounterChange }: CounterHierarchyProps) {\n  const [counters, setCounters] = useState<Counter[]>([]);\n  const [allCounters, setAllCounters] = useState<Counter[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [incrementing, setIncrementing] = useState(false);\n  const [mode, setMode] = useState<IncrementMode>('linked');\n  const [showForm, setShowForm] = useState(false);\n  const [editingCounter, setEditingCounter] = useState<Counter | null>(null);\n  const [parentForNewCounter, setParentForNewCounter] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchCounters();\n  }, [projectId]);\n\n  const fetchCounters = async () => {\n    try {\n      setLoading(true);\n      // Fetch both flat and hierarchical\n      const [hierarchyRes, flatRes] = await Promise.all([\n        axios.get(`/api/projects/${projectId}/counters/hierarchy`),\n        axios.get(`/api/projects/${projectId}/counters`)\n      ]);\n      setCounters(hierarchyRes.data.data.counters || []);\n      setAllCounters(flatRes.data.data.counters || []);\n    } catch (error) {\n      console.error('Error fetching counters:', error);\n      toast.error('Failed to load counters');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleIncrement = async (counterId: string, amount: number) => {\n    try {\n      setIncrementing(true);\n      const response = await axios.post(\n        `/api/projects/${projectId}/counters/${counterId}/increment`,\n        { amount, mode }\n      );\n\n      if (response.data.success) {\n        const updates: CounterUpdateResult[] = response.data.data.updated_counters;\n\n        // Show toast for any resets\n        updates\n          .filter((u) => u.reset && u.completion_message)\n          .forEach((u) => {\n            toast.success(u.completion_message, {\n              icon: '',\n              autoClose: 3000,\n            });\n          });\n\n        // Refresh counters\n        await fetchCounters();\n        onCounterChange?.();\n      }\n    } catch (error) {\n      console.error('Error incrementing counter:', error);\n      toast.error('Failed to update counter');\n    } finally {\n      setIncrementing(false);\n    }\n  };\n\n  const handleCreateCounter = async (counterData: Partial<Counter>) => {\n    try {\n      await axios.post(`/api/projects/${projectId}/counters`, {\n        ...counterData,\n        parentCounterId: parentForNewCounter,\n      });\n      toast.success('Counter created!');\n      setShowForm(false);\n      setParentForNewCounter(null);\n      fetchCounters();\n      onCounterChange?.();\n    } catch (error) {\n      console.error('Error creating counter:', error);\n      toast.error('Failed to create counter');\n    }\n  };\n\n  const handleUpdateCounter = async (counterId: string, counterData: Partial<Counter>) => {\n    try {\n      await axios.put(`/api/projects/${projectId}/counters/${counterId}`, counterData);\n      toast.success('Counter updated!');\n      setShowForm(false);\n      setEditingCounter(null);\n      fetchCounters();\n      onCounterChange?.();\n    } catch (error) {\n      console.error('Error updating counter:', error);\n      toast.error('Failed to update counter');\n    }\n  };\n\n  const handleDeleteCounter = async (counterId: string) => {\n    if (!confirm('Delete this counter? Any linked counters will be unlinked.')) return;\n    try {\n      await axios.delete(`/api/projects/${projectId}/counters/${counterId}`);\n      toast.success('Counter deleted!');\n      fetchCounters();\n      onCounterChange?.();\n    } catch (error) {\n      console.error('Error deleting counter:', error);\n      toast.error('Failed to delete counter');\n    }\n  };\n\n  // Filter to show only primary counters (children are nested inside)\n  const primaryCounters = counters.filter(\n    (c) => !c.parent_counter_id && c.is_visible && c.is_active\n  );\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Counters</h2>\n        <div className=\"flex items-center gap-2\">\n          {/* Mode Toggle */}\n          <div className=\"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1\">\n            <button\n              onClick={() => setMode('linked')}\n              className={`px-3 py-1.5 text-sm font-medium rounded-md transition ${\n                mode === 'linked'\n                  ? 'bg-white dark:bg-gray-600 text-purple-600 dark:text-purple-400 shadow'\n                  : 'text-gray-600 dark:text-gray-400'\n              }`}\n            >\n              <FiLink className=\"inline h-4 w-4 mr-1\" />\n              Linked\n            </button>\n            <button\n              onClick={() => setMode('independent')}\n              className={`px-3 py-1.5 text-sm font-medium rounded-md transition ${\n                mode === 'independent'\n                  ? 'bg-white dark:bg-gray-600 text-purple-600 dark:text-purple-400 shadow'\n                  : 'text-gray-600 dark:text-gray-400'\n              }`}\n            >\n              Independent\n            </button>\n          </div>\n          <button\n            onClick={() => {\n              setEditingCounter(null);\n              setParentForNewCounter(null);\n              setShowForm(true);\n            }}\n            className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition flex items-center gap-2\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n            Add Counter\n          </button>\n        </div>\n      </div>\n\n      {/* Mode Description */}\n      <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 text-sm text-gray-600 dark:text-gray-400\">\n        {mode === 'linked' ? (\n          <p>\n            <FiLink className=\"inline h-4 w-4 mr-1\" />\n            <strong>Linked Mode:</strong> Incrementing a parent counter will update all linked child counters together.\n            Auto-reset counters will reset when they reach their target.\n          </p>\n        ) : (\n          <p>\n            <strong>Independent Mode:</strong> Each counter can be adjusted separately without affecting linked counters.\n          </p>\n        )}\n      </div>\n\n      {/* Counter List */}\n      {primaryCounters.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-700\">\n          <p className=\"text-gray-500 dark:text-gray-400 mb-4\">\n            No counters yet. Add your first counter to track your progress!\n          </p>\n          <button\n            onClick={() => setShowForm(true)}\n            className=\"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2\"\n          >\n            <FiPlus className=\"h-5 w-5\" />\n            Add Counter\n          </button>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {primaryCounters.map((counter) => (\n            <div key={counter.id}>\n              <HierarchicalCounterCard\n                counter={counter}\n                isPrimary={true}\n                mode={mode}\n                onIncrement={handleIncrement}\n                onEdit={(c) => {\n                  setEditingCounter(c);\n                  setShowForm(true);\n                }}\n                onDelete={handleDeleteCounter}\n                loading={incrementing}\n              />\n              {/* Add Linked Counter Button */}\n              <button\n                onClick={() => {\n                  setEditingCounter(null);\n                  setParentForNewCounter(counter.id);\n                  setShowForm(true);\n                }}\n                className=\"ml-6 mt-2 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 flex items-center gap-1\"\n              >\n                <FiPlus className=\"h-4 w-4\" />\n                Add linked counter\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Counter Form Modal */}\n      {showForm && (\n        <CounterForm\n          projectId={projectId}\n          counter={editingCounter}\n          parentCounterId={parentForNewCounter}\n          existingCounters={allCounters}\n          onSave={(data) => {\n            if (editingCounter) {\n              handleUpdateCounter(editingCounter.id, data);\n            } else {\n              handleCreateCounter(data);\n            }\n          }}\n          onCancel={() => {\n            setShowForm(false);\n            setEditingCounter(null);\n            setParentForNewCounter(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","// @ts-nocheck\nimport React, { useState, useEffect, useRef } from 'react';\nimport { FiClock, FiPlay, FiPause, FiSquare } from 'react-icons/fi';\nimport { KnittingSession } from '../../types/counter.types';\n\ninterface SessionTimerProps {\n  projectId: string;\n  currentSession: KnittingSession | null;\n  onStartSession: () => Promise<KnittingSession>;\n  onEndSession: (notes?: string, mood?: string) => Promise<void>;\n  onPauseSession?: () => Promise<void>;\n  getCurrentCounterValues: () => Record<string, number>;\n}\n\nexport const SessionTimer: React.FC<SessionTimerProps> = ({\n  projectId,\n  currentSession,\n  onStartSession,\n  onEndSession,\n  onPauseSession,\n  getCurrentCounterValues,\n}) => {\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [isRunning, setIsRunning] = useState(false);\n  const [showEndModal, setShowEndModal] = useState(false);\n  const [endNotes, setEndNotes] = useState('');\n  const [mood, setMood] = useState<'productive' | 'frustrated' | 'relaxed' | undefined>();\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Calculate elapsed time from current session\n  useEffect(() => {\n    if (currentSession && !currentSession.end_time) {\n      const startTime = new Date(currentSession.start_time).getTime();\n      const now = Date.now();\n      setElapsedTime(Math.floor((now - startTime) / 1000));\n      setIsRunning(true);\n    } else {\n      setElapsedTime(0);\n      setIsRunning(false);\n    }\n  }, [currentSession]);\n\n  // Update timer every second when running\n  useEffect(() => {\n    if (isRunning) {\n      intervalRef.current = setInterval(() => {\n        setElapsedTime((prev) => prev + 1);\n      }, 1000);\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [isRunning]);\n\n  const handleStart = async () => {\n    try {\n      await onStartSession();\n      setIsRunning(true);\n    } catch (error) {\n      console.error('Failed to start session:', error);\n    }\n  };\n\n  const handlePause = async () => {\n    if (onPauseSession) {\n      try {\n        await onPauseSession();\n        setIsRunning(false);\n      } catch (error) {\n        console.error('Failed to pause session:', error);\n      }\n    }\n  };\n\n  const handleStop = () => {\n    setShowEndModal(true);\n  };\n\n  const handleConfirmEnd = async () => {\n    try {\n      await onEndSession(endNotes, mood);\n      setShowEndModal(false);\n      setEndNotes('');\n      setMood(undefined);\n      setIsRunning(false);\n      setElapsedTime(0);\n    } catch (error) {\n      console.error('Failed to end session:', error);\n    }\n  };\n\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n\n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n          <FiClock className=\"w-5 h-5\" />\n          Knitting Session\n        </h3>\n      </div>\n\n      {/* Timer Display */}\n      <div className=\"text-center mb-6\">\n        <div className=\"text-6xl font-bold text-gray-900 dark:text-white tabular-nums mb-2\">\n          {formatTime(elapsedTime)}\n        </div>\n        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n          {isRunning ? 'Session in progress' : 'No active session'}\n        </div>\n      </div>\n\n      {/* Control Buttons */}\n      <div className=\"flex gap-3 justify-center\">\n        {!isRunning ? (\n          <button\n            onClick={handleStart}\n            className=\"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n          >\n            <FiPlay className=\"w-6 h-6\" />\n            Start Session\n          </button>\n        ) : (\n          <>\n            {onPauseSession && (\n              <button\n                onClick={handlePause}\n                className=\"flex items-center gap-2 px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n              >\n                <FiPause className=\"w-6 h-6\" />\n                Pause\n              </button>\n            )}\n            <button\n              onClick={handleStop}\n              className=\"flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n            >\n              <FiSquare className=\"w-6 h-6\" />\n              End Session\n            </button>\n          </>\n        )}\n      </div>\n\n      {/* End Session Modal */}\n      {showEndModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6\">\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\n              End Knitting Session\n            </h3>\n\n            {/* Session Summary */}\n            <div className=\"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"text-sm text-gray-600 dark:text-gray-300\">\n                Session Duration\n              </div>\n              <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                {formatTime(elapsedTime)}\n              </div>\n            </div>\n\n            {/* Mood Selection */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                How was this session?\n              </label>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setMood('productive')}\n                  className={`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${\n                    mood === 'productive'\n                      ? 'border-green-500 bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-green-500'\n                  }`}\n                >\n                   Productive\n                </button>\n                <button\n                  onClick={() => setMood('relaxed')}\n                  className={`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${\n                    mood === 'relaxed'\n                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-blue-500'\n                  }`}\n                >\n                   Relaxed\n                </button>\n                <button\n                  onClick={() => setMood('frustrated')}\n                  className={`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${\n                    mood === 'frustrated'\n                      ? 'border-orange-500 bg-orange-50 dark:bg-orange-900 text-orange-700 dark:text-orange-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-orange-500'\n                  }`}\n                >\n                   Frustrated\n                </button>\n              </div>\n            </div>\n\n            {/* Session Notes */}\n            <div className=\"mb-6\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Session Notes (optional)\n              </label>\n              <textarea\n                value={endNotes}\n                onChange={(e) => setEndNotes(e.target.value)}\n                placeholder=\"Add any notes about this session...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={3}\n              />\n            </div>\n\n            {/* Modal Actions */}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setShowEndModal(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleConfirmEnd}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                End Session\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiClock, FiTrendingUp, FiMapPin } from 'react-icons/fi';\nimport { KnittingSession } from '../../types/counter.types';\nimport { format } from 'date-fns';\n\ninterface SessionHistoryProps {\n  sessions: KnittingSession[];\n  onDeleteSession?: (sessionId: string) => Promise<void>;\n}\n\nexport const SessionHistory: React.FC<SessionHistoryProps> = ({\n  sessions,\n  onDeleteSession,\n}) => {\n  const [expandedSession, setExpandedSession] = useState<string | null>(null);\n\n  const formatDuration = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n\n    if (hours > 0) {\n      return `${hours}h ${minutes}m`;\n    }\n    return `${minutes}m`;\n  };\n\n  const calculateRowsPerHour = (session: KnittingSession): number => {\n    if (!session.duration_seconds || session.duration_seconds === 0) return 0;\n    const hours = session.duration_seconds / 3600;\n    return Math.round(session.rows_completed / hours);\n  };\n\n  const getMoodEmoji = (mood?: string): string => {\n    switch (mood) {\n      case 'productive':\n        return '';\n      case 'relaxed':\n        return '';\n      case 'frustrated':\n        return '';\n      default:\n        return '';\n    }\n  };\n\n  const getMoodColor = (mood?: string): string => {\n    switch (mood) {\n      case 'productive':\n        return 'text-green-600 dark:text-green-400';\n      case 'relaxed':\n        return 'text-blue-600 dark:text-blue-400';\n      case 'frustrated':\n        return 'text-orange-600 dark:text-orange-400';\n      default:\n        return 'text-gray-600 dark:text-gray-400';\n    }\n  };\n\n  const toggleExpand = (sessionId: string) => {\n    setExpandedSession(expandedSession === sessionId ? null : sessionId);\n  };\n\n  // Calculate totals\n  const totalDuration = sessions.reduce(\n    (sum, session) => sum + (session.duration_seconds || 0),\n    0\n  );\n  const totalRows = sessions.reduce((sum, session) => sum + session.rows_completed, 0);\n  const averageRowsPerHour =\n    totalDuration > 0 ? Math.round((totalRows / totalDuration) * 3600) : 0;\n\n  if (sessions.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4\">\n          <FiClock className=\"w-5 h-5\" />\n          Session History\n        </h3>\n        <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <FiClock className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n          <p>No sessions recorded yet</p>\n          <p className=\"text-sm mt-1\">Start a knitting session to track your progress</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4\">\n        <FiClock className=\"w-5 h-5\" />\n        Session History\n      </h3>\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n        <div className=\"text-center\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Sessions</div>\n          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {sessions.length}\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Time</div>\n          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {formatDuration(totalDuration)}\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Avg Pace</div>\n          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {averageRowsPerHour}\n          </div>\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">rows/hour</div>\n        </div>\n      </div>\n\n      {/* Session List */}\n      <div className=\"space-y-3\">\n        {sessions.map((session) => {\n          const isExpanded = expandedSession === session.id;\n          const rowsPerHour = calculateRowsPerHour(session);\n\n          return (\n            <div\n              key={session.id}\n              className=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\"\n            >\n              {/* Session Header */}\n              <button\n                onClick={() => toggleExpand(session.id)}\n                className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <span className={`text-2xl ${getMoodColor(session.mood)}`}>\n                    {getMoodEmoji(session.mood)}\n                  </span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-gray-900 dark:text-white\">\n                      {format(new Date(session.start_time), 'MMM d, yyyy')}\n                    </div>\n                    <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                      {format(new Date(session.start_time), 'h:mm a')}\n                      {session.end_time &&\n                        ` - ${format(new Date(session.end_time), 'h:mm a')}`}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"text-right\">\n                    <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                      {formatDuration(session.duration_seconds || 0)}\n                    </div>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                      {session.rows_completed} rows\n                    </div>\n                  </div>\n                  <svg\n                    className={`w-5 h-5 text-gray-400 transition-transform ${\n                      isExpanded ? 'transform rotate-180' : ''\n                    }`}\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M19 9l-7 7-7-7\"\n                    />\n                  </svg>\n                </div>\n              </button>\n\n              {/* Expanded Details */}\n              {isExpanded && (\n                <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600\">\n                  {/* Stats */}\n                  <div className=\"grid grid-cols-2 gap-4 mb-3\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <FiTrendingUp className=\"w-4 h-4 text-gray-500\" />\n                      <span className=\"text-gray-600 dark:text-gray-400\">Pace:</span>\n                      <span className=\"font-medium text-gray-900 dark:text-white\">\n                        {rowsPerHour} rows/hour\n                      </span>\n                    </div>\n                    {session.location && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <FiMapPin className=\"w-4 h-4 text-gray-500\" />\n                        <span className=\"text-gray-600 dark:text-gray-400\">Location:</span>\n                        <span className=\"font-medium text-gray-900 dark:text-white\">\n                          {session.location}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Counter Values */}\n                  {session.starting_counter_values &&\n                    session.ending_counter_values &&\n                    Object.keys(session.starting_counter_values).length > 0 && (\n                      <div className=\"mb-3\">\n                        <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400 mb-2\">\n                          Counter Progress\n                        </div>\n                        <div className=\"space-y-1\">\n                          {Object.entries(session.starting_counter_values).map(\n                            ([counterId, startValue]) => {\n                              const endValue =\n                                session.ending_counter_values?.[counterId] || startValue;\n                              const diff = endValue - startValue;\n                              return (\n                                <div\n                                  key={counterId}\n                                  className=\"flex justify-between text-sm\"\n                                >\n                                  <span className=\"text-gray-600 dark:text-gray-400\">\n                                    Counter {counterId.slice(0, 8)}\n                                  </span>\n                                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                                    {startValue}  {endValue}\n                                    {diff > 0 && (\n                                      <span className=\"text-green-600 dark:text-green-400 ml-1\">\n                                        (+{diff})\n                                      </span>\n                                    )}\n                                  </span>\n                                </div>\n                              );\n                            }\n                          )}\n                        </div>\n                      </div>\n                    )}\n\n                  {/* Notes */}\n                  {session.notes && (\n                    <div className=\"mb-3\">\n                      <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\n                        Notes\n                      </div>\n                      <div className=\"text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded\">\n                        {session.notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Delete Button */}\n                  {onDeleteSession && (\n                    <button\n                      onClick={() => onDeleteSession(session.id)}\n                      className=\"text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium\"\n                    >\n                      Delete Session\n                    </button>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiClock, FiPlus, FiTrash2, FiCheckCircle, FiCircle } from 'react-icons/fi';\nimport { ProjectMilestone } from '../../types/counter.types';\nimport { formatDuration as _formatDuration } from 'date-fns';\n\ninterface ProjectTimerProps {\n  projectId: string;\n  milestones: ProjectMilestone[];\n  totalTimeSeconds: number;\n  totalRows: number;\n  completedRows: number;\n  onAddMilestone: (milestone: Omit<ProjectMilestone, 'id' | 'created_at'>) => Promise<void>;\n  onUpdateMilestone: (milestoneId: string, updates: Partial<ProjectMilestone>) => Promise<void>;\n  onDeleteMilestone: (milestoneId: string) => Promise<void>;\n}\n\nexport const ProjectTimer: React.FC<ProjectTimerProps> = ({\n  projectId,\n  milestones,\n  totalTimeSeconds,\n  totalRows,\n  completedRows,\n  onAddMilestone,\n  onUpdateMilestone,\n  onDeleteMilestone,\n}) => {\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [_editingMilestone, _setEditingMilestone] = useState<ProjectMilestone | null>(null);\n  const [newMilestone, setNewMilestone] = useState({\n    name: '',\n    target_rows: 0,\n  });\n\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n\n    if (hours === 0) return `${minutes}m`;\n    if (hours < 10) return `${hours}h ${minutes}m`;\n    return `${hours}h`;\n  };\n\n  const calculateRowsPerHour = (): number => {\n    if (totalTimeSeconds === 0) return 0;\n    const hours = totalTimeSeconds / 3600;\n    return Math.round(completedRows / hours);\n  };\n\n  const calculateEstimatedCompletion = (): string => {\n    const rowsPerHour = calculateRowsPerHour();\n    if (rowsPerHour === 0) return 'Not enough data';\n\n    const remainingRows = totalRows - completedRows;\n    const estimatedHours = remainingRows / rowsPerHour;\n\n    if (estimatedHours < 1) {\n      return `~${Math.round(estimatedHours * 60)} minutes`;\n    }\n    if (estimatedHours < 24) {\n      return `~${Math.round(estimatedHours)} hours`;\n    }\n    const days = Math.round(estimatedHours / 24);\n    return `~${days} day${days !== 1 ? 's' : ''}`;\n  };\n\n  const handleAddMilestone = async () => {\n    if (!newMilestone.name.trim()) return;\n\n    try {\n      await onAddMilestone({\n        project_id: projectId,\n        name: newMilestone.name,\n        target_rows: newMilestone.target_rows || undefined,\n        actual_rows: 0,\n        time_spent_seconds: 0,\n        sort_order: milestones.length,\n      });\n\n      setNewMilestone({ name: '', target_rows: 0 });\n      setShowAddModal(false);\n    } catch (error) {\n      console.error('Failed to add milestone:', error);\n    }\n  };\n\n  const handleCompleteMilestone = async (milestone: ProjectMilestone) => {\n    try {\n      await onUpdateMilestone(milestone.id, {\n        completed_at: milestone.completed_at ? undefined : new Date().toISOString(),\n        actual_rows: milestone.actual_rows || completedRows,\n      });\n    } catch (error) {\n      console.error('Failed to complete milestone:', error);\n    }\n  };\n\n  const progressPercentage = totalRows > 0 ? (completedRows / totalRows) * 100 : 0;\n  const rowsPerHour = calculateRowsPerHour();\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n          <FiClock className=\"w-5 h-5\" />\n          Project Progress\n        </h3>\n        <button\n          onClick={() => setShowAddModal(true)}\n          className=\"flex items-center gap-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\n        >\n          <FiPlus className=\"w-4 h-4\" />\n          Add Milestone\n        </button>\n      </div>\n\n      {/* Overall Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Total Time</div>\n          <div className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {formatTime(totalTimeSeconds)}\n          </div>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Rows Complete</div>\n          <div className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {completedRows}\n            {totalRows > 0 && (\n              <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                /{totalRows}\n              </span>\n            )}\n          </div>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Average Pace</div>\n          <div className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {rowsPerHour}\n          </div>\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">rows/hour</div>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Time Remaining</div>\n          <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n            {calculateEstimatedCompletion()}\n          </div>\n        </div>\n      </div>\n\n      {/* Progress Bar */}\n      {totalRows > 0 && (\n        <div className=\"mb-6\">\n          <div className=\"flex justify-between text-sm mb-2\">\n            <span className=\"text-gray-600 dark:text-gray-400\">Overall Progress</span>\n            <span className=\"font-medium text-gray-900 dark:text-white\">\n              {progressPercentage.toFixed(1)}%\n            </span>\n          </div>\n          <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3\">\n            <div\n              className=\"bg-blue-600 h-3 rounded-full transition-all duration-300\"\n              style={{ width: `${Math.min(progressPercentage, 100)}%` }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Milestones */}\n      <div>\n        <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n          Milestones\n        </h4>\n\n        {milestones.length === 0 ? (\n          <div className=\"text-center py-6 text-gray-500 dark:text-gray-400\">\n            <FiCircle className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n            <p className=\"text-sm\">No milestones yet</p>\n            <p className=\"text-xs mt-1\">Break down your project into manageable sections</p>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            {milestones\n              .sort((a, b) => a.sort_order - b.sort_order)\n              .map((milestone) => {\n                const isCompleted = !!milestone.completed_at;\n                const milestoneProgress = milestone.target_rows\n                  ? Math.min(\n                      ((milestone.actual_rows || 0) / milestone.target_rows) * 100,\n                      100\n                    )\n                  : 0;\n\n                return (\n                  <div\n                    key={milestone.id}\n                    className={`p-3 rounded-lg border-2 transition-all ${\n                      isCompleted\n                        ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\n                        : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700'\n                    }`}\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div className=\"flex items-start gap-2 flex-1\">\n                        <button\n                          onClick={() => handleCompleteMilestone(milestone)}\n                          className=\"mt-0.5\"\n                        >\n                          {isCompleted ? (\n                            <FiCheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n                          ) : (\n                            <FiCircle className=\"w-5 h-5 text-gray-400\" />\n                          )}\n                        </button>\n                        <div className=\"flex-1\">\n                          <div\n                            className={`font-medium ${\n                              isCompleted\n                                ? 'text-green-900 dark:text-green-300 line-through'\n                                : 'text-gray-900 dark:text-white'\n                            }`}\n                          >\n                            {milestone.name}\n                          </div>\n                          <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 space-x-3\">\n                            {milestone.target_rows && (\n                              <span>\n                                Target: {milestone.target_rows} rows\n                              </span>\n                            )}\n                            {milestone.time_spent_seconds > 0 && (\n                              <span>\n                                Time: {formatTime(milestone.time_spent_seconds)}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => onDeleteMilestone(milestone.id)}\n                        className=\"text-red-600 hover:text-red-700 dark:text-red-400 p-1\"\n                      >\n                        <FiTrash2 className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n\n                    {/* Milestone Progress Bar */}\n                    {milestone.target_rows && !isCompleted && (\n                      <div className=\"mt-2\">\n                        <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5\">\n                          <div\n                            className=\"bg-blue-600 h-1.5 rounded-full transition-all duration-300\"\n                            style={{ width: `${milestoneProgress}%` }}\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n          </div>\n        )}\n      </div>\n\n      {/* Add Milestone Modal */}\n      {showAddModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6\">\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\n              Add Milestone\n            </h3>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Milestone Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={newMilestone.name}\n                  onChange={(e) =>\n                    setNewMilestone({ ...newMilestone, name: e.target.value })\n                  }\n                  placeholder=\"e.g., Ribbing, Body, Sleeves\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Target Rows (optional)\n                </label>\n                <input\n                  type=\"number\"\n                  value={newMilestone.target_rows || ''}\n                  onChange={(e) =>\n                    setNewMilestone({\n                      ...newMilestone,\n                      target_rows: parseInt(e.target.value) || 0,\n                    })\n                  }\n                  placeholder=\"Number of rows for this section\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => setShowAddModal(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleAddMilestone}\n                disabled={!newMilestone.name.trim()}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors\"\n              >\n                Add Milestone\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import React, { useState, useEffect } from 'react';\nimport { SessionTimer } from './SessionTimer';\nimport { SessionHistory } from './SessionHistory';\nimport { ProjectTimer } from './ProjectTimer';\nimport { KnittingSession, ProjectMilestone } from '../../types/counter.types';\nimport axios from 'axios';\n\ninterface SessionManagerProps {\n  projectId: string;\n  totalRows?: number;\n  getCurrentCounterValues: () => Record<string, number>;\n}\n\nexport const SessionManager: React.FC<SessionManagerProps> = ({\n  projectId,\n  totalRows = 0,\n  getCurrentCounterValues,\n}) => {\n  const [currentSession, setCurrentSession] = useState<KnittingSession | null>(null);\n  const [sessions, setSessions] = useState<KnittingSession[]>([]);\n  const [milestones, setMilestones] = useState<ProjectMilestone[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState<'timer' | 'history' | 'progress'>('timer');\n\n  // Fetch sessions and milestones\n  useEffect(() => {\n    fetchSessions();\n    fetchMilestones();\n    checkActiveSession();\n  }, [projectId]);\n\n  const checkActiveSession = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${projectId}/sessions/active`);\n      if (response.data.success && response.data.data) {\n        setCurrentSession(response.data.data);\n      }\n    } catch (error) {\n      // No active session\n      console.log('No active session');\n    }\n  };\n\n  const fetchSessions = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/projects/${projectId}/sessions`);\n      setSessions(response.data.success ? response.data.data.sessions || [] : []);\n    } catch (error) {\n      console.error('Failed to fetch sessions:', error);\n      setSessions([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMilestones = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${projectId}/milestones`);\n      setMilestones(response.data.success ? response.data.data.milestones || [] : []);\n    } catch (error) {\n      console.error('Failed to fetch milestones:', error);\n      setMilestones([]);\n    }\n  };\n\n  const handleStartSession = async (): Promise<KnittingSession> => {\n    try {\n      const response = await axios.post(`/api/projects/${projectId}/sessions/start`, {\n        mood: undefined,\n        location: undefined,\n        notes: undefined,\n      });\n\n      const newSession = response.data.success ? response.data.data.session : response.data;\n      setCurrentSession(newSession);\n      return newSession;\n    } catch (error) {\n      console.error('Failed to start session:', error);\n      throw error;\n    }\n  };\n\n  const handleEndSession = async (notes?: string, mood?: string) => {\n    if (!currentSession) return;\n\n    try {\n      await axios.post(`/api/projects/${projectId}/sessions/${currentSession.id}/end`, {\n        notes,\n        mood,\n      });\n\n      setCurrentSession(null);\n      fetchSessions(); // Refresh session list\n    } catch (error) {\n      console.error('Failed to end session:', error);\n      throw error;\n    }\n  };\n\n  const handleDeleteSession = async (sessionId: string) => {\n    try {\n      await axios.delete(`/api/projects/${projectId}/sessions/${sessionId}`);\n      setSessions(sessions.filter((s) => s.id !== sessionId));\n    } catch (error) {\n      console.error('Failed to delete session:', error);\n    }\n  };\n\n  const handleAddMilestone = async (\n    milestone: Omit<ProjectMilestone, 'id' | 'created_at'>\n  ) => {\n    try {\n      const response = await axios.post(`/api/projects/${projectId}/milestones`, {\n        name: milestone.name,\n        targetRows: milestone.target_rows,\n      });\n      const newMilestone = response.data.success ? response.data.data.milestone : response.data;\n      setMilestones([...milestones, newMilestone]);\n    } catch (error) {\n      console.error('Failed to add milestone:', error);\n      throw error;\n    }\n  };\n\n  const handleUpdateMilestone = async (\n    milestoneId: string,\n    updates: Partial<ProjectMilestone>\n  ) => {\n    try {\n      const response = await axios.put(\n        `/api/projects/${projectId}/milestones/${milestoneId}`,\n        {\n          name: updates.name,\n          targetRows: updates.target_rows,\n          actualRows: updates.actual_rows,\n          timeSpentSeconds: updates.time_spent_seconds,\n          completedAt: updates.completed_at,\n        }\n      );\n      const updatedMilestone = response.data.success ? response.data.data.milestone : response.data;\n      setMilestones(\n        milestones.map((m) => (m.id === milestoneId ? updatedMilestone : m))\n      );\n    } catch (error) {\n      console.error('Failed to update milestone:', error);\n      throw error;\n    }\n  };\n\n  const handleDeleteMilestone = async (milestoneId: string) => {\n    try {\n      await axios.delete(`/api/projects/${projectId}/milestones/${milestoneId}`);\n      setMilestones(milestones.filter((m) => m.id !== milestoneId));\n    } catch (error) {\n      console.error('Failed to delete milestone:', error);\n      throw error;\n    }\n  };\n\n  // Calculate totals\n  const totalTimeSeconds = sessions.reduce(\n    (sum, session) => sum + (session.duration_seconds || 0),\n    0\n  );\n  const completedRows = sessions.reduce(\n    (sum, session) => sum + session.rows_completed,\n    0\n  );\n\n  if (loading) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n        <div className=\"text-center text-gray-500 dark:text-gray-400\">\n          Loading sessions...\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Tab Navigation */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden\">\n        <div className=\"flex border-b border-gray-200 dark:border-gray-700\">\n          <button\n            onClick={() => setActiveTab('timer')}\n            className={`flex-1 px-4 py-3 font-medium transition-colors ${\n              activeTab === 'timer'\n                ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\n            }`}\n          >\n            Session Timer\n          </button>\n          <button\n            onClick={() => setActiveTab('progress')}\n            className={`flex-1 px-4 py-3 font-medium transition-colors ${\n              activeTab === 'progress'\n                ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\n            }`}\n          >\n            Progress\n          </button>\n          <button\n            onClick={() => setActiveTab('history')}\n            className={`flex-1 px-4 py-3 font-medium transition-colors ${\n              activeTab === 'history'\n                ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\n            }`}\n          >\n            History ({sessions.length})\n          </button>\n        </div>\n\n        <div className=\"p-6\">\n          {/* Session Timer Tab */}\n          {activeTab === 'timer' && (\n            <SessionTimer\n              projectId={projectId}\n              currentSession={currentSession}\n              onStartSession={handleStartSession}\n              onEndSession={handleEndSession}\n              getCurrentCounterValues={getCurrentCounterValues}\n            />\n          )}\n\n          {/* Progress Tab */}\n          {activeTab === 'progress' && (\n            <ProjectTimer\n              projectId={projectId}\n              milestones={milestones}\n              totalTimeSeconds={totalTimeSeconds}\n              totalRows={totalRows}\n              completedRows={completedRows}\n              onAddMilestone={handleAddMilestone}\n              onUpdateMilestone={handleUpdateMilestone}\n              onDeleteMilestone={handleDeleteMilestone}\n            />\n          )}\n\n          {/* History Tab */}\n          {activeTab === 'history' && (\n            <SessionHistory sessions={sessions} onDeleteSession={handleDeleteSession} />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React, { createContext, useContext, useEffect, useState, useCallback, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { useAuthStore } from '../stores/authStore';\n\ninterface WebSocketContextType {\n  socket: Socket | null;\n  isConnected: boolean;\n  joinProject: (projectId: string) => void;\n  leaveProject: (projectId: string) => void;\n  emitCounterUpdate: (counterId: string, projectId: string, currentValue: number) => void;\n  emitCounterIncrement: (counterId: string, projectId: string, currentValue: number) => void;\n  emitCounterDecrement: (counterId: string, projectId: string, currentValue: number) => void;\n  emitCounterReset: (counterId: string, projectId: string) => void;\n  onCounterUpdate: (callback: (data: { counterId: string; projectId: string; currentValue: number }) => void) => void;\n  offCounterUpdate: (callback: (data: { counterId: string; projectId: string; currentValue: number }) => void) => void;\n}\n\nconst WebSocketContext = createContext<WebSocketContextType | undefined>(undefined);\n\nexport const WebSocketProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [socket, setSocket] = useState<Socket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const { accessToken } = useAuthStore();\n  const socketRef = useRef<Socket | null>(null);\n\n  useEffect(() => {\n    if (!accessToken) {\n      // Disconnect if no token\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n        socketRef.current = null;\n        setSocket(null);\n        setIsConnected(false);\n      }\n      return;\n    }\n\n    // Create Socket.IO connection\n    const socketUrl = import.meta.env.VITE_API_URL || 'http://localhost:5000';\n\n    const newSocket = io(socketUrl, {\n      auth: {\n        token: accessToken,\n      },\n      transports: ['websocket', 'polling'],\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      reconnectionAttempts: 5,\n    });\n\n    newSocket.on('connect', () => {\n      console.log(' Socket.IO connected:', newSocket.id);\n      setIsConnected(true);\n    });\n\n    newSocket.on('disconnect', (reason) => {\n      console.log(' Socket.IO disconnected:', reason);\n      setIsConnected(false);\n    });\n\n    newSocket.on('connect_error', (error) => {\n      console.error('Socket.IO connection error:', error);\n      setIsConnected(false);\n    });\n\n    socketRef.current = newSocket;\n    setSocket(newSocket);\n\n    // Cleanup on unmount\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n        socketRef.current = null;\n      }\n    };\n  }, [accessToken]);\n\n  const joinProject = useCallback((projectId: string) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('join:project', projectId);\n      console.log(`Joined project room: ${projectId}`);\n    }\n  }, []);\n\n  const leaveProject = useCallback((projectId: string) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('leave:project', projectId);\n      console.log(`Left project room: ${projectId}`);\n    }\n  }, []);\n\n  const emitCounterUpdate = useCallback((counterId: string, projectId: string, currentValue: number) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:update', { counterId, projectId, currentValue });\n    }\n  }, []);\n\n  const emitCounterIncrement = useCallback((counterId: string, projectId: string, currentValue: number) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:increment', { counterId, projectId, currentValue });\n    }\n  }, []);\n\n  const emitCounterDecrement = useCallback((counterId: string, projectId: string, currentValue: number) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:decrement', { counterId, projectId, currentValue });\n    }\n  }, []);\n\n  const emitCounterReset = useCallback((counterId: string, projectId: string) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:reset', { counterId, projectId });\n    }\n  }, []);\n\n  const onCounterUpdate = useCallback((callback: (data: any) => void) => {\n    if (socketRef.current) {\n      socketRef.current.on('counter:updated', callback);\n      socketRef.current.on('counter:incremented', callback);\n      socketRef.current.on('counter:decremented', callback);\n    }\n  }, []);\n\n  const offCounterUpdate = useCallback((callback: (data: any) => void) => {\n    if (socketRef.current) {\n      socketRef.current.off('counter:updated', callback);\n      socketRef.current.off('counter:incremented', callback);\n      socketRef.current.off('counter:decremented', callback);\n    }\n  }, []);\n\n  const value: WebSocketContextType = {\n    socket,\n    isConnected,\n    joinProject,\n    leaveProject,\n    emitCounterUpdate,\n    emitCounterIncrement,\n    emitCounterDecrement,\n    emitCounterReset,\n    onCounterUpdate,\n    offCounterUpdate,\n  };\n\n  return <WebSocketContext.Provider value={value}>{children}</WebSocketContext.Provider>;\n};\n\nexport const useWebSocket = (): WebSocketContextType => {\n  const context = useContext(WebSocketContext);\n  if (context === undefined) {\n    throw new Error('useWebSocket must be used within a WebSocketProvider');\n  }\n  return context;\n};\n","// @ts-nocheck\nimport React, { useState, useRef, useEffect } from 'react';\nimport { FiMic, FiSquare, FiPlay, FiPause, FiTrash2, FiDownload, FiEdit2, FiCheck, FiX } from 'react-icons/fi';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface AudioNote {\n  id: string;\n  project_id: string;\n  pattern_id?: string;\n  audio_url: string;\n  transcription?: string;\n  duration_seconds: number;\n  counter_values?: Record<string, number>;\n  created_at: string;\n}\n\ninterface AudioNotesProps {\n  projectId: string;\n  patternId?: string;\n  notes: AudioNote[];\n  getCurrentCounterValues?: () => Record<string, number>;\n  onSaveNote: (audioBlob: Blob, durationSeconds: number, transcription?: string) => Promise<void>;\n  onDeleteNote: (noteId: string) => Promise<void>;\n  onUpdateTranscription?: (noteId: string, transcription: string) => Promise<void>;\n}\n\nexport const AudioNotes: React.FC<AudioNotesProps> = ({\n  projectId,\n  patternId,\n  notes,\n  getCurrentCounterValues,\n  onSaveNote,\n  onDeleteNote,\n  onUpdateTranscription,\n}) => {\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [playingNoteId, setPlayingNoteId] = useState<string | null>(null);\n  const [editingNoteId, setEditingNoteId] = useState<string | null>(null);\n  const [editTranscription, setEditTranscription] = useState('');\n\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const recordingIntervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const recordingTimeRef = useRef<number>(0);\n  const audioElementsRef = useRef<Map<string, HTMLAudioElement>>(new Map());\n  const recordingMimeTypeRef = useRef<string>('audio/webm');\n\n  // Cleanup audio elements on unmount\n  useEffect(() => {\n    return () => {\n      audioElementsRef.current.forEach((audio) => {\n        audio.pause();\n        audio.src = '';\n      });\n      audioElementsRef.current.clear();\n    };\n  }, []);\n\n  // Get the best supported audio mime type for recording\n  const getSupportedMimeType = (): string => {\n    const types = [\n      'audio/webm;codecs=opus',\n      'audio/webm',\n      'audio/ogg;codecs=opus',\n      'audio/mp4',\n      'audio/mpeg',\n      'audio/wav',\n    ];\n\n    for (const type of types) {\n      if (MediaRecorder.isTypeSupported(type)) {\n        console.log(` Using audio mime type: ${type}`);\n        return type;\n      }\n    }\n\n    console.warn(' No preferred mime type supported, using browser default');\n    return '';\n  };\n\n  const startRecording = async () => {\n    try {\n      // Check if MediaRecorder API is supported\n      if (!window.MediaRecorder) {\n        alert(' Audio recording is not supported in this browser. Please use Chrome, Firefox, Edge, or Safari.');\n        return;\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n      // Detect supported mime type\n      const mimeType = getSupportedMimeType();\n      recordingMimeTypeRef.current = mimeType;\n\n      // Create MediaRecorder with supported mime type\n      const options = mimeType ? { mimeType } : {};\n      const mediaRecorder = new MediaRecorder(stream, options);\n\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          console.log(` Audio chunk received: ${event.data.size} bytes`);\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      mediaRecorder.onstop = async () => {\n        console.log(` Recording stopped. Total chunks: ${audioChunksRef.current.length}`);\n\n        // Use the actual mime type from the MediaRecorder\n        const actualMimeType = mediaRecorder.mimeType || recordingMimeTypeRef.current;\n        const audioBlob = new Blob(audioChunksRef.current, { type: actualMimeType });\n\n        console.log(` Audio blob created: ${audioBlob.size} bytes, type: ${actualMimeType}`);\n\n        // Stop all tracks\n        stream.getTracks().forEach((track) => track.stop());\n\n        // Validate blob before saving\n        if (audioBlob.size === 0) {\n          console.error(' Audio blob is empty - no data was recorded');\n          alert('Recording failed: No audio data was captured. Please try again.');\n          return;\n        }\n\n        // Save the note with duration (transcription can be added manually later)\n        // Use ref value instead of state to get the current recording time\n        const duration = recordingTimeRef.current;\n        console.log(`  Recording duration: ${duration} seconds`);\n        try {\n          await onSaveNote(audioBlob, duration, undefined);\n          console.log(' Audio note saved successfully');\n        } catch (error) {\n          console.error('Failed to save audio note:', error);\n          alert('Failed to save audio note');\n        }\n      };\n\n      // Add error handler for MediaRecorder\n      mediaRecorder.onerror = (event: any) => {\n        console.error(' MediaRecorder error:', event.error);\n        alert(`Recording error: ${event.error?.message || 'Unknown error occurred'}`);\n      };\n\n      mediaRecorder.start(1000); // Request data every 1000ms for reliability\n      setIsRecording(true);\n      setRecordingTime(0);\n      recordingTimeRef.current = 0;\n\n      // Start recording timer\n      recordingIntervalRef.current = setInterval(() => {\n        recordingTimeRef.current += 1;\n        setRecordingTime(recordingTimeRef.current);\n      }, 1000);\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n\n      // Provide specific error messages based on error type\n      if (error instanceof DOMException) {\n        switch (error.name) {\n          case 'NotAllowedError':\n            alert(' Microphone access denied. Please allow microphone permissions in your browser settings and try again.');\n            break;\n          case 'NotFoundError':\n            alert(' No microphone found. Please connect a microphone and try again.');\n            break;\n          case 'NotReadableError':\n            alert(' Microphone is already in use by another application. Please close other apps using the microphone and try again.');\n            break;\n          default:\n            alert(` Failed to access microphone: ${error.message}`);\n        }\n      } else {\n        alert('Failed to access microphone. Please grant microphone permissions.');\n      }\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n\n      if (recordingIntervalRef.current) {\n        clearInterval(recordingIntervalRef.current);\n        recordingIntervalRef.current = null;\n      }\n    }\n  };\n\n  const playAudio = (note: AudioNote) => {\n    // Pause any currently playing audio\n    if (playingNoteId) {\n      const currentAudio = audioElementsRef.current.get(playingNoteId);\n      if (currentAudio) {\n        currentAudio.pause();\n        currentAudio.currentTime = 0;\n      }\n    }\n\n    // Get or create audio element for this note\n    let audio = audioElementsRef.current.get(note.id);\n    if (!audio) {\n      audio = new Audio(note.audio_url);\n      audio.onended = () => setPlayingNoteId(null);\n      audioElementsRef.current.set(note.id, audio);\n    }\n\n    if (playingNoteId === note.id) {\n      audio.pause();\n      setPlayingNoteId(null);\n    } else {\n      audio.play();\n      setPlayingNoteId(note.id);\n    }\n  };\n\n  const handleDeleteNote = async (noteId: string) => {\n    if (!confirm('Are you sure you want to delete this audio note?')) return;\n\n    try {\n      // Stop and cleanup audio if playing\n      const audio = audioElementsRef.current.get(noteId);\n      if (audio) {\n        audio.pause();\n        audio.src = '';\n        audioElementsRef.current.delete(noteId);\n      }\n\n      await onDeleteNote(noteId);\n    } catch (error) {\n      console.error('Failed to delete note:', error);\n      alert('Failed to delete note');\n    }\n  };\n\n  const startEditTranscription = (note: AudioNote) => {\n    setEditingNoteId(note.id);\n    setEditTranscription(note.transcription || '');\n  };\n\n  const saveTranscription = async (noteId: string) => {\n    if (!onUpdateTranscription) return;\n\n    try {\n      await onUpdateTranscription(noteId, editTranscription);\n      setEditingNoteId(null);\n      setEditTranscription('');\n    } catch (error) {\n      console.error('Failed to update transcription:', error);\n      alert('Failed to update transcription');\n    }\n  };\n\n  const cancelEditTranscription = () => {\n    setEditingNoteId(null);\n    setEditTranscription('');\n  };\n\n  const formatDuration = (seconds: number): string => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n        Audio Notes\n      </h3>\n\n      {/* Recording Controls */}\n      <div className=\"mb-6\">\n        {!isRecording ? (\n          <button\n            onClick={startRecording}\n            className=\"w-full flex items-center justify-center gap-3 px-6 py-4 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n          >\n            <FiMic className=\"w-6 h-6\" />\n            Start Recording\n          </button>\n        ) : (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-center gap-3 py-4\">\n              <div className=\"w-4 h-4 bg-red-600 rounded-full animate-pulse\" />\n              <span className=\"text-2xl font-bold text-gray-900 dark:text-white tabular-nums\">\n                {formatDuration(recordingTime)}\n              </span>\n            </div>\n            <button\n              onClick={stopRecording}\n              className=\"w-full flex items-center justify-center gap-3 px-6 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n            >\n              <FiSquare className=\"w-6 h-6\" />\n              Stop Recording\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Audio Notes List */}\n      <div className=\"space-y-3\">\n        {notes.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n            <FiMic className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>No audio notes yet</p>\n            <p className=\"text-sm mt-1\">Record your first voice note</p>\n          </div>\n        ) : (\n          notes.map((note) => (\n            <div\n              key={note.id}\n              className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n            >\n              {/* Note Header */}\n              <div className=\"flex items-center justify-between mb-3\">\n                <div>\n                  <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    {formatDistanceToNow(new Date(note.created_at), { addSuffix: true })}\n                  </div>\n                  <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    Duration: {formatDuration(note.duration_seconds)}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    onClick={() => playAudio(note)}\n                    className={`p-2 rounded-lg transition-colors ${\n                      playingNoteId === note.id\n                        ? 'bg-blue-600 text-white'\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                    }`}\n                    title={playingNoteId === note.id ? 'Pause' : 'Play'}\n                  >\n                    {playingNoteId === note.id ? (\n                      <FiPause className=\"w-5 h-5\" />\n                    ) : (\n                      <FiPlay className=\"w-5 h-5\" />\n                    )}\n                  </button>\n                  <a\n                    href={note.audio_url}\n                    download={`audio-note-${note.id}.webm`}\n                    className=\"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600\"\n                    title=\"Download\"\n                  >\n                    <FiDownload className=\"w-5 h-5\" />\n                  </a>\n                  <button\n                    onClick={() => handleDeleteNote(note.id)}\n                    className=\"p-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30\"\n                    title=\"Delete\"\n                  >\n                    <FiTrash2 className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </div>\n\n              {/* Transcription */}\n              {editingNoteId === note.id ? (\n                <div className=\"space-y-2\">\n                  <textarea\n                    value={editTranscription}\n                    onChange={(e) => setEditTranscription(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm\"\n                    rows={3}\n                    placeholder=\"Add transcription or notes...\"\n                  />\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => saveTranscription(note.id)}\n                      className=\"flex items-center gap-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm\"\n                    >\n                      <FiCheck className=\"w-4 h-4\" />\n                      Save\n                    </button>\n                    <button\n                      onClick={cancelEditTranscription}\n                      className=\"flex items-center gap-1 px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm\"\n                    >\n                      <FiX className=\"w-4 h-4\" />\n                      Cancel\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"bg-gray-50 dark:bg-gray-700 rounded p-3\">\n                  <div className=\"flex items-start justify-between mb-1\">\n                    <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400\">\n                      Transcription\n                    </div>\n                    {onUpdateTranscription && (\n                      <button\n                        onClick={() => startEditTranscription(note)}\n                        className=\"text-blue-600 dark:text-blue-400 hover:text-blue-700\"\n                      >\n                        <FiEdit2 className=\"w-3 h-3\" />\n                      </button>\n                    )}\n                  </div>\n                  <div className=\"text-sm text-gray-700 dark:text-gray-300\">\n                    {note.transcription || (\n                      <span className=\"italic text-gray-500 dark:text-gray-400\">\n                        No transcription available. Click edit to add notes.\n                      </span>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Counter Values */}\n              {note.counter_values && Object.keys(note.counter_values).length > 0 && (\n                <div className=\"mt-3 text-xs text-gray-500 dark:text-gray-400\">\n                  <span className=\"font-medium\">At: </span>\n                  {Object.entries(note.counter_values)\n                    .map(([key, value]) => `${key}: ${value}`)\n                    .join(', ')}\n                </div>\n              )}\n            </div>\n          ))\n        )}\n      </div>\n\n      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-4\">\n         Tip: Click the microphone icon to record voice notes hands-free while knitting\n      </p>\n    </div>\n  );\n};\n","// @ts-nocheck\nimport React, { useRef, useState, useEffect } from 'react';\nimport { FiEdit3, FiTrash, FiDownload, FiTrash2, FiRotateCcw, FiRotateCw, FiDroplet } from 'react-icons/fi';\n\ninterface HandwrittenNotesProps {\n  patternId?: string;\n  projectId: string;\n  pageNumber?: number;\n  onSave?: (imageData: string) => Promise<void>;\n  initialData?: string; // Base64 image data\n}\n\ninterface DrawingPoint {\n  x: number;\n  y: number;\n}\n\ninterface DrawingPath {\n  points: DrawingPoint[];\n  color: string;\n  width: number;\n  tool: 'pen' | 'eraser';\n}\n\nconst COLORS = [\n  { name: 'Black', value: '#000000' },\n  { name: 'Blue', value: '#3B82F6' },\n  { name: 'Red', value: '#EF4444' },\n  { name: 'Green', value: '#10B981' },\n  { name: 'Purple', value: '#8B5CF6' },\n  { name: 'Orange', value: '#F97316' },\n  { name: 'Pink', value: '#EC4899' },\n  { name: 'Yellow', value: '#FBBF24' },\n];\n\nconst LINE_WIDTHS = [2, 4, 6, 8, 12];\n\nexport const HandwrittenNotes: React.FC<HandwrittenNotesProps> = ({\n  patternId,\n  projectId,\n  pageNumber,\n  onSave,\n  initialData,\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [currentPath, setCurrentPath] = useState<DrawingPoint[]>([]);\n  const [paths, setPaths] = useState<DrawingPath[]>([]);\n  const [undoStack, setUndoStack] = useState<DrawingPath[][]>([]);\n  const [redoStack, setRedoStack] = useState<DrawingPath[][]>([]);\n\n  const [tool, setTool] = useState<'pen' | 'eraser'>('pen');\n  const [color, setColor] = useState('#000000');\n  const [lineWidth, setLineWidth] = useState(4);\n  const [showColorPicker, setShowColorPicker] = useState(false);\n  const [showWidthPicker, setShowWidthPicker] = useState(false);\n\n  // Initialize canvas\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const container = containerRef.current;\n    if (!canvas || !container) return;\n\n    // Set canvas size to match container\n    const rect = container.getBoundingClientRect();\n    canvas.width = rect.width;\n    canvas.height = Math.max(rect.height, 400);\n\n    // Set white background\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      ctx.fillStyle = '#FFFFFF';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      // Load initial data if provided\n      if (initialData) {\n        const img = new Image();\n        img.onload = () => {\n          ctx.drawImage(img, 0, 0);\n        };\n        img.src = initialData;\n      }\n    }\n  }, [initialData]);\n\n  // Redraw canvas when paths change\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Clear canvas\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Draw all paths\n    paths.forEach((path) => {\n      if (path.points.length < 2) return;\n\n      ctx.beginPath();\n      ctx.strokeStyle = path.tool === 'eraser' ? '#FFFFFF' : path.color;\n      ctx.lineWidth = path.tool === 'eraser' ? path.width * 2 : path.width;\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n\n      ctx.moveTo(path.points[0].x, path.points[0].y);\n      for (let i = 1; i < path.points.length; i++) {\n        ctx.lineTo(path.points[i].x, path.points[i].y);\n      }\n      ctx.stroke();\n    });\n  }, [paths]);\n\n  const getCanvasPoint = (e: React.MouseEvent | React.TouchEvent): DrawingPoint => {\n    const canvas = canvasRef.current;\n    if (!canvas) return { x: 0, y: 0 };\n\n    const rect = canvas.getBoundingClientRect();\n    let clientX: number, clientY: number;\n\n    if ('touches' in e) {\n      clientX = e.touches[0].clientX;\n      clientY = e.touches[0].clientY;\n    } else {\n      clientX = e.clientX;\n      clientY = e.clientY;\n    }\n\n    return {\n      x: clientX - rect.left,\n      y: clientY - rect.top,\n    };\n  };\n\n  const startDrawing = (e: React.MouseEvent | React.TouchEvent) => {\n    e.preventDefault();\n    setIsDrawing(true);\n    const point = getCanvasPoint(e);\n    setCurrentPath([point]);\n  };\n\n  const draw = (e: React.MouseEvent | React.TouchEvent) => {\n    if (!isDrawing) return;\n    e.preventDefault();\n\n    const point = getCanvasPoint(e);\n    setCurrentPath((prev) => [...prev, point]);\n\n    // Draw current stroke immediately\n    const canvas = canvasRef.current;\n    const ctx = canvas?.getContext('2d');\n    if (!ctx || currentPath.length === 0) return;\n\n    ctx.beginPath();\n    ctx.strokeStyle = tool === 'eraser' ? '#FFFFFF' : color;\n    ctx.lineWidth = tool === 'eraser' ? lineWidth * 2 : lineWidth;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    const lastPoint = currentPath[currentPath.length - 1];\n    ctx.moveTo(lastPoint.x, lastPoint.y);\n    ctx.lineTo(point.x, point.y);\n    ctx.stroke();\n  };\n\n  const endDrawing = () => {\n    if (!isDrawing) return;\n    setIsDrawing(false);\n\n    if (currentPath.length > 1) {\n      const newPath: DrawingPath = {\n        points: currentPath,\n        color,\n        width: lineWidth,\n        tool,\n      };\n\n      // Save state for undo\n      setUndoStack((prev) => [...prev, paths]);\n      setRedoStack([]); // Clear redo stack on new action\n\n      setPaths((prev) => [...prev, newPath]);\n    }\n\n    setCurrentPath([]);\n  };\n\n  const handleUndo = () => {\n    if (undoStack.length === 0) return;\n\n    const previousState = undoStack[undoStack.length - 1];\n    setRedoStack((prev) => [...prev, paths]);\n    setPaths(previousState);\n    setUndoStack((prev) => prev.slice(0, -1));\n  };\n\n  const handleRedo = () => {\n    if (redoStack.length === 0) return;\n\n    const nextState = redoStack[redoStack.length - 1];\n    setUndoStack((prev) => [...prev, paths]);\n    setPaths(nextState);\n    setRedoStack((prev) => prev.slice(0, -1));\n  };\n\n  const handleClear = () => {\n    if (paths.length === 0) return;\n\n    setUndoStack((prev) => [...prev, paths]);\n    setRedoStack([]);\n    setPaths([]);\n  };\n\n  const handleExport = async () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const imageData = canvas.toDataURL('image/png');\n\n    if (onSave) {\n      try {\n        await onSave(imageData);\n        alert('Notes saved successfully!');\n      } catch (error) {\n        console.error('Failed to save notes:', error);\n        alert('Failed to save notes');\n      }\n    } else {\n      // Download as file\n      const link = document.createElement('a');\n      link.download = `notes-${Date.now()}.png`;\n      link.href = imageData;\n      link.click();\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Handwritten Notes\n        </h3>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleUndo}\n            disabled={undoStack.length === 0}\n            className=\"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed\"\n            title=\"Undo\"\n          >\n            <FiRotateCcw className=\"w-5 h-5\" />\n          </button>\n          <button\n            onClick={handleRedo}\n            disabled={redoStack.length === 0}\n            className=\"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed\"\n            title=\"Redo\"\n          >\n            <FiRotateCw className=\"w-5 h-5\" />\n          </button>\n          <button\n            onClick={handleClear}\n            className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded\"\n            title=\"Clear all\"\n          >\n            <FiTrash2 className=\"w-5 h-5\" />\n          </button>\n          <button\n            onClick={handleExport}\n            className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded\"\n            title=\"Save/Export\"\n          >\n            <FiDownload className=\"w-5 h-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Drawing Tools */}\n      <div className=\"flex items-center gap-3 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex-wrap\">\n        {/* Tool Selection */}\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => setTool('pen')}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${\n              tool === 'pen'\n                ? 'bg-blue-600 text-white'\n                : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500'\n            }`}\n          >\n            <FiEdit3 className=\"w-4 h-4\" />\n            Pen\n          </button>\n          <button\n            onClick={() => setTool('eraser')}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${\n              tool === 'eraser'\n                ? 'bg-blue-600 text-white'\n                : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500'\n            }`}\n          >\n            <FiTrash className=\"w-4 h-4\" />\n            Eraser\n          </button>\n        </div>\n\n        {/* Color Picker */}\n        {tool === 'pen' && (\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowColorPicker(!showColorPicker)}\n              className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg\"\n            >\n              <FiDroplet className=\"w-4 h-4\" />\n              <div\n                className=\"w-6 h-6 rounded border-2 border-gray-300\"\n                style={{ backgroundColor: color }}\n              />\n            </button>\n            {showColorPicker && (\n              <div className=\"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10\">\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {COLORS.map((c) => (\n                    <button\n                      key={c.value}\n                      onClick={() => {\n                        setColor(c.value);\n                        setShowColorPicker(false);\n                      }}\n                      className={`w-8 h-8 rounded border-2 transition-transform hover:scale-110 ${\n                        color === c.value\n                          ? 'border-blue-600 ring-2 ring-blue-300'\n                          : 'border-gray-300'\n                      }`}\n                      style={{ backgroundColor: c.value }}\n                      title={c.name}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Line Width */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowWidthPicker(!showWidthPicker)}\n            className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg\"\n          >\n            <div\n              className=\"rounded-full bg-gray-900 dark:bg-white\"\n              style={{ width: lineWidth * 2, height: lineWidth * 2 }}\n            />\n            {lineWidth}px\n          </button>\n          {showWidthPicker && (\n            <div className=\"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10\">\n              <div className=\"flex flex-col gap-2\">\n                {LINE_WIDTHS.map((width) => (\n                  <button\n                    key={width}\n                    onClick={() => {\n                      setLineWidth(width);\n                      setShowWidthPicker(false);\n                    }}\n                    className={`flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${\n                      lineWidth === width ? 'bg-blue-50 dark:bg-blue-900/20' : ''\n                    }`}\n                  >\n                    <div\n                      className=\"rounded-full bg-gray-900 dark:bg-white\"\n                      style={{ width: width * 2, height: width * 2 }}\n                    />\n                    <span className=\"text-sm\">{width}px</span>\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Drawing Canvas */}\n      <div\n        ref={containerRef}\n        className=\"border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white\"\n        style={{ touchAction: 'none' }}\n      >\n        <canvas\n          ref={canvasRef}\n          onMouseDown={startDrawing}\n          onMouseMove={draw}\n          onMouseUp={endDrawing}\n          onMouseLeave={endDrawing}\n          onTouchStart={startDrawing}\n          onTouchMove={draw}\n          onTouchEnd={endDrawing}\n          className=\"cursor-crosshair\"\n        />\n      </div>\n\n      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n        Draw on the canvas with your mouse, trackpad, or touch screen. Use the eraser to remove\n        strokes.\n      </p>\n    </div>\n  );\n};\n","// @ts-nocheck\nimport React, { useState } from 'react';\nimport { FiFileText, FiPlus, FiTrash2, FiDownload } from 'react-icons/fi';\nimport { formatDistanceToNow } from 'date-fns';\n\ntype TemplateType = 'gauge_swatch' | 'fit_adjustment' | 'yarn_substitution' | 'finishing_techniques';\n\ninterface GaugeSwatchData {\n  needle_size: string;\n  stitches_per_inch: number;\n  rows_per_inch: number;\n  swatch_width: number;\n  swatch_height: number;\n  notes?: string;\n}\n\ninterface FitAdjustmentData {\n  measurement_name: string;\n  original_value: number;\n  adjusted_value: number;\n  reason: string;\n  notes?: string;\n}\n\ninterface YarnSubstitutionData {\n  original_yarn_name: string;\n  original_yarn_weight: string;\n  original_yardage: number;\n  replacement_yarn_name: string;\n  replacement_yarn_weight: string;\n  replacement_yardage: number;\n  gauge_comparison: string;\n  notes?: string;\n}\n\ninterface FinishingTechniquesData {\n  bind_off_method: string;\n  seaming_technique: string;\n  blocking_instructions: string;\n  notes?: string;\n}\n\ntype MemoData = GaugeSwatchData | FitAdjustmentData | YarnSubstitutionData | FinishingTechniquesData;\n\ninterface StructuredMemo {\n  id: string;\n  project_id: string;\n  template_type: TemplateType;\n  data: MemoData;\n  created_at: string;\n}\n\ninterface StructuredMemoTemplatesProps {\n  projectId: string;\n  memos: StructuredMemo[];\n  onSaveMemo: (templateType: TemplateType, data: MemoData) => Promise<void>;\n  onDeleteMemo: (memoId: string) => Promise<void>;\n}\n\nconst TEMPLATE_INFO = {\n  gauge_swatch: {\n    name: 'Gauge Swatch',\n    icon: '',\n    description: 'Record gauge measurements for accurate sizing',\n  },\n  fit_adjustment: {\n    name: 'Fit Adjustment',\n    icon: '',\n    description: 'Track modifications to pattern measurements',\n  },\n  yarn_substitution: {\n    name: 'Yarn Substitution',\n    icon: '',\n    description: 'Document yarn changes and gauge comparison',\n  },\n  finishing_techniques: {\n    name: 'Finishing Techniques',\n    icon: '',\n    description: 'Notes on bind-off, seaming, and blocking',\n  },\n};\n\nexport const StructuredMemoTemplates: React.FC<StructuredMemoTemplatesProps> = ({\n  projectId,\n  memos,\n  onSaveMemo,\n  onDeleteMemo,\n}) => {\n  const [showNewMemoModal, setShowNewMemoModal] = useState(false);\n  const [selectedTemplate, setSelectedTemplate] = useState<TemplateType>('gauge_swatch');\n  const [formData, setFormData] = useState<any>({});\n\n  const handleOpenNewMemo = (templateType: TemplateType) => {\n    setSelectedTemplate(templateType);\n    setFormData({});\n    setShowNewMemoModal(true);\n  };\n\n  const handleSaveMemo = async () => {\n    try {\n      await onSaveMemo(selectedTemplate, formData);\n      setShowNewMemoModal(false);\n      setFormData({});\n    } catch (error) {\n      console.error('Failed to save memo:', error);\n      alert('Failed to save memo');\n    }\n  };\n\n  const handleDeleteMemo = async (memoId: string) => {\n    if (!confirm('Are you sure you want to delete this memo?')) return;\n\n    try {\n      await onDeleteMemo(memoId);\n    } catch (error) {\n      console.error('Failed to delete memo:', error);\n      alert('Failed to delete memo');\n    }\n  };\n\n  const exportMemo = (memo: StructuredMemo) => {\n    const text = renderMemoAsText(memo);\n    const blob = new Blob([text], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${TEMPLATE_INFO[memo.template_type].name.replace(/\\s/g, '_')}_${memo.id}.txt`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const renderMemoAsText = (memo: StructuredMemo): string => {\n    const title = TEMPLATE_INFO[memo.template_type].name;\n    const date = new Date(memo.created_at).toLocaleDateString();\n\n    let content = `${title}\\n`;\n    content += `Date: ${date}\\n`;\n    content += `${'='.repeat(50)}\\n\\n`;\n\n    switch (memo.template_type) {\n      case 'gauge_swatch':\n        const gauge = memo.data as GaugeSwatchData;\n        content += `Needle Size: ${gauge.needle_size}\\n`;\n        content += `Stitches per Inch: ${gauge.stitches_per_inch}\\n`;\n        content += `Rows per Inch: ${gauge.rows_per_inch}\\n`;\n        content += `Swatch Dimensions: ${gauge.swatch_width}\"  ${gauge.swatch_height}\"\\n`;\n        if (gauge.notes) content += `\\nNotes: ${gauge.notes}\\n`;\n        break;\n\n      case 'fit_adjustment':\n        const fit = memo.data as FitAdjustmentData;\n        content += `Measurement: ${fit.measurement_name}\\n`;\n        content += `Original: ${fit.original_value}\\n`;\n        content += `Adjusted: ${fit.adjusted_value}\\n`;\n        content += `Reason: ${fit.reason}\\n`;\n        if (fit.notes) content += `\\nNotes: ${fit.notes}\\n`;\n        break;\n\n      case 'yarn_substitution':\n        const yarn = memo.data as YarnSubstitutionData;\n        content += `Original Yarn: ${yarn.original_yarn_name} (${yarn.original_yarn_weight})\\n`;\n        content += `Original Yardage: ${yarn.original_yardage} yards\\n`;\n        content += `Replacement Yarn: ${yarn.replacement_yarn_name} (${yarn.replacement_yarn_weight})\\n`;\n        content += `Replacement Yardage: ${yarn.replacement_yardage} yards\\n`;\n        content += `Gauge Comparison: ${yarn.gauge_comparison}\\n`;\n        if (yarn.notes) content += `\\nNotes: ${yarn.notes}\\n`;\n        break;\n\n      case 'finishing_techniques':\n        const finish = memo.data as FinishingTechniquesData;\n        content += `Bind-Off Method: ${finish.bind_off_method}\\n`;\n        content += `Seaming Technique: ${finish.seaming_technique}\\n`;\n        content += `Blocking Instructions: ${finish.blocking_instructions}\\n`;\n        if (finish.notes) content += `\\nNotes: ${finish.notes}\\n`;\n        break;\n    }\n\n    return content;\n  };\n\n  const renderTemplateForm = () => {\n    switch (selectedTemplate) {\n      case 'gauge_swatch':\n        return (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Needle Size\n              </label>\n              <input\n                type=\"text\"\n                value={formData.needle_size || ''}\n                onChange={(e) => setFormData({ ...formData, needle_size: e.target.value })}\n                placeholder=\"e.g., US 7 / 4.5mm\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Stitches per Inch\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  value={formData.stitches_per_inch || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, stitches_per_inch: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"4.5\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Rows per Inch\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  value={formData.rows_per_inch || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, rows_per_inch: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"6.0\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Swatch Width (inches)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.swatch_width || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, swatch_width: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"4\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Swatch Height (inches)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.swatch_height || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, swatch_height: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"4\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Any additional observations...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={3}\n              />\n            </div>\n          </div>\n        );\n\n      case 'fit_adjustment':\n        return (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Measurement Name\n              </label>\n              <input\n                type=\"text\"\n                value={formData.measurement_name || ''}\n                onChange={(e) => setFormData({ ...formData, measurement_name: e.target.value })}\n                placeholder=\"e.g., Sleeve length, Bust circumference\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Original Value\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.original_value || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, original_value: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"36\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Adjusted Value\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.adjusted_value || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, adjusted_value: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"38\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Reason for Change\n              </label>\n              <input\n                type=\"text\"\n                value={formData.reason || ''}\n                onChange={(e) => setFormData({ ...formData, reason: e.target.value })}\n                placeholder=\"e.g., Prefer looser fit, Accommodate larger bust\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Additional details...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={2}\n              />\n            </div>\n          </div>\n        );\n\n      case 'yarn_substitution':\n        return (\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Original Yarn Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.original_yarn_name || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, original_yarn_name: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Original Weight\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.original_yarn_weight || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, original_yarn_weight: e.target.value })\n                  }\n                  placeholder=\"DK, Worsted, etc.\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Original Yardage\n              </label>\n              <input\n                type=\"number\"\n                value={formData.original_yardage || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, original_yardage: parseInt(e.target.value) })\n                }\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Replacement Yarn Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.replacement_yarn_name || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, replacement_yarn_name: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Replacement Weight\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.replacement_yarn_weight || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, replacement_yarn_weight: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Replacement Yardage\n              </label>\n              <input\n                type=\"number\"\n                value={formData.replacement_yardage || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, replacement_yardage: parseInt(e.target.value) })\n                }\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Gauge Comparison\n              </label>\n              <input\n                type=\"text\"\n                value={formData.gauge_comparison || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, gauge_comparison: e.target.value })\n                }\n                placeholder=\"e.g., Same gauge, Slightly looser\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Differences in texture, drape, etc.\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={2}\n              />\n            </div>\n          </div>\n        );\n\n      case 'finishing_techniques':\n        return (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Bind-Off Method\n              </label>\n              <input\n                type=\"text\"\n                value={formData.bind_off_method || ''}\n                onChange={(e) => setFormData({ ...formData, bind_off_method: e.target.value })}\n                placeholder=\"e.g., Standard, Sewn, I-cord\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Seaming Technique\n              </label>\n              <input\n                type=\"text\"\n                value={formData.seaming_technique || ''}\n                onChange={(e) => setFormData({ ...formData, seaming_technique: e.target.value })}\n                placeholder=\"e.g., Mattress stitch, Kitchener stitch\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Blocking Instructions\n              </label>\n              <textarea\n                value={formData.blocking_instructions || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, blocking_instructions: e.target.value })\n                }\n                placeholder=\"Wet blocking, steam blocking, measurements, etc.\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={3}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Additional Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Any other finishing details...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={2}\n              />\n            </div>\n          </div>\n        );\n    }\n  };\n\n  const renderMemoCard = (memo: StructuredMemo) => {\n    const info = TEMPLATE_INFO[memo.template_type];\n\n    return (\n      <div\n        key={memo.id}\n        className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n      >\n        <div className=\"flex items-start justify-between mb-3\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-2xl\">{info.icon}</span>\n              <h4 className=\"font-medium text-gray-900 dark:text-white\">{info.name}</h4>\n            </div>\n            <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n              {formatDistanceToNow(new Date(memo.created_at), { addSuffix: true })}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => exportMemo(memo)}\n              className=\"p-1 text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              title=\"Export\"\n            >\n              <FiDownload className=\"w-4 h-4\" />\n            </button>\n            <button\n              onClick={() => handleDeleteMemo(memo.id)}\n              className=\"p-1 text-red-600 hover:text-red-700 dark:text-red-400\"\n              title=\"Delete\"\n            >\n              <FiTrash2 className=\"w-4 h-4\" />\n            </button>\n          </div>\n        </div>\n        <div className=\"text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-3 rounded\">\n          <pre className=\"whitespace-pre-wrap font-sans\">{renderMemoAsText(memo)}</pre>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n          <FiFileText className=\"w-5 h-5\" />\n          Structured Memos\n        </h3>\n      </div>\n\n      {/* Template Selection */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 mb-6\">\n        {(Object.entries(TEMPLATE_INFO) as [TemplateType, typeof TEMPLATE_INFO[TemplateType]][]).map(\n          ([type, info]) => (\n            <button\n              key={type}\n              onClick={() => handleOpenNewMemo(type)}\n              className=\"flex items-start gap-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 dark:hover:border-blue-500 transition-colors text-left\"\n            >\n              <span className=\"text-3xl\">{info.icon}</span>\n              <div>\n                <div className=\"font-medium text-gray-900 dark:text-white\">{info.name}</div>\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                  {info.description}\n                </div>\n              </div>\n            </button>\n          )\n        )}\n      </div>\n\n      {/* Saved Memos */}\n      <div className=\"space-y-3\">\n        {memos.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n            <FiFileText className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>No memos yet</p>\n            <p className=\"text-sm mt-1\">Click a template above to create your first memo</p>\n          </div>\n        ) : (\n          memos.map(renderMemoCard)\n        )}\n      </div>\n\n      {/* New Memo Modal */}\n      {showNewMemoModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <span className=\"text-2xl\">{TEMPLATE_INFO[selectedTemplate].icon}</span>\n              <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                {TEMPLATE_INFO[selectedTemplate].name}\n              </h3>\n            </div>\n\n            {renderTemplateForm()}\n\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => setShowNewMemoModal(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSaveMemo}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                Save Memo\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","// @ts-nocheck\nimport { useState, useEffect } from 'react';\nimport { FiAlertCircle, FiPlus, FiTrash2, FiToggleLeft, FiToggleRight, FiClock, FiCheck, FiRepeat, FiBell, FiFlag } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface MagicMarker {\n  id: string;\n  project_id: string;\n  counter_id: string | null;\n  name: string;\n  trigger_type: string;\n  trigger_condition: any;\n  alert_message: string;\n  alert_type: string;\n  is_active: boolean;\n  // Enhanced fields\n  start_row: number | null;\n  end_row: number | null;\n  repeat_interval: number | null;\n  repeat_offset: number | null;\n  is_repeating: boolean;\n  priority: 'low' | 'normal' | 'high' | 'critical';\n  display_style: string;\n  color: string | null;\n  category: string;\n  is_completed: boolean;\n  snoozed_until: string | null;\n  trigger_count: number;\n  created_at: string;\n}\n\ninterface Counter {\n  id: string;\n  name: string;\n  current_value: number;\n  target_value: number | null;\n}\n\ninterface MagicMarkerManagerProps {\n  projectId: string;\n  counters: Counter[];\n  currentRow?: number;\n}\n\nconst TRIGGER_TYPES = [\n  { value: 'row_range', label: 'Row Range (At the same time)' },\n  { value: 'counter_value', label: 'Counter reaches value' },\n  { value: 'row_interval', label: 'Every N rows' },\n  { value: 'stitch_count', label: 'Stitch count milestone' },\n  { value: 'time_based', label: 'Time-based reminder' },\n];\n\nconst ALERT_TYPES = [\n  { value: 'notification', label: 'Notification' },\n  { value: 'sound', label: 'Sound' },\n  { value: 'vibration', label: 'Vibration' },\n  { value: 'visual', label: 'Visual' },\n];\n\nconst PRIORITIES = [\n  { value: 'low', label: 'Low', color: 'bg-gray-100 text-gray-700' },\n  { value: 'normal', label: 'Normal', color: 'bg-blue-100 text-blue-700' },\n  { value: 'high', label: 'High', color: 'bg-orange-100 text-orange-700' },\n  { value: 'critical', label: 'Critical', color: 'bg-red-100 text-red-700' },\n];\n\nconst CATEGORIES = [\n  { value: 'reminder', label: 'Reminder', icon: FiBell },\n  { value: 'at_same_time', label: 'At the Same Time', icon: FiRepeat },\n  { value: 'milestone', label: 'Milestone', icon: FiFlag },\n  { value: 'shaping', label: 'Shaping', icon: FiFlag },\n  { value: 'note', label: 'Note', icon: FiAlertCircle },\n];\n\nconst DISPLAY_STYLES = [\n  { value: 'banner', label: 'Banner (prominent)' },\n  { value: 'popup', label: 'Popup (interruptive)' },\n  { value: 'toast', label: 'Toast (subtle)' },\n  { value: 'inline', label: 'Inline (always visible)' },\n];\n\nexport default function MagicMarkerManager({ projectId, counters, currentRow }: MagicMarkerManagerProps) {\n  const [markers, setMarkers] = useState<MagicMarker[]>([]);\n  const [showModal, setShowModal] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    counterId: '',\n    triggerType: 'row_range',\n    operator: 'equals',\n    triggerValue: '',\n    interval: '',\n    alertMessage: '',\n    alertType: 'notification',\n    // Enhanced fields\n    startRow: '',\n    endRow: '',\n    repeatInterval: '',\n    repeatOffset: '0',\n    isRepeating: false,\n    priority: 'normal',\n    displayStyle: 'banner',\n    color: '',\n    category: 'reminder',\n  });\n\n  useEffect(() => {\n    fetchMarkers();\n  }, [projectId]);\n\n  const fetchMarkers = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/projects/${projectId}/magic-markers`);\n      setMarkers(response.data.data.magicMarkers || []);\n    } catch (error) {\n      console.error('Error fetching magic markers:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreate = async () => {\n    if (!formData.name.trim()) {\n      toast.error('Please enter a marker name');\n      return;\n    }\n\n    if (!formData.alertMessage.trim()) {\n      toast.error('Please enter an alert message');\n      return;\n    }\n\n    let triggerCondition: any = {};\n\n    switch (formData.triggerType) {\n      case 'counter_value':\n        if (!formData.triggerValue) {\n          toast.error('Please enter trigger value');\n          return;\n        }\n        triggerCondition = {\n          operator: formData.operator,\n          value: parseInt(formData.triggerValue),\n        };\n        break;\n      case 'row_interval':\n        if (!formData.interval) {\n          toast.error('Please enter interval');\n          return;\n        }\n        triggerCondition = {\n          interval: parseInt(formData.interval),\n        };\n        break;\n      case 'row_range':\n        // Row range uses startRow/endRow fields\n        break;\n      case 'stitch_count':\n        if (!formData.triggerValue) {\n          toast.error('Please enter stitch count');\n          return;\n        }\n        triggerCondition = {\n          count: parseInt(formData.triggerValue),\n        };\n        break;\n      case 'time_based':\n        if (!formData.interval) {\n          toast.error('Please enter time interval (minutes)');\n          return;\n        }\n        triggerCondition = {\n          minutes: parseInt(formData.interval),\n        };\n        break;\n    }\n\n    try {\n      await axios.post(`/api/projects/${projectId}/magic-markers`, {\n        name: formData.name,\n        counterId: formData.counterId || null,\n        triggerType: formData.triggerType,\n        triggerCondition,\n        alertMessage: formData.alertMessage,\n        alertType: formData.alertType,\n        isActive: true,\n        // Enhanced fields\n        startRow: formData.startRow ? parseInt(formData.startRow) : null,\n        endRow: formData.endRow ? parseInt(formData.endRow) : null,\n        repeatInterval: formData.repeatInterval ? parseInt(formData.repeatInterval) : null,\n        repeatOffset: parseInt(formData.repeatOffset) || 0,\n        isRepeating: formData.isRepeating,\n        priority: formData.priority,\n        displayStyle: formData.displayStyle,\n        color: formData.color || null,\n        category: formData.category,\n      });\n\n      toast.success('Magic marker created!');\n      setShowModal(false);\n      resetForm();\n      fetchMarkers();\n    } catch (error: any) {\n      console.error('Error creating marker:', error);\n      toast.error(error.response?.data?.message || 'Failed to create marker');\n    }\n  };\n\n  const handleToggle = async (markerId: string) => {\n    try {\n      await axios.patch(`/api/projects/${projectId}/magic-markers/${markerId}/toggle`);\n      fetchMarkers();\n    } catch (error) {\n      console.error('Error toggling marker:', error);\n      toast.error('Failed to toggle marker');\n    }\n  };\n\n  const handleSnooze = async (markerId: string, duration: number) => {\n    try {\n      await axios.post(`/api/projects/${projectId}/magic-markers/${markerId}/snooze`, {\n        duration,\n      });\n      toast.success(`Snoozed for ${duration} minutes`);\n      fetchMarkers();\n    } catch (error) {\n      console.error('Error snoozing marker:', error);\n      toast.error('Failed to snooze marker');\n    }\n  };\n\n  const handleComplete = async (markerId: string) => {\n    try {\n      await axios.post(`/api/projects/${projectId}/magic-markers/${markerId}/complete`);\n      toast.success('Marked as completed!');\n      fetchMarkers();\n    } catch (error) {\n      console.error('Error completing marker:', error);\n      toast.error('Failed to complete marker');\n    }\n  };\n\n  const handleDelete = async (markerId: string, name: string) => {\n    if (!confirm(`Delete magic marker \"${name}\"?`)) return;\n\n    try {\n      await axios.delete(`/api/projects/${projectId}/magic-markers/${markerId}`);\n      toast.success('Marker deleted');\n      fetchMarkers();\n    } catch (error) {\n      console.error('Error deleting marker:', error);\n      toast.error('Failed to delete marker');\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      counterId: '',\n      triggerType: 'row_range',\n      operator: 'equals',\n      triggerValue: '',\n      interval: '',\n      alertMessage: '',\n      alertType: 'notification',\n      startRow: '',\n      endRow: '',\n      repeatInterval: '',\n      repeatOffset: '0',\n      isRepeating: false,\n      priority: 'normal',\n      displayStyle: 'banner',\n      color: '',\n      category: 'reminder',\n    });\n  };\n\n  const getTriggerDescription = (marker: MagicMarker) => {\n    const condition = marker.trigger_condition || {};\n\n    // Check for row range\n    if (marker.start_row !== null || marker.end_row !== null) {\n      let desc = '';\n      if (marker.start_row !== null && marker.end_row !== null) {\n        desc = `Rows ${marker.start_row}-${marker.end_row}`;\n      } else if (marker.start_row !== null) {\n        desc = `From row ${marker.start_row}`;\n      } else if (marker.end_row !== null) {\n        desc = `Until row ${marker.end_row}`;\n      }\n\n      if (marker.is_repeating && marker.repeat_interval) {\n        desc += ` (every ${marker.repeat_interval} rows)`;\n      }\n\n      return desc;\n    }\n\n    switch (marker.trigger_type) {\n      case 'counter_value':\n        const operatorMap: Record<string, string> = {\n          equals: '=',\n          greater_than: '>',\n          less_than: '<',\n          multiple_of: 'is multiple of',\n        };\n        const operatorText = operatorMap[condition.operator as string] || condition.operator;\n        return `When counter ${operatorText} ${condition.value}`;\n      case 'row_interval':\n        return `Every ${condition.interval} rows`;\n      case 'stitch_count':\n        return `At ${condition.count} stitches`;\n      case 'time_based':\n        return `Every ${condition.minutes} minutes`;\n      default:\n        return marker.trigger_type;\n    }\n  };\n\n  const getPriorityClass = (priority: string) => {\n    const p = PRIORITIES.find(pr => pr.value === priority);\n    return p?.color || 'bg-gray-100 text-gray-700';\n  };\n\n  const isMarkerRelevantNow = (marker: MagicMarker) => {\n    if (!currentRow) return false;\n    if (!marker.is_active || marker.is_completed) return false;\n\n    // Check snooze\n    if (marker.snoozed_until && new Date(marker.snoozed_until) > new Date()) {\n      return false;\n    }\n\n    // Check row range\n    if (marker.start_row !== null && currentRow < marker.start_row) return false;\n    if (marker.end_row !== null && currentRow > marker.end_row) return false;\n\n    // Check repeating\n    if (marker.is_repeating && marker.repeat_interval) {\n      const offset = marker.repeat_offset || 0;\n      if ((currentRow - offset) % marker.repeat_interval !== 0) return false;\n    }\n\n    return true;\n  };\n\n  // Sort markers: relevant first, then by priority, then by active status\n  const sortedMarkers = [...markers].sort((a, b) => {\n    const aRelevant = isMarkerRelevantNow(a);\n    const bRelevant = isMarkerRelevantNow(b);\n    if (aRelevant && !bRelevant) return -1;\n    if (!aRelevant && bRelevant) return 1;\n\n    const priorityOrder = { critical: 4, high: 3, normal: 2, low: 1 };\n    const aPriority = priorityOrder[a.priority] || 2;\n    const bPriority = priorityOrder[b.priority] || 2;\n    if (aPriority !== bPriority) return bPriority - aPriority;\n\n    if (a.is_active && !b.is_active) return -1;\n    if (!a.is_active && b.is_active) return 1;\n\n    return 0;\n  });\n\n  const relevantMarkers = sortedMarkers.filter(m => isMarkerRelevantNow(m));\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Active Alerts Banner */}\n      {relevantMarkers.length > 0 && (\n        <div className=\"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-4 text-white shadow-lg\">\n          <div className=\"flex items-center gap-3 mb-3\">\n            <div className=\"p-2 bg-white/20 rounded-lg\">\n              <FiBell className=\"h-5 w-5\" />\n            </div>\n            <div>\n              <h3 className=\"font-bold text-lg\">Active Reminders</h3>\n              <p className=\"text-white/80 text-sm\">\n                {relevantMarkers.length} reminder{relevantMarkers.length !== 1 ? 's' : ''} for row {currentRow}\n              </p>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            {relevantMarkers.map((marker) => (\n              <div\n                key={marker.id}\n                className={`p-3 rounded-lg ${\n                  marker.priority === 'critical' ? 'bg-red-500/30 border border-red-300/50' :\n                  marker.priority === 'high' ? 'bg-orange-500/30 border border-orange-300/50' :\n                  'bg-white/10'\n                }`}\n              >\n                <div className=\"flex items-start justify-between gap-3\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"font-semibold\">{marker.name}</span>\n                      {marker.priority !== 'normal' && (\n                        <span className={`text-xs px-2 py-0.5 rounded-full ${\n                          marker.priority === 'critical' ? 'bg-red-200 text-red-800' :\n                          marker.priority === 'high' ? 'bg-orange-200 text-orange-800' :\n                          'bg-gray-200 text-gray-800'\n                        }`}>\n                          {marker.priority}\n                        </span>\n                      )}\n                    </div>\n                    <p className=\"text-sm opacity-90\">{marker.alert_message}</p>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      onClick={() => handleSnooze(marker.id, 5)}\n                      className=\"p-1.5 hover:bg-white/20 rounded text-white/80 hover:text-white\"\n                      title=\"Snooze 5 min\"\n                    >\n                      <FiClock className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => handleComplete(marker.id)}\n                      className=\"p-1.5 hover:bg-white/20 rounded text-white/80 hover:text-white\"\n                      title=\"Mark complete\"\n                    >\n                      <FiCheck className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Main Panel */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2\">\n            <FiAlertCircle className=\"h-5 w-5 text-purple-600\" />\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Magic Markers</h2>\n            <span className=\"text-sm text-gray-500 dark:text-gray-400\">({markers.length})</span>\n          </div>\n\n          <button\n            onClick={() => setShowModal(true)}\n            className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n            New Marker\n          </button>\n        </div>\n\n        {/* Markers List */}\n        {loading ? (\n          <div className=\"flex justify-center py-8\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n          </div>\n        ) : markers.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n            <FiAlertCircle className=\"h-12 w-12 mx-auto mb-3 text-gray-300 dark:text-gray-600\" />\n            <p>No magic markers yet</p>\n            <p className=\"text-sm mt-1\">Create markers for \"at the same time\" instructions and important milestones</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {sortedMarkers.map((marker) => {\n              const isRelevant = isMarkerRelevantNow(marker);\n              const isSnoozed = marker.snoozed_until && new Date(marker.snoozed_until) > new Date();\n\n              return (\n                <div\n                  key={marker.id}\n                  className={`border rounded-lg p-4 transition-all ${\n                    marker.is_completed ? 'border-gray-200 bg-gray-50 dark:bg-gray-700/50 dark:border-gray-600 opacity-60' :\n                    isRelevant ? 'border-purple-400 bg-purple-50 dark:bg-purple-900/20 dark:border-purple-600 ring-2 ring-purple-300' :\n                    marker.is_active ? 'border-purple-200 bg-purple-50/50 dark:bg-gray-700 dark:border-purple-800' :\n                    'border-gray-200 bg-gray-50 dark:bg-gray-700 dark:border-gray-600'\n                  }`}\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                        <h3 className=\"font-semibold text-gray-900 dark:text-white\">{marker.name}</h3>\n\n                        {/* Status badges */}\n                        {marker.is_completed ? (\n                          <span className=\"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs rounded-full flex items-center gap-1\">\n                            <FiCheck className=\"h-3 w-3\" /> Completed\n                          </span>\n                        ) : isSnoozed ? (\n                          <span className=\"px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 text-xs rounded-full flex items-center gap-1\">\n                            <FiClock className=\"h-3 w-3\" /> Snoozed\n                          </span>\n                        ) : marker.is_active ? (\n                          <span className=\"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs rounded-full\">\n                            Active\n                          </span>\n                        ) : (\n                          <span className=\"px-2 py-0.5 bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 text-xs rounded-full\">\n                            Inactive\n                          </span>\n                        )}\n\n                        {/* Priority badge */}\n                        {marker.priority !== 'normal' && (\n                          <span className={`px-2 py-0.5 text-xs rounded-full ${getPriorityClass(marker.priority)}`}>\n                            {marker.priority}\n                          </span>\n                        )}\n\n                        {/* Repeating badge */}\n                        {marker.is_repeating && (\n                          <span className=\"px-2 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 text-xs rounded-full flex items-center gap-1\">\n                            <FiRepeat className=\"h-3 w-3\" /> Repeating\n                          </span>\n                        )}\n\n                        {/* Relevant now badge */}\n                        {isRelevant && !marker.is_completed && (\n                          <span className=\"px-2 py-0.5 bg-purple-600 text-white text-xs rounded-full animate-pulse\">\n                            Now!\n                          </span>\n                        )}\n                      </div>\n\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\n                        {getTriggerDescription(marker)}\n                      </p>\n\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-xs text-gray-500 dark:text-gray-500\">Alert:</span>\n                        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                          {marker.alert_message}\n                        </span>\n                      </div>\n\n                      {marker.trigger_count > 0 && (\n                        <p className=\"text-xs text-gray-400 mt-1\">\n                          Triggered {marker.trigger_count} time{marker.trigger_count !== 1 ? 's' : ''}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"flex items-center gap-2 ml-4\">\n                      {!marker.is_completed && (\n                        <>\n                          <button\n                            onClick={() => handleSnooze(marker.id, 5)}\n                            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition\"\n                            title=\"Snooze 5 min\"\n                          >\n                            <FiClock className=\"h-4 w-4 text-gray-400\" />\n                          </button>\n                          <button\n                            onClick={() => handleComplete(marker.id)}\n                            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition\"\n                            title=\"Mark complete\"\n                          >\n                            <FiCheck className=\"h-4 w-4 text-gray-400\" />\n                          </button>\n                          <button\n                            onClick={() => handleToggle(marker.id)}\n                            className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition\"\n                            title={marker.is_active ? 'Disable' : 'Enable'}\n                          >\n                            {marker.is_active ? (\n                              <FiToggleRight className=\"h-5 w-5 text-green-600\" />\n                            ) : (\n                              <FiToggleLeft className=\"h-5 w-5 text-gray-400\" />\n                            )}\n                          </button>\n                        </>\n                      )}\n                      <button\n                        onClick={() => handleDelete(marker.id, marker.name)}\n                        className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition text-red-600\"\n                        title=\"Delete\"\n                      >\n                        <FiTrash2 className=\"h-4 w-4\" />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Create Modal */}\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"sticky top-0 p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800\">\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">New Magic Marker</h3>\n              <button\n                onClick={() => {\n                  setShowModal(false);\n                  resetForm();\n                }}\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl\"\n              >\n                x\n              </button>\n            </div>\n\n            <div className=\"p-4 space-y-4\">\n              {/* Name & Category */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Marker Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    placeholder=\"e.g., Start sleeve shaping\"\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                    autoFocus\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Category\n                  </label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                  >\n                    {CATEGORIES.map((cat) => (\n                      <option key={cat.value} value={cat.value}>{cat.label}</option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              {/* Row Range - \"At the Same Time\" */}\n              <div className=\"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                <h4 className=\"font-medium text-purple-800 dark:text-purple-300 mb-3\">\n                  Row Range (\"At the Same Time\")\n                </h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm text-gray-700 dark:text-gray-300 mb-1\">\n                      Start Row\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.startRow}\n                      onChange={(e) => setFormData({ ...formData, startRow: e.target.value })}\n                      placeholder=\"e.g., 45\"\n                      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm text-gray-700 dark:text-gray-300 mb-1\">\n                      End Row\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.endRow}\n                      onChange={(e) => setFormData({ ...formData, endRow: e.target.value })}\n                      placeholder=\"e.g., 80\"\n                      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                    />\n                  </div>\n                </div>\n\n                {/* Repeating */}\n                <div className=\"mt-3 flex items-center gap-4\">\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={formData.isRepeating}\n                      onChange={(e) => setFormData({ ...formData, isRepeating: e.target.checked })}\n                      className=\"w-4 h-4 text-purple-600 rounded\"\n                    />\n                    <span className=\"text-sm text-gray-700 dark:text-gray-300\">Repeat every</span>\n                  </label>\n                  {formData.isRepeating && (\n                    <input\n                      type=\"number\"\n                      value={formData.repeatInterval}\n                      onChange={(e) => setFormData({ ...formData, repeatInterval: e.target.value })}\n                      placeholder=\"N\"\n                      className=\"w-20 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm dark:bg-gray-700 dark:text-white\"\n                    />\n                  )}\n                  {formData.isRepeating && (\n                    <span className=\"text-sm text-gray-700 dark:text-gray-300\">rows</span>\n                  )}\n                </div>\n              </div>\n\n              {/* Counter (optional) */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Linked Counter (optional)\n                </label>\n                <select\n                  value={formData.counterId}\n                  onChange={(e) => setFormData({ ...formData, counterId: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                >\n                  <option value=\"\">No specific counter</option>\n                  {counters.map((counter) => (\n                    <option key={counter.id} value={counter.id}>\n                      {counter.name} (current: {counter.current_value})\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Priority & Display Style */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Priority\n                  </label>\n                  <select\n                    value={formData.priority}\n                    onChange={(e) => setFormData({ ...formData, priority: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                  >\n                    {PRIORITIES.map((p) => (\n                      <option key={p.value} value={p.value}>{p.label}</option>\n                    ))}\n                  </select>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Display Style\n                  </label>\n                  <select\n                    value={formData.displayStyle}\n                    onChange={(e) => setFormData({ ...formData, displayStyle: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                  >\n                    {DISPLAY_STYLES.map((s) => (\n                      <option key={s.value} value={s.value}>{s.label}</option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              {/* Alert Message */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Alert Message *\n                </label>\n                <textarea\n                  value={formData.alertMessage}\n                  onChange={(e) => setFormData({ ...formData, alertMessage: e.target.value })}\n                  placeholder=\"e.g., AT THE SAME TIME: Begin armhole shaping - BO 4 sts at beg of next 2 rows\"\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n\n              {/* Alert Type */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Alert Type\n                </label>\n                <select\n                  value={formData.alertType}\n                  onChange={(e) => setFormData({ ...formData, alertType: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white\"\n                >\n                  {ALERT_TYPES.map((type) => (\n                    <option key={type.value} value={type.value}>\n                      {type.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\n                <button\n                  onClick={() => {\n                    setShowModal(false);\n                    resetForm();\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-50 dark:hover:bg-gray-700\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleCreate}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                >\n                  Create Marker\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { FiLoader } from 'react-icons/fi';\n\ninterface LoadingSpinnerProps {\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  text?: string;\n  fullScreen?: boolean;\n  className?: string;\n}\n\nexport default function LoadingSpinner({\n  size = 'md',\n  text,\n  fullScreen = false,\n  className = ''\n}: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: 'w-4 h-4',\n    md: 'w-8 h-8',\n    lg: 'w-12 h-12',\n    xl: 'w-16 h-16'\n  };\n\n  const textSizeClasses = {\n    sm: 'text-sm',\n    md: 'text-base',\n    lg: 'text-lg',\n    xl: 'text-xl'\n  };\n\n  const spinner = (\n    <div className={`flex flex-col items-center justify-center gap-3 ${className}`}>\n      <FiLoader\n        className={`${sizeClasses[size]} text-purple-600 dark:text-purple-400 animate-spin`}\n        aria-label=\"Loading\"\n        role=\"status\"\n      />\n      {text && (\n        <p className={`${textSizeClasses[size]} text-gray-600 dark:text-gray-400 font-medium`}>\n          {text}\n        </p>\n      )}\n    </div>\n  );\n\n  if (fullScreen) {\n    return (\n      <div className=\"fixed inset-0 bg-gray-50 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 flex items-center justify-center z-50\">\n        {spinner}\n      </div>\n    );\n  }\n\n  return spinner;\n}\n\n/**\n * Inline loading spinner for buttons\n */\nexport function ButtonSpinner({ className = '' }: { className?: string }) {\n  return (\n    <FiLoader\n      className={`w-4 h-4 animate-spin ${className}`}\n      aria-label=\"Loading\"\n      role=\"status\"\n    />\n  );\n}\n\n/**\n * Card/Section loading skeleton\n */\nexport function LoadingSkeleton({\n  lines = 3,\n  className = ''\n}: {\n  lines?: number;\n  className?: string;\n}) {\n  return (\n    <div className={`animate-pulse space-y-3 ${className}`} role=\"status\" aria-label=\"Loading content\">\n      {Array.from({ length: lines }).map((_, i) => (\n        <div\n          key={i}\n          className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded\"\n          style={{ width: `${100 - (i * 10)}%` }}\n        />\n      ))}\n    </div>\n  );\n}\n\n/**\n * Card loading state\n */\nexport function LoadingCard({ className = '' }: { className?: string }) {\n  return (\n    <div className={`bg-white dark:bg-gray-800 rounded-lg p-6 ${className}`}>\n      <div className=\"animate-pulse\">\n        <div className=\"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4\" />\n        <div className=\"space-y-3\">\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded\" />\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6\" />\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/6\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FiExternalLink } from 'react-icons/fi';\nimport axios from 'axios';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\nimport 'react-pdf/dist/Page/TextLayer.css';\n\n// Configure PDF.js worker - use local file for production reliability\npdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.min.js';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  designer?: string;\n  description?: string;\n}\n\ninterface PatternFile {\n  id: string;\n  filename: string;\n  original_filename: string;\n  file_path: string;\n  file_type: 'pdf' | 'image' | 'document' | 'other';\n  mime_type: string;\n}\n\ninterface PatternPreviewProps {\n  patterns: Pattern[];\n  mode?: 'normal' | 'knitting';\n}\n\nexport default function PatternPreview({ patterns, mode = 'normal' }: PatternPreviewProps) {\n  const [selectedPattern, setSelectedPattern] = useState<Pattern | null>(null);\n  const [patternFiles, setPatternFiles] = useState<PatternFile[]>([]);\n  const [selectedFile, setSelectedFile] = useState<PatternFile | null>(null);\n  const [numPages, setNumPages] = useState<number | null>(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [scale, setScale] = useState(1.0);\n  const [loading, setLoading] = useState(false);\n\n  // Auto-select first pattern on mount if available\n  useEffect(() => {\n    if (patterns.length > 0 && !selectedPattern) {\n      setSelectedPattern(patterns[0]);\n    }\n  }, [patterns]);\n\n  // Fetch pattern files when pattern is selected\n  useEffect(() => {\n    if (selectedPattern) {\n      fetchPatternFiles(selectedPattern.id);\n    }\n  }, [selectedPattern]);\n\n  // Auto-select first PDF file when files are loaded\n  useEffect(() => {\n    if (patternFiles.length > 0 && !selectedFile) {\n      const firstPdf = patternFiles.find(f => f.file_type === 'pdf');\n      if (firstPdf) {\n        setSelectedFile(firstPdf);\n      }\n    }\n  }, [patternFiles]);\n\n  const fetchPatternFiles = async (patternId: string) => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/uploads/patterns/${patternId}/files`);\n      const files = response.data.data.files || [];\n      setPatternFiles(files);\n    } catch (error) {\n      console.error('Error fetching pattern files:', error);\n      setPatternFiles([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePatternChange = (patternId: string) => {\n    const pattern = patterns.find(p => p.id === patternId);\n    if (pattern) {\n      setSelectedPattern(pattern);\n      setSelectedFile(null);\n      setPageNumber(1);\n    }\n  };\n\n  const handleFileChange = (fileId: string) => {\n    const file = patternFiles.find(f => f.id === fileId);\n    if (file) {\n      setSelectedFile(file);\n      setPageNumber(1);\n    }\n  };\n\n  const onDocumentLoadSuccess = ({ numPages }: { numPages: number }) => {\n    setNumPages(numPages);\n  };\n\n  const previousPage = () => {\n    setPageNumber(prev => Math.max(prev - 1, 1));\n  };\n\n  const nextPage = () => {\n    setPageNumber(prev => Math.min(prev + 1, numPages || prev));\n  };\n\n  const zoomIn = () => {\n    setScale(prev => Math.min(prev + 0.2, 2.0));\n  };\n\n  const zoomOut = () => {\n    setScale(prev => Math.max(prev - 0.2, 0.5));\n  };\n\n  const pdfFiles = patternFiles.filter(f => f.file_type === 'pdf');\n\n  if (patterns.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\n        <h3 className={`font-semibold text-gray-900 mb-4 ${mode === 'knitting' ? 'text-xl' : 'text-lg'}`}>\n          Pattern Preview\n        </h3>\n        <div className=\"text-center py-8 text-gray-500\">\n          <p>No patterns linked to this project yet.</p>\n          <p className=\"text-sm mt-2\">Add a pattern to see it here.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n      <div className=\"mb-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h3 className={`font-semibold text-gray-900 ${mode === 'knitting' ? 'text-xl' : 'text-lg'}`}>\n            Pattern Preview\n          </h3>\n          {selectedPattern && (\n            <Link\n              to={`/patterns/${selectedPattern.id}`}\n              className=\"text-purple-600 hover:text-purple-700 flex items-center gap-1 text-sm\"\n            >\n              Open Full View <FiExternalLink className=\"h-4 w-4\" />\n            </Link>\n          )}\n        </div>\n\n        {/* Pattern Selector */}\n        <div className=\"space-y-3\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Select Pattern\n            </label>\n            <select\n              value={selectedPattern?.id || ''}\n              onChange={(e) => handlePatternChange(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent\"\n            >\n              {patterns.map((pattern) => (\n                <option key={pattern.id} value={pattern.id}>\n                  {pattern.name} {pattern.designer ? `by ${pattern.designer}` : ''}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* File Selector - Only show if there are PDF files */}\n          {pdfFiles.length > 0 && (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Select PDF File\n              </label>\n              <select\n                value={selectedFile?.id || ''}\n                onChange={(e) => handleFileChange(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent\"\n              >\n                {pdfFiles.map((file) => (\n                  <option key={file.id} value={file.id}>\n                    {file.original_filename}\n                  </option>\n                ))}\n              </select>\n            </div>\n          )}\n        </div>\n\n        {/* Pattern Description */}\n        {selectedPattern?.description && (\n          <div className=\"mt-3 p-3 bg-purple-50 rounded-lg\">\n            <p className=\"text-sm text-gray-700\">{selectedPattern.description}</p>\n          </div>\n        )}\n      </div>\n\n      {/* PDF Viewer */}\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12 bg-gray-50 rounded-lg\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n        </div>\n      ) : selectedFile && selectedFile.file_type === 'pdf' ? (\n        <div className=\"border border-gray-200 rounded-lg overflow-hidden\">\n          {/* PDF Controls */}\n          <div className=\"bg-gray-100 px-4 py-2 flex items-center justify-between border-b border-gray-200\">\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={previousPage}\n                disabled={pageNumber <= 1}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                Previous\n              </button>\n              <span className=\"text-sm text-gray-700\">\n                Page {pageNumber} of {numPages || '?'}\n              </span>\n              <button\n                onClick={nextPage}\n                disabled={pageNumber >= (numPages || 0)}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                Next\n              </button>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={zoomOut}\n                disabled={scale <= 0.5}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                -\n              </button>\n              <span className=\"text-sm text-gray-700\">{Math.round(scale * 100)}%</span>\n              <button\n                onClick={zoomIn}\n                disabled={scale >= 2.0}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                +\n              </button>\n            </div>\n          </div>\n\n          {/* PDF Display */}\n          <div className=\"overflow-auto bg-gray-50\" style={{ maxHeight: mode === 'knitting' ? '600px' : '500px' }}>\n            <Document\n              file={`/api/uploads/patterns/${selectedPattern?.id}/files/${selectedFile.id}/download`}\n              onLoadSuccess={onDocumentLoadSuccess}\n              loading={\n                <div className=\"flex items-center justify-center py-12\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n                </div>\n              }\n              error={\n                <div className=\"flex items-center justify-center py-12 text-red-600\">\n                  <p>Failed to load PDF. Please try again.</p>\n                </div>\n              }\n            >\n              <Page\n                pageNumber={pageNumber}\n                scale={scale}\n                renderTextLayer={true}\n                renderAnnotationLayer={true}\n              />\n            </Document>\n          </div>\n        </div>\n      ) : pdfFiles.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n          <p className=\"text-gray-500\">No PDF files found for this pattern.</p>\n          {selectedPattern && (\n            <Link\n              to={`/patterns/${selectedPattern.id}`}\n              className=\"inline-block mt-2 text-purple-600 hover:text-purple-700 text-sm\"\n            >\n              Upload a PDF file \n            </Link>\n          )}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport {\n  FiArrowLeft, FiEdit2, FiTrash2, FiCalendar, FiClock, FiCheck, FiImage,\n  FiPlus, FiX, FiUser, FiAlertCircle, FiMic, FiEye, FiEyeOff\n} from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport PhotoGallery from '../components/PhotoGallery';\nimport FileUpload from '../components/FileUpload';\nimport CounterHierarchy from '../components/counters/CounterHierarchy';\nimport { SessionManager, SessionTimer, SessionHistory } from '../components/sessions';\nimport { useWebSocket } from '../contexts/WebSocketContext';\nimport { AudioNotes } from '../components/notes/AudioNotes';\nimport { HandwrittenNotes } from '../components/notes/HandwrittenNotes';\nimport { StructuredMemoTemplates } from '../components/notes/StructuredMemoTemplates';\nimport MagicMarkerManager from '../components/magic-markers/MagicMarkerManager';\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport PatternPreview from '../components/PatternPreview';\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string;\n  project_type: string;\n  status: string;\n  start_date: string;\n  target_completion_date: string;\n  completion_date: string;\n  notes: string;\n  recipient_id?: string;\n  photos: any[];\n  counters: any[];\n  patterns: any[];\n  yarn: any[];\n  tools: any[];\n}\n\nexport default function ProjectDetail() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { joinProject, leaveProject } = useWebSocket();\n\n  const [project, setProject] = useState<Project | null>(null);\n  const [photos, setPhotos] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showEditModal, setShowEditModal] = useState(false);\n\n  // Knitting Mode state\n  const [knittingMode, setKnittingMode] = useState(false);\n  const [showKnittingVoiceNotes, setShowKnittingVoiceNotes] = useState(false);\n  const [showKnittingHistory, setShowKnittingHistory] = useState(false);\n\n  // Notes state\n  const [audioNotes, setAudioNotes] = useState<any[]>([]);\n  const [structuredMemos, setStructuredMemos] = useState<any[]>([]);\n  const [notesTab, setNotesTab] = useState<'audio' | 'handwritten' | 'memos'>('audio');\n  const [editingNotes, setEditingNotes] = useState(false);\n  const [notesText, setNotesText] = useState('');\n\n  // Modal states for adding items\n  const [showAddPatternModal, setShowAddPatternModal] = useState(false);\n  const [showUploadPatternModal, setShowUploadPatternModal] = useState(false);\n  const [showAddYarnModal, setShowAddYarnModal] = useState(false);\n  const [showAddToolModal, setShowAddToolModal] = useState(false);\n\n  // Available items to add\n  const [availablePatterns, setAvailablePatterns] = useState<any[]>([]);\n  const [availableYarn, setAvailableYarn] = useState<any[]>([]);\n  const [availableTools, setAvailableTools] = useState<any[]>([]);\n  const [availableRecipients, setAvailableRecipients] = useState<any[]>([]);\n\n  // Selected items for adding\n  const [selectedPatternId, setSelectedPatternId] = useState('');\n  const [selectedYarnId, setSelectedYarnId] = useState('');\n  const [yarnQuantity, setYarnQuantity] = useState({ skeins: '', yards: '' });\n  const [selectedToolId, setSelectedToolId] = useState('');\n\n  // Pattern upload form\n  const [uploadingPattern, setUploadingPattern] = useState(false);\n  const [newPatternData, setNewPatternData] = useState({\n    name: '',\n    description: '',\n    designer: '',\n    difficulty: 'intermediate',\n  });\n  const [patternFile, setPatternFile] = useState<File | null>(null);\n\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    status: 'active',\n    notes: '',\n    recipientId: '',\n  });\n\n  useEffect(() => {\n    fetchProject();\n    fetchPhotos();\n    fetchAvailableItems();\n    fetchAudioNotes();\n    // fetchStructuredMemos(); // Temporarily disabled - feature not yet implemented\n\n    if (id) {\n      joinProject(id);\n    }\n\n    return () => {\n      if (id) {\n        leaveProject(id);\n      }\n    };\n  }, [id, joinProject, leaveProject]);\n\n  // Session and counter state for knitting mode integration\n  const [currentSession, setCurrentSession] = useState<any>(null);\n  const [sessions, setSessions] = useState<any[]>([]);\n\n  useEffect(() => {\n    if (knittingMode) {\n      fetchSessions();\n      checkActiveSession();\n    }\n  }, [knittingMode]);\n\n  const checkActiveSession = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/sessions/active`);\n      if (response.data.success && response.data.data) {\n        setCurrentSession(response.data.data);\n      }\n    } catch (error) {\n      // No active session\n      setCurrentSession(null);\n    }\n  };\n\n  const fetchSessions = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/sessions`);\n      setSessions(response.data.success ? response.data.data.sessions || [] : []);\n    } catch (error) {\n      console.error('Failed to fetch sessions:', error);\n      setSessions([]);\n    }\n  };\n\n  const fetchProject = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}`);\n      const projectData = response.data.data.project;\n      setProject(projectData);\n      setFormData({\n        name: projectData.name,\n        description: projectData.description || '',\n        status: projectData.status || 'active',\n        notes: projectData.notes || '',\n        recipientId: projectData.recipient_id || '',\n      });\n    } catch (error: any) {\n      console.error('Error fetching project:', error);\n      toast.error('Failed to load project');\n      navigate('/projects');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchAvailableItems = async () => {\n    try {\n      const [patternsRes, yarnRes, toolsRes, recipientsRes] = await Promise.all([\n        axios.get('/api/patterns'),\n        axios.get('/api/yarn'),\n        axios.get('/api/tools'),\n        axios.get('/api/recipients'),\n      ]);\n      setAvailablePatterns(patternsRes.data.data.patterns || []);\n      setAvailableYarn(yarnRes.data.data.yarn || []);\n      setAvailableTools(toolsRes.data.data.tools || []);\n      setAvailableRecipients(recipientsRes.data.data.recipients || []);\n    } catch (error) {\n      console.error('Error fetching available items:', error);\n    }\n  };\n\n  const handleUpdate = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    try {\n      await axios.put(`/api/projects/${id}`, formData);\n      toast.success('Project updated successfully!');\n      setShowEditModal(false);\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error updating project:', error);\n      toast.error('Failed to update project');\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!confirm(`Are you sure you want to delete \"${project?.name}\"?`)) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/projects/${id}`);\n      toast.success('Project deleted successfully');\n      navigate('/projects');\n    } catch (error: any) {\n      console.error('Error deleting project:', error);\n      toast.error('Failed to delete project');\n    }\n  };\n\n  const handleEditNotes = () => {\n    setNotesText(project?.notes || '');\n    setEditingNotes(true);\n  };\n\n  const handleSaveNotes = async () => {\n    try {\n      await axios.put(`/api/projects/${id}`, {\n        name: project?.name,\n        description: project?.description,\n        status: project?.status,\n        notes: notesText,\n      });\n      toast.success('Notes saved successfully!');\n      setEditingNotes(false);\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error saving notes:', error);\n      toast.error('Failed to save notes');\n    }\n  };\n\n  const handleCancelNotes = () => {\n    setNotesText('');\n    setEditingNotes(false);\n  };\n\n  // Pattern management\n  const handleAddPattern = async () => {\n    if (!selectedPatternId) {\n      toast.error('Please select a pattern');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/patterns`, {\n        patternId: selectedPatternId,\n      });\n      toast.success('Pattern added to project!');\n      setShowAddPatternModal(false);\n      setSelectedPatternId('');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error adding pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to add pattern');\n    }\n  };\n\n  const handleRemovePattern = async (patternId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/patterns/${patternId}`);\n      toast.success('Pattern removed from project');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error removing pattern:', error);\n      toast.error('Failed to remove pattern');\n    }\n  };\n\n  // Upload new pattern directly from project\n  const handleUploadPattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!patternFile) {\n      toast.error('Please select a pattern file to upload');\n      return;\n    }\n\n    if (!newPatternData.name.trim()) {\n      toast.error('Please enter a pattern name');\n      return;\n    }\n\n    setUploadingPattern(true);\n\n    try {\n      // Step 1: Create the pattern\n      const createResponse = await axios.post('/api/patterns', newPatternData);\n      const newPattern = createResponse.data.data.pattern;\n      toast.success('Pattern created!');\n\n      // Step 2: Upload the file to the pattern\n      const fileFormData = new FormData();\n      fileFormData.append('file', patternFile);\n      fileFormData.append('description', 'Pattern file');\n\n      await axios.post(`/api/uploads/patterns/${newPattern.id}/files`, fileFormData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('File uploaded!');\n\n      // Step 3: Link the pattern to the project\n      await axios.post(`/api/projects/${id}/patterns`, {\n        patternId: newPattern.id,\n      });\n      toast.success('Pattern added to project!');\n\n      // Reset form and close modal\n      setShowUploadPatternModal(false);\n      setNewPatternData({\n        name: '',\n        description: '',\n        designer: '',\n        difficulty: 'intermediate',\n      });\n      setPatternFile(null);\n      fetchProject();\n      fetchAvailableItems();\n    } catch (error: any) {\n      console.error('Error uploading pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to upload pattern');\n    } finally {\n      setUploadingPattern(false);\n    }\n  };\n\n  // Yarn management\n  const handleAddYarn = async () => {\n    if (!selectedYarnId) {\n      toast.error('Please select yarn');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/yarn`, {\n        yarnId: selectedYarnId,\n        skeinsUsed: yarnQuantity.skeins ? parseFloat(yarnQuantity.skeins) : undefined,\n        yardsUsed: yarnQuantity.yards ? parseFloat(yarnQuantity.yards) : undefined,\n      });\n      toast.success('Yarn added to project! Stash has been updated.');\n      setShowAddYarnModal(false);\n      setSelectedYarnId('');\n      setYarnQuantity({ skeins: '', yards: '' });\n      fetchProject();\n      fetchAvailableItems(); // Refresh to show updated yarn quantities\n    } catch (error: any) {\n      console.error('Error adding yarn:', error);\n      toast.error(error.response?.data?.message || 'Failed to add yarn');\n    }\n  };\n\n  const handleRemoveYarn = async (yarnId: string) => {\n    if (!confirm('Remove this yarn? The used amount will be restored to your stash.')) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/projects/${id}/yarn/${yarnId}`);\n      toast.success('Yarn removed and restored to stash');\n      fetchProject();\n      fetchAvailableItems(); // Refresh to show updated yarn quantities\n    } catch (error: any) {\n      console.error('Error removing yarn:', error);\n      toast.error('Failed to remove yarn');\n    }\n  };\n\n  // Tool management\n  const handleAddTool = async () => {\n    if (!selectedToolId) {\n      toast.error('Please select a tool');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/tools`, {\n        toolId: selectedToolId,\n      });\n      toast.success('Tool added to project!');\n      setShowAddToolModal(false);\n      setSelectedToolId('');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error adding tool:', error);\n      toast.error(error.response?.data?.message || 'Failed to add tool');\n    }\n  };\n\n  const handleRemoveTool = async (toolId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/tools/${toolId}`);\n      toast.success('Tool removed from project');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error removing tool:', error);\n      toast.error('Failed to remove tool');\n    }\n  };\n\n  const fetchPhotos = async () => {\n    try {\n      const response = await axios.get(`/api/uploads/projects/${id}/photos`);\n      setPhotos(response.data.data.photos);\n    } catch (error: any) {\n      console.error('Error fetching photos:', error);\n    }\n  };\n\n  const fetchAudioNotes = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/audio-notes`);\n      setAudioNotes(response.data.data.audioNotes || []);\n    } catch (error: any) {\n      console.error('Error fetching audio notes:', error);\n    }\n  };\n\n  const fetchStructuredMemos = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/structured-memos`);\n      setStructuredMemos(response.data.data.memos || []);\n    } catch (error: any) {\n      console.error('Error fetching structured memos:', error);\n    }\n  };\n\n  const handleSaveAudioNote = async (audioBlob: Blob, durationSeconds: number, transcription?: string) => {\n    const formData = new FormData();\n    formData.append('audio', audioBlob, 'audio-note.webm');\n    formData.append('durationSeconds', durationSeconds.toString());\n    if (transcription) {\n      formData.append('transcription', transcription);\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/audio-notes`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('Audio note saved!');\n      fetchAudioNotes();\n    } catch (error: any) {\n      console.error('Error saving audio note:', error);\n      toast.error('Failed to save audio note');\n      throw error;\n    }\n  };\n\n  const handleDeleteAudioNote = async (noteId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/audio-notes/${noteId}`);\n      toast.success('Audio note deleted');\n      fetchAudioNotes();\n    } catch (error: any) {\n      console.error('Error deleting audio note:', error);\n      toast.error('Failed to delete audio note');\n      throw error;\n    }\n  };\n\n  const handleUpdateAudioTranscription = async (noteId: string, transcription: string) => {\n    try {\n      await axios.put(`/api/projects/${id}/audio-notes/${noteId}`, { transcription });\n      toast.success('Transcription updated');\n      fetchAudioNotes();\n    } catch (error: any) {\n      console.error('Error updating transcription:', error);\n      toast.error('Failed to update transcription');\n      throw error;\n    }\n  };\n\n  const handleSaveStructuredMemo = async (templateType: string, data: any) => {\n    try {\n      await axios.post(`/api/projects/${id}/structured-memos`, {\n        templateType,\n        data,\n      });\n      toast.success('Memo saved!');\n      fetchStructuredMemos();\n    } catch (error: any) {\n      console.error('Error saving memo:', error);\n      toast.error('Failed to save memo');\n      throw error;\n    }\n  };\n\n  const handleDeleteStructuredMemo = async (memoId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/structured-memos/${memoId}`);\n      toast.success('Memo deleted');\n      fetchStructuredMemos();\n    } catch (error: any) {\n      console.error('Error deleting memo:', error);\n      toast.error('Failed to delete memo');\n      throw error;\n    }\n  };\n\n  const handleToggleKnittingMode = () => {\n    setKnittingMode(!knittingMode);\n    if (!knittingMode) {\n      toast.success('Knitting Mode activated! ');\n    } else {\n      toast.info('Knitting Mode deactivated');\n    }\n  };\n\n  // Get current counter values for session tracking\n  const getCurrentCounterValues = () => {\n    const counterValues: Record<string, number> = {};\n    if (project?.counters) {\n      project.counters.forEach((counter: any) => {\n        counterValues[counter.id] = counter.current_count || 0;\n      });\n    }\n    return counterValues;\n  };\n\n  const handleStartSession = async (): Promise<any> => {\n    try {\n      const response = await axios.post(`/api/projects/${id}/sessions/start`, {\n        mood: undefined,\n        location: undefined,\n        notes: 'Knitting session',\n      });\n      const newSession = response.data.success ? response.data.data.session : response.data;\n      setCurrentSession(newSession);\n      await fetchSessions();\n      toast.success('Knitting session started! ');\n      return newSession;\n    } catch (error) {\n      console.error('Failed to start session:', error);\n      toast.error('Failed to start session');\n      throw error;\n    }\n  };\n\n  const handleEndSession = async (notes?: string, mood?: string) => {\n    if (!currentSession) return;\n\n    try {\n      await axios.post(`/api/projects/${id}/sessions/${currentSession.id}/end`, {\n        notes,\n        mood,\n      });\n      setCurrentSession(null);\n      await fetchSessions();\n      toast.success('Session ended and saved!');\n    } catch (error) {\n      console.error('Failed to end session:', error);\n      toast.error('Failed to end session');\n      throw error;\n    }\n  };\n\n  const handleDeleteSession = async (sessionId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/sessions/${sessionId}`);\n      await fetchSessions();\n      toast.success('Session deleted');\n    } catch (error) {\n      console.error('Failed to delete session:', error);\n      toast.error('Failed to delete session');\n    }\n  };\n\n  const handlePhotoUpload = async (file: File) => {\n    const formData = new FormData();\n    formData.append('photo', file);\n\n    try {\n      await axios.post(`/api/uploads/projects/${id}/photos`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('Photo uploaded successfully!');\n      fetchPhotos();\n    } catch (error: any) {\n      console.error('Error uploading photo:', error);\n      toast.error('Failed to upload photo');\n      throw error;\n    }\n  };\n\n  const handlePhotoDelete = async (photoId: string) => {\n    try {\n      await axios.delete(`/api/uploads/projects/${id}/photos/${photoId}`);\n      toast.success('Photo deleted successfully');\n      fetchPhotos();\n    } catch (error: any) {\n      console.error('Error deleting photo:', error);\n      toast.error('Failed to delete photo');\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return 'Not set';\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active':\n        return 'bg-green-100 text-green-800';\n      case 'completed':\n        return 'bg-blue-100 text-blue-800';\n      case 'paused':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'planned':\n        return 'bg-gray-100 text-gray-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getYarnPercentage = (y: any) => {\n    const remaining = y.yarn_remaining || 0;\n    const total = y.yarn_total || 1;\n    return Math.max(0, Math.min(100, (remaining / total) * 100));\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <LoadingSpinner size=\"lg\" text=\"Loading project...\" />\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-gray-500\">Project not found</p>\n        <Link to=\"/projects\" className=\"text-purple-600 hover:text-purple-700 mt-4 inline-block\">\n          Back to Projects\n        </Link>\n      </div>\n    );\n  }\n\n  const selectedRecipient = availableRecipients.find(r => r.id === formData.recipientId);\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"mb-6\">\n        <Link\n          to=\"/projects\"\n          className=\"inline-flex items-center text-purple-600 hover:text-purple-700 mb-4\"\n        >\n          <FiArrowLeft className=\"mr-2\" />\n          Back to Projects\n        </Link>\n\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-3 mb-2\">\n              <h1 className=\"text-3xl font-bold text-gray-900\">{project.name}</h1>\n              <span\n                className={`px-3 py-1 text-sm font-medium rounded-full ${getStatusColor(\n                  project.status\n                )}`}\n              >\n                {project.status}\n              </span>\n            </div>\n            {project.project_type && (\n              <p className=\"text-gray-600\">Type: {project.project_type}</p>\n            )}\n            {selectedRecipient && (\n              <p className=\"text-gray-600 flex items-center mt-1\">\n                <FiUser className=\"mr-2 h-4 w-4\" />\n                Gift for: {selectedRecipient.first_name} {selectedRecipient.last_name}\n              </p>\n            )}\n          </div>\n\n          <div className=\"flex gap-2 flex-wrap\">\n            <button\n              onClick={handleToggleKnittingMode}\n              className={`px-4 py-3 md:py-2 rounded-lg transition flex items-center min-h-[48px] md:min-h-0 ${\n                knittingMode\n                  ? 'bg-green-600 text-white hover:bg-green-700'\n                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n              }`}\n            >\n              {knittingMode ? <FiEyeOff className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" /> : <FiEye className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />}\n              <span className=\"text-base md:text-sm\">{knittingMode ? 'Exit Knitting Mode' : 'Knitting Mode'}</span>\n            </button>\n            <button\n              onClick={() => setShowEditModal(true)}\n              className=\"px-4 py-3 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center min-h-[48px] md:min-h-0\"\n            >\n              <FiEdit2 className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Edit</span>\n            </button>\n            <button\n              onClick={handleDelete}\n              className=\"px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition flex items-center min-h-[48px] md:min-h-0\"\n            >\n              <FiTrash2 className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Delete</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Knitting Mode - Full Featured UI */}\n      {knittingMode ? (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n          {/* Main Content - Left Column */}\n          <div className=\"lg:col-span-2 space-y-4 md:space-y-6\">\n            {/* Pattern Preview - Knitting Mode */}\n            {project.patterns && project.patterns.length > 0 && (\n              <PatternPreview\n                patterns={project.patterns}\n                mode=\"knitting\"\n              />\n            )}\n\n            {/* Counters - Large Display */}\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 md:p-6\">\n              <CounterHierarchy projectId={id!} />\n            </div>\n          </div>\n\n          {/* Sidebar - Right Column */}\n          <div className=\"space-y-4 md:space-y-6\">\n            {/* Session Timer with Row Tracking */}\n            <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-lg md:text-xl font-bold text-gray-900\">Session Timer</h2>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setShowKnittingVoiceNotes(!showKnittingVoiceNotes)}\n                    className={`p-2 rounded-lg transition ${\n                      showKnittingVoiceNotes\n                        ? 'bg-purple-600 text-white'\n                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                    }`}\n                    title=\"Voice Notes\"\n                  >\n                    <FiMic className=\"h-4 w-4\" />\n                  </button>\n                  <button\n                    onClick={() => setShowKnittingHistory(!showKnittingHistory)}\n                    className={`p-2 rounded-lg transition ${\n                      showKnittingHistory\n                        ? 'bg-purple-600 text-white'\n                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                    }`}\n                    title=\"History\"\n                  >\n                    <FiClock className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              </div>\n              <SessionTimer\n                projectId={id!}\n                currentSession={currentSession}\n                onStartSession={handleStartSession}\n                onEndSession={handleEndSession}\n                getCurrentCounterValues={getCurrentCounterValues}\n              />\n            </div>\n\n            {/* Voice Notes - Embedded in Knitting Mode */}\n            {showKnittingVoiceNotes && (\n              <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n                <h2 className=\"text-lg md:text-xl font-bold text-gray-900 mb-4\">Voice Notes</h2>\n                <AudioNotes\n                  projectId={id!}\n                  notes={audioNotes}\n                  onSaveNote={handleSaveAudioNote}\n                  onDeleteNote={handleDeleteAudioNote}\n                  onUpdateTranscription={handleUpdateAudioTranscription}\n                />\n              </div>\n            )}\n\n            {/* Session History - Embedded in Knitting Mode */}\n            {showKnittingHistory && sessions.length > 0 && (\n              <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n                <h2 className=\"text-lg md:text-xl font-bold text-gray-900 mb-4\">Session History</h2>\n                <SessionHistory sessions={sessions} onDeleteSession={handleDeleteSession} />\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        <>\n          {/* Normal Mode - Project Details Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n        {/* Main Content - Left Column */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Description */}\n          {project.description && (\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-3\">Description</h2>\n              <p className=\"text-gray-700 whitespace-pre-wrap\">{project.description}</p>\n            </div>\n          )}\n\n          {/* Pattern Preview Section - Normal Mode */}\n          {project.patterns && project.patterns.length > 0 && (\n            <PatternPreview\n              patterns={project.patterns}\n              mode=\"normal\"\n            />\n          )}\n\n          {/* Photos */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center mb-4\">\n              <FiImage className=\"h-5 w-5 text-purple-600 mr-2\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">Project Photos</h2>\n              <span className=\"ml-2 text-sm text-gray-500\">({photos.length})</span>\n            </div>\n\n            <div className=\"mb-6\">\n              <FileUpload onUpload={handlePhotoUpload} />\n            </div>\n\n            <PhotoGallery photos={photos} onDelete={handlePhotoDelete} />\n          </div>\n\n          {/* Counters */}\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-6\">\n            <CounterHierarchy projectId={id!} />\n          </div>\n\n          {/* Magic Markers */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <MagicMarkerManager\n              projectId={id!}\n              counters={project?.counters || []}\n            />\n          </div>\n\n          {/* Session Management */}\n          <SessionManager\n            projectId={id!}\n            totalRows={0}\n            getCurrentCounterValues={() => {\n              return {};\n            }}\n          />\n\n          {/* Notes Section with Tabs */}\n          <div id=\"notes-section\" className=\"bg-white rounded-lg shadow\">\n            <div className=\"border-b border-gray-200 px-6 pt-6\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Notes</h2>\n              <nav className=\"flex -mb-px gap-6\">\n                <button\n                  onClick={() => setNotesTab('audio')}\n                  className={`pb-3 text-sm font-medium border-b-2 ${\n                    notesTab === 'audio'\n                      ? 'border-purple-600 text-purple-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Audio Notes\n                </button>\n                <button\n                  onClick={() => setNotesTab('handwritten')}\n                  className={`pb-3 text-sm font-medium border-b-2 ${\n                    notesTab === 'handwritten'\n                      ? 'border-purple-600 text-purple-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Handwritten\n                </button>\n                <button\n                  onClick={() => setNotesTab('memos')}\n                  className={`pb-3 text-sm font-medium border-b-2 ${\n                    notesTab === 'memos'\n                      ? 'border-purple-600 text-purple-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Structured Memos\n                </button>\n              </nav>\n            </div>\n\n            <div className=\"p-6\">\n              {notesTab === 'audio' && (\n                <AudioNotes\n                  projectId={id!}\n                  notes={audioNotes}\n                  onSaveNote={handleSaveAudioNote}\n                  onDeleteNote={handleDeleteAudioNote}\n                  onUpdateTranscription={handleUpdateAudioTranscription}\n                />\n              )}\n\n              {notesTab === 'handwritten' && (\n                <HandwrittenNotes\n                  projectId={id!}\n                  onSave={async (imageData) => {\n                    try {\n                      // Convert base64 to blob\n                      const response = await fetch(imageData);\n                      const blob = await response.blob();\n\n                      const formData = new FormData();\n                      formData.append('image', blob, 'handwritten-note.png');\n\n                      await axios.post(`/api/projects/${id}/handwritten-notes`, formData, {\n                        headers: {\n                          'Content-Type': 'multipart/form-data',\n                        },\n                      });\n                      toast.success('Handwritten note saved!');\n                    } catch (error) {\n                      console.error('Error saving handwritten note:', error);\n                      throw error;\n                    }\n                  }}\n                />\n              )}\n\n              {notesTab === 'memos' && (\n                <StructuredMemoTemplates\n                  projectId={id!}\n                  memos={structuredMemos}\n                  onSaveMemo={handleSaveStructuredMemo}\n                  onDeleteMemo={handleDeleteStructuredMemo}\n                />\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Sidebar - Right Column */}\n        <div className=\"space-y-6\">\n          {/* Timeline */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Timeline</h2>\n            <div className=\"space-y-3\">\n              {project.start_date && (\n                <div className=\"flex items-start\">\n                  <FiCalendar className=\"mt-1 mr-3 h-5 w-5 text-gray-400\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Started</p>\n                    <p className=\"text-sm text-gray-600\">{formatDate(project.start_date)}</p>\n                  </div>\n                </div>\n              )}\n              {project.target_completion_date && (\n                <div className=\"flex items-start\">\n                  <FiClock className=\"mt-1 mr-3 h-5 w-5 text-gray-400\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Target Completion</p>\n                    <p className=\"text-sm text-gray-600\">\n                      {formatDate(project.target_completion_date)}\n                    </p>\n                  </div>\n                </div>\n              )}\n              {project.completion_date && (\n                <div className=\"flex items-start\">\n                  <FiCheck className=\"mt-1 mr-3 h-5 w-5 text-green-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Completed</p>\n                    <p className=\"text-sm text-gray-600\">{formatDate(project.completion_date)}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Notes */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Notes</h2>\n              {!editingNotes && (\n                <button\n                  onClick={handleEditNotes}\n                  className=\"text-purple-600 hover:text-purple-700\"\n                  title=\"Edit notes\"\n                >\n                  <FiEdit2 className=\"h-4 w-4\" />\n                </button>\n              )}\n            </div>\n\n            {editingNotes ? (\n              <div className=\"space-y-3\">\n                <textarea\n                  value={notesText}\n                  onChange={(e) => setNotesText(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm\"\n                  rows={6}\n                  placeholder=\"Add notes about your project...\"\n                />\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={handleSaveNotes}\n                    className=\"flex-1 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm flex items-center justify-center gap-2\"\n                  >\n                    <FiCheck className=\"h-4 w-4\" />\n                    Save\n                  </button>\n                  <button\n                    onClick={handleCancelNotes}\n                    className=\"flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm flex items-center justify-center gap-2\"\n                  >\n                    <FiX className=\"h-4 w-4\" />\n                    Cancel\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div>\n                {project.notes ? (\n                  <p className=\"text-sm text-gray-700 whitespace-pre-wrap\">{project.notes}</p>\n                ) : (\n                  <p className=\"text-sm text-gray-500 italic\">No notes added yet</p>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Patterns */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Patterns</h2>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setShowAddPatternModal(true)}\n                  className=\"text-purple-600 hover:text-purple-700 text-xs flex items-center gap-1\"\n                  title=\"Select existing pattern\"\n                >\n                  <FiPlus className=\"h-4 w-4\" />\n                  Select\n                </button>\n                <button\n                  onClick={() => setShowUploadPatternModal(true)}\n                  className=\"px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 flex items-center gap-1\"\n                  title=\"Upload new pattern\"\n                >\n                  <FiPlus className=\"h-3 w-3\" />\n                  Upload\n                </button>\n              </div>\n            </div>\n\n            {project.patterns && project.patterns.length > 0 ? (\n              <ul className=\"space-y-2\">\n                {project.patterns.map((pattern: any) => (\n                  <li key={pattern.id} className=\"flex items-center justify-between text-sm\">\n                    <Link\n                      to={`/patterns/${pattern.id}`}\n                      className=\"text-purple-600 hover:text-purple-700 flex-1\"\n                    >\n                      {pattern.name}\n                    </Link>\n                    <button\n                      onClick={() => handleRemovePattern(pattern.id)}\n                      className=\"text-red-600 hover:text-red-700 ml-2\"\n                      title=\"Remove pattern\"\n                    >\n                      <FiX className=\"h-4 w-4\" />\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <p className=\"text-sm text-gray-500\">No patterns added</p>\n            )}\n          </div>\n\n          {/* Tools */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Tools</h2>\n              <button\n                onClick={() => setShowAddToolModal(true)}\n                className=\"text-purple-600 hover:text-purple-700\"\n                title=\"Add tool\"\n              >\n                <FiPlus className=\"h-5 w-5\" />\n              </button>\n            </div>\n\n            {project.tools && project.tools.length > 0 ? (\n              <ul className=\"space-y-2\">\n                {project.tools.map((tool: any) => (\n                  <li key={tool.id} className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-gray-700 flex-1\">\n                      {tool.name}\n                      {tool.size && <span className=\"text-gray-500\"> ({tool.size})</span>}\n                    </span>\n                    <button\n                      onClick={() => handleRemoveTool(tool.id)}\n                      className=\"text-red-600 hover:text-red-700 ml-2\"\n                      title=\"Remove tool\"\n                    >\n                      <FiX className=\"h-4 w-4\" />\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <p className=\"text-sm text-gray-500\">No tools added</p>\n            )}\n          </div>\n\n          {/* Yarn Usage */}\n          {project.yarn && project.yarn.length > 0 ? (\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Yarn Usage</h2>\n                <button\n                  onClick={() => setShowAddYarnModal(true)}\n                  className=\"text-purple-600 hover:text-purple-700\"\n                  title=\"Add yarn\"\n                >\n                  <FiPlus className=\"h-5 w-5\" />\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                {project.yarn.map((y: any) => {\n                  const percentage = getYarnPercentage(y);\n                  const isLowStock = y.low_stock_alert && y.yards_remaining <= (y.low_stock_threshold || 0);\n\n                  return (\n                    <div key={y.id} className=\"border border-gray-200 rounded-lg p-3\">\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div className=\"flex-1\">\n                          <h3 className=\"text-sm font-medium text-gray-900\">\n                            {y.brand} {y.name}\n                            {y.color && <span className=\"text-gray-600\"> - {y.color}</span>}\n                          </h3>\n                          <p className=\"text-xs text-gray-500\">{y.weight}</p>\n                        </div>\n                        <button\n                          onClick={() => handleRemoveYarn(y.id)}\n                          className=\"text-red-600 hover:text-red-700 p-1\"\n                          title=\"Remove yarn\"\n                        >\n                          <FiX className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n\n                      {/* Usage Stats */}\n                      <div className=\"space-y-2 mb-3\">\n                        <div>\n                          <p className=\"text-xs text-gray-500\">Used in Project</p>\n                          <p className=\"text-xs font-medium text-gray-900\">\n                            {y.skeins_used || 0} skeins, {y.yards_used || 0} yds\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-xs text-gray-500\">Remaining in Stash</p>\n                          <p className=\"text-xs font-medium text-gray-900\">\n                            {y.skeins_remaining || 0} skeins, {y.yards_remaining || 0} yds\n                          </p>\n                        </div>\n                      </div>\n\n                      {/* Progress Bar */}\n                      <div className=\"mb-2\">\n                        <div className=\"flex items-center justify-between text-xs text-gray-600 mb-1\">\n                          <span>Stash Level</span>\n                          <span>{percentage.toFixed(0)}%</span>\n                        </div>\n                        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                          <div\n                            className={`h-2 rounded-full transition-all ${\n                              percentage < 20 ? 'bg-red-500' : percentage < 50 ? 'bg-yellow-500' : 'bg-green-500'\n                            }`}\n                            style={{ width: `${percentage}%` }}\n                          />\n                        </div>\n                      </div>\n\n                      {/* Low Stock Warning */}\n                      {isLowStock && (\n                        <div className=\"flex items-center text-orange-600 text-xs mt-2\">\n                          <FiAlertCircle className=\"mr-1 h-3 w-3\" />\n                          Low stock! Only {y.yards_remaining} yards remaining\n                        </div>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          ) : (\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Yarn Usage</h2>\n                <button\n                  onClick={() => setShowAddYarnModal(true)}\n                  className=\"text-purple-600 hover:text-purple-700\"\n                  title=\"Add yarn\"\n                >\n                  <FiPlus className=\"h-5 w-5\" />\n                </button>\n              </div>\n              <p className=\"text-sm text-gray-500\">No yarn added</p>\n            </div>\n          )}\n        </div>\n      </div>\n        </>\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Project</h2>\n            </div>\n\n            <form onSubmit={handleUpdate} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Project Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Status</label>\n                  <select\n                    value={formData.status}\n                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"planned\">Planned</option>\n                    <option value=\"active\">Active</option>\n                    <option value=\"paused\">Paused</option>\n                    <option value=\"completed\">Completed</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Gift Recipient (Optional)\n                  </label>\n                  <select\n                    value={formData.recipientId}\n                    onChange={(e) => setFormData({ ...formData, recipientId: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"\">None</option>\n                    {availableRecipients.map((r) => (\n                      <option key={r.id} value={r.id}>\n                        {r.first_name} {r.last_name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={5}\n                  placeholder=\"Add notes about your project...\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowEditModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Save Changes\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Add Pattern Modal */}\n      {showAddPatternModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Add Pattern to Project</h2>\n            </div>\n\n            <div className=\"p-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Select Pattern\n              </label>\n              <select\n                value={selectedPatternId}\n                onChange={(e) => setSelectedPatternId(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4\"\n              >\n                <option value=\"\">Choose a pattern...</option>\n                {availablePatterns\n                  .filter(p => !project?.patterns?.some((pp: any) => pp.id === p.id))\n                  .map((pattern) => (\n                    <option key={pattern.id} value={pattern.id}>\n                      {pattern.name}\n                      {pattern.designer && ` by ${pattern.designer}`}\n                    </option>\n                  ))}\n              </select>\n\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => {\n                    setShowAddPatternModal(false);\n                    setSelectedPatternId('');\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleAddPattern}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Pattern\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Upload New Pattern Modal */}\n      {showUploadPatternModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Upload New Pattern</h2>\n              <p className=\"text-sm text-gray-600 mt-1\">Upload a PDF pattern and add it to this project</p>\n            </div>\n\n            <form onSubmit={handleUploadPattern} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={newPatternData.name}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Cable Knit Sweater\"\n                  required\n                  disabled={uploadingPattern}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Designer\n                </label>\n                <input\n                  type=\"text\"\n                  value={newPatternData.designer}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, designer: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Jane Doe\"\n                  disabled={uploadingPattern}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Difficulty\n                </label>\n                <select\n                  value={newPatternData.difficulty}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, difficulty: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  disabled={uploadingPattern}\n                >\n                  <option value=\"beginner\">Beginner</option>\n                  <option value=\"intermediate\">Intermediate</option>\n                  <option value=\"advanced\">Advanced</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={newPatternData.description}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Brief description of the pattern...\"\n                  disabled={uploadingPattern}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern File (PDF) *\n                </label>\n                <input\n                  type=\"file\"\n                  accept=\".pdf,application/pdf\"\n                  onChange={(e) => setPatternFile(e.target.files?.[0] || null)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100\"\n                  required\n                  disabled={uploadingPattern}\n                />\n                {patternFile && (\n                  <p className=\"text-sm text-gray-600 mt-2\">\n                    Selected: {patternFile.name} ({(patternFile.size / 1024 / 1024).toFixed(2)} MB)\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowUploadPatternModal(false);\n                    setNewPatternData({\n                      name: '',\n                      description: '',\n                      designer: '',\n                      difficulty: 'intermediate',\n                    });\n                    setPatternFile(null);\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                  disabled={uploadingPattern}\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed\"\n                  disabled={uploadingPattern}\n                >\n                  {uploadingPattern ? 'Uploading...' : 'Upload & Add to Project'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Add Yarn Modal */}\n      {showAddYarnModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Add Yarn to Project</h2>\n            </div>\n\n            <div className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Select Yarn\n                </label>\n                <select\n                  value={selectedYarnId}\n                  onChange={(e) => setSelectedYarnId(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                >\n                  <option value=\"\">Choose yarn...</option>\n                  {availableYarn\n                    .filter(y => y.skeins_remaining > 0)\n                    .map((yarn) => (\n                      <option key={yarn.id} value={yarn.id}>\n                        {yarn.brand} {yarn.name} - {yarn.color}\n                        ({yarn.skeins_remaining} skeins, {yarn.yards_remaining} yds available)\n                      </option>\n                    ))}\n                </select>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Skeins to Use\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={yarnQuantity.skeins}\n                    onChange={(e) => setYarnQuantity({ ...yarnQuantity, skeins: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"0\"\n                    min=\"0\"\n                    step=\"0.1\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yards to Use\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={yarnQuantity.yards}\n                    onChange={(e) => setYarnQuantity({ ...yarnQuantity, yards: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"0\"\n                    min=\"0\"\n                    step=\"1\"\n                  />\n                </div>\n              </div>\n\n              <p className=\"text-sm text-gray-500\">\n                The specified amount will be deducted from your stash automatically.\n              </p>\n\n              <div className=\"flex gap-3 pt-2\">\n                <button\n                  onClick={() => {\n                    setShowAddYarnModal(false);\n                    setSelectedYarnId('');\n                    setYarnQuantity({ skeins: '', yards: '' });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleAddYarn}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Yarn\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Add Tool Modal */}\n      {showAddToolModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Add Tool to Project</h2>\n            </div>\n\n            <div className=\"p-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Select Tool\n              </label>\n              <select\n                value={selectedToolId}\n                onChange={(e) => setSelectedToolId(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4\"\n              >\n                <option value=\"\">Choose a tool...</option>\n                {availableTools\n                  .filter(t => !project?.tools?.some((pt: any) => pt.id === t.id))\n                  .map((tool) => (\n                    <option key={tool.id} value={tool.id}>\n                      {tool.name}\n                      {tool.size && ` (${tool.size})`}\n                      {tool.type && ` - ${tool.type}`}\n                    </option>\n                  ))}\n              </select>\n\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => {\n                    setShowAddToolModal(false);\n                    setSelectedToolId('');\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleAddTool}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Tool\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiBookmark, FiPlus, FiX, FiEdit2, FiTrash2, FiChevronRight } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Bookmark {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  name: string;\n  page_number: number;\n  y_position: number | null;\n  zoom_level: number;\n  notes: string | null;\n  color: string;\n  sort_order: number;\n  created_at: string;\n}\n\ninterface BookmarkManagerProps {\n  patternId: string;\n  projectId?: string;\n  currentPage?: number;\n  currentZoom?: number;\n  onJumpToBookmark: (bookmark: Bookmark) => void;\n}\n\nconst BOOKMARK_COLORS = [\n  { name: 'Yellow', value: '#FBBF24' },\n  { name: 'Red', value: '#EF4444' },\n  { name: 'Blue', value: '#3B82F6' },\n  { name: 'Green', value: '#10B981' },\n  { name: 'Purple', value: '#8B5CF6' },\n  { name: 'Pink', value: '#EC4899' },\n];\n\nexport default function BookmarkManager({\n  patternId,\n  projectId,\n  currentPage = 1,\n  currentZoom = 1.0,\n  onJumpToBookmark,\n}: BookmarkManagerProps) {\n  const [bookmarks, setBookmarks] = useState<Bookmark[]>([]);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [editingBookmark, setEditingBookmark] = useState<Bookmark | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    pageNumber: currentPage,\n    notes: '',\n    color: '#FBBF24',\n  });\n\n  useEffect(() => {\n    fetchBookmarks();\n  }, [patternId, projectId]);\n\n  const fetchBookmarks = async () => {\n    try {\n      const params = projectId ? { projectId } : {};\n      const response = await axios.get(`/api/patterns/${patternId}/bookmarks`, { params });\n      setBookmarks(response.data.data.bookmarks);\n    } catch (error) {\n      console.error('Error fetching bookmarks:', error);\n    }\n  };\n\n  const handleCreateBookmark = async () => {\n    if (!formData.name.trim()) {\n      toast.error('Please enter a bookmark name');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/patterns/${patternId}/bookmarks`, {\n        name: formData.name,\n        pageNumber: formData.pageNumber,\n        zoomLevel: currentZoom,\n        notes: formData.notes || null,\n        color: formData.color,\n        projectId: projectId || null,\n      });\n\n      toast.success('Bookmark created!');\n      setShowCreateModal(false);\n      resetForm();\n      fetchBookmarks();\n    } catch (error: any) {\n      console.error('Error creating bookmark:', error);\n      toast.error(error.response?.data?.message || 'Failed to create bookmark');\n    }\n  };\n\n  const handleUpdateBookmark = async () => {\n    if (!editingBookmark) return;\n\n    try {\n      await axios.put(`/api/patterns/${patternId}/bookmarks/${editingBookmark.id}`, {\n        name: formData.name,\n        pageNumber: formData.pageNumber,\n        notes: formData.notes || null,\n        color: formData.color,\n      });\n\n      toast.success('Bookmark updated!');\n      setEditingBookmark(null);\n      resetForm();\n      fetchBookmarks();\n    } catch (error: any) {\n      console.error('Error updating bookmark:', error);\n      toast.error(error.response?.data?.message || 'Failed to update bookmark');\n    }\n  };\n\n  const handleDeleteBookmark = async (bookmarkId: string) => {\n    if (!confirm('Delete this bookmark?')) return;\n\n    try {\n      await axios.delete(`/api/patterns/${patternId}/bookmarks/${bookmarkId}`);\n      toast.success('Bookmark deleted');\n      fetchBookmarks();\n    } catch (error) {\n      console.error('Error deleting bookmark:', error);\n      toast.error('Failed to delete bookmark');\n    }\n  };\n\n  const handleQuickBookmark = async () => {\n    try {\n      await axios.post(`/api/patterns/${patternId}/bookmarks`, {\n        name: `Page ${currentPage}`,\n        pageNumber: currentPage,\n        zoomLevel: currentZoom,\n        color: '#FBBF24',\n        projectId: projectId || null,\n      });\n\n      toast.success(`Bookmark added for page ${currentPage}!`);\n      fetchBookmarks();\n    } catch (error) {\n      console.error('Error creating quick bookmark:', error);\n      toast.error('Failed to create bookmark');\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      pageNumber: currentPage,\n      notes: '',\n      color: '#FBBF24',\n    });\n  };\n\n  const openCreateModal = () => {\n    resetForm();\n    setShowCreateModal(true);\n  };\n\n  const openEditModal = (bookmark: Bookmark) => {\n    setFormData({\n      name: bookmark.name,\n      pageNumber: bookmark.page_number,\n      notes: bookmark.notes || '',\n      color: bookmark.color,\n    });\n    setEditingBookmark(bookmark);\n  };\n\n  return (\n    <div className=\"bg-gray-700 rounded-lg p-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <FiBookmark className=\"h-5 w-5 text-yellow-400\" />\n          <h3 className=\"text-white font-semibold\">Bookmarks</h3>\n          <span className=\"text-gray-400 text-sm\">({bookmarks.length})</span>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleQuickBookmark}\n            className=\"p-2 bg-gray-600 hover:bg-gray-500 rounded text-white text-sm\"\n            title=\"Quick bookmark current page\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n          </button>\n          <button\n            onClick={openCreateModal}\n            className=\"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded text-white text-sm flex items-center gap-2\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n            New\n          </button>\n        </div>\n      </div>\n\n      {/* Bookmarks List */}\n      <div className=\"space-y-2 max-h-80 overflow-y-auto\">\n        {bookmarks.length === 0 ? (\n          <p className=\"text-gray-400 text-sm text-center py-4\">No bookmarks yet</p>\n        ) : (\n          bookmarks.map((bookmark) => (\n            <div\n              key={bookmark.id}\n              className=\"flex items-center gap-3 p-3 bg-gray-800 rounded-lg hover:bg-gray-750 cursor-pointer group\"\n            >\n              {/* Color indicator */}\n              <div\n                className=\"w-1 h-12 rounded-full flex-shrink-0\"\n                style={{ backgroundColor: bookmark.color }}\n              />\n\n              {/* Bookmark info */}\n              <div\n                className=\"flex-1 min-w-0\"\n                onClick={() => onJumpToBookmark(bookmark)}\n              >\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <h4 className=\"text-white font-medium truncate\">{bookmark.name}</h4>\n                  <FiChevronRight className=\"h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                </div>\n                <div className=\"flex items-center gap-3 text-xs text-gray-400\">\n                  <span>Page {bookmark.page_number}</span>\n                  {bookmark.notes && (\n                    <span className=\"truncate max-w-xs\">{bookmark.notes}</span>\n                  )}\n                </div>\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    openEditModal(bookmark);\n                  }}\n                  className=\"p-1.5 hover:bg-gray-600 rounded text-blue-400\"\n                  title=\"Edit bookmark\"\n                >\n                  <FiEdit2 className=\"h-4 w-4\" />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleDeleteBookmark(bookmark.id);\n                  }}\n                  className=\"p-1.5 hover:bg-gray-600 rounded text-red-400\"\n                  title=\"Delete bookmark\"\n                >\n                  <FiTrash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      {/* Create/Edit Modal */}\n      {(showCreateModal || editingBookmark) && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-4 border-b border-gray-700 flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-white\">\n                {editingBookmark ? 'Edit Bookmark' : 'New Bookmark'}\n              </h3>\n              <button\n                onClick={() => {\n                  setShowCreateModal(false);\n                  setEditingBookmark(null);\n                  resetForm();\n                }}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                <FiX className=\"h-5 w-5\" />\n              </button>\n            </div>\n\n            <div className=\"p-4 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Bookmark Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"e.g., Current row, Sleeve decreases\"\n                  className=\"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500\"\n                  autoFocus\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Page Number\n                </label>\n                <input\n                  type=\"number\"\n                  value={formData.pageNumber}\n                  onChange={(e) => setFormData({ ...formData, pageNumber: parseInt(e.target.value) })}\n                  min={1}\n                  className=\"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Color\n                </label>\n                <div className=\"grid grid-cols-6 gap-2\">\n                  {BOOKMARK_COLORS.map((color) => (\n                    <button\n                      key={color.value}\n                      onClick={() => setFormData({ ...formData, color: color.value })}\n                      className={`w-full h-10 rounded border-2 ${\n                        formData.color === color.value\n                          ? 'border-white'\n                          : 'border-gray-600 hover:border-gray-400'\n                      }`}\n                      style={{ backgroundColor: color.value }}\n                      title={color.name}\n                    />\n                  ))}\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Notes (optional)\n                </label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  placeholder=\"Additional notes or instructions\"\n                  rows={3}\n                  className=\"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-2\">\n                <button\n                  onClick={() => {\n                    setShowCreateModal(false);\n                    setEditingBookmark(null);\n                    resetForm();\n                  }}\n                  className=\"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={editingBookmark ? handleUpdateBookmark : handleCreateBookmark}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                >\n                  {editingBookmark ? 'Update' : 'Create'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","// @ts-nocheck\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport {  FiTrash2, FiEye, FiEyeOff } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Highlight {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  page_number: number;\n  coordinates: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  };\n  color: string;\n  opacity: number;\n  layer: number;\n}\n\ninterface PatternHighlighterProps {\n  patternId: string;\n  projectId?: string;\n  pageNumber: number;\n  isActive: boolean;\n}\n\nconst HIGHLIGHT_COLORS = [\n  { name: 'Yellow', value: '#FBBF24' },\n  { name: 'Red', value: '#EF4444' },\n  { name: 'Blue', value: '#3B82F6' },\n  { name: 'Green', value: '#10B981' },\n  { name: 'Purple', value: '#8B5CF6' },\n  { name: 'Pink', value: '#EC4899' },\n];\n\nexport default function PatternHighlighter({\n  patternId,\n  projectId,\n  pageNumber,\n  isActive,\n}: PatternHighlighterProps) {\n  const [highlights, setHighlights] = useState<Highlight[]>([]);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [startPos, setStartPos] = useState<{ x: number; y: number } | null>(null);\n  const [currentRect, setCurrentRect] = useState<any>(null);\n  const [selectedColor, setSelectedColor] = useState(HIGHLIGHT_COLORS[0].value);\n  const [opacity, setOpacity] = useState(0.3);\n  const [showControls, setShowControls] = useState(true);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isActive) {\n      fetchHighlights();\n    }\n  }, [patternId, projectId, pageNumber, isActive]);\n\n  useEffect(() => {\n    if (isActive) {\n      drawHighlights();\n    }\n  }, [highlights, isActive]);\n\n  const fetchHighlights = async () => {\n    try {\n      const params: any = { pageNumber };\n      if (projectId) params.projectId = projectId;\n\n      const response = await axios.get(`/api/patterns/${patternId}/highlights`, { params });\n      setHighlights(response.data.data.highlights || []);\n    } catch (error) {\n      console.error('Error fetching highlights:', error);\n    }\n  };\n\n  const drawHighlights = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Draw all highlights\n    highlights.forEach((highlight) => {\n      ctx.fillStyle = highlight.color;\n      ctx.globalAlpha = highlight.opacity;\n      ctx.fillRect(\n        highlight.coordinates.x,\n        highlight.coordinates.y,\n        highlight.coordinates.width,\n        highlight.coordinates.height\n      );\n    });\n\n    // Draw current rectangle being drawn\n    if (currentRect) {\n      ctx.fillStyle = selectedColor;\n      ctx.globalAlpha = opacity;\n      ctx.fillRect(currentRect.x, currentRect.y, currentRect.width, currentRect.height);\n    }\n\n    ctx.globalAlpha = 1;\n  };\n\n  const getMousePos = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return { x: 0, y: 0 };\n\n    const rect = canvas.getBoundingClientRect();\n    return {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top,\n    };\n  };\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isActive) return;\n\n    const pos = getMousePos(e);\n    setStartPos(pos);\n    setIsDrawing(true);\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isDrawing || !startPos) return;\n\n    const pos = getMousePos(e);\n    const width = pos.x - startPos.x;\n    const height = pos.y - startPos.y;\n\n    setCurrentRect({\n      x: width < 0 ? pos.x : startPos.x,\n      y: height < 0 ? pos.y : startPos.y,\n      width: Math.abs(width),\n      height: Math.abs(height),\n    });\n\n    drawHighlights();\n  };\n\n  const handleMouseUp = async () => {\n    if (!isDrawing || !currentRect) {\n      setIsDrawing(false);\n      return;\n    }\n\n    // Only save if rectangle is large enough\n    if (currentRect.width > 5 && currentRect.height > 5) {\n      await saveHighlight(currentRect);\n    }\n\n    setIsDrawing(false);\n    setStartPos(null);\n    setCurrentRect(null);\n  };\n\n  const saveHighlight = async (coordinates: any) => {\n    try {\n      await axios.post(`/api/patterns/${patternId}/highlights`, {\n        pageNumber,\n        coordinates,\n        color: selectedColor,\n        opacity,\n        projectId: projectId || null,\n      });\n\n      toast.success('Highlight saved!');\n      fetchHighlights();\n    } catch (error) {\n      console.error('Error saving highlight:', error);\n      toast.error('Failed to save highlight');\n    }\n  };\n\n  const handleClearAll = async () => {\n    if (!confirm('Clear all highlights on this page?')) return;\n\n    try {\n      // Delete all highlights for this page\n      await Promise.all(\n        highlights.map((h) =>\n          axios.delete(`/api/patterns/${patternId}/highlights/${h.id}`)\n        )\n      );\n\n      toast.success('All highlights cleared');\n      setHighlights([]);\n    } catch (error) {\n      console.error('Error clearing highlights:', error);\n      toast.error('Failed to clear highlights');\n    }\n  };\n\n  if (!isActive) return null;\n\n  return (\n    <>\n      {/* Canvas overlay */}\n      <canvas\n        ref={canvasRef}\n        className=\"absolute inset-0 w-full h-full z-30 pointer-events-auto\"\n        style={{ cursor: isDrawing ? 'crosshair' : 'default' }}\n        width={containerRef.current?.clientWidth || 800}\n        height={containerRef.current?.clientHeight || 1000}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n      />\n\n      {/* Control Panel */}\n      <div className=\"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64\">\n        <div className=\"flex items-center justify-between\">\n          <h4 className=\"text-white font-semibold text-sm\">Highlighter</h4>\n          <button\n            onClick={() => setShowControls(!showControls)}\n            className=\"p-1 hover:bg-gray-700 rounded text-gray-400\"\n          >\n            {showControls ? <FiEyeOff className=\"h-4 w-4\" /> : <FiEye className=\"h-4 w-4\" />}\n          </button>\n        </div>\n\n        {showControls && (\n          <>\n            {/* Instructions */}\n            <div className=\"text-xs text-gray-300 bg-gray-700 rounded p-2\">\n              <p>Click and drag to highlight</p>\n            </div>\n\n            {/* Color Selection */}\n            <div>\n              <label className=\"block text-xs font-medium text-gray-300 mb-2\">Color</label>\n              <div className=\"grid grid-cols-3 gap-2\">\n                {HIGHLIGHT_COLORS.map((c) => (\n                  <button\n                    key={c.value}\n                    onClick={() => setSelectedColor(c.value)}\n                    className={`h-10 rounded border-2 ${\n                      selectedColor === c.value ? 'border-white' : 'border-gray-600'\n                    }`}\n                    style={{ backgroundColor: c.value }}\n                    title={c.name}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Opacity Slider */}\n            <div>\n              <label className=\"block text-xs font-medium text-gray-300 mb-2\">\n                Opacity: {Math.round(opacity * 100)}%\n              </label>\n              <input\n                type=\"range\"\n                min=\"0.1\"\n                max=\"0.6\"\n                step=\"0.1\"\n                value={opacity}\n                onChange={(e) => setOpacity(parseFloat(e.target.value))}\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* Highlight Count */}\n            <div className=\"text-xs text-gray-400 pt-2 border-t border-gray-700\">\n              {highlights.length} highlight{highlights.length !== 1 ? 's' : ''} on this page\n            </div>\n\n            {/* Clear All Button */}\n            {highlights.length > 0 && (\n              <button\n                onClick={handleClearAll}\n                className=\"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-medium flex items-center justify-center gap-2\"\n              >\n                <FiTrash2 className=\"h-4 w-4\" />\n                Clear All\n              </button>\n            )}\n          </>\n        )}\n      </div>\n    </>\n  );\n}\n","// @ts-nocheck\nimport { useState, useEffect, useCallback } from 'react';\nimport { FiMove, FiX, FiEye, FiEyeOff } from 'react-icons/fi';\n\ninterface RowMarkerProps {\n  pageNumber: number;\n  onPositionChange?: (position: { x: number; y: number }) => void;\n}\n\nconst MARKER_COLORS = [\n  { name: 'Yellow', value: '#FBBF24', opacity: 0.3 },\n  { name: 'Red', value: '#EF4444', opacity: 0.3 },\n  { name: 'Blue', value: '#3B82F6', opacity: 0.3 },\n  { name: 'Green', value: '#10B981', opacity: 0.3 },\n  { name: 'Purple', value: '#8B5CF6', opacity: 0.3 },\n];\n\nexport default function RowMarker({ pageNumber, onPositionChange }: RowMarkerProps) {\n  const [position, setPosition] = useState({ x: 50, y: 50 }); // Percentage based\n  const [height, setHeight] = useState(3); // Percentage of viewport\n  const [isDragging, setIsDragging] = useState(false);\n  const [isResizing, setIsResizing] = useState(false);\n  const [color, setColor] = useState(MARKER_COLORS[0].value);\n  const [opacity, setOpacity] = useState(0.3);\n  const [isLocked, setIsLocked] = useState(false);\n  const [isVisible, setIsVisible] = useState(true);\n  const [showControls, setShowControls] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n\n  // Handle dragging\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    if (isLocked) return;\n\n    e.preventDefault();\n    setIsDragging(true);\n    setDragStart({\n      x: e.clientX - (position.x * window.innerWidth) / 100,\n      y: e.clientY - (position.y * window.innerHeight) / 100,\n    });\n  }, [isLocked, position]);\n\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    if (!isDragging || isLocked) return;\n\n    const newX = ((e.clientX - dragStart.x) / window.innerWidth) * 100;\n    const newY = ((e.clientY - dragStart.y) / window.innerHeight) * 100;\n\n    setPosition({\n      x: Math.max(0, Math.min(100, newX)),\n      y: Math.max(0, Math.min(100 - height, newY)),\n    });\n  }, [isDragging, isLocked, dragStart, height]);\n\n  const handleMouseUp = useCallback(() => {\n    if (isDragging) {\n      setIsDragging(false);\n      onPositionChange?.(position);\n    }\n    setIsResizing(false);\n  }, [isDragging, position, onPositionChange]);\n\n  // Handle resize\n  const handleResizeStart = useCallback((e: React.MouseEvent) => {\n    if (isLocked) return;\n    e.stopPropagation();\n    setIsResizing(true);\n  }, [isLocked]);\n\n  const handleResize = useCallback((e: MouseEvent) => {\n    if (!isResizing || isLocked) return;\n\n    const newHeight = (e.clientY / window.innerHeight) * 100 - position.y;\n    setHeight(Math.max(1, Math.min(20, newHeight)));\n  }, [isResizing, isLocked, position.y]);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isVisible) return;\n\n      switch (e.key) {\n        case 'ArrowUp':\n          if (!isLocked) {\n            e.preventDefault();\n            setPosition(prev => ({ ...prev, y: Math.max(0, prev.y - 1) }));\n          }\n          break;\n        case 'ArrowDown':\n          if (!isLocked) {\n            e.preventDefault();\n            setPosition(prev => ({ ...prev, y: Math.min(100 - height, prev.y + 1) }));\n          }\n          break;\n        case 'l':\n        case 'L':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            setIsLocked(!isLocked);\n          }\n          break;\n        case 'h':\n        case 'H':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            setIsVisible(!isVisible);\n          }\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isVisible, isLocked, height]);\n\n  // Mouse event listeners\n  useEffect(() => {\n    if (isDragging) {\n      window.addEventListener('mousemove', handleMouseMove);\n      window.addEventListener('mouseup', handleMouseUp);\n      return () => {\n        window.removeEventListener('mousemove', handleMouseMove);\n        window.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDragging, handleMouseMove, handleMouseUp]);\n\n  useEffect(() => {\n    if (isResizing) {\n      window.addEventListener('mousemove', handleResize);\n      window.addEventListener('mouseup', handleMouseUp);\n      return () => {\n        window.removeEventListener('mousemove', handleResize);\n        window.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isResizing, handleResize, handleMouseUp]);\n\n  if (!isVisible) {\n    return (\n      <button\n        onClick={() => setIsVisible(true)}\n        className=\"fixed top-20 right-4 z-50 px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg shadow-lg flex items-center gap-2\"\n        title=\"Show row marker (Ctrl+H)\"\n      >\n        <FiEye className=\"h-4 w-4\" />\n        Show Marker\n      </button>\n    );\n  }\n\n  return (\n    <>\n      {/* Row Marker */}\n      <div\n        className={`fixed z-40 transition-opacity ${isDragging ? 'cursor-move' : ''} ${\n          isLocked ? 'pointer-events-none' : 'cursor-move'\n        }`}\n        style={{\n          left: `${position.x}%`,\n          top: `${position.y}%`,\n          width: '90%',\n          height: `${height}%`,\n          backgroundColor: color,\n          opacity: opacity,\n          transform: 'translate(-50%, 0)',\n        }}\n        onMouseDown={handleMouseDown}\n        onMouseEnter={() => !isLocked && setShowControls(true)}\n        onMouseLeave={() => setShowControls(false)}\n      >\n        {/* Controls */}\n        {showControls && !isLocked && (\n          <div className=\"absolute top-0 right-0 flex items-center gap-1 bg-gray-900 bg-opacity-90 rounded-bl-lg p-1\">\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsVisible(false);\n              }}\n              className=\"p-1 hover:bg-gray-700 rounded text-white\"\n              title=\"Hide marker\"\n            >\n              <FiEyeOff className=\"h-3 w-3\" />\n            </button>\n            <FiMove className=\"h-3 w-3 text-white\" title=\"Drag to move\" />\n          </div>\n        )}\n\n        {/* Resize Handle */}\n        {!isLocked && (\n          <div\n            className=\"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize bg-gray-900 bg-opacity-50 hover:bg-opacity-75\"\n            onMouseDown={handleResizeStart}\n            title=\"Drag to resize\"\n          />\n        )}\n      </div>\n\n      {/* Control Panel */}\n      <div className=\"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64\">\n        <div className=\"flex items-center justify-between\">\n          <h4 className=\"text-white font-semibold text-sm\">Row Marker</h4>\n          <button\n            onClick={() => setIsVisible(false)}\n            className=\"p-1 hover:bg-gray-700 rounded text-gray-400\"\n            title=\"Hide marker (Ctrl+H)\"\n          >\n            <FiX className=\"h-4 w-4\" />\n          </button>\n        </div>\n\n        {/* Color Selection */}\n        <div>\n          <label className=\"block text-xs font-medium text-gray-300 mb-2\">Color</label>\n          <div className=\"flex gap-2\">\n            {MARKER_COLORS.map((c) => (\n              <button\n                key={c.value}\n                onClick={() => setColor(c.value)}\n                className={`w-8 h-8 rounded border-2 ${\n                  color === c.value ? 'border-white' : 'border-gray-600'\n                }`}\n                style={{ backgroundColor: c.value }}\n                title={c.name}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Opacity Slider */}\n        <div>\n          <label className=\"block text-xs font-medium text-gray-300 mb-2\">\n            Opacity: {Math.round(opacity * 100)}%\n          </label>\n          <input\n            type=\"range\"\n            min=\"0.1\"\n            max=\"0.8\"\n            step=\"0.1\"\n            value={opacity}\n            onChange={(e) => setOpacity(parseFloat(e.target.value))}\n            className=\"w-full\"\n          />\n        </div>\n\n        {/* Height Slider */}\n        <div>\n          <label className=\"block text-xs font-medium text-gray-300 mb-2\">\n            Height: {height.toFixed(1)}%\n          </label>\n          <input\n            type=\"range\"\n            min=\"1\"\n            max=\"20\"\n            step=\"0.5\"\n            value={height}\n            onChange={(e) => setHeight(parseFloat(e.target.value))}\n            className=\"w-full\"\n          />\n        </div>\n\n        {/* Lock Toggle */}\n        <button\n          onClick={() => setIsLocked(!isLocked)}\n          className={`w-full px-3 py-2 rounded text-sm font-medium ${\n            isLocked\n              ? 'bg-red-600 hover:bg-red-700 text-white'\n              : 'bg-gray-700 hover:bg-gray-600 text-white'\n          }`}\n        >\n          {isLocked ? ' Locked' : ' Unlocked'} (Ctrl+L)\n        </button>\n\n        {/* Instructions */}\n        <div className=\"text-xs text-gray-400 space-y-1 pt-2 border-t border-gray-700\">\n          <p> Drag marker to move</p>\n          <p> Drag bottom edge to resize</p>\n          <p> Arrow keys to fine-tune</p>\n          <p> Ctrl+L to lock/unlock</p>\n          <p> Ctrl+H to hide/show</p>\n        </div>\n      </div>\n    </>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport {\n  FiZoomIn,\n  FiZoomOut,\n  FiRotateCw,\n  FiChevronLeft,\n  FiChevronRight,\n  FiSearch,\n  FiX,\n  FiMaximize,\n  \n  FiBookmark,\n  FiMove,\n  FiEdit3\n} from 'react-icons/fi';\nimport { toast } from 'react-toastify';\nimport BookmarkManager from './BookmarkManager';\nimport RowMarker from './RowMarker';\nimport PatternHighlighter from './PatternHighlighter';\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\nimport 'react-pdf/dist/Page/TextLayer.css';\n\n// Configure PDF.js worker - use local file for production reliability\npdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.min.js';\n\ninterface PatternViewerProps {\n  fileUrl: string;\n  filename: string;\n  patternId?: string;\n  projectId?: string;\n  onClose?: () => void;\n  fullscreen?: boolean;\n}\n\nconst ZOOM_LEVELS = [0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];\n\nexport default function PatternViewer({ fileUrl, filename, patternId, projectId, onClose, fullscreen = true }: PatternViewerProps) {\n  const [numPages, setNumPages] = useState<number>(0);\n  const [currentPage, setCurrentPage] = useState<number>(1);\n  const [zoomIndex, setZoomIndex] = useState<number>(2); // Start at 1.0\n  const [rotation, setRotation] = useState<number>(0);\n  const [searchText, setSearchText] = useState<string>('');\n  const [showSearch, setShowSearch] = useState<boolean>(false);\n  const [_isFullscreen, setIsFullscreen] = useState<boolean>(false);\n  const [showBookmarks, setShowBookmarks] = useState<boolean>(Boolean(patternId));\n  const [showRowMarker, setShowRowMarker] = useState<boolean>(false);\n  const [showHighlighter, setShowHighlighter] = useState<boolean>(false);\n\n  const zoomLevel = ZOOM_LEVELS[zoomIndex];\n\n  function onDocumentLoadSuccess({ numPages }: { numPages: number }) {\n    setNumPages(numPages);\n    setCurrentPage(1);\n    toast.success(`PDF loaded: ${numPages} pages`);\n  }\n\n  function onDocumentLoadError(error: Error) {\n    console.error('Error loading PDF:', error);\n    toast.error('Failed to load PDF file');\n  }\n\n  const handleZoomIn = useCallback(() => {\n    if (zoomIndex < ZOOM_LEVELS.length - 1) {\n      setZoomIndex(prev => prev + 1);\n    }\n  }, [zoomIndex]);\n\n  const handleZoomOut = useCallback(() => {\n    if (zoomIndex > 0) {\n      setZoomIndex(prev => prev - 1);\n    }\n  }, [zoomIndex]);\n\n  const handleRotate = useCallback(() => {\n    setRotation(prev => (prev + 90) % 360);\n  }, []);\n\n  const handleNextPage = useCallback(() => {\n    if (currentPage < numPages) {\n      setCurrentPage(prev => prev + 1);\n    }\n  }, [currentPage, numPages]);\n\n  const handlePrevPage = useCallback(() => {\n    if (currentPage > 1) {\n      setCurrentPage(prev => prev - 1);\n    }\n  }, [currentPage]);\n\n  const handlePageJump = useCallback((page: number) => {\n    if (page >= 1 && page <= numPages) {\n      setCurrentPage(page);\n    }\n  }, [numPages]);\n\n  const toggleFullscreen = useCallback(() => {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n      setIsFullscreen(true);\n    } else {\n      document.exitFullscreen();\n      setIsFullscreen(false);\n    }\n  }, []);\n\n  const handleJumpToBookmark = useCallback((bookmark: any) => {\n    setCurrentPage(bookmark.page_number);\n    if (bookmark.zoom_level) {\n      const zoomIdx = ZOOM_LEVELS.findIndex(z => Math.abs(z - bookmark.zoom_level) < 0.01);\n      if (zoomIdx !== -1) {\n        setZoomIndex(zoomIdx);\n      }\n    }\n    toast.success(`Jumped to: ${bookmark.name}`);\n  }, []);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      switch (e.key) {\n        case 'ArrowRight':\n        case 'PageDown':\n          handleNextPage();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          handlePrevPage();\n          break;\n        case 'Home':\n          setCurrentPage(1);\n          break;\n        case 'End':\n          setCurrentPage(numPages);\n          break;\n        case '+':\n        case '=':\n          handleZoomIn();\n          break;\n        case '-':\n          handleZoomOut();\n          break;\n        case 'f':\n        case 'F':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            setShowSearch(true);\n          }\n          break;\n        case 'Escape':\n          setShowSearch(false);\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [currentPage, numPages, handleNextPage, handlePrevPage, handleZoomIn, handleZoomOut]);\n\n  // Handle fullscreen change\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);\n  }, []);\n\n  return (\n    <div className={fullscreen ? \"fixed inset-0 bg-gray-900 z-50 flex flex-col\" : \"bg-gray-900 flex flex-col h-full\"}>\n      {/* Toolbar */}\n      <div className=\"bg-gray-800 text-white p-3 flex items-center justify-between shadow-lg\">\n        <div className=\"flex items-center gap-4\">\n          <h3 className=\"font-semibold text-lg truncate max-w-md\">{filename}</h3>\n          <span className=\"text-sm text-gray-400\">\n            {numPages > 0 && `${numPages} pages`}\n          </span>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* Page Navigation */}\n          <div className=\"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2\">\n            <button\n              onClick={handlePrevPage}\n              disabled={currentPage <= 1}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Previous page ()\"\n            >\n              <FiChevronLeft className=\"h-5 w-5\" />\n            </button>\n\n            <div className=\"flex items-center gap-2\">\n              <input\n                type=\"number\"\n                value={currentPage}\n                onChange={(e) => handlePageJump(parseInt(e.target.value))}\n                className=\"w-14 px-2 py-1 bg-gray-600 text-white text-center rounded border-none focus:ring-2 focus:ring-purple-500\"\n                min={1}\n                max={numPages}\n              />\n              <span className=\"text-gray-400\">/ {numPages}</span>\n            </div>\n\n            <button\n              onClick={handleNextPage}\n              disabled={currentPage >= numPages}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Next page ()\"\n            >\n              <FiChevronRight className=\"h-5 w-5\" />\n            </button>\n          </div>\n\n          {/* Zoom Controls */}\n          <div className=\"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2\">\n            <button\n              onClick={handleZoomOut}\n              disabled={zoomIndex <= 0}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Zoom out (-)\"\n            >\n              <FiZoomOut className=\"h-5 w-5\" />\n            </button>\n\n            <span className=\"text-sm font-medium w-12 text-center\">\n              {Math.round(zoomLevel * 100)}%\n            </span>\n\n            <button\n              onClick={handleZoomIn}\n              disabled={zoomIndex >= ZOOM_LEVELS.length - 1}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Zoom in (+)\"\n            >\n              <FiZoomIn className=\"h-5 w-5\" />\n            </button>\n          </div>\n\n          {/* Additional Controls */}\n          <button\n            onClick={handleRotate}\n            className=\"p-2 hover:bg-gray-700 rounded-lg\"\n            title=\"Rotate clockwise\"\n          >\n            <FiRotateCw className=\"h-5 w-5\" />\n          </button>\n\n          <button\n            onClick={() => setShowSearch(!showSearch)}\n            className={`p-2 hover:bg-gray-700 rounded-lg ${showSearch ? 'bg-gray-700' : ''}`}\n            title=\"Search (Ctrl+F)\"\n          >\n            <FiSearch className=\"h-5 w-5\" />\n          </button>\n\n          {patternId && (\n            <button\n              onClick={() => setShowBookmarks(!showBookmarks)}\n              className={`p-2 hover:bg-gray-700 rounded-lg ${showBookmarks ? 'bg-gray-700' : ''}`}\n              title=\"Bookmarks\"\n            >\n              <FiBookmark className=\"h-5 w-5\" />\n            </button>\n          )}\n\n          <button\n            onClick={() => setShowRowMarker(!showRowMarker)}\n            className={`p-2 hover:bg-gray-700 rounded-lg ${showRowMarker ? 'bg-gray-700' : ''}`}\n            title=\"Row marker\"\n          >\n            <FiMove className=\"h-5 w-5\" />\n          </button>\n\n          {patternId && (\n            <button\n              onClick={() => setShowHighlighter(!showHighlighter)}\n              className={`p-2 hover:bg-gray-700 rounded-lg ${showHighlighter ? 'bg-gray-700' : ''}`}\n              title=\"Highlighter\"\n            >\n              <FiEdit3 className=\"h-5 w-5\" />\n            </button>\n          )}\n\n          <button\n            onClick={toggleFullscreen}\n            className=\"p-2 hover:bg-gray-700 rounded-lg\"\n            title=\"Toggle fullscreen\"\n          >\n            <FiMaximize className=\"h-5 w-5\" />\n          </button>\n\n          {onClose && (\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-700 rounded-lg ml-2\"\n              title=\"Close viewer (Esc)\"\n            >\n              <FiX className=\"h-5 w-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Search Bar */}\n      {showSearch && (\n        <div className=\"bg-gray-800 border-t border-gray-700 px-4 py-3\">\n          <div className=\"flex items-center gap-3 max-w-md\">\n            <div className=\"flex-1 relative\">\n              <input\n                type=\"text\"\n                value={searchText}\n                onChange={(e) => setSearchText(e.target.value)}\n                placeholder=\"Search in document...\"\n                className=\"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border-none focus:ring-2 focus:ring-purple-500\"\n                autoFocus\n              />\n            </div>\n            <button\n              onClick={() => setShowSearch(false)}\n              className=\"p-2 hover:bg-gray-700 rounded-lg text-white\"\n            >\n              <FiX className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Bookmark Sidebar */}\n        {showBookmarks && patternId && (\n          <div className=\"w-80 flex-shrink-0 border-r border-gray-700 overflow-y-auto\">\n            <BookmarkManager\n              patternId={patternId}\n              projectId={projectId}\n              currentPage={currentPage}\n              currentZoom={zoomLevel}\n              onJumpToBookmark={handleJumpToBookmark}\n            />\n          </div>\n        )}\n\n        {/* PDF Viewer */}\n        <div className=\"flex-1 overflow-auto bg-gray-800 p-4\">\n          <div className=\"flex justify-center min-h-full\">\n            <Document\n              file={fileUrl}\n              onLoadSuccess={onDocumentLoadSuccess}\n              onLoadError={onDocumentLoadError}\n              loading={\n                <div className=\"flex items-center justify-center h-screen\">\n                  <div className=\"text-white text-lg\">Loading PDF...</div>\n                </div>\n              }\n              error={\n                <div className=\"flex items-center justify-center h-screen\">\n                  <div className=\"text-red-500 text-lg\">Failed to load PDF</div>\n                </div>\n              }\n            >\n              <Page\n                pageNumber={currentPage}\n                scale={zoomLevel}\n                rotate={rotation}\n                renderTextLayer={true}\n                renderAnnotationLayer={true}\n                className=\"shadow-2xl\"\n                loading={\n                  <div className=\"flex items-center justify-center min-h-screen\">\n                    <div className=\"text-white\">Loading page...</div>\n                  </div>\n                }\n              />\n            </Document>\n          </div>\n        </div>\n      </div>\n\n      {/* Page Indicator (Mobile) */}\n      <div className=\"md:hidden bg-gray-800 text-white text-center py-2 border-t border-gray-700\">\n        Page {currentPage} of {numPages}\n      </div>\n\n      {/* Row Marker Overlay */}\n      {showRowMarker && <RowMarker pageNumber={currentPage} />}\n\n      {/* Pattern Highlighter */}\n      {showHighlighter && patternId && (\n        <PatternHighlighter\n          patternId={patternId}\n          projectId={projectId}\n          pageNumber={currentPage}\n          isActive={showHighlighter}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  designer?: string;\n  category?: string;\n}\n\ninterface CollationResult {\n  id: string;\n  fileUrl: string;\n  pageCount: number;\n  fileSize: number;\n  patternCount: number;\n}\n\nexport const PDFCollation: React.FC = () => {\n  const [patterns, setPatterns] = useState<Pattern[]>([]);\n  const [selectedPatterns, setSelectedPatterns] = useState<string[]>([]);\n  const [addDividers, setAddDividers] = useState(false);\n  const [dividerText, setDividerText] = useState('Pattern');\n  const [loading, setLoading] = useState(false);\n  const [collationResult, setCollationResult] = useState<CollationResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchPatterns();\n  }, []);\n\n  const fetchPatterns = async () => {\n    try {\n      const response = await axios.get('/api/patterns');\n      if (response.data.success) {\n        setPatterns(response.data.data.patterns);\n      }\n    } catch (err) {\n      console.error('Failed to fetch patterns:', err);\n      setError('Failed to load patterns');\n    }\n  };\n\n  const handlePatternToggle = (patternId: string) => {\n    setSelectedPatterns((prev) =>\n      prev.includes(patternId)\n        ? prev.filter((id) => id !== patternId)\n        : [...prev, patternId]\n    );\n  };\n\n  const handleMoveUp = (index: number) => {\n    if (index === 0) return;\n    const newOrder = [...selectedPatterns];\n    [newOrder[index - 1], newOrder[index]] = [newOrder[index], newOrder[index - 1]];\n    setSelectedPatterns(newOrder);\n  };\n\n  const handleMoveDown = (index: number) => {\n    if (index === selectedPatterns.length - 1) return;\n    const newOrder = [...selectedPatterns];\n    [newOrder[index], newOrder[index + 1]] = [newOrder[index + 1], newOrder[index]];\n    setSelectedPatterns(newOrder);\n  };\n\n  const handleCollate = async () => {\n    if (selectedPatterns.length === 0) {\n      setError('Please select at least one pattern');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    setCollationResult(null);\n\n    try {\n      const response = await axios.post('/api/patterns/collate', {\n        patternIds: selectedPatterns,\n        addDividers,\n        dividerText,\n      });\n\n      if (response.data.success) {\n        setCollationResult(response.data.data.collation);\n      }\n    } catch (err: any) {\n      console.error('Failed to collate patterns:', err);\n      setError(err.response?.data?.message || 'Failed to merge PDFs');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getPatternName = (patternId: string) => {\n    const pattern = patterns.find((p) => p.id === patternId);\n    return pattern?.name || 'Unknown Pattern';\n  };\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';\n  };\n\n  return (\n    <div className=\"pdf-collation\">\n      <div className=\"collation-header\">\n        <h2>Merge Pattern PDFs</h2>\n        <p className=\"description\">\n          Select multiple patterns to merge into a single PDF file\n        </p>\n      </div>\n\n      {error && (\n        <div className=\"error-message\" role=\"alert\">\n          {error}\n        </div>\n      )}\n\n      <div className=\"collation-content\">\n        {/* Pattern Selection */}\n        <div className=\"pattern-selection\">\n          <h3>Available Patterns</h3>\n          <div className=\"pattern-list\">\n            {patterns.map((pattern) => (\n              <div\n                key={pattern.id}\n                className={`pattern-item ${selectedPatterns.includes(pattern.id) ? 'selected' : ''}`}\n                onClick={() => handlePatternToggle(pattern.id)}\n              >\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPatterns.includes(pattern.id)}\n                  onChange={() => handlePatternToggle(pattern.id)}\n                  onClick={(e) => e.stopPropagation()}\n                />\n                <div className=\"pattern-info\">\n                  <div className=\"pattern-name\">{pattern.name}</div>\n                  {pattern.designer && (\n                    <div className=\"pattern-designer\">by {pattern.designer}</div>\n                  )}\n                  {pattern.category && (\n                    <span className=\"pattern-category\">{pattern.category}</span>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Selected Patterns Order */}\n        {selectedPatterns.length > 0 && (\n          <div className=\"selected-patterns\">\n            <h3>Merge Order ({selectedPatterns.length} patterns)</h3>\n            <div className=\"pattern-order-list\">\n              {selectedPatterns.map((patternId, index) => (\n                <div key={patternId} className=\"pattern-order-item\">\n                  <span className=\"order-number\">{index + 1}.</span>\n                  <span className=\"pattern-name\">{getPatternName(patternId)}</span>\n                  <div className=\"order-controls\">\n                    <button\n                      onClick={() => handleMoveUp(index)}\n                      disabled={index === 0}\n                      className=\"btn-icon\"\n                      aria-label=\"Move up\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => handleMoveDown(index)}\n                      disabled={index === selectedPatterns.length - 1}\n                      className=\"btn-icon\"\n                      aria-label=\"Move down\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => handlePatternToggle(patternId)}\n                      className=\"btn-icon btn-remove\"\n                      aria-label=\"Remove\"\n                    >\n                      \n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Options */}\n        <div className=\"collation-options\">\n          <h3>Options</h3>\n          <div className=\"option\">\n            <label>\n              <input\n                type=\"checkbox\"\n                checked={addDividers}\n                onChange={(e) => setAddDividers(e.target.checked)}\n              />\n              Add divider pages between patterns\n            </label>\n          </div>\n          {addDividers && (\n            <div className=\"option\">\n              <label>\n                Divider text:\n                <input\n                  type=\"text\"\n                  value={dividerText}\n                  onChange={(e) => setDividerText(e.target.value)}\n                  placeholder=\"Pattern\"\n                  maxLength={255}\n                />\n              </label>\n            </div>\n          )}\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"collation-actions\">\n          <button\n            onClick={handleCollate}\n            disabled={loading || selectedPatterns.length === 0}\n            className=\"btn-primary\"\n          >\n            {loading ? 'Merging PDFs...' : 'Merge PDFs'}\n          </button>\n          {selectedPatterns.length > 0 && (\n            <button\n              onClick={() => setSelectedPatterns([])}\n              className=\"btn-secondary\"\n              disabled={loading}\n            >\n              Clear Selection\n            </button>\n          )}\n        </div>\n\n        {/* Result */}\n        {collationResult && (\n          <div className=\"collation-result\">\n            <h3> PDF Merged Successfully!</h3>\n            <div className=\"result-info\">\n              <p>\n                <strong>Patterns merged:</strong> {collationResult.patternCount}\n              </p>\n              <p>\n                <strong>Total pages:</strong> {collationResult.pageCount}\n              </p>\n              <p>\n                <strong>File size:</strong> {formatFileSize(collationResult.fileSize)}\n              </p>\n            </div>\n            <div className=\"result-actions\">\n              <a\n                href={collationResult.fileUrl}\n                download\n                className=\"btn-primary\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                Download Merged PDF\n              </a>\n              <button\n                onClick={() => {\n                  setCollationResult(null);\n                  setSelectedPatterns([]);\n                }}\n                className=\"btn-secondary\"\n              >\n                Merge More Patterns\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <style>{`\n        .pdf-collation {\n          max-width: 1200px;\n          margin: 0 auto;\n          padding: 20px;\n        }\n\n        .collation-header {\n          margin-bottom: 30px;\n        }\n\n        .collation-header h2 {\n          font-size: 24px;\n          font-weight: 600;\n          margin-bottom: 8px;\n        }\n\n        .description {\n          color: #6b7280;\n          font-size: 14px;\n        }\n\n        .error-message {\n          background-color: #fef2f2;\n          border: 1px solid #fecaca;\n          color: #991b1b;\n          padding: 12px 16px;\n          border-radius: 6px;\n          margin-bottom: 20px;\n        }\n\n        .collation-content {\n          display: grid;\n          gap: 30px;\n        }\n\n        .pattern-selection h3,\n        .selected-patterns h3,\n        .collation-options h3 {\n          font-size: 18px;\n          font-weight: 600;\n          margin-bottom: 16px;\n        }\n\n        .pattern-list {\n          display: grid;\n          gap: 12px;\n          max-height: 400px;\n          overflow-y: auto;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 16px;\n        }\n\n        .pattern-item {\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n          padding: 12px;\n          border: 2px solid #e5e7eb;\n          border-radius: 6px;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n\n        .pattern-item:hover {\n          border-color: #3b82f6;\n          background-color: #eff6ff;\n        }\n\n        .pattern-item.selected {\n          border-color: #3b82f6;\n          background-color: #dbeafe;\n        }\n\n        .pattern-item input[type='checkbox'] {\n          margin-top: 2px;\n          width: 18px;\n          height: 18px;\n          cursor: pointer;\n        }\n\n        .pattern-info {\n          flex: 1;\n        }\n\n        .pattern-name {\n          font-weight: 500;\n          margin-bottom: 4px;\n        }\n\n        .pattern-designer {\n          font-size: 14px;\n          color: #6b7280;\n          margin-bottom: 4px;\n        }\n\n        .pattern-category {\n          display: inline-block;\n          font-size: 12px;\n          padding: 2px 8px;\n          background-color: #f3f4f6;\n          border-radius: 4px;\n          color: #4b5563;\n        }\n\n        .pattern-order-list {\n          display: grid;\n          gap: 8px;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 16px;\n        }\n\n        .pattern-order-item {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 10px 12px;\n          background-color: #f9fafb;\n          border-radius: 6px;\n        }\n\n        .order-number {\n          font-weight: 600;\n          color: #6b7280;\n          min-width: 30px;\n        }\n\n        .pattern-order-item .pattern-name {\n          flex: 1;\n        }\n\n        .order-controls {\n          display: flex;\n          gap: 4px;\n        }\n\n        .btn-icon {\n          width: 32px;\n          height: 32px;\n          border: 1px solid #d1d5db;\n          background-color: white;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 16px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: all 0.2s;\n        }\n\n        .btn-icon:hover:not(:disabled) {\n          background-color: #f3f4f6;\n          border-color: #9ca3af;\n        }\n\n        .btn-icon:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .btn-icon.btn-remove {\n          color: #dc2626;\n          font-size: 24px;\n        }\n\n        .btn-icon.btn-remove:hover:not(:disabled) {\n          background-color: #fef2f2;\n          border-color: #fca5a5;\n        }\n\n        .collation-options {\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 20px;\n        }\n\n        .option {\n          margin-bottom: 16px;\n        }\n\n        .option:last-child {\n          margin-bottom: 0;\n        }\n\n        .option label {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          font-size: 14px;\n        }\n\n        .option input[type='checkbox'] {\n          width: 18px;\n          height: 18px;\n          cursor: pointer;\n        }\n\n        .option input[type='text'] {\n          margin-left: 8px;\n          padding: 6px 12px;\n          border: 1px solid #d1d5db;\n          border-radius: 4px;\n          font-size: 14px;\n        }\n\n        .collation-actions {\n          display: flex;\n          gap: 12px;\n        }\n\n        .btn-primary,\n        .btn-secondary {\n          padding: 12px 24px;\n          border-radius: 6px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s;\n          border: none;\n          font-size: 14px;\n        }\n\n        .btn-primary {\n          background-color: #3b82f6;\n          color: white;\n        }\n\n        .btn-primary:hover:not(:disabled) {\n          background-color: #2563eb;\n        }\n\n        .btn-primary:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n\n        .btn-secondary {\n          background-color: white;\n          color: #374151;\n          border: 1px solid #d1d5db;\n        }\n\n        .btn-secondary:hover:not(:disabled) {\n          background-color: #f9fafb;\n        }\n\n        .collation-result {\n          background-color: #f0fdf4;\n          border: 2px solid #86efac;\n          border-radius: 8px;\n          padding: 24px;\n        }\n\n        .collation-result h3 {\n          color: #166534;\n          font-size: 20px;\n          margin-bottom: 16px;\n        }\n\n        .result-info {\n          margin-bottom: 20px;\n        }\n\n        .result-info p {\n          margin-bottom: 8px;\n          font-size: 14px;\n          color: #166534;\n        }\n\n        .result-actions {\n          display: flex;\n          gap: 12px;\n        }\n\n        .result-actions a {\n          text-decoration: none;\n        }\n\n        @media (max-width: 768px) {\n          .pdf-collation {\n            padding: 16px;\n          }\n\n          .collation-header h2 {\n            font-size: 20px;\n          }\n\n          .collation-actions {\n            flex-direction: column;\n          }\n\n          .result-actions {\n            flex-direction: column;\n          }\n\n          .btn-primary,\n          .btn-secondary {\n            width: 100%;\n          }\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default PDFCollation;\n","import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { FiPlus, FiTrash2, FiBook, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { PDFCollation } from '../components/patterns';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  description: string;\n  designer: string;\n  difficulty: string;\n  category: string;\n  created_at: string;\n}\n\nexport default function Patterns() {\n  const navigate = useNavigate();\n  const [patterns, setPatterns] = useState<Pattern[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showCollationModal, setShowCollationModal] = useState(false);\n  const [editingPattern, setEditingPattern] = useState<Pattern | null>(null);\n  const [patternFiles, setPatternFiles] = useState<File[]>([]);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    designer: '',\n    difficulty: 'intermediate',\n    category: 'sweater',\n  });\n\n  useEffect(() => {\n    fetchPatterns();\n  }, []);\n\n  const fetchPatterns = async () => {\n    try {\n      const response = await axios.get('/api/patterns');\n      setPatterns(response.data.data.patterns);\n    } catch (error: any) {\n      console.error('Error fetching patterns:', error);\n      toast.error('Failed to load patterns');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreatePattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    setUploadingFiles(true);\n\n    try {\n      // Step 1: Create the pattern\n      const createResponse = await axios.post('/api/patterns', formData);\n      const newPattern = createResponse.data.data.pattern;\n      toast.success('Pattern created!');\n\n      // Step 2: Upload PDF files if any\n      if (patternFiles.length > 0) {\n        let uploadedCount = 0;\n        for (const file of patternFiles) {\n          try {\n            const fileFormData = new FormData();\n            fileFormData.append('file', file);\n\n            await axios.post(`/api/uploads/patterns/${newPattern.id}/files`, fileFormData, {\n              headers: {\n                'Content-Type': 'multipart/form-data',\n              },\n            });\n            uploadedCount++;\n          } catch (error) {\n            console.error(`Failed to upload ${file.name}:`, error);\n          }\n        }\n\n        if (uploadedCount === patternFiles.length) {\n          toast.success(`Pattern created with ${uploadedCount} PDF${uploadedCount > 1 ? 's' : ''}!`);\n        } else {\n          toast.warning(`Pattern created but only ${uploadedCount}/${patternFiles.length} files uploaded`);\n        }\n      }\n\n      // Reset and close\n      setShowCreateModal(false);\n      setFormData({\n        name: '',\n        description: '',\n        designer: '',\n        difficulty: 'intermediate',\n        category: 'sweater',\n      });\n      setPatternFiles([]);\n      fetchPatterns();\n    } catch (error: any) {\n      console.error('Error creating pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to create pattern');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n\n  const handleEditClick = (pattern: Pattern) => {\n    setEditingPattern(pattern);\n    setFormData({\n      name: pattern.name || '',\n      description: pattern.description || '',\n      designer: pattern.designer || '',\n      difficulty: pattern.difficulty || 'intermediate',\n      category: pattern.category || 'sweater',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdatePattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingPattern) return;\n\n    try {\n      await axios.put(`/api/patterns/${editingPattern.id}`, formData);\n      toast.success('Pattern updated successfully!');\n      setShowEditModal(false);\n      setEditingPattern(null);\n      setFormData({\n        name: '',\n        description: '',\n        designer: '',\n        difficulty: 'intermediate',\n        category: 'sweater',\n      });\n      fetchPatterns();\n    } catch (error: any) {\n      console.error('Error updating pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to update pattern');\n    }\n  };\n\n  const handleDeletePattern = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/patterns/${id}`);\n      toast.success('Pattern deleted successfully');\n      fetchPatterns();\n    } catch (error: any) {\n      console.error('Error deleting pattern:', error);\n      toast.error('Failed to delete pattern');\n    }\n  };\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'beginner':\n        return 'bg-green-100 text-green-800';\n      case 'intermediate':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'advanced':\n        return 'bg-orange-100 text-orange-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading patterns...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Patterns</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your knitting pattern library</p>\n        </div>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={() => setShowCollationModal(true)}\n            className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n            disabled={patterns.length === 0}\n          >\n            <FiBook className=\"mr-2\" />\n            Merge PDFs\n          </button>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            New Pattern\n          </button>\n        </div>\n      </div>\n\n      {patterns.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiBook className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No patterns yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start building your pattern library</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Pattern\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {patterns.map((pattern) => (\n            <div\n              key={pattern.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition\"\n            >\n              {/* Clickable card area */}\n              <div\n                onClick={() => navigate(`/patterns/${pattern.id}`)}\n                className=\"cursor-pointer p-6 pb-4\"\n              >\n                <div className=\"flex items-start justify-between mb-3\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 flex-1 hover:text-purple-600 transition\">\n                    {pattern.name}\n                  </h3>\n                  {pattern.difficulty && (\n                    <span\n                      className={`px-2 py-1 text-xs font-medium rounded-full ${getDifficultyColor(\n                        pattern.difficulty\n                      )}`}\n                    >\n                      {pattern.difficulty}\n                    </span>\n                  )}\n                </div>\n\n                {pattern.designer && (\n                  <p className=\"text-sm text-gray-600 mb-2\">by {pattern.designer}</p>\n                )}\n\n                {pattern.description && (\n                  <p className=\"text-gray-600 text-sm mb-4 line-clamp-2\">\n                    {pattern.description}\n                  </p>\n                )}\n\n                {pattern.category && (\n                  <div className=\"text-sm text-gray-500 mb-2\">\n                    Category: {pattern.category}\n                  </div>\n                )}\n              </div>\n\n              {/* Action buttons */}\n              <div className=\"px-6 pb-6\">\n                <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleEditClick(pattern);\n                    }}\n                    className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                  >\n                    <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                    Edit\n                  </button>\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleDeletePattern(pattern.id, pattern.name);\n                    }}\n                    className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                  >\n                    <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                    Delete\n                  </button>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Pattern Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add New Pattern</h2>\n            </div>\n\n            <form onSubmit={handleCreatePattern} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Classic Raglan Sweater\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Designer\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.designer}\n                  onChange={(e) => setFormData({ ...formData, designer: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"Pattern designer name\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Difficulty\n                  </label>\n                  <select\n                    value={formData.difficulty}\n                    onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"beginner\">Beginner</option>\n                    <option value=\"intermediate\">Intermediate</option>\n                    <option value=\"advanced\">Advanced</option>\n                    <option value=\"expert\">Expert</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Category\n                  </label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"sweater\">Sweater</option>\n                    <option value=\"scarf\">Scarf</option>\n                    <option value=\"hat\">Hat</option>\n                    <option value=\"blanket\">Blanket</option>\n                    <option value=\"socks\">Socks</option>\n                    <option value=\"shawl\">Shawl</option>\n                    <option value=\"toy\">Toy/Amigurumi</option>\n                    <option value=\"other\">Other</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Pattern details, notes, etc.\"\n                />\n              </div>\n\n              {/* PDF Upload */}\n              <div className=\"border-t border-gray-200 pt-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern PDF Files (Optional)\n                </label>\n                <p className=\"text-sm text-gray-500 mb-2\">\n                  Upload one or more PDF files for this pattern\n                </p>\n                <input\n                  type=\"file\"\n                  accept=\".pdf,application/pdf\"\n                  multiple\n                  onChange={(e) => {\n                    if (e.target.files) {\n                      setPatternFiles(Array.from(e.target.files));\n                    }\n                  }}\n                  disabled={uploadingFiles}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed\"\n                />\n                {patternFiles.length > 0 && (\n                  <div className=\"mt-3 space-y-1\">\n                    <p className=\"text-sm font-medium text-gray-700\">\n                      Selected files ({patternFiles.length}):\n                    </p>\n                    {patternFiles.map((file, index) => (\n                      <div key={index} className=\"text-sm text-gray-600 flex items-center justify-between bg-gray-50 px-3 py-2 rounded\">\n                        <span>{file.name}</span>\n                        <span className=\"text-gray-500\">({(file.size / 1024 / 1024).toFixed(2)} MB)</span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateModal(false);\n                    setPatternFiles([]);\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                  disabled={uploadingFiles}\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed\"\n                  disabled={uploadingFiles}\n                >\n                  {uploadingFiles ? 'Creating & Uploading...' : 'Add Pattern'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Pattern Modal */}\n      {showEditModal && editingPattern && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Pattern</h2>\n            </div>\n\n            <form onSubmit={handleUpdatePattern} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Classic Raglan Sweater\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Designer\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.designer}\n                  onChange={(e) => setFormData({ ...formData, designer: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"Pattern designer name\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Difficulty\n                  </label>\n                  <select\n                    value={formData.difficulty}\n                    onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"beginner\">Beginner</option>\n                    <option value=\"intermediate\">Intermediate</option>\n                    <option value=\"advanced\">Advanced</option>\n                    <option value=\"expert\">Expert</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Category\n                  </label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"sweater\">Sweater</option>\n                    <option value=\"scarf\">Scarf</option>\n                    <option value=\"hat\">Hat</option>\n                    <option value=\"blanket\">Blanket</option>\n                    <option value=\"socks\">Socks</option>\n                    <option value=\"shawl\">Shawl</option>\n                    <option value=\"toy\">Toy/Amigurumi</option>\n                    <option value=\"other\">Other</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Pattern details, notes, etc.\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingPattern(null);\n                    setFormData({\n                      name: '',\n                      description: '',\n                      designer: '',\n                      difficulty: 'intermediate',\n                      category: 'sweater',\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Pattern\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* PDF Collation Modal */}\n      {showCollationModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Merge Pattern PDFs</h2>\n              <button\n                onClick={() => setShowCollationModal(false)}\n                className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n              >\n                \n              </button>\n            </div>\n            <div className=\"p-6\">\n              <PDFCollation />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useRef } from 'react';\nimport { FiUpload, FiX, FiFile, FiImage, FiFileText, FiDownload, FiTrash2, FiEye } from 'react-icons/fi';\nimport PatternViewer from './patterns/PatternViewer';\n\ninterface PatternFile {\n  id: string;\n  filename: string;\n  original_filename: string;\n  file_path: string;\n  mime_type: string;\n  size: number;\n  file_type: 'pdf' | 'image' | 'document' | 'other';\n  description?: string;\n  created_at: string;\n}\n\ninterface PatternFileUploadProps {\n  files: PatternFile[];\n  onUpload: (file: File, description?: string) => Promise<void>;\n  onDelete: (fileId: string) => Promise<void>;\n  onDownload: (fileId: string, filename: string) => Promise<void>;\n  patternId?: string;\n}\n\nexport default function PatternFileUpload({\n  files,\n  onUpload,\n  onDelete,\n  onDownload,\n  patternId,\n}: PatternFileUploadProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [description, setDescription] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const [viewingFile, setViewingFile] = useState<PatternFile | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const acceptedTypes = [\n    'application/pdf',\n    'application/x-pdf',\n    'application/acrobat',\n    'applications/vnd.pdf',\n    'text/pdf',\n    'text/x-pdf',\n    '.pdf',\n    'image/jpeg',\n    'image/jpg',\n    'image/png',\n    'image/webp',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'text/plain',\n  ].join(',');\n\n  const handleFileSelect = (file: File) => {\n    // Validate file extension as primary check\n    const fileName = file.name.toLowerCase();\n    const validExtensions = ['.pdf', '.jpg', '.jpeg', '.png', '.webp', '.doc', '.docx', '.txt'];\n    const hasValidExtension = validExtensions.some(ext => fileName.endsWith(ext));\n\n    // Validate file type (MIME type)\n    const validTypes = acceptedTypes.split(',').map(t => t.trim());\n    const hasValidMimeType = validTypes.includes(file.type);\n\n    // Accept file if either extension or MIME type is valid (handles browser inconsistencies)\n    if (!hasValidExtension && !hasValidMimeType) {\n      alert(`Invalid file type: ${file.type || 'unknown'}\\n\\nAccepted file types:\\n- PDF documents (.pdf)\\n- Images (.jpg, .png, .webp)\\n- Word documents (.doc, .docx)\\n- Text files (.txt)\\n\\nPlease make sure your file has the correct extension.`);\n      return;\n    }\n\n    // Validate file size (25MB max)\n    const fileSizeMB = file.size / (1024 * 1024);\n    if (fileSizeMB > 25) {\n      alert(`File size (${fileSizeMB.toFixed(1)}MB) exceeds the 25MB limit.\\n\\nPlease choose a smaller file or compress your PDF.`);\n      return;\n    }\n\n    setSelectedFile(file);\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true);\n    } else if (e.type === 'dragleave') {\n      setDragActive(false);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    try {\n      await onUpload(selectedFile, description);\n      // Reset after successful upload\n      setSelectedFile(null);\n      setDescription('');\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } catch (error) {\n      console.error('Upload error:', error);\n      alert('Failed to upload file. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setSelectedFile(null);\n    setDescription('');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const getFileIcon = (fileType: string) => {\n    switch (fileType) {\n      case 'pdf':\n        return <FiFile className=\"w-6 h-6 text-red-500\" />;\n      case 'image':\n        return <FiImage className=\"w-6 h-6 text-blue-500\" />;\n      case 'document':\n        return <FiFileText className=\"w-6 h-6 text-blue-600\" />;\n      default:\n        return <FiFile className=\"w-6 h-6 text-gray-500\" />;\n    }\n  };\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Upload Section */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm\">\n        <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n          Upload Pattern Files\n        </h3>\n\n        {/* Drag and drop area */}\n        <div\n          className={`\n            border-2 border-dashed rounded-lg p-8 text-center transition-colors\n            ${dragActive\n              ? 'border-pink-500 bg-pink-50 dark:bg-pink-900/10'\n              : 'border-gray-300 dark:border-gray-600 hover:border-pink-400 dark:hover:border-pink-500'\n            }\n          `}\n          onDragEnter={handleDrag}\n          onDragLeave={handleDrag}\n          onDragOver={handleDrag}\n          onDrop={handleDrop}\n        >\n          <FiUpload className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n          <p className=\"mb-2 text-sm text-gray-600 dark:text-gray-400\">\n            <span className=\"font-semibold\">Click to upload</span> or drag and drop\n          </p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n            PDF, Images, Word documents, or text files (MAX. 25MB)\n          </p>\n\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            className=\"hidden\"\n            accept={acceptedTypes}\n            onChange={handleInputChange}\n          />\n\n          <button\n            type=\"button\"\n            onClick={() => fileInputRef.current?.click()}\n            className=\"mt-4 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors\"\n          >\n            Select File\n          </button>\n        </div>\n\n        {/* Selected file preview */}\n        {selectedFile && (\n          <div className=\"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                <FiFile className=\"w-6 h-6 text-gray-500\" />\n                <div>\n                  <p className=\"font-medium text-gray-900 dark:text-white\">\n                    {selectedFile.name}\n                  </p>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    {formatFileSize(selectedFile.size)}\n                  </p>\n                </div>\n              </div>\n              <button\n                onClick={handleCancel}\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              >\n                <FiX className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            {/* Description input */}\n            <div className=\"mb-3\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Description (optional)\n              </label>\n              <input\n                type=\"text\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"E.g., Main pattern, Size chart, Assembly instructions...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\n              />\n            </div>\n\n            <button\n              onClick={handleUpload}\n              disabled={uploading}\n              className=\"w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {uploading ? 'Uploading...' : 'Upload File'}\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Files List */}\n      {files.length > 0 && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm\">\n          <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n            Pattern Files ({files.length})\n          </h3>\n\n          <div className=\"space-y-3\">\n            {files.map((file) => (\n              <div\n                key={file.id}\n                className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-650 transition-colors\"\n              >\n                <div className=\"flex items-center space-x-3 flex-1\">\n                  {getFileIcon(file.file_type)}\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-gray-900 dark:text-white truncate\">\n                      {file.original_filename}\n                    </p>\n                    {file.description && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                        {file.description}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n                      {formatFileSize(file.size)}  {new Date(file.created_at).toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center space-x-2 ml-4\">\n                  {file.file_type === 'pdf' && patternId && (\n                    <button\n                      onClick={() => setViewingFile(file)}\n                      className=\"p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors\"\n                      title=\"View PDF\"\n                    >\n                      <FiEye className=\"w-5 h-5\" />\n                    </button>\n                  )}\n                  <button\n                    onClick={() => onDownload(file.id, file.original_filename)}\n                    className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\n                    title=\"Download\"\n                  >\n                    <FiDownload className=\"w-5 h-5\" />\n                  </button>\n                  <button\n                    onClick={() => {\n                      if (window.confirm('Are you sure you want to delete this file?')) {\n                        onDelete(file.id);\n                      }\n                    }}\n                    className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\n                    title=\"Delete\"\n                  >\n                    <FiTrash2 className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* PDF Viewer Modal */}\n      {viewingFile && viewingFile.file_type === 'pdf' && patternId && (\n        <PatternViewer\n          fileUrl={`/api/uploads/patterns/${patternId}/files/${viewingFile.id}/download`}\n          filename={viewingFile.original_filename}\n          patternId={patternId}\n          onClose={() => setViewingFile(null)}\n        />\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { FiArrowLeft, FiEdit2, FiTrash2, FiFileText, FiGrid, FiTool } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport PatternFileUpload from '../components/PatternFileUpload';\nimport BookmarkManager from '../components/patterns/BookmarkManager';\nimport PatternViewer from '../components/patterns/PatternViewer';\nimport LoadingSpinner from '../components/LoadingSpinner';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  description: string;\n  designer: string;\n  difficulty: string;\n  category: string;\n  yarn_requirements?: string;\n  needle_size?: string;\n  gauge?: string;\n  sizes_available?: string;\n  notes?: string;\n  tags?: string[];\n  is_favorite?: boolean;\n  times_used?: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface PatternFile {\n  id: string;\n  filename: string;\n  original_filename: string;\n  file_path: string;\n  mime_type: string;\n  size: number;\n  file_type: 'pdf' | 'image' | 'document' | 'other';\n  description?: string;\n  created_at: string;\n}\n\nexport default function PatternDetail() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [pattern, setPattern] = useState<Pattern | null>(null);\n  const [files, setFiles] = useState<PatternFile[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [activeTab, setActiveTab] = useState<'overview' | 'viewer' | 'charts' | 'tools'>('overview');\n  const [selectedPdfFile, setSelectedPdfFile] = useState<PatternFile | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    designer: '',\n    difficulty: 'intermediate',\n    category: 'sweater',\n    yarnRequirements: '',\n    needleSize: '',\n    gauge: '',\n    sizesAvailable: '',\n    notes: '',\n  });\n\n  useEffect(() => {\n    if (id) {\n      fetchPattern();\n      fetchPatternFiles();\n    }\n  }, [id]);\n\n  useEffect(() => {\n    // Auto-select first PDF file for viewer\n    if (files.length > 0 && !selectedPdfFile) {\n      const pdfFile = files.find(f => f.file_type === 'pdf');\n      if (pdfFile) {\n        setSelectedPdfFile(pdfFile);\n      }\n    }\n  }, [files, selectedPdfFile]);\n\n  const fetchPattern = async () => {\n    try {\n      const response = await axios.get(`/api/patterns/${id}`);\n      setPattern(response.data.data.pattern);\n    } catch (error) {\n      toast.error('Failed to load pattern');\n      navigate('/patterns');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchPatternFiles = async () => {\n    try {\n      const response = await axios.get(`/api/uploads/patterns/${id}/files`);\n      setFiles(response.data.data.files || []);\n    } catch {\n    }\n  };\n\n  const handleEditClick = () => {\n    if (!pattern) return;\n    setFormData({\n      name: pattern.name || '',\n      description: pattern.description || '',\n      designer: pattern.designer || '',\n      difficulty: pattern.difficulty || 'intermediate',\n      category: pattern.category || 'sweater',\n      yarnRequirements: pattern.yarn_requirements || '',\n      needleSize: pattern.needle_size || '',\n      gauge: pattern.gauge || '',\n      sizesAvailable: pattern.sizes_available || '',\n      notes: pattern.notes || '',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdatePattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!pattern) return;\n\n    try {\n      await axios.put(`/api/patterns/${pattern.id}`, formData);\n      toast.success('Pattern updated successfully!');\n      setShowEditModal(false);\n      fetchPattern();\n    } catch (error: unknown) {\n      const axiosError = error as { response?: { data?: { message?: string } } };\n      toast.error(axiosError.response?.data?.message || 'Failed to update pattern');\n    }\n  };\n\n  const handleDeletePattern = async () => {\n    if (!pattern) return;\n    if (!confirm(`Are you sure you want to delete \"${pattern.name}\"? This will also delete all associated files.`)) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/patterns/${pattern.id}`);\n      toast.success('Pattern deleted successfully');\n      navigate('/patterns');\n    } catch {\n      toast.error('Failed to delete pattern');\n    }\n  };\n\n  const handleFileUpload = async (file: File, description?: string) => {\n    const formDataObj = new FormData();\n    formDataObj.append('file', file);\n    if (description) {\n      formDataObj.append('description', description);\n    }\n\n    try {\n      await axios.post(`/api/uploads/patterns/${id}/files`, formDataObj, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('File uploaded successfully!');\n      fetchPatternFiles();\n    } catch (error: unknown) {\n      const axiosError = error as { response?: { data?: { message?: string } } };\n      toast.error(axiosError.response?.data?.message || 'Failed to upload file');\n      throw error;\n    }\n  };\n\n  const handleFileDownload = async (fileId: string, filename: string) => {\n    try {\n      const response = await axios.get(`/api/uploads/patterns/${id}/files/${fileId}/download`, {\n        responseType: 'blob',\n      });\n\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', filename);\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      window.URL.revokeObjectURL(url);\n    } catch {\n      toast.error('Failed to download file');\n    }\n  };\n\n  const handleFileDelete = async (fileId: string) => {\n    try {\n      await axios.delete(`/api/uploads/patterns/${id}/files/${fileId}`);\n      toast.success('File deleted successfully');\n      fetchPatternFiles();\n    } catch {\n      toast.error('Failed to delete file');\n    }\n  };\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'beginner':\n        return 'bg-green-100 text-green-800';\n      case 'intermediate':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'advanced':\n        return 'bg-orange-100 text-orange-800';\n      case 'expert':\n        return 'bg-red-100 text-red-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <LoadingSpinner size=\"lg\" text=\"Loading pattern...\" />\n      </div>\n    );\n  }\n\n  if (!pattern) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Pattern not found</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"mb-4 md:mb-6\">\n        <button\n          onClick={() => navigate('/patterns')}\n          className=\"flex items-center text-purple-600 hover:text-purple-700 mb-3 md:mb-4 min-h-[48px]\"\n        >\n          <FiArrowLeft className=\"mr-2 h-5 w-5\" />\n          <span className=\"text-base md:text-sm\">Back to Patterns</span>\n        </button>\n\n        <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\n          <div className=\"flex-1\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2\">\n              <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">{pattern.name}</h1>\n              {pattern.difficulty && (\n                <span className={`px-3 py-1 text-sm font-medium rounded-full self-start ${getDifficultyColor(pattern.difficulty)}`}>\n                  {pattern.difficulty}\n                </span>\n              )}\n            </div>\n            {pattern.designer && (\n              <p className=\"text-base md:text-sm text-gray-600\">by {pattern.designer}</p>\n            )}\n          </div>\n\n          <div className=\"flex gap-2 flex-wrap\">\n            <button\n              onClick={handleEditClick}\n              className=\"flex items-center justify-center px-4 py-3 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition min-h-[48px] md:min-h-0 flex-1 sm:flex-none\"\n            >\n              <FiEdit2 className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Edit</span>\n            </button>\n            <button\n              onClick={handleDeletePattern}\n              className=\"flex items-center justify-center px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition min-h-[48px] md:min-h-0 flex-1 sm:flex-none\"\n            >\n              <FiTrash2 className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Delete</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Tabs - Scrollable on mobile */}\n      <div className=\"bg-white rounded-lg shadow mb-4 md:mb-6\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"flex -mb-px overflow-x-auto scrollbar-hide\">\n            <button\n              onClick={() => setActiveTab('overview')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'overview'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiFileText className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">Overview</span>\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('viewer')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'viewer'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              } ${!selectedPdfFile ? 'opacity-50 cursor-not-allowed' : ''}`}\n              disabled={!selectedPdfFile}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiFileText className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">PDF Viewer</span>\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('charts')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'charts'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiGrid className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">Charts</span>\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('tools')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'tools'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiTool className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">Tools</span>\n              </div>\n            </button>\n          </nav>\n        </div>\n      </div>\n\n      {/* Tab Content */}\n      {activeTab === 'overview' && (\n        <>\n          {/* Pattern Details */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n        {/* Main Info */}\n        <div className=\"lg:col-span-2 bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Pattern Information</h2>\n\n          {pattern.description && (\n            <div className=\"mb-4\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Description</h3>\n              <p className=\"text-gray-600\">{pattern.description}</p>\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {pattern.category && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Category</h3>\n                <p className=\"text-gray-900\">{pattern.category}</p>\n              </div>\n            )}\n\n            {pattern.needle_size && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Needle Size</h3>\n                <p className=\"text-gray-900\">{pattern.needle_size}</p>\n              </div>\n            )}\n\n            {pattern.gauge && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Gauge</h3>\n                <p className=\"text-gray-900\">{pattern.gauge}</p>\n              </div>\n            )}\n\n            {pattern.sizes_available && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Sizes Available</h3>\n                <p className=\"text-gray-900\">{pattern.sizes_available}</p>\n              </div>\n            )}\n          </div>\n\n          {pattern.yarn_requirements && (\n            <div className=\"mt-4\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Yarn Requirements</h3>\n              <p className=\"text-gray-600\">{pattern.yarn_requirements}</p>\n            </div>\n          )}\n\n          {pattern.notes && (\n            <div className=\"mt-4\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Notes</h3>\n              <p className=\"text-gray-600 whitespace-pre-wrap\">{pattern.notes}</p>\n            </div>\n          )}\n        </div>\n\n        {/* Stats */}\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Statistics</h2>\n\n          <div className=\"space-y-3\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-700\">Times Used</h3>\n              <p className=\"text-2xl font-bold text-purple-600\">{pattern.times_used || 0}</p>\n            </div>\n\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-700\">Files Attached</h3>\n              <p className=\"text-2xl font-bold text-purple-600\">{files.length}</p>\n            </div>\n\n            <div className=\"pt-3 border-t border-gray-200\">\n              <h3 className=\"text-sm font-medium text-gray-700\">Created</h3>\n              <p className=\"text-gray-600\">{new Date(pattern.created_at).toLocaleDateString()}</p>\n            </div>\n\n            {pattern.updated_at && pattern.updated_at !== pattern.created_at && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Last Updated</h3>\n                <p className=\"text-gray-600\">{new Date(pattern.updated_at).toLocaleDateString()}</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Pattern Files */}\n      <PatternFileUpload\n        files={files}\n        onUpload={handleFileUpload}\n        onDelete={handleFileDelete}\n        onDownload={handleFileDownload}\n        patternId={id}\n      />\n\n          {/* Bookmarks */}\n          <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n            <BookmarkManager\n              patternId={id!}\n              onJumpToBookmark={(bookmark) => {\n                toast.info(`Jumping to page ${bookmark.page_number}`);\n                setActiveTab('viewer');\n              }}\n            />\n          </div>\n        </>\n      )}\n\n      {/* PDF Viewer Tab */}\n      {activeTab === 'viewer' && selectedPdfFile && (\n        <div className=\"bg-white rounded-lg shadow overflow-hidden\" style={{ height: '800px' }}>\n          <PatternViewer\n            fileUrl={`/api/uploads/patterns/${id}/files/${selectedPdfFile.id}/download`}\n            filename={selectedPdfFile.original_filename}\n            patternId={id}\n            fullscreen={false}\n          />\n        </div>\n      )}\n\n      {/* Charts Tab */}\n      {activeTab === 'charts' && (\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"text-center py-12\">\n            <FiGrid className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Chart Viewer</h3>\n            <p className=\"text-gray-500 mb-4\">\n              Interactive knitting chart viewer with zoom and rotation\n            </p>\n            <p className=\"text-sm text-gray-400\">\n              Charts will be displayed here when chart data is available.\n              <br />\n              Future enhancement: Add chart upload/creation functionality.\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Tools Tab */}\n      {activeTab === 'tools' && (\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Pattern Tools</h2>\n          <div className=\"space-y-4\">\n            <div className=\"border border-gray-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-gray-900 mb-2\">Pattern Sections</h3>\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Organize your pattern into sections for easier navigation\n              </p>\n              <button className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700\">\n                Manage Sections\n              </button>\n            </div>\n            <div className=\"border border-gray-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-gray-900 mb-2\">Pattern Annotations</h3>\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Add notes and annotations directly to your pattern\n              </p>\n              <button className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700\">\n                Add Annotations\n              </button>\n            </div>\n            <div className=\"border border-gray-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-gray-900 mb-2\">Pattern Collation</h3>\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Combine multiple PDFs into a single pattern document\n              </p>\n              <button className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700\">\n                Collate PDFs\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Pattern</h2>\n            </div>\n\n            <form onSubmit={handleUpdatePattern} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Pattern Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Designer</label>\n                  <input\n                    type=\"text\"\n                    value={formData.designer}\n                    onChange={(e) => setFormData({ ...formData, designer: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Difficulty</label>\n                  <select\n                    value={formData.difficulty}\n                    onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"beginner\">Beginner</option>\n                    <option value=\"intermediate\">Intermediate</option>\n                    <option value=\"advanced\">Advanced</option>\n                    <option value=\"expert\">Expert</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Category</label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"sweater\">Sweater</option>\n                    <option value=\"scarf\">Scarf</option>\n                    <option value=\"hat\">Hat</option>\n                    <option value=\"blanket\">Blanket</option>\n                    <option value=\"socks\">Socks</option>\n                    <option value=\"shawl\">Shawl</option>\n                    <option value=\"toy\">Toy/Amigurumi</option>\n                    <option value=\"other\">Other</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Needle Size</label>\n                  <input\n                    type=\"text\"\n                    value={formData.needleSize}\n                    onChange={(e) => setFormData({ ...formData, needleSize: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., US 7, 4.5mm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Gauge</label>\n                  <input\n                    type=\"text\"\n                    value={formData.gauge}\n                    onChange={(e) => setFormData({ ...formData, gauge: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., 20 sts x 28 rows = 4 inches\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Sizes Available</label>\n                  <input\n                    type=\"text\"\n                    value={formData.sizesAvailable}\n                    onChange={(e) => setFormData({ ...formData, sizesAvailable: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., XS, S, M, L, XL\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n                  <textarea\n                    value={formData.description}\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    rows={3}\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Yarn Requirements</label>\n                  <textarea\n                    value={formData.yarnRequirements}\n                    onChange={(e) => setFormData({ ...formData, yarnRequirements: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    rows={2}\n                    placeholder=\"e.g., 800 yards worsted weight yarn\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                  <textarea\n                    value={formData.notes}\n                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    rows={3}\n                    placeholder=\"Additional notes, modifications, tips, etc.\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowEditModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Pattern\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiTrash2, FiPackage, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Yarn {\n  id: string;\n  brand: string;\n  name: string;\n  color: string;\n  weight: string;\n  yards_remaining: number;\n  skeins_remaining: number;\n  fiber_content: string;\n  yards_total?: number;\n  skeins_total?: number;\n  low_stock_threshold?: number;\n  low_stock_alert?: boolean;\n  photos?: YarnPhoto[];\n}\n\ninterface YarnPhoto {\n  id: string;\n  yarn_id: string;\n  file_path: string;\n  thumbnail_path: string;\n  original_filename: string;\n}\n\nexport default function YarnStash() {\n  const [yarn, setYarn] = useState<Yarn[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingYarn, setEditingYarn] = useState<Yarn | null>(null);\n  const [yarnPhotos, setYarnPhotos] = useState<YarnPhoto[]>([]);\n  const [uploadingPhoto, setUploadingPhoto] = useState(false);\n  const [formData, setFormData] = useState({\n    brand: '',\n    name: '',\n    color: '',\n    weight: 'worsted',\n    fiberContent: '',\n    yardsTotal: '',\n    skeinsTotal: '1',\n    lowStockThreshold: '',\n    lowStockAlert: false,\n  });\n\n  useEffect(() => {\n    fetchYarn();\n  }, []);\n\n  const fetchYarn = async () => {\n    try {\n      const response = await axios.get('/api/yarn');\n      setYarn(response.data.data.yarn);\n    } catch (error: any) {\n      console.error('Error fetching yarn:', error);\n      toast.error('Failed to load yarn');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateYarn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await axios.post('/api/yarn', formData);\n      toast.success('Yarn added successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        brand: '',\n        name: '',\n        color: '',\n        weight: 'worsted',\n        fiberContent: '',\n        yardsTotal: '',\n        skeinsTotal: '1',\n        lowStockThreshold: '',\n        lowStockAlert: false,\n      });\n      fetchYarn();\n    } catch (error: any) {\n      console.error('Error creating yarn:', error);\n      toast.error(error.response?.data?.message || 'Failed to add yarn');\n    }\n  };\n\n  const handleEditClick = async (y: Yarn) => {\n    setEditingYarn(y);\n    setFormData({\n      brand: y.brand || '',\n      name: y.name || '',\n      color: y.color || '',\n      weight: y.weight || 'worsted',\n      fiberContent: y.fiber_content || '',\n      yardsTotal: y.yards_total?.toString() || '',\n      skeinsTotal: y.skeins_total?.toString() || '1',\n      lowStockThreshold: y.low_stock_threshold?.toString() || '',\n      lowStockAlert: y.low_stock_alert || false,\n    });\n\n    // Fetch photos for this yarn\n    try {\n      const response = await axios.get(`/api/uploads/yarn/${y.id}/photos`);\n      setYarnPhotos(response.data.data.photos || []);\n    } catch (error) {\n      console.error('Error fetching yarn photos:', error);\n      setYarnPhotos([]);\n    }\n\n    setShowEditModal(true);\n  };\n\n  const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!editingYarn || !e.target.files || e.target.files.length === 0) return;\n\n    const file = e.target.files[0];\n    setUploadingPhoto(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('photo', file);\n\n      const response = await axios.post(`/api/uploads/yarn/${editingYarn.id}/photos`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n\n      toast.success('Photo uploaded successfully!');\n      setYarnPhotos([...yarnPhotos, response.data.data.photo]);\n\n      // Reset file input\n      e.target.value = '';\n    } catch (error: any) {\n      console.error('Error uploading photo:', error);\n      toast.error(error.response?.data?.message || 'Failed to upload photo');\n    } finally {\n      setUploadingPhoto(false);\n    }\n  };\n\n  const handlePhotoDelete = async (photoId: string) => {\n    if (!editingYarn) return;\n    if (!confirm('Are you sure you want to delete this photo?')) return;\n\n    try {\n      await axios.delete(`/api/uploads/yarn/${editingYarn.id}/photos/${photoId}`);\n      toast.success('Photo deleted successfully');\n      setYarnPhotos(yarnPhotos.filter(p => p.id !== photoId));\n    } catch (error: any) {\n      console.error('Error deleting photo:', error);\n      toast.error('Failed to delete photo');\n    }\n  };\n\n  const handleUpdateYarn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingYarn) return;\n\n    try {\n      await axios.put(`/api/yarn/${editingYarn.id}`, formData);\n      toast.success('Yarn updated successfully!');\n      setShowEditModal(false);\n      setEditingYarn(null);\n      setFormData({\n        brand: '',\n        name: '',\n        color: '',\n        weight: 'worsted',\n        fiberContent: '',\n        yardsTotal: '',\n        skeinsTotal: '1',\n        lowStockThreshold: '',\n        lowStockAlert: false,\n      });\n      fetchYarn();\n    } catch (error: any) {\n      console.error('Error updating yarn:', error);\n      toast.error(error.response?.data?.message || 'Failed to update yarn');\n    }\n  };\n\n  const handleDeleteYarn = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/yarn/${id}`);\n      toast.success('Yarn deleted successfully');\n      fetchYarn();\n    } catch (error: any) {\n      console.error('Error deleting yarn:', error);\n      toast.error('Failed to delete yarn');\n    }\n  };\n\n  const getWeightColor = (weight: string) => {\n    const colors: { [key: string]: string } = {\n      lace: 'bg-purple-100 text-purple-800',\n      fingering: 'bg-blue-100 text-blue-800',\n      sport: 'bg-green-100 text-green-800',\n      dk: 'bg-yellow-100 text-yellow-800',\n      worsted: 'bg-orange-100 text-orange-800',\n      bulky: 'bg-red-100 text-red-800',\n    };\n    return colors[weight?.toLowerCase()] || 'bg-gray-100 text-gray-800';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading yarn stash...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Yarn Stash</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your yarn inventory</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          Add Yarn\n        </button>\n      </div>\n\n      {yarn.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiPackage className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No yarn in stash</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking your yarn collection</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Yarn\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {yarn.map((y) => (\n            <div\n              key={y.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex-1\">\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\n                    {y.brand && `${y.brand} `}{y.name}\n                  </h3>\n                  {y.color && (\n                    <p className=\"text-sm text-gray-600 mt-1\">{y.color}</p>\n                  )}\n                </div>\n                {y.weight && (\n                  <span\n                    className={`px-2 py-1 text-xs font-medium rounded-full ${getWeightColor(\n                      y.weight\n                    )}`}\n                  >\n                    {y.weight}\n                  </span>\n                )}\n              </div>\n\n              {y.fiber_content && (\n                <p className=\"text-sm text-gray-500 mb-3\">{y.fiber_content}</p>\n              )}\n\n              <div className=\"space-y-2 mb-4\">\n                {y.skeins_remaining !== undefined && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Skeins:</span>\n                    <span className=\"font-medium text-gray-900\">{y.skeins_remaining}</span>\n                  </div>\n                )}\n                {y.yards_remaining !== undefined && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Yards:</span>\n                    <span className=\"font-medium text-gray-900\">{y.yards_remaining}</span>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                <button\n                  onClick={() => handleEditClick(y)}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                  Edit\n                </button>\n                <button\n                  onClick={() => handleDeleteYarn(y.id, y.name)}\n                  className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Yarn Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add Yarn to Stash</h2>\n            </div>\n\n            <form onSubmit={handleCreateYarn} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Brand\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Lion Brand\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yarn Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Wool-Ease\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Color\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.color}\n                    onChange={(e) => setFormData({ ...formData, color: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Navy Blue\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Weight\n                  </label>\n                  <select\n                    value={formData.weight}\n                    onChange={(e) => setFormData({ ...formData, weight: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"lace\">Lace</option>\n                    <option value=\"fingering\">Fingering</option>\n                    <option value=\"sport\">Sport</option>\n                    <option value=\"dk\">DK</option>\n                    <option value=\"worsted\">Worsted</option>\n                    <option value=\"bulky\">Bulky</option>\n                    <option value=\"super-bulky\">Super Bulky</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Fiber Content\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.fiberContent}\n                  onChange={(e) => setFormData({ ...formData, fiberContent: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., 100% Wool, 80% Acrylic 20% Wool\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Number of Skeins\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.skeinsTotal}\n                    onChange={(e) => setFormData({ ...formData, skeinsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    min=\"1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yards per Skein\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.yardsTotal}\n                    onChange={(e) => setFormData({ ...formData, yardsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., 364\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add to Stash\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Yarn Modal */}\n      {showEditModal && editingYarn && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Yarn</h2>\n            </div>\n\n            <form onSubmit={handleUpdateYarn} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Brand\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Lion Brand\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yarn Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Wool-Ease\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Color\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.color}\n                    onChange={(e) => setFormData({ ...formData, color: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Navy Blue\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Weight\n                  </label>\n                  <select\n                    value={formData.weight}\n                    onChange={(e) => setFormData({ ...formData, weight: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"lace\">Lace</option>\n                    <option value=\"fingering\">Fingering</option>\n                    <option value=\"sport\">Sport</option>\n                    <option value=\"dk\">DK</option>\n                    <option value=\"worsted\">Worsted</option>\n                    <option value=\"bulky\">Bulky</option>\n                    <option value=\"super-bulky\">Super Bulky</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Fiber Content\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.fiberContent}\n                  onChange={(e) => setFormData({ ...formData, fiberContent: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., 100% Wool, 80% Acrylic 20% Wool\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Number of Skeins\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.skeinsTotal}\n                    onChange={(e) => setFormData({ ...formData, skeinsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    min=\"1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yards per Skein\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.yardsTotal}\n                    onChange={(e) => setFormData({ ...formData, yardsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., 364\"\n                  />\n                </div>\n              </div>\n\n              {/* Photo Gallery Section */}\n              <div className=\"border-t border-gray-200 pt-4\">\n                <h3 className=\"text-sm font-medium text-gray-900 mb-3\">Photos</h3>\n\n                {/* Photo Upload */}\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm text-gray-600 mb-2\">\n                    Add photo to visualize your yarn\n                  </label>\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handlePhotoUpload}\n                    disabled={uploadingPhoto}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  />\n                  {uploadingPhoto && (\n                    <p className=\"text-sm text-gray-500 mt-2\">Uploading...</p>\n                  )}\n                </div>\n\n                {/* Photo Grid */}\n                {yarnPhotos.length > 0 && (\n                  <div className=\"grid grid-cols-3 gap-2\">\n                    {yarnPhotos.map((photo) => (\n                      <div key={photo.id} className=\"relative group\">\n                        <img\n                          src={photo.thumbnail_path}\n                          alt={photo.original_filename}\n                          className=\"w-full h-24 object-cover rounded-lg border border-gray-200\"\n                        />\n                        <button\n                          type=\"button\"\n                          onClick={() => handlePhotoDelete(photo.id)}\n                          className=\"absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n                          title=\"Delete photo\"\n                        >\n                          <FiTrash2 className=\"h-3 w-3\" />\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                {yarnPhotos.length === 0 && (\n                  <p className=\"text-sm text-gray-500 text-center py-4 bg-gray-50 rounded-lg\">\n                    No photos yet. Upload a photo to see what your yarn looks like!\n                  </p>\n                )}\n              </div>\n\n              <div className=\"border-t border-gray-200 pt-4\">\n                <h3 className=\"text-sm font-medium text-gray-900 mb-3\">Low Stock Alerts</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Low Stock Threshold (yards)\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.lowStockThreshold}\n                      onChange={(e) => setFormData({ ...formData, lowStockThreshold: e.target.value })}\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                      placeholder=\"e.g., 100\"\n                      min=\"0\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">Get notified when yards drop below this amount</p>\n                  </div>\n\n                  <div className=\"flex items-center\">\n                    <label className=\"flex items-center cursor-pointer\">\n                      <input\n                        type=\"checkbox\"\n                        checked={formData.lowStockAlert}\n                        onChange={(e) => setFormData({ ...formData, lowStockAlert: e.target.checked })}\n                        className=\"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500\"\n                      />\n                      <span className=\"ml-2 text-sm text-gray-700\">Enable low stock alerts</span>\n                    </label>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingYarn(null);\n                    setYarnPhotos([]);\n                    setFormData({\n                      brand: '',\n                      name: '',\n                      color: '',\n                      weight: 'worsted',\n                      fiberContent: '',\n                      yardsTotal: '',\n                      skeinsTotal: '1',\n                      lowStockThreshold: '',\n                      lowStockAlert: false,\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Yarn\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiTrash2, FiTool, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Tool {\n  id: string;\n  name: string;\n  type: string;\n  size: string;\n  material: string;\n  brand: string;\n  quantity: number;\n}\n\nexport default function Tools() {\n  const [tools, setTools] = useState<Tool[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingTool, setEditingTool] = useState<Tool | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    type: 'needle',\n    size: '',\n    material: '',\n    brand: '',\n    quantity: '1',\n  });\n\n  useEffect(() => {\n    fetchTools();\n  }, []);\n\n  const fetchTools = async () => {\n    try {\n      const response = await axios.get('/api/tools');\n      setTools(response.data.data.tools);\n    } catch (error: any) {\n      console.error('Error fetching tools:', error);\n      toast.error('Failed to load tools');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateTool = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await axios.post('/api/tools', formData);\n      toast.success('Tool added successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        name: '',\n        type: 'needle',\n        size: '',\n        material: '',\n        brand: '',\n        quantity: '1',\n      });\n      fetchTools();\n    } catch (error: any) {\n      console.error('Error creating tool:', error);\n      toast.error(error.response?.data?.message || 'Failed to add tool');\n    }\n  };\n\n  const handleEditClick = (tool: Tool) => {\n    setEditingTool(tool);\n    setFormData({\n      name: tool.name || '',\n      type: tool.type || 'needle',\n      size: tool.size || '',\n      material: tool.material || '',\n      brand: tool.brand || '',\n      quantity: tool.quantity?.toString() || '1',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdateTool = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingTool) return;\n\n    try {\n      await axios.put(`/api/tools/${editingTool.id}`, formData);\n      toast.success('Tool updated successfully!');\n      setShowEditModal(false);\n      setEditingTool(null);\n      setFormData({\n        name: '',\n        type: 'needle',\n        size: '',\n        material: '',\n        brand: '',\n        quantity: '1',\n      });\n      fetchTools();\n    } catch (error: any) {\n      console.error('Error updating tool:', error);\n      toast.error(error.response?.data?.message || 'Failed to update tool');\n    }\n  };\n\n  const handleDeleteTool = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/tools/${id}`);\n      toast.success('Tool deleted successfully');\n      fetchTools();\n    } catch (error: any) {\n      console.error('Error deleting tool:', error);\n      toast.error('Failed to delete tool');\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    const colors: { [key: string]: string } = {\n      needle: 'bg-blue-100 text-blue-800',\n      hook: 'bg-purple-100 text-purple-800',\n      circular: 'bg-green-100 text-green-800',\n      dpn: 'bg-yellow-100 text-yellow-800',\n      accessory: 'bg-gray-100 text-gray-800',\n    };\n    return colors[type?.toLowerCase()] || 'bg-gray-100 text-gray-800';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading tools...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Tools</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your knitting tools inventory</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          Add Tool\n        </button>\n      </div>\n\n      {tools.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiTool className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No tools yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking your knitting tools</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Tool\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {tools.map((tool) => (\n            <div\n              key={tool.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex-1\">\n                  <h3 className=\"text-lg font-semibold text-gray-900\">{tool.name}</h3>\n                  {tool.size && <p className=\"text-sm text-gray-600 mt-1\">Size {tool.size}</p>}\n                </div>\n                {tool.type && (\n                  <span\n                    className={`px-2 py-1 text-xs font-medium rounded-full ${getTypeColor(\n                      tool.type\n                    )}`}\n                  >\n                    {tool.type}\n                  </span>\n                )}\n              </div>\n\n              <div className=\"space-y-2 mb-4\">\n                {tool.brand && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Brand:</span> {tool.brand}\n                  </div>\n                )}\n                {tool.material && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Material:</span> {tool.material}\n                  </div>\n                )}\n                {tool.quantity && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Quantity:</span> {tool.quantity}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                <button\n                  onClick={() => handleEditClick(tool)}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                  Edit\n                </button>\n                <button\n                  onClick={() => handleDeleteTool(tool.id, tool.name)}\n                  className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Tool Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add Tool</h2>\n            </div>\n\n            <form onSubmit={handleCreateTool} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Tool Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., US 7 Circular Needles\"\n                  required\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Type *\n                  </label>\n                  <select\n                    value={formData.type}\n                    onChange={(e) => setFormData({ ...formData, type: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  >\n                    <option value=\"needle\">Straight Needle</option>\n                    <option value=\"circular\">Circular Needle</option>\n                    <option value=\"dpn\">Double-Pointed Needles (DPN)</option>\n                    <option value=\"hook\">Crochet Hook</option>\n                    <option value=\"accessory\">Accessory</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Size</label>\n                  <input\n                    type=\"text\"\n                    value={formData.size}\n                    onChange={(e) => setFormData({ ...formData, size: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., US 7, 4.5mm\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Material\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.material}\n                    onChange={(e) => setFormData({ ...formData, material: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Bamboo, Metal, Wood\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Brand</label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Clover, Addi\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Quantity</label>\n                <input\n                  type=\"number\"\n                  value={formData.quantity}\n                  onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  min=\"1\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Tool\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Tool Modal */}\n      {showEditModal && editingTool && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Tool</h2>\n            </div>\n\n            <form onSubmit={handleUpdateTool} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Tool Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., US 7 Circular Needles\"\n                  required\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Type *\n                  </label>\n                  <select\n                    value={formData.type}\n                    onChange={(e) => setFormData({ ...formData, type: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  >\n                    <option value=\"needle\">Straight Needle</option>\n                    <option value=\"circular\">Circular Needle</option>\n                    <option value=\"dpn\">Double-Pointed Needles (DPN)</option>\n                    <option value=\"hook\">Crochet Hook</option>\n                    <option value=\"accessory\">Accessory</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Size</label>\n                  <input\n                    type=\"text\"\n                    value={formData.size}\n                    onChange={(e) => setFormData({ ...formData, size: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., US 7, 4.5mm\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Material\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.material}\n                    onChange={(e) => setFormData({ ...formData, material: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Bamboo, Metal, Wood\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Brand</label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Clover, Addi\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Quantity</label>\n                <input\n                  type=\"number\"\n                  value={formData.quantity}\n                  onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  min=\"1\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingTool(null);\n                    setFormData({\n                      name: '',\n                      type: 'needle',\n                      size: '',\n                      material: '',\n                      brand: '',\n                      quantity: '1',\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Tool\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiTrash2, FiUsers, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Recipient {\n  id: string;\n  first_name: string;\n  last_name: string;\n  relationship: string;\n  clothing_size: string;\n  notes: string;\n}\n\nexport default function Recipients() {\n  const [recipients, setRecipients] = useState<Recipient[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingRecipient, setEditingRecipient] = useState<Recipient | null>(null);\n  const [formData, setFormData] = useState({\n    firstName: '',\n    lastName: '',\n    relationship: '',\n    clothingSize: '',\n    notes: '',\n  });\n\n  useEffect(() => {\n    fetchRecipients();\n  }, []);\n\n  const fetchRecipients = async () => {\n    try {\n      const response = await axios.get('/api/recipients');\n      setRecipients(response.data.data.recipients);\n    } catch (error: any) {\n      console.error('Error fetching recipients:', error);\n      toast.error('Failed to load recipients');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateRecipient = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await axios.post('/api/recipients', formData);\n      toast.success('Recipient added successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        firstName: '',\n        lastName: '',\n        relationship: '',\n        clothingSize: '',\n        notes: '',\n      });\n      fetchRecipients();\n    } catch (error: any) {\n      console.error('Error creating recipient:', error);\n      toast.error(error.response?.data?.message || 'Failed to add recipient');\n    }\n  };\n\n  const handleEditClick = (recipient: Recipient) => {\n    setEditingRecipient(recipient);\n    setFormData({\n      firstName: recipient.first_name || '',\n      lastName: recipient.last_name || '',\n      relationship: recipient.relationship || '',\n      clothingSize: recipient.clothing_size || '',\n      notes: recipient.notes || '',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdateRecipient = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingRecipient) return;\n\n    try {\n      await axios.put(`/api/recipients/${editingRecipient.id}`, formData);\n      toast.success('Recipient updated successfully!');\n      setShowEditModal(false);\n      setEditingRecipient(null);\n      setFormData({\n        firstName: '',\n        lastName: '',\n        relationship: '',\n        clothingSize: '',\n        notes: '',\n      });\n      fetchRecipients();\n    } catch (error: any) {\n      console.error('Error updating recipient:', error);\n      toast.error(error.response?.data?.message || 'Failed to update recipient');\n    }\n  };\n\n  const handleDeleteRecipient = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/recipients/${id}`);\n      toast.success('Recipient deleted successfully');\n      fetchRecipients();\n    } catch (error: any) {\n      console.error('Error deleting recipient:', error);\n      toast.error('Failed to delete recipient');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading recipients...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Recipients</h1>\n          <p className=\"text-gray-600 mt-1\">Manage gift recipients and their preferences</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          Add Recipient\n        </button>\n      </div>\n\n      {recipients.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiUsers className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No recipients yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking people you knit for</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Recipient\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {recipients.map((recipient) => (\n            <div\n              key={recipient.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                {recipient.first_name} {recipient.last_name}\n              </h3>\n\n              {recipient.relationship && (\n                <p className=\"text-sm text-gray-600 mb-3\">{recipient.relationship}</p>\n              )}\n\n              {recipient.clothing_size && (\n                <div className=\"text-sm text-gray-500 mb-2\">\n                  <span className=\"font-medium\">Size:</span> {recipient.clothing_size}\n                </div>\n              )}\n\n              {recipient.notes && (\n                <p className=\"text-sm text-gray-600 mt-3 line-clamp-2\">{recipient.notes}</p>\n              )}\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200 mt-4\">\n                <button\n                  onClick={() => handleEditClick(recipient)}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                  Edit\n                </button>\n                <button\n                  onClick={() =>\n                    handleDeleteRecipient(\n                      recipient.id,\n                      `${recipient.first_name} ${recipient.last_name}`\n                    )\n                  }\n                  className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Recipient Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add Recipient</h2>\n            </div>\n\n            <form onSubmit={handleCreateRecipient} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    First Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.firstName}\n                    onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Last Name\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.lastName}\n                    onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Relationship\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.relationship}\n                    onChange={(e) => setFormData({ ...formData, relationship: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Friend, Family, Child\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Clothing Size\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.clothingSize}\n                    onChange={(e) => setFormData({ ...formData, clothingSize: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Medium, Large\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Preferences, measurements, color likes/dislikes, etc.\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Recipient\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Recipient Modal */}\n      {showEditModal && editingRecipient && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Recipient</h2>\n            </div>\n\n            <form onSubmit={handleUpdateRecipient} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    First Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.firstName}\n                    onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Last Name\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.lastName}\n                    onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Relationship\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.relationship}\n                    onChange={(e) => setFormData({ ...formData, relationship: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Friend, Family, Child\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Clothing Size\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.clothingSize}\n                    onChange={(e) => setFormData({ ...formData, clothingSize: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Medium, Large\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Preferences, measurements, color likes/dislikes, etc.\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingRecipient(null);\n                    setFormData({\n                      firstName: '',\n                      lastName: '',\n                      relationship: '',\n                      clothingSize: '',\n                      notes: '',\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Recipient\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","export default function Profile() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">Profile</h1></div>; }\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport {\n  FiCheckCircle,\n  FiLayers,\n  FiClock,\n  FiTrendingUp,\n  FiFolder,\n  FiChevronRight,\n  FiAward\n} from 'react-icons/fi';\nimport axios from 'axios';\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n  CartesianGrid\n} from 'recharts';\n\ninterface StatsData {\n  totalCompleted: number;\n  totalRows: number;\n  totalSeconds: number;\n  currentStreak: number;\n  longestStreak: number;\n  activityData: Array<{ date: string; rows: number }>;\n  recentProjects: Array<{\n    id: string;\n    name: string;\n    status: string;\n    rows_completed: number;\n    total_seconds: number;\n    updated_at: string;\n  }>;\n}\n\ntype TimePeriod = 'today' | 'week' | 'month' | 'all';\n\n// Helper to format seconds to readable time\nfunction formatTime(seconds: number): string {\n  if (seconds < 60) return `${seconds}s`;\n  if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  if (hours >= 24) {\n    const days = Math.floor(hours / 24);\n    const remainingHours = hours % 24;\n    return remainingHours > 0 ? `${days}d ${remainingHours}h` : `${days}d`;\n  }\n  return minutes > 0 ? `${hours}h ${minutes}m` : `${hours}h`;\n}\n\n// Stat Card Component\ninterface StatCardProps {\n  value: string | number;\n  label: string;\n  icon: React.ReactNode;\n  color: string;\n  loading?: boolean;\n  sublabel?: string;\n}\n\nfunction StatCard({ value, label, icon, color, loading, sublabel }: StatCardProps) {\n  if (loading) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 animate-pulse\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"h-12 w-12 bg-gray-200 dark:bg-gray-700 rounded-lg\" />\n        </div>\n        <div className=\"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded mb-2\" />\n        <div className=\"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className={`${color} p-3 rounded-lg`}>\n          {icon}\n        </div>\n        {sublabel && (\n          <span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">\n            {sublabel}\n          </span>\n        )}\n      </div>\n      <div className=\"text-3xl font-bold text-gray-900 dark:text-white mb-1\">\n        {typeof value === 'number' ? value.toLocaleString() : value}\n      </div>\n      <div className=\"text-sm text-gray-500 dark:text-gray-400\">{label}</div>\n    </div>\n  );\n}\n\n// Activity Graph Component\ninterface ActivityGraphProps {\n  data: Array<{ date: string; rows: number }>;\n  loading?: boolean;\n}\n\nfunction ActivityGraph({ data, loading }: ActivityGraphProps) {\n  if (loading) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6\">\n        <div className=\"h-6 w-40 bg-gray-200 dark:bg-gray-700 rounded mb-4\" />\n        <div className=\"h-64 bg-gray-100 dark:bg-gray-700 rounded animate-pulse\" />\n      </div>\n    );\n  }\n\n  if (!data || data.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n          Activity Over Time\n        </h3>\n        <div className=\"h-64 flex items-center justify-center text-gray-500 dark:text-gray-400\">\n          <div className=\"text-center\">\n            <FiTrendingUp className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n            <p>Start knitting to see your activity!</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Format date for tooltip\n  const formatTooltipDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  // Format date for x-axis\n  const formatAxisDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n        Activity Over Time\n      </h3>\n      <div className=\"h-64\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <LineChart data={data} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" opacity={0.1} />\n            <XAxis\n              dataKey=\"date\"\n              tickFormatter={formatAxisDate}\n              stroke=\"#9CA3AF\"\n              fontSize={12}\n              tickLine={false}\n              axisLine={false}\n            />\n            <YAxis\n              stroke=\"#9CA3AF\"\n              fontSize={12}\n              tickLine={false}\n              axisLine={false}\n              tickFormatter={(value: number) => value.toLocaleString()}\n            />\n            <Tooltip\n              labelFormatter={formatTooltipDate}\n              formatter={(value: number) => [`${value.toLocaleString()} rows`, 'Rows Knitted']}\n              contentStyle={{\n                backgroundColor: '#1F2937',\n                border: 'none',\n                borderRadius: '8px',\n                color: '#F9FAFB'\n              }}\n            />\n            <Line\n              type=\"monotone\"\n              dataKey=\"rows\"\n              stroke=\"#8B5CF6\"\n              strokeWidth={2}\n              dot={{ fill: '#8B5CF6', strokeWidth: 0, r: 4 }}\n              activeDot={{ r: 6, fill: '#8B5CF6' }}\n            />\n          </LineChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n}\n\n// Recent Projects List Component\ninterface RecentProjectsProps {\n  projects: StatsData['recentProjects'];\n  loading?: boolean;\n}\n\nfunction RecentProjectsList({ projects, loading }: RecentProjectsProps) {\n  if (loading) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6\">\n        <div className=\"h-6 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-4\" />\n        {[1, 2, 3].map((i) => (\n          <div key={i} className=\"flex items-center p-4 animate-pulse\">\n            <div className=\"h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded-lg mr-4\" />\n            <div className=\"flex-1\">\n              <div className=\"h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-2\" />\n              <div className=\"h-3 w-24 bg-gray-200 dark:bg-gray-700 rounded\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (!projects || projects.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n          Recent Projects\n        </h3>\n        <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <FiFolder className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n          <p>No projects yet. Create one to get started!</p>\n          <Link\n            to=\"/projects\"\n            className=\"mt-4 inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            Create Project\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active':\n        return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400';\n      case 'completed':\n        return 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400';\n      case 'paused':\n        return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400';\n      default:\n        return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400';\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Recent Projects\n        </h3>\n        <Link\n          to=\"/projects\"\n          className=\"text-sm text-purple-600 hover:text-purple-700 dark:text-purple-400 flex items-center\"\n        >\n          View all\n          <FiChevronRight className=\"h-4 w-4 ml-1\" />\n        </Link>\n      </div>\n      <div className=\"space-y-2\">\n        {projects.map((project) => (\n          <Link\n            key={project.id}\n            to={`/projects/${project.id}`}\n            className=\"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition group\"\n          >\n            <div className=\"flex items-center\">\n              <div className=\"bg-purple-100 dark:bg-purple-900/30 p-2.5 rounded-lg mr-4\">\n                <FiFolder className=\"h-5 w-5 text-purple-600 dark:text-purple-400\" />\n              </div>\n              <div>\n                <h4 className=\"font-medium text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition\">\n                  {project.name}\n                </h4>\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                  {project.rows_completed.toLocaleString()} rows\n                  {project.total_seconds > 0 && ` in ${formatTime(project.total_seconds)}`}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <span className={`text-xs px-2.5 py-1 rounded-full capitalize ${getStatusColor(project.status)}`}>\n                {project.status}\n              </span>\n              <FiChevronRight className=\"h-5 w-5 text-gray-400 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition\" />\n            </div>\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n}\n\n// Main Stats Page Component\nexport default function Stats() {\n  const [stats, setStats] = useState<StatsData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [timePeriod, setTimePeriod] = useState<TimePeriod>('week');\n\n  useEffect(() => {\n    fetchStats();\n  }, [timePeriod]);\n\n  const fetchStats = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/stats?period=${timePeriod}`);\n      if (response.data.success) {\n        setStats(response.data.data.stats);\n      }\n    } catch (error) {\n      console.error('Failed to fetch stats:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const periodLabels: Record<TimePeriod, string> = {\n    today: 'Today',\n    week: 'This Week',\n    month: 'This Month',\n    all: 'All Time'\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n          Your Knitting Stats\n        </h1>\n        <p className=\"text-gray-600 dark:text-gray-400\">\n          Track your progress and celebrate your achievements\n        </p>\n      </div>\n\n      {/* Time Period Filter */}\n      <div className=\"flex flex-wrap gap-2 mb-6\">\n        {(Object.keys(periodLabels) as TimePeriod[]).map((period) => (\n          <button\n            key={period}\n            onClick={() => setTimePeriod(period)}\n            className={`px-4 py-2 rounded-lg font-medium transition ${\n              timePeriod === period\n                ? 'bg-purple-600 text-white'\n                : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-700'\n            }`}\n          >\n            {periodLabels[period]}\n          </button>\n        ))}\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n        <StatCard\n          value={stats?.totalCompleted || 0}\n          label=\"Projects Completed\"\n          icon={<FiCheckCircle className=\"h-6 w-6 text-white\" />}\n          color=\"bg-green-500\"\n          loading={loading}\n        />\n        <StatCard\n          value={stats?.totalRows || 0}\n          label=\"Rows Knitted\"\n          icon={<FiLayers className=\"h-6 w-6 text-white\" />}\n          color=\"bg-purple-500\"\n          loading={loading}\n        />\n        <StatCard\n          value={stats ? formatTime(stats.totalSeconds) : '0h'}\n          label=\"Time Knitting\"\n          icon={<FiClock className=\"h-6 w-6 text-white\" />}\n          color=\"bg-blue-500\"\n          loading={loading}\n        />\n        <StatCard\n          value={stats?.currentStreak || 0}\n          label=\"Day Streak\"\n          icon={<FiTrendingUp className=\"h-6 w-6 text-white\" />}\n          color=\"bg-orange-500\"\n          loading={loading}\n          sublabel={stats && stats.longestStreak > 0 ? `Best: ${stats.longestStreak}` : undefined}\n        />\n      </div>\n\n      {/* Achievement Banner (if current streak is active) */}\n      {!loading && stats && stats.currentStreak >= 3 && (\n        <div className=\"bg-gradient-to-r from-orange-500 to-pink-500 rounded-xl p-6 mb-8 text-white\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"bg-white/20 p-3 rounded-full\">\n              <FiAward className=\"h-8 w-8\" />\n            </div>\n            <div>\n              <h3 className=\"text-xl font-bold\">\n                {stats.currentStreak} Day Streak!\n              </h3>\n              <p className=\"text-white/80\">\n                You've been knitting for {stats.currentStreak} days in a row. Keep it up!\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Activity Graph */}\n      <div className=\"mb-8\">\n        <ActivityGraph data={stats?.activityData || []} loading={loading} />\n      </div>\n\n      {/* Recent Projects */}\n      <RecentProjectsList projects={stats?.recentProjects || []} loading={loading} />\n    </div>\n  );\n}\n","import { useState, FormEvent } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useAuthStore } from '../../stores/authStore';\nimport { toast } from 'react-toastify';\n\nexport default function Login() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [rememberMe, setRememberMe] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const navigate = useNavigate();\n  const login = useAuthStore((state) => state.login);\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n\n    if (!email || !password) {\n      toast.error('Please fill in all fields');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      await login(email, password, rememberMe);\n      toast.success('Login successful!');\n      navigate('/dashboard');\n    } catch (error: any) {\n      console.error('Login error:', error);\n      const message = error.response?.data?.message || 'Login failed. Please check your credentials.';\n      toast.error(message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full max-w-md mx-auto\">\n      <div className=\"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-8 transition-colors duration-200\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2\">Rowly</h1>\n          <p className=\"text-gray-600 dark:text-gray-300\">Sign in to your account</p>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div>\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Email Address\n            </label>\n            <input\n              id=\"email\"\n              type=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition\"\n              placeholder=\"you@example.com\"\n              disabled={isLoading}\n              required\n            />\n          </div>\n\n          <div>\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Password\n            </label>\n            <input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition\"\n              placeholder=\"\"\n              disabled={isLoading}\n              required\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <label className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={rememberMe}\n                onChange={(e) => setRememberMe(e.target.checked)}\n                className=\"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"\n                disabled={isLoading}\n              />\n              <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">Remember me for 30 days</span>\n            </label>\n            <Link\n              to=\"/forgot-password\"\n              className=\"text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition\"\n            >\n              Forgot password?\n            </Link>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"w-full bg-purple-600 dark:bg-purple-700 text-white py-2 px-4 rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 transition disabled:opacity-50 disabled:cursor-not-allowed font-medium\"\n          >\n            {isLoading ? 'Signing in...' : 'Sign In'}\n          </button>\n        </form>\n\n        <div className=\"mt-6 text-center\">\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            Don't have an account?{' '}\n            <Link to=\"/register\" className=\"text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 font-medium transition\">\n              Sign up\n            </Link>\n          </p>\n        </div>\n\n        <div className=\"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700\">\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 text-center\">\n            Demo account: <span className=\"font-mono\">demo@rowlyknit.com</span> / <span className=\"font-mono\">Demo123!@#</span>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","export default function Register() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">Register</h1></div>; }\n","export default function ForgotPassword() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">ForgotPassword</h1></div>; }\n","export default function ResetPassword() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">ResetPassword</h1></div>; }\n","export default function VerifyEmail() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">VerifyEmail</h1></div>; }\n","export default function NotFound() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">NotFound</h1></div>; }\n","import { Routes, Route, Navigate } from 'react-router-dom';\nimport { useAuthStore } from './stores/authStore';\nimport PWAInstallPrompt from './components/PWAInstallPrompt';\nimport OfflineIndicator from './components/OfflineIndicator';\n\n// Layouts\nimport MainLayout from './components/layouts/MainLayout';\nimport AuthLayout from './components/layouts/AuthLayout';\n\n// Pages\nimport Dashboard from './pages/Dashboard';\nimport Projects from './pages/Projects';\nimport ProjectDetail from './pages/ProjectDetail';\nimport Patterns from './pages/Patterns';\nimport PatternDetail from './pages/PatternDetail';\nimport YarnStash from './pages/YarnStash';\nimport Tools from './pages/Tools';\nimport Recipients from './pages/Recipients';\nimport Profile from './pages/Profile';\nimport Stats from './pages/Stats';\nimport Login from './pages/auth/Login';\nimport Register from './pages/auth/Register';\nimport ForgotPassword from './pages/auth/ForgotPassword';\nimport ResetPassword from './pages/auth/ResetPassword';\nimport VerifyEmail from './pages/auth/VerifyEmail';\nimport NotFound from './pages/NotFound';\n\n// Protected route wrapper\nfunction PrivateRoute({ children }: { children: React.ReactNode }) {\n  const { isAuthenticated } = useAuthStore();\n  return isAuthenticated ? <>{children}</> : <Navigate to=\"/login\" replace />;\n}\n\n// Public route wrapper (redirect to dashboard if authenticated)\nfunction PublicRoute({ children }: { children: React.ReactNode }) {\n  const { isAuthenticated } = useAuthStore();\n  return !isAuthenticated ? <>{children}</> : <Navigate to=\"/dashboard\" replace />;\n}\n\nfunction App() {\n  return (\n    <>\n      <OfflineIndicator />\n      <PWAInstallPrompt />\n      <Routes>\n        {/* Auth routes */}\n      <Route element={<AuthLayout />}>\n        <Route\n          path=\"/login\"\n          element={\n            <PublicRoute>\n              <Login />\n            </PublicRoute>\n          }\n        />\n        <Route\n          path=\"/register\"\n          element={\n            <PublicRoute>\n              <Register />\n            </PublicRoute>\n          }\n        />\n        <Route\n          path=\"/forgot-password\"\n          element={\n            <PublicRoute>\n              <ForgotPassword />\n            </PublicRoute>\n          }\n        />\n        <Route path=\"/reset-password\" element={<ResetPassword />} />\n        <Route path=\"/verify-email\" element={<VerifyEmail />} />\n      </Route>\n\n      {/* Protected routes */}\n      <Route\n        element={\n          <PrivateRoute>\n            <MainLayout />\n          </PrivateRoute>\n        }\n      >\n        <Route path=\"/\" element={<Navigate to=\"/dashboard\" replace />} />\n        <Route path=\"/dashboard\" element={<Dashboard />} />\n        <Route path=\"/projects\" element={<Projects />} />\n        <Route path=\"/projects/:id\" element={<ProjectDetail />} />\n        <Route path=\"/patterns\" element={<Patterns />} />\n        <Route path=\"/patterns/:id\" element={<PatternDetail />} />\n        <Route path=\"/yarn\" element={<YarnStash />} />\n        <Route path=\"/tools\" element={<Tools />} />\n        <Route path=\"/recipients\" element={<Recipients />} />\n        <Route path=\"/profile\" element={<Profile />} />\n        <Route path=\"/stats\" element={<Stats />} />\n      </Route>\n\n      {/* 404 */}\n      <Route path=\"*\" element={<NotFound />} />\n      </Routes>\n    </>\n  );\n}\n\nexport default App;\n","import { Component, ErrorInfo, ReactNode } from 'react';\nimport { FiAlertTriangle, FiRefreshCw } from 'react-icons/fi';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n}\n\nclass ErrorBoundary extends Component<Props, State> {\n  public state: State = {\n    hasError: false,\n    error: null,\n    errorInfo: null,\n  };\n\n  public static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error, errorInfo: null };\n  }\n\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\n    this.setState({\n      error,\n      errorInfo,\n    });\n  }\n\n  private handleReset = () => {\n    this.setState({ hasError: false, error: null, errorInfo: null });\n    window.location.reload();\n  };\n\n  public render() {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      return (\n        <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4\">\n          <div className=\"max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-8\">\n            <div className=\"flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-red-100 dark:bg-red-900/20 rounded-full mx-auto mb-4 md:mb-6\">\n              <FiAlertTriangle className=\"w-8 h-8 md:w-10 md:h-10 text-red-600 dark:text-red-400\" />\n            </div>\n\n            <h2 className=\"text-xl md:text-2xl font-bold text-gray-900 dark:text-white text-center mb-3 md:mb-4\">\n              Something went wrong\n            </h2>\n\n            <p className=\"text-sm md:text-base text-gray-600 dark:text-gray-400 text-center mb-6 md:mb-8\">\n              We're sorry for the inconvenience. The app encountered an unexpected error.\n            </p>\n\n            {import.meta.env.DEV && this.state.error && (\n              <div className=\"mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-auto max-h-40 md:max-h-60\">\n                <p className=\"text-xs md:text-sm font-mono text-red-600 dark:text-red-400 break-all\">\n                  {this.state.error.toString()}\n                </p>\n                {this.state.errorInfo && (\n                  <pre className=\"text-xs mt-2 text-gray-600 dark:text-gray-400 overflow-auto\">\n                    {this.state.errorInfo.componentStack}\n                  </pre>\n                )}\n              </div>\n            )}\n\n            <button\n              onClick={this.handleReset}\n              className=\"w-full flex items-center justify-center gap-2 px-6 py-3 md:py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors min-h-[56px] md:min-h-[64px]\"\n            >\n              <FiRefreshCw className=\"w-5 h-5 md:w-6 md:h-6\" />\n              <span className=\"text-base md:text-lg\">Reload App</span>\n            </button>\n\n            <p className=\"text-xs md:text-sm text-gray-500 dark:text-gray-400 text-center mt-4 md:mt-6\">\n              If this problem persists, please contact support\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","import axios, { AxiosError, AxiosRequestConfig } from 'axios';\n\n/**\n * Global Axios Configuration\n * - CSRF token handling\n * - Request/response interceptors\n * - Retry logic with exponential backoff\n * - Comprehensive error handling\n * - Development logging\n *\n * This configures the DEFAULT axios instance so all imports get this configuration\n */\n\n// Configure axios defaults globally\naxios.defaults.baseURL = import.meta.env.VITE_API_URL || 'http://localhost:5000';\naxios.defaults.timeout = 30000; // 30 seconds\naxios.defaults.withCredentials = true; // Enable cookies for session/CSRF\naxios.defaults.headers.common['Content-Type'] = 'application/json';\n\n// CSRF token cache\nlet csrfToken: string | null = null;\n\n/**\n * Fetch CSRF token from backend\n */\nasync function fetchCsrfToken(): Promise<string> {\n  try {\n    const response = await axios.get('/api/csrf-token');\n    csrfToken = response.data.csrfToken;\n    return csrfToken || '';\n  } catch (error) {\n    console.error('Failed to fetch CSRF token:', error);\n    // Don't throw - allow app to continue without CSRF token\n    return '';\n  }\n}\n\n/**\n * Get cached CSRF token or fetch new one\n */\nasync function getCsrfToken(): Promise<string> {\n  if (csrfToken) {\n    return csrfToken;\n  }\n  return fetchCsrfToken();\n}\n\n/**\n * Request Interceptor\n * - Add CSRF token to unsafe methods (POST, PUT, DELETE, PATCH)\n * - Log requests in development\n */\naxios.interceptors.request.use(\n  async (config) => {\n    // Add CSRF token for unsafe methods\n    const unsafeMethods = ['POST', 'PUT', 'DELETE', 'PATCH'];\n    if (config.method && unsafeMethods.includes(config.method.toUpperCase())) {\n      try {\n        const token = await getCsrfToken();\n        if (token) {\n          config.headers['x-csrf-token'] = token;\n        }\n      } catch (error) {\n        console.error('Failed to attach CSRF token:', error);\n        // Don't block request if CSRF fails\n      }\n    }\n\n    // Log requests in development\n    if (import.meta.env.DEV) {\n      console.log(`[API Request] ${config.method?.toUpperCase()} ${config.url}`, {\n        params: config.params,\n        data: config.data,\n      });\n    }\n\n    return config;\n  },\n  (error) => {\n    if (import.meta.env.DEV) {\n      console.error('[API Request Error]', error);\n    }\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Response Interceptor\n * - Handle common HTTP errors\n * - Retry failed requests\n * - Log responses in development\n * - Handle CSRF token expiration\n */\naxios.interceptors.response.use(\n  (response) => {\n    // Log successful responses in development\n    if (import.meta.env.DEV) {\n      console.log(`[API Response] ${response.config.method?.toUpperCase()} ${response.config.url}`, {\n        status: response.status,\n        data: response.data,\n      });\n    }\n    return response;\n  },\n  async (error: AxiosError) => {\n    const originalRequest = error.config as AxiosRequestConfig & { _retry?: boolean; _retryCount?: number };\n\n    // Log errors in development\n    if (import.meta.env.DEV) {\n      console.error('[API Error]', {\n        url: originalRequest?.url,\n        method: originalRequest?.method,\n        status: error.response?.status,\n        message: error.message,\n        data: error.response?.data,\n      });\n    }\n\n    // Handle 401 Unauthorized - redirect to login\n    if (error.response?.status === 401) {\n      // Clear CSRF token\n      csrfToken = null;\n\n      // Only redirect if not already on login/auth pages\n      const currentPath = window.location.pathname;\n      const authPaths = ['/login', '/register', '/forgot-password', '/reset-password', '/verify-email'];\n      if (!authPaths.some(path => currentPath.includes(path))) {\n        window.location.href = '/login';\n      }\n      return Promise.reject(error);\n    }\n\n    // Handle 403 Forbidden - might be CSRF token issue\n    if (error.response?.status === 403) {\n      const errorData = error.response.data as { error?: string };\n\n      // If CSRF error, refresh token and retry once\n      if (errorData.error?.includes('CSRF') && originalRequest && !originalRequest._retry) {\n        originalRequest._retry = true;\n\n        try {\n          // Fetch new CSRF token\n          await fetchCsrfToken();\n\n          // Retry original request with new token\n          return axios(originalRequest);\n        } catch (retryError) {\n          console.error('Failed to retry request after CSRF refresh:', retryError);\n          return Promise.reject(error);\n        }\n      }\n    }\n\n    // Handle network errors with retry logic\n    if (!error.response && originalRequest) {\n      const maxRetries = 3;\n      const retryCount = originalRequest._retryCount || 0;\n\n      if (retryCount < maxRetries) {\n        originalRequest._retryCount = retryCount + 1;\n\n        // Exponential backoff: 1s, 2s, 4s\n        const delay = Math.pow(2, retryCount) * 1000;\n\n        if (import.meta.env.DEV) {\n          console.log(`[API Retry] Attempt ${retryCount + 1}/${maxRetries} after ${delay}ms`);\n        }\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n        return axios(originalRequest);\n      }\n    }\n\n    // Handle 404 Not Found\n    if (error.response?.status === 404) {\n      console.warn('Resource not found:', originalRequest?.url);\n    }\n\n    // Handle 429 Too Many Requests\n    if (error.response?.status === 429) {\n      const retryAfter = error.response.headers['retry-after'];\n      console.warn('Rate limit exceeded. Retry after:', retryAfter);\n    }\n\n    // Handle 500 Internal Server Error\n    if (error.response?.status === 500) {\n      console.error('Server error:', error.response.data);\n    }\n\n    // Handle 503 Service Unavailable\n    if (error.response?.status === 503) {\n      console.error('Service unavailable. Server might be down.');\n    }\n\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Helper function to clear CSRF token\n * Useful when user logs out\n */\nexport function clearCsrfToken(): void {\n  csrfToken = null;\n}\n\n/**\n * Helper function to manually refresh CSRF token\n */\nexport async function refreshCsrfToken(): Promise<string> {\n  return fetchCsrfToken();\n}\n\n// Export the configured axios instance as default\nexport default axios;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { BrowserRouter } from 'react-router-dom';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { ToastContainer } from 'react-toastify';\nimport App from './App';\nimport ErrorBoundary from './components/ErrorBoundary';\nimport { WebSocketProvider } from './contexts/WebSocketContext';\nimport './lib/axios'; // Initialize axios configuration with withCredentials\nimport './styles/index.css';\nimport 'react-toastify/dist/ReactToastify.css';\n\n// Global error handlers for debugging\nwindow.addEventListener('error', (event) => {\n  console.error('Global error:', event.error);\n  console.error('Error message:', event.message);\n  console.error('Error source:', event.filename, event.lineno, event.colno);\n});\n\nwindow.addEventListener('unhandledrejection', (event) => {\n  console.error('Unhandled promise rejection:', event.reason);\n});\n\n// IMPORTANT: Unregister old service workers and clear cache to fix React undefined issue\n// This ensures we don't serve stale JS bundles from the service worker cache\nif ('serviceWorker' in navigator && import.meta.env.PROD) {\n  window.addEventListener('load', async () => {\n    try {\n      // Get all service worker registrations\n      const registrations = await navigator.serviceWorker.getRegistrations();\n\n      // Unregister all existing service workers\n      for (const registration of registrations) {\n        console.log('Unregistering old service worker...');\n        await registration.unregister();\n      }\n\n      // Clear all caches\n      if ('caches' in window) {\n        const cacheNames = await caches.keys();\n        for (const cacheName of cacheNames) {\n          console.log('Deleting cache:', cacheName);\n          await caches.delete(cacheName);\n        }\n      }\n\n      console.log(' All service workers unregistered and caches cleared');\n\n      // Now register the new service worker\n      const registration = await navigator.serviceWorker.register('/sw.js');\n      console.log(' New ServiceWorker registered:', registration);\n    } catch (error) {\n      console.error(' ServiceWorker error:', error);\n    }\n  });\n}\n\n// Create React Query client\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 1000 * 60 * 5, // 5 minutes\n      retry: 1,\n      refetchOnWindowFocus: false,\n    },\n  },\n});\n\n// Add error logging to catch initialization errors\ntry {\n  const rootElement = document.getElementById('root');\n\n  if (!rootElement) {\n    throw new Error('Root element not found! DOM might not be ready.');\n  }\n\n  console.log('Initializing React app...');\n  console.log('React version:', React.version);\n  console.log('Environment:', import.meta.env.MODE);\n\n  ReactDOM.createRoot(rootElement).render(\n    <React.StrictMode>\n      <ErrorBoundary>\n        <QueryClientProvider client={queryClient}>\n          <BrowserRouter>\n            <WebSocketProvider>\n              <App />\n              <ToastContainer\n                position=\"top-right\"\n                autoClose={3000}\n                hideProgressBar={false}\n                newestOnTop\n                closeOnClick\n                rtl={false}\n                pauseOnFocusLoss\n                draggable\n                pauseOnHover\n              />\n            </WebSocketProvider>\n          </BrowserRouter>\n        </QueryClientProvider>\n      </ErrorBoundary>\n    </React.StrictMode>\n  );\n\n  console.log(' React app initialized successfully');\n} catch (error) {\n  console.error(' Failed to initialize React app:', error);\n\n  // Display error to user\n  const rootElement = document.getElementById('root');\n  if (rootElement) {\n    rootElement.innerHTML = `\n      <div style=\"padding: 20px; font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto;\">\n        <h1 style=\"color: #dc2626;\">Application Error</h1>\n        <p>The application failed to start. Please check the browser console for details.</p>\n        <pre style=\"background: #f3f4f6; padding: 15px; border-radius: 5px; overflow: auto;\">\n          ${error instanceof Error ? error.message : String(error)}\n          ${error instanceof Error && error.stack ? '\\n\\n' + error.stack : ''}\n        </pre>\n        <button onclick=\"location.reload()\" style=\"margin-top: 20px; padding: 10px 20px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer;\">\n          Reload Page\n        </button>\n      </div>\n    `;\n  }\n}\n"],"file":"index-BF3f87B4.js"}