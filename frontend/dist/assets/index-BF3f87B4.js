import{c as qt,p as Vt,r as a,j as e,F as Z,a as ye,b as as,d as ns,u as fe,Q as k,e as st,f as ls,g as os,R as Re,h as de,i as Te,k as is,l as mt,m as ds,n as at,o as cs,q as Ht,s as us,t as xs,v as gs,w as oe,x as pe,y as ge,z as pt,A as Ae,L as W,B as Wt,C as ms,O as Kt,D as q,E as ee,G as Gt,H as X,I as nt,J as Qt,K as be,M as Xt,N as Zt,P as lt,S as ps,T as Jt,U as er,V as tr,W as ht,X as hs,Y as Pt,Z as bs,_ as ot,$ as he,a0 as ae,a1 as ys,a2 as rr,a3 as sr,a4 as fs,a5 as js,a6 as ke,a7 as ar,a8 as nr,a9 as vs,aa as ws,ab as _t,ac as Ns,ad as lr,ae as ks,af as or,ag as ir,ah as dr,ai as cr,aj as bt,ak as Le,al as ur,am as xr,an as gr,ao as Cs,ap as Xe,aq as Dt,ar as Ss,as as Fs,at as Ps,au as _s,av as Ds,aw as Es,ax as $s,ay as Ms,az as Rs,aA as Ts,aB as G,aC as yt,aD as As,aE as Ls,aF as zs,aG as Is,aH as Bs}from"./vendor-react-ByZW0a9M.js";import{a as S,f as Ze,b as mr}from"./vendor-utils-DYMy7bIE.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))y(l);new MutationObserver(l=>{for(const w of l)if(w.type==="childList")for(const m of w.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&y(m)}).observe(document,{childList:!0,subtree:!0});function r(l){const w={};return l.integrity&&(w.integrity=l.integrity),l.referrerPolicy&&(w.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?w.credentials="include":l.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function y(l){if(l.ep)return;l.ep=!0;const w=r(l);fetch(l.href,w)}})();const je=qt()(Vt((t,s)=>({user:null,accessToken:null,isAuthenticated:!1,login:async(r,y,l)=>{const w=await S.post("/api/auth/login",{email:r,password:y,rememberMe:l}),{user:m,accessToken:C}=w.data.data;t({user:m,accessToken:C,isAuthenticated:!0}),S.defaults.headers.common.Authorization=`Bearer ${C}`},register:async r=>{await S.post("/api/auth/register",r)},logout:async()=>{try{await S.post("/api/auth/logout")}catch(r){console.error("Logout error:",r)}finally{t({user:null,accessToken:null,isAuthenticated:!1}),delete S.defaults.headers.common.Authorization}},setUser:r=>{t({user:r})},setToken:r=>{t({accessToken:r}),S.defaults.headers.common.Authorization=`Bearer ${r}`},checkAuth:async()=>{const{accessToken:r}=s();if(r)try{S.defaults.headers.common.Authorization=`Bearer ${r}`;const y=await S.get("/api/auth/profile"),{user:l}=y.data.data;t({user:l,isAuthenticated:!0})}catch(y){console.error("Auth check failed:",y),t({user:null,accessToken:null,isAuthenticated:!1}),delete S.defaults.headers.common.Authorization}}}),{name:"rowly-auth",partialize:t=>({user:t.user,accessToken:t.accessToken,isAuthenticated:t.isAuthenticated})}));function Os(){const[t,s]=a.useState(null),[r,y]=a.useState(!1);a.useEffect(()=>{const m=C=>{C.preventDefault(),s(C),localStorage.getItem("pwa-install-dismissed")||y(!0)};return window.addEventListener("beforeinstallprompt",m),()=>{window.removeEventListener("beforeinstallprompt",m)}},[]);const l=async()=>{if(!t)return;await t.prompt();const{outcome:m}=await t.userChoice;console.log(m==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),s(null),y(!1)},w=()=>{y(!1);const m=Date.now()+720*60*60*1e3;localStorage.setItem("pwa-install-dismissed",m.toString())};return!r||!t?null:e.jsxs("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-purple-200 dark:border-purple-700 p-6 z-50 animate-slide-up",role:"dialog","aria-labelledby":"pwa-install-title","aria-describedby":"pwa-install-description",children:[e.jsx("button",{onClick:w,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition","aria-label":"Dismiss install prompt",children:e.jsx(Z,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center",children:e.jsx(ye,{className:"h-6 w-6 text-purple-600 dark:text-purple-400","aria-hidden":"true"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{id:"pwa-install-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-1",children:"Install Rowly App"}),e.jsx("p",{id:"pwa-install-description",className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Install Rowly on your device for quick access and offline use!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2 bg-purple-600 dark:bg-purple-700 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition font-medium","aria-label":"Install Rowly app",children:"Install"}),e.jsx("button",{onClick:w,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition","aria-label":"Dismiss for now",children:"Not now"})]})]})]})]})}function Us(){const[t,s]=a.useState(navigator.onLine),[r,y]=a.useState(!1);return a.useEffect(()=>{const l=()=>{s(!0),y(!0),setTimeout(()=>y(!1),3e3)},w=()=>{s(!1),y(!0)};return window.addEventListener("online",l),window.addEventListener("offline",w),()=>{window.removeEventListener("online",l),window.removeEventListener("offline",w)}},[]),!r&&t?null:e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ${r?"translate-y-0":"-translate-y-full"}`,role:"status","aria-live":"polite","aria-atomic":"true",children:e.jsx("div",{className:`px-4 py-3 text-center text-white font-medium ${t?"bg-green-600":"bg-orange-600"}`,children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-5 w-5","aria-hidden":"true"}),e.jsx("span",{children:"Back online! Your changes will sync automatically."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"h-5 w-5","aria-hidden":"true"}),e.jsx("span",{children:"You're offline. Changes will sync when you reconnect."})]})})})})}function Ys(){const[t,s]=a.useState(!1),[r,y]=a.useState(""),[l,w]=a.useState([]),[m,C]=a.useState(!1),p=a.useRef(null),u=fe();a.useEffect(()=>{const h=g=>{(g.metaKey||g.ctrlKey)&&g.key==="k"&&(g.preventDefault(),s(!0)),g.key==="Escape"&&s(!1)};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[]),a.useEffect(()=>{t&&p.current&&p.current.focus()},[t]),a.useEffect(()=>{if(!r.trim()){w([]);return}const h=setTimeout(async()=>{await v(r)},300);return()=>clearTimeout(h)},[r]);const v=async h=>{C(!0);try{const[g,N,F,i,j]=await Promise.all([S.get(`/api/projects?search=${encodeURIComponent(h)}`).catch(()=>({data:{data:{projects:[]}}})),S.get(`/api/patterns?search=${encodeURIComponent(h)}`).catch(()=>({data:{data:{patterns:[]}}})),S.get(`/api/yarn?search=${encodeURIComponent(h)}`).catch(()=>({data:{data:{yarn:[]}}})),S.get(`/api/recipients?search=${encodeURIComponent(h)}`).catch(()=>({data:{data:{recipients:[]}}})),S.get(`/api/tools?search=${encodeURIComponent(h)}`).catch(()=>({data:{data:{tools:[]}}}))]),E=[];g.data.data.projects?.slice(0,5).forEach(_=>{E.push({id:_.id,type:"project",title:_.name,subtitle:_.description||_.status,url:`/projects/${_.id}`})}),N.data.data.patterns?.slice(0,3).forEach(_=>{E.push({id:_.id,type:"pattern",title:_.name,subtitle:_.designer||_.pattern_type,url:"/patterns"})}),F.data.data.yarn?.slice(0,3).forEach(_=>{E.push({id:_.id,type:"yarn",title:`${_.brand} ${_.name}`,subtitle:`${_.color_name||""} - ${_.weight||""}`,url:"/yarn"})}),i.data.data.recipients?.slice(0,2).forEach(_=>{E.push({id:_.id,type:"recipient",title:_.name,subtitle:_.relationship,url:"/recipients"})}),j.data.data.tools?.slice(0,2).forEach(_=>{E.push({id:_.id,type:"tool",title:_.name,subtitle:_.tool_type,url:"/tools"})}),w(E)}catch(g){console.error("Search error:",g),k.error("Search failed")}finally{C(!1)}},o=h=>{u(h.url),s(!1),y("")},c=h=>{switch(h){case"project":return"bg-purple-100 text-purple-800";case"pattern":return"bg-blue-100 text-blue-800";case"yarn":return"bg-pink-100 text-pink-800";case"recipient":return"bg-green-100 text-green-800";case"tool":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20 px-4",role:"dialog","aria-modal":"true","aria-label":"Global search",onClick:h=>{h.target===h.currentTarget&&(s(!1),y(""))},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[60vh] flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}),e.jsx("input",{ref:p,type:"text",value:r,onChange:h=>y(h.target.value),placeholder:"Search projects, patterns, yarn, and more...",className:"flex-1 outline-none text-lg bg-transparent text-gray-900 dark:text-gray-100","aria-label":"Search input",autoComplete:"off"}),e.jsx("button",{onClick:()=>{s(!1),y("")},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Close search",children:e.jsx(Z,{className:"h-5 w-5","aria-hidden":"true"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",role:"region","aria-live":"polite","aria-label":"Search results",children:[m&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",role:"status",children:"Searching..."}),!m&&r&&l.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",role:"status",children:"No results found"}),!m&&l.length>0&&e.jsx("div",{className:"space-y-1",role:"list",children:l.map(h=>e.jsxs("button",{onClick:()=>o(h),className:"w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition flex items-center justify-between",role:"listitem","aria-label":`${h.type}: ${h.title}${h.subtitle?` - ${h.subtitle}`:""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:h.title}),h.subtitle&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.subtitle})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${c(h.type)}`,children:h.type})]},`${h.type}-${h.id}`))}),!m&&!r&&e.jsxs("div",{className:"py-8 text-center text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"mb-2",children:"Start typing to search"}),e.jsx("p",{className:"text-sm",children:"Projects, patterns, yarn, recipients, and tools"})]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between",children:[e.jsx("span",{children:"Press ESC to close"}),e.jsx("span",{children:"⌘K to open"})]})]})}):e.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition","aria-label":"Open global search",title:"Search (⌘K)",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"}),e.jsx("kbd",{className:"hidden sm:inline-block px-2 py-0.5 text-xs font-semibold text-gray-500 bg-gray-200 border border-gray-300 rounded",children:"⌘K"})]})}const it=qt()(Vt(t=>({theme:"light",toggleTheme:()=>{t(s=>{const r=s.theme==="light"?"dark":"light";return Ne(r),{theme:r}})},setTheme:s=>{Ne(s),t({theme:s})}}),{name:"rowly-theme",onRehydrateStorage:()=>t=>{t?.theme&&Ne(t.theme)}}));function Ne(t){if(typeof window>"u"||typeof document>"u")return;const s=document.documentElement;s&&(t==="dark"?s.classList.add("dark"):s.classList.remove("dark"))}if(typeof window<"u"&&typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{const{theme:t}=it.getState();Ne(t)});else{const{theme:t}=it.getState();Ne(t)}function pr(){const{theme:t,toggleTheme:s}=it();return e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200","aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,title:`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx(ls,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}):e.jsx(os,{className:"w-5 h-5 text-yellow-500"})})}const qs="modulepreload",Vs=function(t){return"/"+t},Et={},Hs=function(s,r,y){let l=Promise.resolve();if(r&&r.length>0){let p=function(u){return Promise.all(u.map(v=>Promise.resolve(v).then(o=>({status:"fulfilled",value:o}),o=>({status:"rejected",reason:o}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),C=m?.nonce||m?.getAttribute("nonce");l=p(r.map(u=>{if(u=Vs(u),u in Et)return;Et[u]=!0;const v=u.endsWith(".css"),o=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${o}`))return;const c=document.createElement("link");if(c.rel=v?"stylesheet":qs,v||(c.as="script"),c.crossOrigin="",c.href=u,C&&c.setAttribute("nonce",C),document.head.appendChild(c),v)return new Promise((h,g)=>{c.addEventListener("load",h),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function w(m){const C=new Event("vite:preloadError",{cancelable:!0});if(C.payload=m,window.dispatchEvent(C),!C.defaultPrevented)throw m}return l.then(m=>{for(const C of m||[])C.status==="rejected"&&w(C.reason);return s().catch(w)})},dt=(t,s)=>s.some(r=>t instanceof r);let $t,Mt;function Ws(){return $t||($t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ks(){return Mt||(Mt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ct=new WeakMap,Je=new WeakMap,ze=new WeakMap;function Gs(t){const s=new Promise((r,y)=>{const l=()=>{t.removeEventListener("success",w),t.removeEventListener("error",m)},w=()=>{r(ie(t.result)),l()},m=()=>{y(t.error),l()};t.addEventListener("success",w),t.addEventListener("error",m)});return ze.set(s,t),s}function Qs(t){if(ct.has(t))return;const s=new Promise((r,y)=>{const l=()=>{t.removeEventListener("complete",w),t.removeEventListener("error",m),t.removeEventListener("abort",m)},w=()=>{r(),l()},m=()=>{y(t.error||new DOMException("AbortError","AbortError")),l()};t.addEventListener("complete",w),t.addEventListener("error",m),t.addEventListener("abort",m)});ct.set(t,s)}let ut={get(t,s,r){if(t instanceof IDBTransaction){if(s==="done")return ct.get(t);if(s==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ie(t[s])},set(t,s,r){return t[s]=r,!0},has(t,s){return t instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in t}};function hr(t){ut=t(ut)}function Xs(t){return Ks().includes(t)?function(...s){return t.apply(xt(this),s),ie(this.request)}:function(...s){return ie(t.apply(xt(this),s))}}function Zs(t){return typeof t=="function"?Xs(t):(t instanceof IDBTransaction&&Qs(t),dt(t,Ws())?new Proxy(t,ut):t)}function ie(t){if(t instanceof IDBRequest)return Gs(t);if(Je.has(t))return Je.get(t);const s=Zs(t);return s!==t&&(Je.set(t,s),ze.set(s,t)),s}const xt=t=>ze.get(t);function Js(t,s,{blocked:r,upgrade:y,blocking:l,terminated:w}={}){const m=indexedDB.open(t,s),C=ie(m);return y&&m.addEventListener("upgradeneeded",p=>{y(ie(m.result),p.oldVersion,p.newVersion,ie(m.transaction),p)}),r&&m.addEventListener("blocked",p=>r(p.oldVersion,p.newVersion,p)),C.then(p=>{w&&p.addEventListener("close",()=>w()),l&&p.addEventListener("versionchange",u=>l(u.oldVersion,u.newVersion,u))}).catch(()=>{}),C}const ea=["get","getKey","getAll","getAllKeys","count"],ta=["put","add","delete","clear"],et=new Map;function Rt(t,s){if(!(t instanceof IDBDatabase&&!(s in t)&&typeof s=="string"))return;if(et.get(s))return et.get(s);const r=s.replace(/FromIndex$/,""),y=s!==r,l=ta.includes(r);if(!(r in(y?IDBIndex:IDBObjectStore).prototype)||!(l||ea.includes(r)))return;const w=async function(m,...C){const p=this.transaction(m,l?"readwrite":"readonly");let u=p.store;return y&&(u=u.index(C.shift())),(await Promise.all([u[r](...C),l&&p.done]))[0]};return et.set(s,w),w}hr(t=>({...t,get:(s,r,y)=>Rt(s,r)||t.get(s,r,y),has:(s,r)=>!!Rt(s,r)||t.has(s,r)}));const ra=["continue","continuePrimaryKey","advance"],Tt={},gt=new WeakMap,br=new WeakMap,sa={get(t,s){if(!ra.includes(s))return t[s];let r=Tt[s];return r||(r=Tt[s]=function(...y){gt.set(this,br.get(this)[s](...y))}),r}};async function*aa(...t){let s=this;if(s instanceof IDBCursor||(s=await s.openCursor(...t)),!s)return;s=s;const r=new Proxy(s,sa);for(br.set(r,s),ze.set(r,xt(s));s;)yield r,s=await(gt.get(r)||s.continue()),gt.delete(r)}function At(t,s){return s===Symbol.asyncIterator&&dt(t,[IDBIndex,IDBObjectStore,IDBCursor])||s==="iterate"&&dt(t,[IDBIndex,IDBObjectStore])}hr(t=>({...t,get(s,r,y){return At(s,r)?aa:t.get(s,r,y)},has(s,r){return At(s,r)||t.has(s,r)}}));const na="rowly-offline",la=1;let me=null;const yr=async()=>me||(me=await Js(na,la,{upgrade(t,s,r,y){if(t.objectStoreNames.contains("patterns")||t.createObjectStore("patterns",{keyPath:"id"}),t.objectStoreNames.contains("pdf-cache")||t.createObjectStore("pdf-cache",{keyPath:"patternId"}),!t.objectStoreNames.contains("counters")){const l=t.createObjectStore("counters",{keyPath:"id"});l.createIndex("project_id","project_id"),l.createIndex("synced","synced")}if(!t.objectStoreNames.contains("sync-queue")){const l=t.createObjectStore("sync-queue",{keyPath:"id",autoIncrement:!0});l.createIndex("synced","synced"),l.createIndex("timestamp","timestamp")}if(t.objectStoreNames.contains("projects")||t.createObjectStore("projects",{keyPath:"id"}),!t.objectStoreNames.contains("sessions")){const l=t.createObjectStore("sessions",{keyPath:"id"});l.createIndex("project_id","project_id"),l.createIndex("synced","synced")}if(!t.objectStoreNames.contains("notes")){const l=t.createObjectStore("notes",{keyPath:"id"});l.createIndex("type","type"),l.createIndex("synced","synced")}}}),me),V=async()=>me||yr(),oa=async t=>{await(await V()).put("patterns",{id:t.id,name:t.name,file_url:t.file_url,data:t,cached_at:new Date().toISOString()})},ia=async t=>(await V()).get("patterns",t),da=async()=>(await V()).getAll("patterns"),ca=async(t,s)=>{await(await V()).put("pdf-cache",{patternId:t,blob:s,cached_at:new Date().toISOString()})},ua=async t=>(await V()).get("pdf-cache",t),xa=async(t,s=!0)=>{await(await V()).put("counters",{id:t.id,project_id:t.project_id,value:t.current_value,updated_at:Date.now(),synced:s})},ga=async t=>(await V()).get("counters",t),ma=async t=>(await V()).transaction("counters").store.index("project_id").getAll(t),pa=async t=>{await(await V()).add("sync-queue",{...t,timestamp:Date.now(),synced:!1,retries:0})},Me=async()=>(await V()).getAll("sync-queue"),fr=async()=>(await V()).transaction("sync-queue").store.index("synced").getAll(!1),jr=async t=>{const s=await V(),r=await s.get("sync-queue",t);r&&await s.put("sync-queue",{...r,synced:!0})},vr=async t=>{const s=await V(),r=await s.get("sync-queue",t);r&&await s.put("sync-queue",{...r,retries:r.retries+1})},wr=async t=>{await(await V()).delete("sync-queue",t)},ha=async t=>{await(await V()).put("projects",{id:t.id,data:t,cached_at:new Date().toISOString()})},ba=async t=>(await V()).get("projects",t),ya=async(t,s=!0)=>{await(await V()).put("sessions",{id:t.id,project_id:t.project_id,data:t,cached_at:new Date().toISOString(),synced:s})},fa=async t=>(await V()).get("sessions",t),ja=async t=>(await(await V()).transaction("sessions").store.index("project_id").getAll(t)).map(l=>l.data),va=async(t,s,r=!0)=>{await(await V()).put("notes",{id:t.id,type:s,data:t,cached_at:new Date().toISOString(),synced:r})},wa=async t=>(await V()).get("notes",t),Na=async()=>(await V()).transaction("notes").store.index("synced").getAll(!1),ka=async()=>{const t=await V(),s=["patterns","pdf-cache","counters","projects","sessions","notes"];for(const r of s)await t.clear(r)},Ca=async()=>"storage"in navigator&&"estimate"in navigator.storage&&(await navigator.storage.estimate()).usage||0,Sa=Object.freeze(Object.defineProperty({__proto__:null,addToSyncQueue:pa,cacheCounter:xa,cacheNote:va,cachePDF:ca,cachePattern:oa,cacheProject:ha,cacheSession:ya,clearCache:ka,deleteSyncItem:wr,getAllCachedPatterns:da,getCacheSize:Ca,getCounterFromCache:ga,getDB:V,getNoteFromCache:wa,getPDFFromCache:ua,getPatternFromCache:ia,getProjectCountersFromCache:ma,getProjectFromCache:ba,getProjectSessionsFromCache:ja,getSessionFromCache:fa,getSyncQueue:Me,getUnsyncedItems:fr,getUnsyncedNotes:Na,incrementSyncRetry:vr,initDB:yr,markSyncItemComplete:jr},Symbol.toStringTag,{value:"Module"})),tt=3,Fa=2e3;class Pa{isSyncing=!1;syncListeners=new Set;constructor(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline())}onSyncStatusChange(s){return this.syncListeners.add(s),()=>this.syncListeners.delete(s)}notifyListeners(s){this.syncListeners.forEach(r=>r(s))}async getSyncStatus(){const r=(await Me()).filter(l=>!l.synced),y=r.filter(l=>l.retries>=tt);return{isSyncing:this.isSyncing,pendingCount:r.length,failedCount:y.length,lastSyncTime:void 0}}async handleOnline(){console.log("Device is online, starting sync..."),await this.processSyncQueue()}handleOffline(){console.log("Device is offline"),this.isSyncing=!1}async processSyncQueue(){if(this.isSyncing){console.log("Sync already in progress");return}if(!navigator.onLine){console.log("Device is offline, skipping sync");return}this.isSyncing=!0,this.notifyListeners(await this.getSyncStatus());try{const s=await fr();console.log(`Processing ${s.length} unsynced items`);for(const r of s){if(r.retries>=tt){console.error(`Item ${r.id} has exceeded max retries, skipping`);continue}try{await this.syncItem(r),await jr(r.id),console.log(`Successfully synced item ${r.id}`)}catch(y){console.error(`Failed to sync item ${r.id}:`,y),await vr(r.id);const l=Fa*Math.pow(2,r.retries);await this.sleep(l)}}this.notifyListeners(await this.getSyncStatus())}catch(s){console.error("Error processing sync queue:",s)}finally{this.isSyncing=!1}}async syncItem(s){const r={method:s.method,url:s.endpoint,data:s.data,headers:{"Content-Type":"application/json"}};await S(r)}async sync(){return this.processSyncQueue()}async clearQueue(){const s=await Me();for(const r of s)r.id&&await wr(r.id);this.notifyListeners(await this.getSyncStatus())}async getFailedItems(){return(await Me()).filter(r=>!r.synced&&r.retries>=tt)}async retryFailed(){const s=await this.getFailedItems();for(const r of s)r.id&&await(await Hs(()=>Promise.resolve().then(()=>Sa),void 0).then(l=>l.getDB())).put("sync-queue",{...r,retries:0});await this.processSyncQueue()}sleep(s){return new Promise(r=>setTimeout(r,s))}}const we=new Pa,_a=()=>{const[t,s]=a.useState(navigator.onLine),[r,y]=a.useState({isSyncing:!1,pendingCount:0,failedCount:0}),[l,w]=a.useState(!1),[m,C]=a.useState([]);Re.useEffect(()=>{const g=()=>s(!0),N=()=>s(!1);return window.addEventListener("online",g),window.addEventListener("offline",N),()=>{window.removeEventListener("online",g),window.removeEventListener("offline",N)}},[]),Re.useEffect(()=>{const g=we.onSyncStatusChange(N=>{y(N)});return we.getSyncStatus().then(y),()=>{typeof g=="function"&&g()}},[]);const p=async()=>{try{await we.sync()}catch(g){console.error("Manual sync failed:",g)}},u=async()=>{try{await we.retryFailed(),w(!1)}catch(g){console.error("Retry failed:",g)}},v=async()=>{w(!0);const g=await we.getFailedItems();C(g)},o=()=>t?r.failedCount>0?"text-red-600":r.pendingCount>0?"text-yellow-600":"text-green-600":"text-gray-500",c=()=>t?r.isSyncing?e.jsx(mt,{className:"w-5 h-5 animate-spin"}):r.failedCount>0?e.jsx(de,{className:"w-5 h-5"}):r.pendingCount>0?e.jsx(ds,{className:"w-5 h-5"}):e.jsx(Te,{className:"w-5 h-5"}):e.jsx(is,{className:"w-5 h-5"}),h=()=>t?r.isSyncing?"Syncing...":r.failedCount>0?`${r.failedCount} failed`:r.pendingCount>0?`${r.pendingCount} pending`:"Synced":"Offline";return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:t?p:void 0,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${t?"hover:bg-gray-100 dark:hover:bg-gray-700":"cursor-not-allowed opacity-70"}`,title:t?"Click to sync now":"Device is offline",children:[e.jsx("span",{className:o(),children:c()}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:h()})]}),r.failedCount>0&&e.jsx("button",{onClick:v,className:"text-xs text-red-600 hover:text-red-700 dark:text-red-400 underline ml-2",children:"View failed items"}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(de,{className:"w-6 h-6 text-red-600"}),"Sync Conflicts"]}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(Z,{className:"w-6 h-6"})})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["The following changes could not be synced after ",3," attempts. You can retry syncing or resolve them manually."]}),m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Te,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No failed items"})]}):e.jsx("div",{className:"space-y-3 mb-6",children:m.map((g,N)=>e.jsxs("div",{className:"border border-red-200 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:g.type}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[g.method," ",g.endpoint]})]}),e.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400",children:[g.retries," retries"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Timestamp: ",new Date(g.timestamp).toLocaleString()]})]},g.id||N))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Close"}),e.jsx("button",{onClick:u,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Retry All"})]})]})})]})},Da=({conflicts:t,onResolve:s,onResolveAll:r})=>{const[y,l]=a.useState(null),[w,m]=a.useState(null);if(t.length===0)return null;const C=async(c,h)=>{m(c);try{await s(c,h)}catch(g){console.error("Failed to resolve conflict:",g),alert("Failed to resolve conflict")}finally{m(null)}},p=async c=>{if(confirm(`Are you sure you want to use ${c==="local"?"local":"server"} version for all conflicts?`))try{await r(c)}catch(h){console.error("Failed to resolve all conflicts:",h),alert("Failed to resolve conflicts")}},u=c=>{l(y===c?null:c)},v=c=>typeof c=="object"?JSON.stringify(c,null,2):String(c),o=c=>{switch(c){case"counter":return"Counter";case"session":return"Session";case"note":return"Note";case"project":return"Project";default:return c}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-2 border-orange-500",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(at,{className:"w-6 h-6 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Sync Conflicts Detected"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:[t.length," conflict",t.length!==1?"s":""," found between your local changes and the server. Please review and resolve each conflict."]}),e.jsxs("div",{className:"flex gap-3 mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("button",{onClick:()=>p("local"),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"Use Local for All"}),e.jsx("button",{onClick:()=>p("server"),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors text-sm",children:"Use Server for All"})]}),e.jsx("div",{className:"space-y-3",children:t.map(c=>{const h=y===c.id,g=w===c.id;return e.jsxs("div",{className:"border border-orange-200 dark:border-orange-800 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>u(c.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 text-left",children:[e.jsx(at,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[o(c.resourceType)," - ",c.field]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",c.resourceId.slice(0,8),"..."]})]})]}),h?e.jsx(cs,{className:"w-5 h-5 text-gray-400"}):e.jsx(Ht,{className:"w-5 h-5 text-gray-400"})]}),h&&e.jsxs("div",{className:"px-4 py-4 bg-orange-50 dark:bg-orange-900/20 border-t border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Your Local Version"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-800",children:e.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap",children:v(c.localValue)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Server Version"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700",children:e.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap",children:v(c.serverValue)})})]})]}),c.lastSyncedValue&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Last Synced Value (for reference)"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700",children:e.jsx("pre",{className:"text-xs text-gray-500 dark:text-gray-400 overflow-x-auto whitespace-pre-wrap",children:v(c.lastSyncedValue)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>C(c.id,"local"),disabled:g,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:g?"Resolving...":"Use Local"}),e.jsx("button",{onClick:()=>C(c.id,"server"),disabled:g,className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:g?"Resolving...":"Use Server"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:["Conflict detected at:"," ",new Date(c.timestamp).toLocaleString()]})]})]},c.id)})})]})};function Ea(){const{user:t,logout:s}=je(),r=fe(),y=us(),[l,w]=a.useState([]),m=async()=>{await s(),r("/login")},C=async(o,c)=>{w(h=>h.filter(g=>g.id!==o)),console.log(`Resolved conflict ${o} with ${c}`)},p=async o=>{w([]),console.log(`Resolved all conflicts with ${o}`)},u=[{name:"Dashboard",href:"/dashboard",icon:xs,shortName:"Home"},{name:"Stats",href:"/stats",icon:gs,shortName:"Stats"},{name:"Projects",href:"/projects",icon:oe,shortName:"Projects"},{name:"Patterns",href:"/patterns",icon:pe,shortName:"Patterns"},{name:"Yarn Stash",href:"/yarn",icon:ge,shortName:"Stash"},{name:"Tools",href:"/tools",icon:pt,shortName:"Tools"},{name:"Recipients",href:"/recipients",icon:Ae,shortName:"Recipients"}],v=u.slice(0,5);return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200 pb-20 md:pb-0",children:[e.jsx("aside",{className:"hidden md:fixed md:inset-y-0 md:left-0 md:w-64 md:block bg-white dark:bg-gray-800 shadow-lg transition-colors duration-200",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 h-16 bg-purple-600 dark:bg-purple-700",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Rowly"}),e.jsx(pr,{})]}),e.jsx("div",{className:"px-4 py-3",children:e.jsx(Ys,{})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-4","aria-label":"Main navigation",children:u.map(o=>{const c=o.icon,h=y.pathname===o.href;return e.jsxs(W,{to:o.href,className:`flex items-center px-6 py-3 text-sm font-medium transition ${h?"bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 border-r-4 border-purple-600 dark:border-purple-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-purple-600 dark:hover:text-purple-400"}`,"aria-label":o.name,"aria-current":h?"page":void 0,children:[e.jsx(c,{className:"mr-3 h-5 w-5","aria-hidden":"true"}),o.name]},o.name)})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"h-10 w-10 rounded-full bg-purple-600 dark:bg-purple-700 flex items-center justify-center text-white font-semibold",children:[t?.firstName?.[0],t?.lastName?.[0]]})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:[t?.firstName," ",t?.lastName]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t?.email})]})]}),e.jsxs(W,{to:"/profile",className:"flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg mb-2 transition",children:[e.jsx(Wt,{className:"mr-2 h-4 w-4"}),"Profile"]}),e.jsxs("button",{onClick:m,className:"w-full flex items-center px-3 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 md:hidden z-40","aria-label":"Main navigation",children:e.jsx("div",{className:"flex justify-around items-center h-20",children:v.map(o=>{const c=o.icon,h=y.pathname===o.href;return e.jsxs(W,{to:o.href,className:`flex flex-col items-center justify-center flex-1 h-full min-w-0 ${h?"text-purple-600 dark:text-purple-400":"text-gray-600 dark:text-gray-400"}`,"aria-label":o.name,"aria-current":h?"page":void 0,children:[e.jsx(c,{className:"h-7 w-7 mb-1","aria-hidden":"true"}),e.jsx("span",{className:"text-xs font-medium truncate",children:o.shortName})]},o.name)})})}),e.jsxs("div",{className:"md:ml-64",children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(_a,{})}),l.length>0&&e.jsx("div",{className:"p-4 md:p-6 lg:p-8 pb-0",children:e.jsx(Da,{conflicts:l,onResolve:C,onResolveAll:p})}),e.jsx("main",{className:"p-4 md:p-6 lg:p-8",children:e.jsx(Kt,{})})]})]})}function $a(){return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center transition-colors duration-200",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(pr,{})}),e.jsx("div",{className:"max-w-md w-full px-4",children:e.jsx(Kt,{})})]})}function Ma(){const{user:t}=je(),[s,r]=a.useState([{name:"Active Projects",value:"0",icon:oe,href:"/projects",color:"bg-purple-500"},{name:"Patterns",value:"0",icon:pe,href:"/patterns",color:"bg-blue-500"},{name:"Yarn Skeins",value:"0",icon:ge,href:"/yarn",color:"bg-green-500"},{name:"Recipients",value:"0",icon:Ae,href:"/recipients",color:"bg-orange-500"}]),[y,l]=a.useState(!0),[w,m]=a.useState([]),[C,p]=a.useState([]);a.useEffect(()=>{u()},[]);const u=async()=>{try{const[o,c,h,g,N,F]=await Promise.all([S.get("/api/projects/stats"),S.get("/api/patterns/stats"),S.get("/api/yarn/stats"),S.get("/api/recipients/stats"),S.get("/api/projects?limit=5"),S.get("/api/yarn")]);r([{name:"Active Projects",value:String(o.data.data.stats.active_count||0),icon:oe,href:"/projects",color:"bg-purple-500"},{name:"Patterns",value:String(c.data.data.stats.total_count||0),icon:pe,href:"/patterns",color:"bg-blue-500"},{name:"Yarn Skeins",value:String(h.data.data.stats.total_skeins||0),icon:ge,href:"/yarn",color:"bg-green-500"},{name:"Recipients",value:String(g.data.data.stats.total_count||0),icon:Ae,href:"/recipients",color:"bg-orange-500"}]),m(N.data.data.projects||[]);const j=(F.data.data.yarn||[]).filter(E=>!E.low_stock_alert||!E.low_stock_threshold?!1:(E.quantity_remaining||E.skeins||0)<=E.low_stock_threshold);p(j)}catch(o){console.error("Error fetching dashboard data:",o)}finally{l(!1)}},v=[{name:"New Project",description:"Start tracking a new knitting project",href:"/projects",icon:oe,color:"text-purple-600 bg-purple-50 hover:bg-purple-100"},{name:"Add Pattern",description:"Save a new knitting pattern",href:"/patterns",icon:pe,color:"text-blue-600 bg-blue-50 hover:bg-blue-100"},{name:"Add Yarn",description:"Add yarn to your stash",href:"/yarn",icon:ge,color:"text-green-600 bg-green-50 hover:bg-green-100"}];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Welcome back, ",t?.firstName,"!"]}),e.jsx("p",{className:"text-gray-600",children:"Here's what's happening with your knitting projects today."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:y?e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading statistics..."})}):s.map(o=>{const c=o.icon;return e.jsx(W,{to:o.href,className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:o.name}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:o.value})]}),e.jsx("div",{className:`${o.color} p-3 rounded-lg`,children:e.jsx(c,{className:"h-6 w-6 text-white"})})]})},o.name)})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:v.map(o=>{const c=o.icon;return e.jsx(W,{to:o.href,className:`${o.color} rounded-lg p-6 transition`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(c,{className:"h-6 w-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:o.name}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:o.description})]})]})},o.name)})})]}),!y&&C.length>0&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-500 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-start mb-4",children:[e.jsx(de,{className:"h-6 w-6 text-orange-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-orange-900 mb-1",children:"Low Stock Alerts"}),e.jsx("p",{className:"text-sm text-orange-700",children:"The following yarn items are running low and need restocking:"})]})]}),e.jsx("div",{className:"space-y-3",children:C.map(o=>{const c=o.quantity_remaining||o.skeins||0,h=o.low_stock_threshold||0,g=h>0?c/h*100:0;return e.jsx(W,{to:"/yarn",className:"flex items-center justify-between p-4 bg-white rounded-lg hover:shadow-md transition",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[o.brand," ",o.name]}),e.jsxs("span",{className:"text-sm font-medium text-orange-600",children:[c," / ",h," ",o.unit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all",style:{width:`${Math.min(100,g)}%`}})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),o.color&&e.jsxs("span",{className:"mr-3",children:["Color: ",o.color]}),o.weight&&e.jsxs("span",{children:["Weight: ",o.weight]})]})]})},o.id)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-orange-200",children:e.jsxs(W,{to:"/yarn",className:"text-sm font-medium text-orange-700 hover:text-orange-800 flex items-center",children:["View all yarn in stash",e.jsx("span",{className:"ml-2",children:"→"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Recent Projects"}),y?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Loading recent projects..."})}):w.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No projects yet"}),e.jsxs(W,{to:"/projects",className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Create Your First Project"]})]}):e.jsx("div",{className:"space-y-4",children:w.map(o=>e.jsxs(W,{to:`/projects/${o.id}`,className:"flex items-center justify-between p-4 hover:bg-gray-50 rounded-lg transition",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(oe,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[o.type&&e.jsx("span",{className:"capitalize",children:o.type}),o.status&&e.jsx("span",{className:"ml-2 capitalize",children:o.status})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(o.created_at).toLocaleDateString()})]},o.id))})]})]})}function Ra(){const[t,s]=a.useState([]),[r,y]=a.useState(!0),[l,w]=a.useState(!1),[m,C]=a.useState({name:"",description:"",projectType:"sweater",startDate:new Date().toISOString().split("T")[0],targetCompletionDate:""});a.useEffect(()=>{p()},[]);const p=async()=>{try{const h=await S.get("/api/projects");s(h.data.data.projects)}catch(h){console.error("Error fetching projects:",h),k.error("Failed to load projects")}finally{y(!1)}},u=async h=>{h.preventDefault();try{await S.post("/api/projects",m),k.success("Project created successfully!"),w(!1),C({name:"",description:"",projectType:"sweater",startDate:new Date().toISOString().split("T")[0],targetCompletionDate:""}),p()}catch(g){console.error("Error creating project:",g),k.error(g.response?.data?.message||"Failed to create project")}},v=async(h,g)=>{if(confirm(`Are you sure you want to delete "${g}"?`))try{await S.delete(`/api/projects/${h}`),k.success("Project deleted successfully"),p()}catch(N){console.error("Error deleting project:",N),k.error("Failed to delete project")}},o=h=>{switch(h){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paused":return"bg-yellow-100 text-yellow-800";case"planned":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},c=h=>h?new Date(h).toLocaleDateString():"Not set";return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading projects..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Projects"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your knitting projects"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"New Project"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(ee,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No projects yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking your knitting projects"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Create Your First Project"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(h=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:h.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${o(h.status)}`,children:h.status||"active"})]}),h.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:h.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[h.project_type&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",h.project_type]}),h.start_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Gt,{className:"mr-2 h-4 w-4"}),"Started: ",c(h.start_date)]}),h.target_completion_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Due: ",c(h.target_completion_date)]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsx(W,{to:`/projects/${h.id}`,className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition text-center text-sm font-medium",children:"View Details"}),e.jsx("button",{onClick:()=>v(h.id,h.name),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition",title:"Delete project",children:e.jsx(X,{className:"h-4 w-4"})})]})]},h.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Project"})}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name *"}),e.jsx("input",{type:"text",value:m.name,onChange:h=>C({...m,name:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Cozy Winter Sweater",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:m.description,onChange:h=>C({...m,description:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Describe your project..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Type"}),e.jsxs("select",{value:m.projectType,onChange:h=>C({...m,projectType:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:m.startDate,onChange:h=>C({...m,startDate:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Completion"}),e.jsx("input",{type:"date",value:m.targetCompletionDate,onChange:h=>C({...m,targetCompletionDate:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Create Project"})]})]})]})})]})}function Ta({photos:t,onDelete:s}){const[r,y]=a.useState(null),[l,w]=a.useState(1),m=N=>{y(N),w(1)},C=()=>{y(null),w(1)},p=()=>{r!==null&&r>0&&(y(r-1),w(1))},u=()=>{r!==null&&r<t.length-1&&(y(r+1),w(1))},v=N=>{const F=document.createElement("a");F.href=N.file_path,F.download=N.filename,document.body.appendChild(F),F.click(),document.body.removeChild(F)},o=()=>{w(N=>Math.min(N+.25,3))},c=()=>{w(N=>Math.max(N-.25,.5))},h=N=>{if(r!==null)switch(N.key){case"Escape":C();break;case"ArrowLeft":p();break;case"ArrowRight":u();break;case"+":case"=":o();break;case"-":case"_":c();break}};if(t.length===0)return e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"No photos yet. Upload your first photo!"})});const g=r!==null?t[r]:null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map((N,F)=>e.jsxs("div",{className:"relative group cursor-pointer aspect-square overflow-hidden rounded-lg bg-gray-100",onClick:()=>m(F),children:[e.jsx("img",{src:N.thumbnail_path,alt:N.caption||`Photo ${F+1}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center",children:e.jsx(nt,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity h-8 w-8"})}),s&&e.jsx("button",{onClick:i=>{i.stopPropagation(),confirm("Are you sure you want to delete this photo?")&&s(N.id)},className:"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700",children:e.jsx(X,{className:"h-4 w-4"})})]},N.id))}),g&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center",onClick:C,onKeyDown:h,tabIndex:0,children:[e.jsx("button",{onClick:C,className:"absolute top-4 right-4 p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10","aria-label":"Close",children:e.jsx(Z,{className:"h-8 w-8"})}),r>0&&e.jsx("button",{onClick:N=>{N.stopPropagation(),p()},className:"absolute left-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10","aria-label":"Previous",children:e.jsx(Qt,{className:"h-8 w-8"})}),r<t.length-1&&e.jsx("button",{onClick:N=>{N.stopPropagation(),u()},className:"absolute right-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10","aria-label":"Next",children:e.jsx(be,{className:"h-8 w-8"})}),e.jsx("div",{className:"relative max-w-7xl max-h-full p-4 flex items-center justify-center",onClick:N=>N.stopPropagation(),children:e.jsx("img",{src:g.file_path,alt:g.caption||"Photo",className:"max-w-full max-h-[80vh] object-contain rounded-lg",style:{transform:`scale(${l})`,transition:"transform 0.2s"}})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-4 bg-black bg-opacity-75 px-6 py-3 rounded-full z-10",children:[e.jsx("button",{onClick:N=>{N.stopPropagation(),c()},disabled:l<=.5,className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Zoom out",children:e.jsx(Xt,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-white text-sm font-medium min-w-[60px] text-center",children:[Math.round(l*100),"%"]}),e.jsx("button",{onClick:N=>{N.stopPropagation(),o()},disabled:l>=3,className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Zoom in",children:e.jsx(nt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:N=>{N.stopPropagation(),v(g)},className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition","aria-label":"Download",children:e.jsx(ye,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-white text-sm",children:[r+1," / ",t.length]})]}),g.caption&&e.jsx("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 px-6 py-2 rounded-full max-w-2xl",children:e.jsx("p",{className:"text-white text-sm text-center",children:g.caption})})]})]})}function Aa({onUpload:t,accept:s="image/jpeg,image/jpg,image/png,image/webp",maxSize:r=10}){const[y,l]=a.useState(null),[w,m]=a.useState(null),[C,p]=a.useState(!1),[u,v]=a.useState(!1),o=a.useRef(null),c=j=>{if(!s.split(",").some(b=>j.type.match(b.trim()))){alert(`Invalid file type. Accepted types: ${s}`);return}if(j.size/(1024*1024)>r){alert(`File size exceeds ${r}MB limit`);return}l(j);const _=new FileReader;_.onloadend=()=>{m(_.result)},_.readAsDataURL(j)},h=j=>{const E=j.target.files?.[0];E&&c(E)},g=j=>{j.preventDefault(),j.stopPropagation(),v(!1);const E=j.dataTransfer.files?.[0];E&&c(E)},N=j=>{j.preventDefault(),j.stopPropagation(),j.type==="dragenter"||j.type==="dragover"?v(!0):j.type==="dragleave"&&v(!1)},F=async()=>{if(y){p(!0);try{await t(y),l(null),m(null),o.current&&(o.current.value="")}catch(j){console.error("Upload error:",j)}finally{p(!1)}}},i=()=>{l(null),m(null),o.current&&(o.current.value="")};return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{onDragEnter:N,onDragLeave:N,onDragOver:N,onDrop:g,className:`relative border-2 border-dashed rounded-lg p-6 transition-colors ${u?"border-purple-500 bg-purple-50":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("input",{ref:o,type:"file",accept:s,onChange:h,className:"hidden"}),w?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:w,alt:"Preview",className:"max-w-full max-h-64 mx-auto rounded-lg object-contain"}),e.jsx("button",{type:"button",onClick:i,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition",children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium",children:y?.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((y?.size||0)/1024/1024).toFixed(2)," MB"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:F,disabled:C,className:"flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Uploading...":"Upload Photo"}),e.jsx("button",{type:"button",onClick:i,disabled:C,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50",children:"Cancel"})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(Zt,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>o.current?.click(),className:"text-purple-600 hover:text-purple-700 font-medium",children:"Click to upload"}),e.jsx("span",{className:"text-gray-600",children:" or drag and drop"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["PNG, JPG, or WebP up to ",r,"MB"]})]})]})})}const Lt=["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#EC4899","#6366F1","#14B8A6"],La=[{value:"simple",label:"Simple (+1 each)",description:"Standard counting, +1 per row"},{value:"every_n_garter",label:"Garter Stitch Ridges",description:"+1 every 2 rows (ridge counting)"},{value:"every_n_cable",label:"Cable Repeats",description:"+1 every 4 rows (cable pattern)"},{value:"custom",label:"Custom Pattern",description:"Define your own increment pattern"}];function za({counter:t,parentCounterId:s,existingCounters:r,onSave:y,onCancel:l}){const[w,m]=a.useState(t?.name||""),[C,p]=a.useState(t?.type||"rows"),[u,v]=a.useState(t?.current_value||0),[o,c]=a.useState(t?.target_value||""),[h]=a.useState(t?.increment_by||1),[g,N]=a.useState(t?.min_value||0),[F,i]=a.useState(t?.max_value||""),[j,E]=a.useState(t?.display_color||Lt[0]),[_,b]=a.useState(t?.notes||""),[P,x]=a.useState(t?.increment_pattern?.type||"simple"),[d,n]=a.useState(t?.increment_pattern?.increment||1),[D,R]=a.useState(t?.auto_reset||!1),[$,I]=a.useState(s||t?.parent_counter_id||""),U=$&&r?r.find(M=>M.id===$):null,K=r?.filter(M=>M.id!==t?.id&&!M.parent_counter_id)||[],A=M=>{M.preventDefault();let H;switch(P){case"simple":H={type:"simple"};break;case"every_n":H={type:"every_n",rule:"every_n_rows",n:2,increment:1,description:"Garter stitch ridge counting"};break;case"every_n_cable":H={type:"every_n",rule:"every_n_rows",n:4,increment:1,description:"Cable pattern repeat"};break;case"custom":H={type:"custom_fixed",increment:d,description:`Custom: +${d} per action`};break}const L={name:w,type:C,currentValue:u,targetValue:o?Number(o):void 0,incrementBy:h,minValue:g,maxValue:F?Number(F):void 0,displayColor:j,notes:_,incrementPattern:H,parentCounterId:$||null,autoReset:D};y(L)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t?"Edit Counter":"Create Counter"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(Z,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter Name *"}),e.jsx("input",{type:"text",value:w,onChange:M=>m(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",placeholder:"e.g., Main Row Counter",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter Type"}),e.jsxs("select",{value:C,onChange:M=>p(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"rows",children:"Row Counter"}),e.jsx("option",{value:"stitches",children:"Stitch Counter"}),e.jsx("option",{value:"repeats",children:"Repeat Counter"}),e.jsx("option",{value:"custom",children:"Custom Counter"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Value"}),e.jsx("input",{type:"number",value:u,onChange:M=>v(Number(M.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Value (optional)"}),e.jsx("input",{type:"number",value:o,onChange:M=>c(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",placeholder:"No limit"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Value"}),e.jsx("input",{type:"number",value:g,onChange:M=>N(Number(M.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Value (optional)"}),e.jsx("input",{type:"number",value:F,onChange:M=>i(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",placeholder:"No limit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Increment Pattern"}),e.jsx("div",{className:"space-y-2",children:La.map(M=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"incrementPattern",value:M.value,checked:P===M.value,onChange:H=>x(H.target.value),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:M.label}),e.jsx("div",{className:"text-sm text-gray-500",children:M.description})]})]},M.value))}),P==="custom"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Increment Value"}),e.jsx("input",{type:"number",value:d,onChange:M=>n(Number(M.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",min:"1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter Color"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Lt.map(M=>e.jsx("button",{type:"button",onClick:()=>E(M),className:`w-10 h-10 rounded-lg border-2 transition ${j===M?"border-gray-900 scale-110":"border-gray-200"}`,style:{backgroundColor:M}},M))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:_,onChange:M=>b(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",rows:3,placeholder:"Add any notes or reminders for this counter..."})]}),K.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Parent Counter (optional)"}),e.jsxs("select",{value:$,onChange:M=>I(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"",children:"None (Primary Counter)"}),K.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))]}),$&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:['This counter will update when "',U?.name,'" is incremented in Linked Mode.']})]}),$&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"autoReset",checked:D,onChange:M=>R(M.target.checked),className:"mt-1 h-4 w-4 text-purple-600 rounded focus:ring-purple-500"}),e.jsxs("label",{htmlFor:"autoReset",className:"flex-1",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Auto-reset when target reached"}),e.jsx("span",{className:"block text-sm text-gray-500",children:"When this counter reaches its target value, it will automatically reset to the minimum value. Great for tracking pattern repeats!"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition",children:t?"Update Counter":"Create Counter"})]})]})]})})}function Nr({counter:t,isPrimary:s,mode:r,onIncrement:y,onEdit:l,onDelete:w,loading:m}){const[C,p]=a.useState(!0),u=t.target_value?Math.round(t.current_value/t.target_value*100):null,v=s||r==="independent",o=t.children&&t.children.length>0;return e.jsxs("div",{className:`${s?"":"ml-6 border-l-2 border-purple-200 dark:border-purple-800 pl-4"}`,children:[e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-4 mb-3 transition-all ${s?"border-l-4 border-purple-600":"border-l-2 border-blue-400 dark:border-blue-600"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx("button",{onClick:()=>p(!C),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:C?e.jsx(Ht,{className:"h-4 w-4 text-gray-500"}):e.jsx(be,{className:"h-4 w-4 text-gray-500"})}),e.jsx("span",{className:"text-xl",children:s?"📊":"🔁"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t.name}),t.auto_reset&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full flex items-center gap-1",children:[e.jsx(mt,{className:"h-3 w-3"}),"Auto-reset"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsxs("span",{className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:[t.children.length," linked"]}),e.jsx("button",{onClick:()=>l(t),className:"text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 p-1",children:"Edit"})]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[e.jsx("span",{className:"text-4xl font-bold text-purple-600 dark:text-purple-400",children:t.current_value.toLocaleString()}),t.target_value&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl text-gray-400",children:"/"}),e.jsx("span",{className:"text-2xl text-gray-500 dark:text-gray-400",children:t.target_value.toLocaleString()})]})]}),u!==null&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-600 dark:bg-purple-500 transition-all duration-300 ease-out",style:{width:`${Math.min(u,100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-right",children:[u,"% complete"]})]}),v&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>y(t.id,-1),disabled:m||t.current_value<=(t.min_value||0),className:`flex-1 h-12 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600
                       text-gray-700 dark:text-gray-200 rounded-lg transition flex items-center justify-center
                       disabled:opacity-50 disabled:cursor-not-allowed`,children:e.jsx(ps,{className:"h-6 w-6"})}),e.jsx("button",{onClick:()=>y(t.id,t.increment_by||1),disabled:m,className:`flex-1 h-12 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition
                       flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed`,children:e.jsx(q,{className:"h-6 w-6"})})]}),!v&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-2",children:[e.jsx(lt,{className:"inline h-4 w-4 mr-1"}),"Updates with parent counter"]})]}),C&&o&&e.jsx("div",{className:"space-y-2",children:t.children.map(c=>e.jsx(Nr,{counter:c,isPrimary:!1,mode:r,onIncrement:y,onEdit:l,onDelete:w,loading:m},c.id))})]})}function zt({projectId:t,onCounterChange:s}){const[r,y]=a.useState([]),[l,w]=a.useState([]),[m,C]=a.useState(!0),[p,u]=a.useState(!1),[v,o]=a.useState("linked"),[c,h]=a.useState(!1),[g,N]=a.useState(null),[F,i]=a.useState(null);a.useEffect(()=>{j()},[t]);const j=async()=>{try{C(!0);const[d,n]=await Promise.all([S.get(`/api/projects/${t}/counters/hierarchy`),S.get(`/api/projects/${t}/counters`)]);y(d.data.data.counters||[]),w(n.data.data.counters||[])}catch(d){console.error("Error fetching counters:",d),k.error("Failed to load counters")}finally{C(!1)}},E=async(d,n)=>{try{u(!0);const D=await S.post(`/api/projects/${t}/counters/${d}/increment`,{amount:n,mode:v});D.data.success&&(D.data.data.updated_counters.filter($=>$.reset&&$.completion_message).forEach($=>{k.success($.completion_message,{icon:"🎉",autoClose:3e3})}),await j(),s?.())}catch(D){console.error("Error incrementing counter:",D),k.error("Failed to update counter")}finally{u(!1)}},_=async d=>{try{await S.post(`/api/projects/${t}/counters`,{...d,parentCounterId:F}),k.success("Counter created!"),h(!1),i(null),j(),s?.()}catch(n){console.error("Error creating counter:",n),k.error("Failed to create counter")}},b=async(d,n)=>{try{await S.put(`/api/projects/${t}/counters/${d}`,n),k.success("Counter updated!"),h(!1),N(null),j(),s?.()}catch(D){console.error("Error updating counter:",D),k.error("Failed to update counter")}},P=async d=>{if(confirm("Delete this counter? Any linked counters will be unlinked."))try{await S.delete(`/api/projects/${t}/counters/${d}`),k.success("Counter deleted!"),j(),s?.()}catch(n){console.error("Error deleting counter:",n),k.error("Failed to delete counter")}},x=r.filter(d=>!d.parent_counter_id&&d.is_visible&&d.is_active);return m?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Counters"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("linked"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${v==="linked"?"bg-white dark:bg-gray-600 text-purple-600 dark:text-purple-400 shadow":"text-gray-600 dark:text-gray-400"}`,children:[e.jsx(lt,{className:"inline h-4 w-4 mr-1"}),"Linked"]}),e.jsx("button",{onClick:()=>o("independent"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition ${v==="independent"?"bg-white dark:bg-gray-600 text-purple-600 dark:text-purple-400 shadow":"text-gray-600 dark:text-gray-400"}`,children:"Independent"})]}),e.jsxs("button",{onClick:()=>{N(null),i(null),h(!0)},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Add Counter"]})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 text-sm text-gray-600 dark:text-gray-400",children:v==="linked"?e.jsxs("p",{children:[e.jsx(lt,{className:"inline h-4 w-4 mr-1"}),e.jsx("strong",{children:"Linked Mode:"})," Incrementing a parent counter will update all linked child counters together. Auto-reset counters will reset when they reach their target."]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Independent Mode:"})," Each counter can be adjusted separately without affecting linked counters."]})}),x.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No counters yet. Add your first counter to track your progress!"}),e.jsxs("button",{onClick:()=>h(!0),className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Add Counter"]})]}):e.jsx("div",{className:"space-y-4",children:x.map(d=>e.jsxs("div",{children:[e.jsx(Nr,{counter:d,isPrimary:!0,mode:v,onIncrement:E,onEdit:n=>{N(n),h(!0)},onDelete:P,loading:p}),e.jsxs("button",{onClick:()=>{N(null),i(d.id),h(!0)},className:"ml-6 mt-2 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),"Add linked counter"]})]},d.id))}),c&&e.jsx(za,{projectId:t,counter:g,parentCounterId:F,existingCounters:l,onSave:d=>{g?b(g.id,d):_(d)},onCancel:()=>{h(!1),N(null),i(null)}})]})}const kr=({projectId:t,currentSession:s,onStartSession:r,onEndSession:y,onPauseSession:l,getCurrentCounterValues:w})=>{const[m,C]=a.useState(0),[p,u]=a.useState(!1),[v,o]=a.useState(!1),[c,h]=a.useState(""),[g,N]=a.useState(),F=a.useRef(null);a.useEffect(()=>{if(s&&!s.end_time){const P=new Date(s.start_time).getTime(),x=Date.now();C(Math.floor((x-P)/1e3)),u(!0)}else C(0),u(!1)},[s]),a.useEffect(()=>(p?F.current=setInterval(()=>{C(P=>P+1)},1e3):F.current&&(clearInterval(F.current),F.current=null),()=>{F.current&&clearInterval(F.current)}),[p]);const i=async()=>{try{await r(),u(!0)}catch(P){console.error("Failed to start session:",P)}},j=async()=>{if(l)try{await l(),u(!1)}catch(P){console.error("Failed to pause session:",P)}},E=()=>{o(!0)},_=async()=>{try{await y(c,g),o(!1),h(""),N(void 0),u(!1),C(0)}catch(P){console.error("Failed to end session:",P)}},b=P=>{const x=Math.floor(P/3600),d=Math.floor(P%3600/60),n=P%60;return x>0?`${x}:${d.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${d}:${n.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Knitting Session"]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-gray-900 dark:text-white tabular-nums mb-2",children:b(m)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:p?"Session in progress":"No active session"})]}),e.jsx("div",{className:"flex gap-3 justify-center",children:p?e.jsxs(e.Fragment,{children:[l&&e.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(er,{className:"w-6 h-6"}),"Pause"]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(tr,{className:"w-6 h-6"}),"End Session"]})]}):e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(Jt,{className:"w-6 h-6"}),"Start Session"]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"End Knitting Session"}),e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Session Duration"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b(m)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"How was this session?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N("productive"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${g==="productive"?"border-green-500 bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300":"border-gray-300 dark:border-gray-600 hover:border-green-500"}`,children:"😊 Productive"}),e.jsx("button",{onClick:()=>N("relaxed"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${g==="relaxed"?"border-blue-500 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300":"border-gray-300 dark:border-gray-600 hover:border-blue-500"}`,children:"😌 Relaxed"}),e.jsx("button",{onClick:()=>N("frustrated"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${g==="frustrated"?"border-orange-500 bg-orange-50 dark:bg-orange-900 text-orange-700 dark:text-orange-300":"border-gray-300 dark:border-gray-600 hover:border-orange-500"}`,children:"😤 Frustrated"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Notes (optional)"}),e.jsx("textarea",{value:c,onChange:P=>h(P.target.value),placeholder:"Add any notes about this session...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"End Session"})]})]})})]})},Cr=({sessions:t,onDeleteSession:s})=>{const[r,y]=a.useState(null),l=c=>{const h=Math.floor(c/3600),g=Math.floor(c%3600/60);return h>0?`${h}h ${g}m`:`${g}m`},w=c=>{if(!c.duration_seconds||c.duration_seconds===0)return 0;const h=c.duration_seconds/3600;return Math.round(c.rows_completed/h)},m=c=>{switch(c){case"productive":return"😊";case"relaxed":return"😌";case"frustrated":return"😤";default:return"🧶"}},C=c=>{switch(c){case"productive":return"text-green-600 dark:text-green-400";case"relaxed":return"text-blue-600 dark:text-blue-400";case"frustrated":return"text-orange-600 dark:text-orange-400";default:return"text-gray-600 dark:text-gray-400"}},p=c=>{y(r===c?null:c)},u=t.reduce((c,h)=>c+(h.duration_seconds||0),0),v=t.reduce((c,h)=>c+h.rows_completed,0),o=u>0?Math.round(v/u*3600):0;return t.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(ee,{className:"w-5 h-5"}),"Session History"]}),e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No sessions recorded yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start a knitting session to track your progress"})]})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(ee,{className:"w-5 h-5"}),"Session History"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Sessions"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Time"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(u)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Avg Pace"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"rows/hour"})]})]}),e.jsx("div",{className:"space-y-3",children:t.map(c=>{const h=r===c.id,g=w(c);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>p(c.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl ${C(c.mood)}`,children:m(c.mood)}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:Ze(new Date(c.start_time),"MMM d, yyyy")}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Ze(new Date(c.start_time),"h:mm a"),c.end_time&&` - ${Ze(new Date(c.end_time),"h:mm a")}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:l(c.duration_seconds||0)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[c.rows_completed," rows"]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${h?"transform rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),h&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ht,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Pace:"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[g," rows/hour"]})]}),c.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(hs,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Location:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:c.location})]})]}),c.starting_counter_values&&c.ending_counter_values&&Object.keys(c.starting_counter_values).length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Counter Progress"}),e.jsx("div",{className:"space-y-1",children:Object.entries(c.starting_counter_values).map(([N,F])=>{const i=c.ending_counter_values?.[N]||F,j=i-F;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Counter ",N.slice(0,8)]}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[F," → ",i,j>0&&e.jsxs("span",{className:"text-green-600 dark:text-green-400 ml-1",children:["(+",j,")"]})]})]},N)})})]}),c.notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Notes"}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded",children:c.notes})]}),s&&e.jsx("button",{onClick:()=>s(c.id),className:"text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium",children:"Delete Session"})]})]},c.id)})})]})},Ia=({projectId:t,milestones:s,totalTimeSeconds:r,totalRows:y,completedRows:l,onAddMilestone:w,onUpdateMilestone:m,onDeleteMilestone:C})=>{const[p,u]=a.useState(!1),[v,o]=a.useState(null),[c,h]=a.useState({name:"",target_rows:0}),g=b=>{const P=Math.floor(b/3600),x=Math.floor(b%3600/60);return P===0?`${x}m`:P<10?`${P}h ${x}m`:`${P}h`},N=()=>{if(r===0)return 0;const b=r/3600;return Math.round(l/b)},F=()=>{const b=N();if(b===0)return"Not enough data";const x=(y-l)/b;if(x<1)return`~${Math.round(x*60)} minutes`;if(x<24)return`~${Math.round(x)} hours`;const d=Math.round(x/24);return`~${d} day${d!==1?"s":""}`},i=async()=>{if(c.name.trim())try{await w({project_id:t,name:c.name,target_rows:c.target_rows||void 0,actual_rows:0,time_spent_seconds:0,sort_order:s.length}),h({name:"",target_rows:0}),u(!1)}catch(b){console.error("Failed to add milestone:",b)}},j=async b=>{try{await m(b.id,{completed_at:b.completed_at?void 0:new Date().toISOString(),actual_rows:b.actual_rows||l})}catch(P){console.error("Failed to complete milestone:",P)}},E=y>0?l/y*100:0,_=N();return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Project Progress"]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),"Add Milestone"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Total Time"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:g(r)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Rows Complete"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[l,y>0&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["/",y]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Average Pace"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:_}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"rows/hour"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Time Remaining"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:F()})]})]}),y>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Overall Progress"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[E.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${Math.min(E,100)}%`}})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Milestones"}),s.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500 dark:text-gray-400",children:[e.jsx(Pt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No milestones yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Break down your project into manageable sections"})]}):e.jsx("div",{className:"space-y-2",children:s.sort((b,P)=>b.sort_order-P.sort_order).map(b=>{const P=!!b.completed_at,x=b.target_rows?Math.min((b.actual_rows||0)/b.target_rows*100,100):0;return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${P?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("button",{onClick:()=>j(b),className:"mt-0.5",children:P?e.jsx(Te,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(Pt,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${P?"text-green-900 dark:text-green-300 line-through":"text-gray-900 dark:text-white"}`,children:b.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-x-3",children:[b.target_rows&&e.jsxs("span",{children:["Target: ",b.target_rows," rows"]}),b.time_spent_seconds>0&&e.jsxs("span",{children:["Time: ",g(b.time_spent_seconds)]})]})]})]}),e.jsx("button",{onClick:()=>C(b.id),className:"text-red-600 hover:text-red-700 dark:text-red-400 p-1",children:e.jsx(X,{className:"w-4 h-4"})})]}),b.target_rows&&!P&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${x}%`}})})})]},b.id)})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Add Milestone"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Milestone Name"}),e.jsx("input",{type:"text",value:c.name,onChange:b=>h({...c,name:b.target.value}),placeholder:"e.g., Ribbing, Body, Sleeves",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Target Rows (optional)"}),e.jsx("input",{type:"number",value:c.target_rows||"",onChange:b=>h({...c,target_rows:parseInt(b.target.value)||0}),placeholder:"Number of rows for this section",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:i,disabled:!c.name.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:"Add Milestone"})]})]})})]})},Ba=({projectId:t,totalRows:s=0,getCurrentCounterValues:r})=>{const[y,l]=a.useState(null),[w,m]=a.useState([]),[C,p]=a.useState([]),[u,v]=a.useState(!0),[o,c]=a.useState("timer");a.useEffect(()=>{g(),N(),h()},[t]);const h=async()=>{try{const d=await S.get(`/api/projects/${t}/sessions/active`);d.data.success&&d.data.data&&l(d.data.data)}catch{console.log("No active session")}},g=async()=>{try{v(!0);const d=await S.get(`/api/projects/${t}/sessions`);m(d.data.success?d.data.data.sessions||[]:[])}catch(d){console.error("Failed to fetch sessions:",d),m([])}finally{v(!1)}},N=async()=>{try{const d=await S.get(`/api/projects/${t}/milestones`);p(d.data.success?d.data.data.milestones||[]:[])}catch(d){console.error("Failed to fetch milestones:",d),p([])}},F=async()=>{try{const d=await S.post(`/api/projects/${t}/sessions/start`,{mood:void 0,location:void 0,notes:void 0}),n=d.data.success?d.data.data.session:d.data;return l(n),n}catch(d){throw console.error("Failed to start session:",d),d}},i=async(d,n)=>{if(y)try{await S.post(`/api/projects/${t}/sessions/${y.id}/end`,{notes:d,mood:n}),l(null),g()}catch(D){throw console.error("Failed to end session:",D),D}},j=async d=>{try{await S.delete(`/api/projects/${t}/sessions/${d}`),m(w.filter(n=>n.id!==d))}catch(n){console.error("Failed to delete session:",n)}},E=async d=>{try{const n=await S.post(`/api/projects/${t}/milestones`,{name:d.name,targetRows:d.target_rows}),D=n.data.success?n.data.data.milestone:n.data;p([...C,D])}catch(n){throw console.error("Failed to add milestone:",n),n}},_=async(d,n)=>{try{const D=await S.put(`/api/projects/${t}/milestones/${d}`,{name:n.name,targetRows:n.target_rows,actualRows:n.actual_rows,timeSpentSeconds:n.time_spent_seconds,completedAt:n.completed_at}),R=D.data.success?D.data.data.milestone:D.data;p(C.map($=>$.id===d?R:$))}catch(D){throw console.error("Failed to update milestone:",D),D}},b=async d=>{try{await S.delete(`/api/projects/${t}/milestones/${d}`),p(C.filter(n=>n.id!==d))}catch(n){throw console.error("Failed to delete milestone:",n),n}},P=w.reduce((d,n)=>d+(n.duration_seconds||0),0),x=w.reduce((d,n)=>d+n.rows_completed,0);return u?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"Loading sessions..."})}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>c("timer"),className:`flex-1 px-4 py-3 font-medium transition-colors ${o==="timer"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Session Timer"}),e.jsx("button",{onClick:()=>c("progress"),className:`flex-1 px-4 py-3 font-medium transition-colors ${o==="progress"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Progress"}),e.jsxs("button",{onClick:()=>c("history"),className:`flex-1 px-4 py-3 font-medium transition-colors ${o==="history"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:["History (",w.length,")"]})]}),e.jsxs("div",{className:"p-6",children:[o==="timer"&&e.jsx(kr,{projectId:t,currentSession:y,onStartSession:F,onEndSession:i,getCurrentCounterValues:r}),o==="progress"&&e.jsx(Ia,{projectId:t,milestones:C,totalTimeSeconds:P,totalRows:s,completedRows:x,onAddMilestone:E,onUpdateMilestone:_,onDeleteMilestone:b}),o==="history"&&e.jsx(Cr,{sessions:w,onDeleteSession:j})]})]})})},Sr=a.createContext(void 0),Oa=({children:t})=>{const[s,r]=a.useState(null),[y,l]=a.useState(!1),{accessToken:w}=je(),m=a.useRef(null);a.useEffect(()=>{if(!w){m.current&&(m.current.disconnect(),m.current=null,r(null),l(!1));return}const i=bs("http://localhost:5000",{auth:{token:w},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5});return i.on("connect",()=>{console.log("✅ Socket.IO connected:",i.id),l(!0)}),i.on("disconnect",j=>{console.log("❌ Socket.IO disconnected:",j),l(!1)}),i.on("connect_error",j=>{console.error("Socket.IO connection error:",j),l(!1)}),m.current=i,r(i),()=>{m.current&&(m.current.disconnect(),m.current=null)}},[w]);const C=a.useCallback(F=>{m.current?.connected&&(m.current.emit("join:project",F),console.log(`Joined project room: ${F}`))},[]),p=a.useCallback(F=>{m.current?.connected&&(m.current.emit("leave:project",F),console.log(`Left project room: ${F}`))},[]),u=a.useCallback((F,i,j)=>{m.current?.connected&&m.current.emit("counter:update",{counterId:F,projectId:i,currentValue:j})},[]),v=a.useCallback((F,i,j)=>{m.current?.connected&&m.current.emit("counter:increment",{counterId:F,projectId:i,currentValue:j})},[]),o=a.useCallback((F,i,j)=>{m.current?.connected&&m.current.emit("counter:decrement",{counterId:F,projectId:i,currentValue:j})},[]),c=a.useCallback((F,i)=>{m.current?.connected&&m.current.emit("counter:reset",{counterId:F,projectId:i})},[]),h=a.useCallback(F=>{m.current&&(m.current.on("counter:updated",F),m.current.on("counter:incremented",F),m.current.on("counter:decremented",F))},[]),g=a.useCallback(F=>{m.current&&(m.current.off("counter:updated",F),m.current.off("counter:incremented",F),m.current.off("counter:decremented",F))},[]),N={socket:s,isConnected:y,joinProject:C,leaveProject:p,emitCounterUpdate:u,emitCounterIncrement:v,emitCounterDecrement:o,emitCounterReset:c,onCounterUpdate:h,offCounterUpdate:g};return e.jsx(Sr.Provider,{value:N,children:t})},Ua=()=>{const t=a.useContext(Sr);if(t===void 0)throw new Error("useWebSocket must be used within a WebSocketProvider");return t},It=({projectId:t,patternId:s,notes:r,getCurrentCounterValues:y,onSaveNote:l,onDeleteNote:w,onUpdateTranscription:m})=>{const[C,p]=a.useState(!1),[u,v]=a.useState(0),[o,c]=a.useState(null),[h,g]=a.useState(null),[N,F]=a.useState(""),i=a.useRef(null),j=a.useRef([]),E=a.useRef(null),_=a.useRef(0),b=a.useRef(new Map),P=a.useRef("audio/webm");a.useEffect(()=>()=>{b.current.forEach(A=>{A.pause(),A.src=""}),b.current.clear()},[]);const x=()=>{const A=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/mpeg","audio/wav"];for(const M of A)if(MediaRecorder.isTypeSupported(M))return console.log(`✅ Using audio mime type: ${M}`),M;return console.warn("⚠️ No preferred mime type supported, using browser default"),""},d=async()=>{try{if(!window.MediaRecorder){alert("❌ Audio recording is not supported in this browser. Please use Chrome, Firefox, Edge, or Safari.");return}const A=await navigator.mediaDevices.getUserMedia({audio:!0}),M=x();P.current=M;const H=M?{mimeType:M}:{},L=new MediaRecorder(A,H);i.current=L,j.current=[],L.ondataavailable=B=>{B.data.size>0&&(console.log(`📦 Audio chunk received: ${B.data.size} bytes`),j.current.push(B.data))},L.onstop=async()=>{console.log(`🎤 Recording stopped. Total chunks: ${j.current.length}`);const B=L.mimeType||P.current,T=new Blob(j.current,{type:B});if(console.log(`📁 Audio blob created: ${T.size} bytes, type: ${B}`),A.getTracks().forEach(Q=>Q.stop()),T.size===0){console.error("❌ Audio blob is empty - no data was recorded"),alert("Recording failed: No audio data was captured. Please try again.");return}const O=_.current;console.log(`⏱️  Recording duration: ${O} seconds`);try{await l(T,O,void 0),console.log("✅ Audio note saved successfully")}catch(Q){console.error("Failed to save audio note:",Q),alert("Failed to save audio note")}},L.onerror=B=>{console.error("🔴 MediaRecorder error:",B.error),alert(`Recording error: ${B.error?.message||"Unknown error occurred"}`)},L.start(1e3),p(!0),v(0),_.current=0,E.current=setInterval(()=>{_.current+=1,v(_.current)},1e3)}catch(A){if(console.error("Failed to start recording:",A),A instanceof DOMException)switch(A.name){case"NotAllowedError":alert("🎤 Microphone access denied. Please allow microphone permissions in your browser settings and try again.");break;case"NotFoundError":alert("🎤 No microphone found. Please connect a microphone and try again.");break;case"NotReadableError":alert("🎤 Microphone is already in use by another application. Please close other apps using the microphone and try again.");break;default:alert(`🎤 Failed to access microphone: ${A.message}`)}else alert("Failed to access microphone. Please grant microphone permissions.")}},n=()=>{i.current&&C&&(i.current.stop(),p(!1),E.current&&(clearInterval(E.current),E.current=null))},D=A=>{if(o){const H=b.current.get(o);H&&(H.pause(),H.currentTime=0)}let M=b.current.get(A.id);M||(M=new Audio(A.audio_url),M.onended=()=>c(null),b.current.set(A.id,M)),o===A.id?(M.pause(),c(null)):(M.play(),c(A.id))},R=async A=>{if(confirm("Are you sure you want to delete this audio note?"))try{const M=b.current.get(A);M&&(M.pause(),M.src="",b.current.delete(A)),await w(A)}catch(M){console.error("Failed to delete note:",M),alert("Failed to delete note")}},$=A=>{g(A.id),F(A.transcription||"")},I=async A=>{if(m)try{await m(A,N),g(null),F("")}catch(M){console.error("Failed to update transcription:",M),alert("Failed to update transcription")}},U=()=>{g(null),F("")},K=A=>{const M=Math.floor(A/60),H=A%60;return`${M}:${H.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Audio Notes"}),e.jsx("div",{className:"mb-6",children:C?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"w-4 h-4 bg-red-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white tabular-nums",children:K(u)})]}),e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-3 px-6 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(tr,{className:"w-6 h-6"}),"Stop Recording"]})]}):e.jsxs("button",{onClick:d,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(ot,{className:"w-6 h-6"}),"Start Recording"]})}),e.jsx("div",{className:"space-y-3",children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ot,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No audio notes yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Record your first voice note"})]}):r.map(A=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:mr(new Date(A.created_at),{addSuffix:!0})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Duration: ",K(A.duration_seconds)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>D(A),className:`p-2 rounded-lg transition-colors ${o===A.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,title:o===A.id?"Pause":"Play",children:o===A.id?e.jsx(er,{className:"w-5 h-5"}):e.jsx(Jt,{className:"w-5 h-5"})}),e.jsx("a",{href:A.audio_url,download:`audio-note-${A.id}.webm`,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Download",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>R(A.id),className:"p-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30",title:"Delete",children:e.jsx(X,{className:"w-5 h-5"})})]})]}),h===A.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:N,onChange:M=>F(M.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm",rows:3,placeholder:"Add transcription or notes..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(A.id),className:"flex items-center gap-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm",children:[e.jsx(he,{className:"w-4 h-4"}),"Save"]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-1 px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Transcription"}),m&&e.jsx("button",{onClick:()=>$(A),className:"text-blue-600 dark:text-blue-400 hover:text-blue-700",children:e.jsx(ae,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:A.transcription||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:"No transcription available. Click edit to add notes."})})]}),A.counter_values&&Object.keys(A.counter_values).length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"At: "}),Object.entries(A.counter_values).map(([M,H])=>`${M}: ${H}`).join(", ")]})]},A.id))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"💡 Tip: Click the microphone icon to record voice notes hands-free while knitting"})]})},Ya=[{name:"Black",value:"#000000"},{name:"Blue",value:"#3B82F6"},{name:"Red",value:"#EF4444"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Orange",value:"#F97316"},{name:"Pink",value:"#EC4899"},{name:"Yellow",value:"#FBBF24"}],qa=[2,4,6,8,12],Va=({patternId:t,projectId:s,pageNumber:r,onSave:y,initialData:l})=>{const w=a.useRef(null),m=a.useRef(null),[C,p]=a.useState(!1),[u,v]=a.useState([]),[o,c]=a.useState([]),[h,g]=a.useState([]),[N,F]=a.useState([]),[i,j]=a.useState("pen"),[E,_]=a.useState("#000000"),[b,P]=a.useState(4),[x,d]=a.useState(!1),[n,D]=a.useState(!1);a.useEffect(()=>{const L=w.current,B=m.current;if(!L||!B)return;const T=B.getBoundingClientRect();L.width=T.width,L.height=Math.max(T.height,400);const O=L.getContext("2d");if(O&&(O.fillStyle="#FFFFFF",O.fillRect(0,0,L.width,L.height),l)){const Q=new Image;Q.onload=()=>{O.drawImage(Q,0,0)},Q.src=l}},[l]),a.useEffect(()=>{const L=w.current;if(!L)return;const B=L.getContext("2d");B&&(B.fillStyle="#FFFFFF",B.fillRect(0,0,L.width,L.height),o.forEach(T=>{if(!(T.points.length<2)){B.beginPath(),B.strokeStyle=T.tool==="eraser"?"#FFFFFF":T.color,B.lineWidth=T.tool==="eraser"?T.width*2:T.width,B.lineCap="round",B.lineJoin="round",B.moveTo(T.points[0].x,T.points[0].y);for(let O=1;O<T.points.length;O++)B.lineTo(T.points[O].x,T.points[O].y);B.stroke()}}))},[o]);const R=L=>{const B=w.current;if(!B)return{x:0,y:0};const T=B.getBoundingClientRect();let O,Q;return"touches"in L?(O=L.touches[0].clientX,Q=L.touches[0].clientY):(O=L.clientX,Q=L.clientY),{x:O-T.left,y:Q-T.top}},$=L=>{L.preventDefault(),p(!0);const B=R(L);v([B])},I=L=>{if(!C)return;L.preventDefault();const B=R(L);v(Ie=>[...Ie,B]);const O=w.current?.getContext("2d");if(!O||u.length===0)return;O.beginPath(),O.strokeStyle=i==="eraser"?"#FFFFFF":E,O.lineWidth=i==="eraser"?b*2:b,O.lineCap="round",O.lineJoin="round";const Q=u[u.length-1];O.moveTo(Q.x,Q.y),O.lineTo(B.x,B.y),O.stroke()},U=()=>{if(C){if(p(!1),u.length>1){const L={points:u,color:E,width:b,tool:i};g(B=>[...B,o]),F([]),c(B=>[...B,L])}v([])}},K=()=>{if(h.length===0)return;const L=h[h.length-1];F(B=>[...B,o]),c(L),g(B=>B.slice(0,-1))},A=()=>{if(N.length===0)return;const L=N[N.length-1];g(B=>[...B,o]),c(L),F(B=>B.slice(0,-1))},M=()=>{o.length!==0&&(g(L=>[...L,o]),F([]),c([]))},H=async()=>{const L=w.current;if(!L)return;const B=L.toDataURL("image/png");if(y)try{await y(B),alert("Notes saved successfully!")}catch(T){console.error("Failed to save notes:",T),alert("Failed to save notes")}else{const T=document.createElement("a");T.download=`notes-${Date.now()}.png`,T.href=B,T.click()}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Handwritten Notes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:K,disabled:h.length===0,className:"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed",title:"Undo",children:e.jsx(ys,{className:"w-5 h-5"})}),e.jsx("button",{onClick:A,disabled:N.length===0,className:"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed",title:"Redo",children:e.jsx(rr,{className:"w-5 h-5"})}),e.jsx("button",{onClick:M,className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Clear all",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:H,className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Save/Export",children:e.jsx(ye,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j("pen"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${i==="pen"?"bg-blue-600 text-white":"bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500"}`,children:[e.jsx(sr,{className:"w-4 h-4"}),"Pen"]}),e.jsxs("button",{onClick:()=>j("eraser"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${i==="eraser"?"bg-blue-600 text-white":"bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500"}`,children:[e.jsx(fs,{className:"w-4 h-4"}),"Eraser"]})]}),i==="pen"&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>d(!x),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsx("div",{className:"w-6 h-6 rounded border-2 border-gray-300",style:{backgroundColor:E}})]}),x&&e.jsx("div",{className:"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ya.map(L=>e.jsx("button",{onClick:()=>{_(L.value),d(!1)},className:`w-8 h-8 rounded border-2 transition-transform hover:scale-110 ${E===L.value?"border-blue-600 ring-2 ring-blue-300":"border-gray-300"}`,style:{backgroundColor:L.value},title:L.name},L.value))})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>D(!n),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg",children:[e.jsx("div",{className:"rounded-full bg-gray-900 dark:bg-white",style:{width:b*2,height:b*2}}),b,"px"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"flex flex-col gap-2",children:qa.map(L=>e.jsxs("button",{onClick:()=>{P(L),D(!1)},className:`flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${b===L?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("div",{className:"rounded-full bg-gray-900 dark:bg-white",style:{width:L*2,height:L*2}}),e.jsxs("span",{className:"text-sm",children:[L,"px"]})]},L))})})]})]}),e.jsx("div",{ref:m,className:"border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white",style:{touchAction:"none"},children:e.jsx("canvas",{ref:w,onMouseDown:$,onMouseMove:I,onMouseUp:U,onMouseLeave:U,onTouchStart:$,onTouchMove:I,onTouchEnd:U,className:"cursor-crosshair"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Draw on the canvas with your mouse, trackpad, or touch screen. Use the eraser to remove strokes."})]})},xe={gauge_swatch:{name:"Gauge Swatch",icon:"📏",description:"Record gauge measurements for accurate sizing"},fit_adjustment:{name:"Fit Adjustment",icon:"📐",description:"Track modifications to pattern measurements"},yarn_substitution:{name:"Yarn Substitution",icon:"🧶",description:"Document yarn changes and gauge comparison"},finishing_techniques:{name:"Finishing Techniques",icon:"✨",description:"Notes on bind-off, seaming, and blocking"}},Ha=({projectId:t,memos:s,onSaveMemo:r,onDeleteMemo:y})=>{const[l,w]=a.useState(!1),[m,C]=a.useState("gauge_swatch"),[p,u]=a.useState({}),v=i=>{C(i),u({}),w(!0)},o=async()=>{try{await r(m,p),w(!1),u({})}catch(i){console.error("Failed to save memo:",i),alert("Failed to save memo")}},c=async i=>{if(confirm("Are you sure you want to delete this memo?"))try{await y(i)}catch(j){console.error("Failed to delete memo:",j),alert("Failed to delete memo")}},h=i=>{const j=g(i),E=new Blob([j],{type:"text/plain"}),_=URL.createObjectURL(E),b=document.createElement("a");b.href=_,b.download=`${xe[i.template_type].name.replace(/\s/g,"_")}_${i.id}.txt`,b.click(),URL.revokeObjectURL(_)},g=i=>{const j=xe[i.template_type].name,E=new Date(i.created_at).toLocaleDateString();let _=`${j}
`;switch(_+=`Date: ${E}
`,_+=`${"=".repeat(50)}

`,i.template_type){case"gauge_swatch":const b=i.data;_+=`Needle Size: ${b.needle_size}
`,_+=`Stitches per Inch: ${b.stitches_per_inch}
`,_+=`Rows per Inch: ${b.rows_per_inch}
`,_+=`Swatch Dimensions: ${b.swatch_width}" × ${b.swatch_height}"
`,b.notes&&(_+=`
Notes: ${b.notes}
`);break;case"fit_adjustment":const P=i.data;_+=`Measurement: ${P.measurement_name}
`,_+=`Original: ${P.original_value}
`,_+=`Adjusted: ${P.adjusted_value}
`,_+=`Reason: ${P.reason}
`,P.notes&&(_+=`
Notes: ${P.notes}
`);break;case"yarn_substitution":const x=i.data;_+=`Original Yarn: ${x.original_yarn_name} (${x.original_yarn_weight})
`,_+=`Original Yardage: ${x.original_yardage} yards
`,_+=`Replacement Yarn: ${x.replacement_yarn_name} (${x.replacement_yarn_weight})
`,_+=`Replacement Yardage: ${x.replacement_yardage} yards
`,_+=`Gauge Comparison: ${x.gauge_comparison}
`,x.notes&&(_+=`
Notes: ${x.notes}
`);break;case"finishing_techniques":const d=i.data;_+=`Bind-Off Method: ${d.bind_off_method}
`,_+=`Seaming Technique: ${d.seaming_technique}
`,_+=`Blocking Instructions: ${d.blocking_instructions}
`,d.notes&&(_+=`
Notes: ${d.notes}
`);break}return _},N=()=>{switch(m){case"gauge_swatch":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Needle Size"}),e.jsx("input",{type:"text",value:p.needle_size||"",onChange:i=>u({...p,needle_size:i.target.value}),placeholder:"e.g., US 7 / 4.5mm",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Stitches per Inch"}),e.jsx("input",{type:"number",step:"0.1",value:p.stitches_per_inch||"",onChange:i=>u({...p,stitches_per_inch:parseFloat(i.target.value)}),placeholder:"4.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Rows per Inch"}),e.jsx("input",{type:"number",step:"0.1",value:p.rows_per_inch||"",onChange:i=>u({...p,rows_per_inch:parseFloat(i.target.value)}),placeholder:"6.0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Swatch Width (inches)"}),e.jsx("input",{type:"number",step:"0.5",value:p.swatch_width||"",onChange:i=>u({...p,swatch_width:parseFloat(i.target.value)}),placeholder:"4",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Swatch Height (inches)"}),e.jsx("input",{type:"number",step:"0.5",value:p.swatch_height||"",onChange:i=>u({...p,swatch_height:parseFloat(i.target.value)}),placeholder:"4",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:p.notes||"",onChange:i=>u({...p,notes:i.target.value}),placeholder:"Any additional observations...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3})]})]});case"fit_adjustment":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Measurement Name"}),e.jsx("input",{type:"text",value:p.measurement_name||"",onChange:i=>u({...p,measurement_name:i.target.value}),placeholder:"e.g., Sleeve length, Bust circumference",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Value"}),e.jsx("input",{type:"number",step:"0.5",value:p.original_value||"",onChange:i=>u({...p,original_value:parseFloat(i.target.value)}),placeholder:"36",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Adjusted Value"}),e.jsx("input",{type:"number",step:"0.5",value:p.adjusted_value||"",onChange:i=>u({...p,adjusted_value:parseFloat(i.target.value)}),placeholder:"38",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Reason for Change"}),e.jsx("input",{type:"text",value:p.reason||"",onChange:i=>u({...p,reason:i.target.value}),placeholder:"e.g., Prefer looser fit, Accommodate larger bust",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:p.notes||"",onChange:i=>u({...p,notes:i.target.value}),placeholder:"Additional details...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:2})]})]});case"yarn_substitution":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Yarn Name"}),e.jsx("input",{type:"text",value:p.original_yarn_name||"",onChange:i=>u({...p,original_yarn_name:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Weight"}),e.jsx("input",{type:"text",value:p.original_yarn_weight||"",onChange:i=>u({...p,original_yarn_weight:i.target.value}),placeholder:"DK, Worsted, etc.",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Yardage"}),e.jsx("input",{type:"number",value:p.original_yardage||"",onChange:i=>u({...p,original_yardage:parseInt(i.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Replacement Yarn Name"}),e.jsx("input",{type:"text",value:p.replacement_yarn_name||"",onChange:i=>u({...p,replacement_yarn_name:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Replacement Weight"}),e.jsx("input",{type:"text",value:p.replacement_yarn_weight||"",onChange:i=>u({...p,replacement_yarn_weight:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Replacement Yardage"}),e.jsx("input",{type:"number",value:p.replacement_yardage||"",onChange:i=>u({...p,replacement_yardage:parseInt(i.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Gauge Comparison"}),e.jsx("input",{type:"text",value:p.gauge_comparison||"",onChange:i=>u({...p,gauge_comparison:i.target.value}),placeholder:"e.g., Same gauge, Slightly looser",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:p.notes||"",onChange:i=>u({...p,notes:i.target.value}),placeholder:"Differences in texture, drape, etc.",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:2})]})]});case"finishing_techniques":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Bind-Off Method"}),e.jsx("input",{type:"text",value:p.bind_off_method||"",onChange:i=>u({...p,bind_off_method:i.target.value}),placeholder:"e.g., Standard, Sewn, I-cord",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Seaming Technique"}),e.jsx("input",{type:"text",value:p.seaming_technique||"",onChange:i=>u({...p,seaming_technique:i.target.value}),placeholder:"e.g., Mattress stitch, Kitchener stitch",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Blocking Instructions"}),e.jsx("textarea",{value:p.blocking_instructions||"",onChange:i=>u({...p,blocking_instructions:i.target.value}),placeholder:"Wet blocking, steam blocking, measurements, etc.",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Notes (optional)"}),e.jsx("textarea",{value:p.notes||"",onChange:i=>u({...p,notes:i.target.value}),placeholder:"Any other finishing details...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:2})]})]})}},F=i=>{const j=xe[i.template_type];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:j.icon}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:j.name})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:mr(new Date(i.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(i),className:"p-1 text-blue-600 hover:text-blue-700 dark:text-blue-400",title:"Export",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(i.id),className:"p-1 text-red-600 hover:text-red-700 dark:text-red-400",title:"Delete",children:e.jsx(X,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-3 rounded",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:g(i)})})]},i.id)};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5"}),"Structured Memos"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-6",children:Object.entries(xe).map(([i,j])=>e.jsxs("button",{onClick:()=>v(i),className:"flex items-start gap-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 dark:hover:border-blue-500 transition-colors text-left",children:[e.jsx("span",{className:"text-3xl",children:j.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:j.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:j.description})]})]},i))}),e.jsx("div",{className:"space-y-3",children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No memos yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Click a template above to create your first memo"})]}):s.map(F)}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-2xl",children:xe[m].icon}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:xe[m].name})]}),N(),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Save Memo"})]})]})})]})},Wa=[{value:"notification",label:"Notification"},{value:"sound",label:"Sound"},{value:"vibration",label:"Vibration"},{value:"visual",label:"Visual"}],Bt=[{value:"low",label:"Low",color:"bg-gray-100 text-gray-700"},{value:"normal",label:"Normal",color:"bg-blue-100 text-blue-700"},{value:"high",label:"High",color:"bg-orange-100 text-orange-700"},{value:"critical",label:"Critical",color:"bg-red-100 text-red-700"}],Ka=[{value:"reminder",label:"Reminder",icon:ar},{value:"at_same_time",label:"At the Same Time",icon:nr},{value:"milestone",label:"Milestone",icon:_t},{value:"shaping",label:"Shaping",icon:_t},{value:"note",label:"Note",icon:de}],Ga=[{value:"banner",label:"Banner (prominent)"},{value:"popup",label:"Popup (interruptive)"},{value:"toast",label:"Toast (subtle)"},{value:"inline",label:"Inline (always visible)"}];function Qa({projectId:t,counters:s,currentRow:r}){const[y,l]=a.useState([]),[w,m]=a.useState(!1),[C,p]=a.useState(!1),[u,v]=a.useState({name:"",counterId:"",triggerType:"row_range",operator:"equals",triggerValue:"",interval:"",alertMessage:"",alertType:"notification",startRow:"",endRow:"",repeatInterval:"",repeatOffset:"0",isRepeating:!1,priority:"normal",displayStyle:"banner",color:"",category:"reminder"});a.useEffect(()=>{o()},[t]);const o=async()=>{try{p(!0);const x=await S.get(`/api/projects/${t}/magic-markers`);l(x.data.data.magicMarkers||[])}catch(x){console.error("Error fetching magic markers:",x)}finally{p(!1)}},c=async()=>{if(!u.name.trim()){k.error("Please enter a marker name");return}if(!u.alertMessage.trim()){k.error("Please enter an alert message");return}let x={};switch(u.triggerType){case"counter_value":if(!u.triggerValue){k.error("Please enter trigger value");return}x={operator:u.operator,value:parseInt(u.triggerValue)};break;case"row_interval":if(!u.interval){k.error("Please enter interval");return}x={interval:parseInt(u.interval)};break;case"row_range":break;case"stitch_count":if(!u.triggerValue){k.error("Please enter stitch count");return}x={count:parseInt(u.triggerValue)};break;case"time_based":if(!u.interval){k.error("Please enter time interval (minutes)");return}x={minutes:parseInt(u.interval)};break}try{await S.post(`/api/projects/${t}/magic-markers`,{name:u.name,counterId:u.counterId||null,triggerType:u.triggerType,triggerCondition:x,alertMessage:u.alertMessage,alertType:u.alertType,isActive:!0,startRow:u.startRow?parseInt(u.startRow):null,endRow:u.endRow?parseInt(u.endRow):null,repeatInterval:u.repeatInterval?parseInt(u.repeatInterval):null,repeatOffset:parseInt(u.repeatOffset)||0,isRepeating:u.isRepeating,priority:u.priority,displayStyle:u.displayStyle,color:u.color||null,category:u.category}),k.success("Magic marker created!"),m(!1),i(),o()}catch(d){console.error("Error creating marker:",d),k.error(d.response?.data?.message||"Failed to create marker")}},h=async x=>{try{await S.patch(`/api/projects/${t}/magic-markers/${x}/toggle`),o()}catch(d){console.error("Error toggling marker:",d),k.error("Failed to toggle marker")}},g=async(x,d)=>{try{await S.post(`/api/projects/${t}/magic-markers/${x}/snooze`,{duration:d}),k.success(`Snoozed for ${d} minutes`),o()}catch(n){console.error("Error snoozing marker:",n),k.error("Failed to snooze marker")}},N=async x=>{try{await S.post(`/api/projects/${t}/magic-markers/${x}/complete`),k.success("Marked as completed!"),o()}catch(d){console.error("Error completing marker:",d),k.error("Failed to complete marker")}},F=async(x,d)=>{if(confirm(`Delete magic marker "${d}"?`))try{await S.delete(`/api/projects/${t}/magic-markers/${x}`),k.success("Marker deleted"),o()}catch(n){console.error("Error deleting marker:",n),k.error("Failed to delete marker")}},i=()=>{v({name:"",counterId:"",triggerType:"row_range",operator:"equals",triggerValue:"",interval:"",alertMessage:"",alertType:"notification",startRow:"",endRow:"",repeatInterval:"",repeatOffset:"0",isRepeating:!1,priority:"normal",displayStyle:"banner",color:"",category:"reminder"})},j=x=>{const d=x.trigger_condition||{};if(x.start_row!==null||x.end_row!==null){let n="";return x.start_row!==null&&x.end_row!==null?n=`Rows ${x.start_row}-${x.end_row}`:x.start_row!==null?n=`From row ${x.start_row}`:x.end_row!==null&&(n=`Until row ${x.end_row}`),x.is_repeating&&x.repeat_interval&&(n+=` (every ${x.repeat_interval} rows)`),n}switch(x.trigger_type){case"counter_value":return`When counter ${{equals:"=",greater_than:">",less_than:"<",multiple_of:"is multiple of"}[d.operator]||d.operator} ${d.value}`;case"row_interval":return`Every ${d.interval} rows`;case"stitch_count":return`At ${d.count} stitches`;case"time_based":return`Every ${d.minutes} minutes`;default:return x.trigger_type}},E=x=>Bt.find(n=>n.value===x)?.color||"bg-gray-100 text-gray-700",_=x=>{if(!r||!x.is_active||x.is_completed||x.snoozed_until&&new Date(x.snoozed_until)>new Date||x.start_row!==null&&r<x.start_row||x.end_row!==null&&r>x.end_row)return!1;if(x.is_repeating&&x.repeat_interval){const d=x.repeat_offset||0;if((r-d)%x.repeat_interval!==0)return!1}return!0},b=[...y].sort((x,d)=>{const n=_(x),D=_(d);if(n&&!D)return-1;if(!n&&D)return 1;const R={critical:4,high:3,normal:2,low:1},$=R[x.priority]||2,I=R[d.priority]||2;return $!==I?I-$:x.is_active&&!d.is_active?-1:!x.is_active&&d.is_active?1:0}),P=b.filter(x=>_(x));return e.jsxs("div",{className:"space-y-4",children:[P.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-4 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(ar,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Active Reminders"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[P.length," reminder",P.length!==1?"s":""," for row ",r]})]})]}),e.jsx("div",{className:"space-y-2",children:P.map(x=>e.jsx("div",{className:`p-3 rounded-lg ${x.priority==="critical"?"bg-red-500/30 border border-red-300/50":x.priority==="high"?"bg-orange-500/30 border border-orange-300/50":"bg-white/10"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold",children:x.name}),x.priority!=="normal"&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x.priority==="critical"?"bg-red-200 text-red-800":x.priority==="high"?"bg-orange-200 text-orange-800":"bg-gray-200 text-gray-800"}`,children:x.priority})]}),e.jsx("p",{className:"text-sm opacity-90",children:x.alert_message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(x.id,5),className:"p-1.5 hover:bg-white/20 rounded text-white/80 hover:text-white",title:"Snooze 5 min",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N(x.id),className:"p-1.5 hover:bg-white/20 rounded text-white/80 hover:text-white",title:"Mark complete",children:e.jsx(he,{className:"h-4 w-4"})})]})]})},x.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-purple-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Magic Markers"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",y.length,")"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition",children:[e.jsx(q,{className:"h-4 w-4"}),"New Marker"]})]}),C?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-3 text-gray-300 dark:text-gray-600"}),e.jsx("p",{children:"No magic markers yet"}),e.jsx("p",{className:"text-sm mt-1",children:'Create markers for "at the same time" instructions and important milestones'})]}):e.jsx("div",{className:"space-y-3",children:b.map(x=>{const d=_(x),n=x.snoozed_until&&new Date(x.snoozed_until)>new Date;return e.jsx("div",{className:`border rounded-lg p-4 transition-all ${x.is_completed?"border-gray-200 bg-gray-50 dark:bg-gray-700/50 dark:border-gray-600 opacity-60":d?"border-purple-400 bg-purple-50 dark:bg-purple-900/20 dark:border-purple-600 ring-2 ring-purple-300":x.is_active?"border-purple-200 bg-purple-50/50 dark:bg-gray-700 dark:border-purple-800":"border-gray-200 bg-gray-50 dark:bg-gray-700 dark:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:x.name}),x.is_completed?e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs rounded-full flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"})," Completed"]}):n?e.jsxs("span",{className:"px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 text-xs rounded-full flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"})," Snoozed"]}):x.is_active?e.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs rounded-full",children:"Active"}):e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 text-xs rounded-full",children:"Inactive"}),x.priority!=="normal"&&e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${E(x.priority)}`,children:x.priority}),x.is_repeating&&e.jsxs("span",{className:"px-2 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 text-xs rounded-full flex items-center gap-1",children:[e.jsx(nr,{className:"h-3 w-3"})," Repeating"]}),d&&!x.is_completed&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-600 text-white text-xs rounded-full animate-pulse",children:"Now!"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:j(x)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:"Alert:"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:x.alert_message})]}),x.trigger_count>0&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Triggered ",x.trigger_count," time",x.trigger_count!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[!x.is_completed&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(x.id,5),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition",title:"Snooze 5 min",children:e.jsx(ee,{className:"h-4 w-4 text-gray-400"})}),e.jsx("button",{onClick:()=>N(x.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition",title:"Mark complete",children:e.jsx(he,{className:"h-4 w-4 text-gray-400"})}),e.jsx("button",{onClick:()=>h(x.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition",title:x.is_active?"Disable":"Enable",children:x.is_active?e.jsx(vs,{className:"h-5 w-5 text-green-600"}):e.jsx(ws,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx("button",{onClick:()=>F(x.id,x.name),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition text-red-600",title:"Delete",children:e.jsx(X,{className:"h-4 w-4"})})]})]})},x.id)})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"New Magic Marker"}),e.jsx("button",{onClick:()=>{m(!1),i()},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl",children:"x"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Marker Name *"}),e.jsx("input",{type:"text",value:u.name,onChange:x=>v({...u,name:x.target.value}),placeholder:"e.g., Start sleeve shaping",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),e.jsx("select",{value:u.category,onChange:x=>v({...u,category:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",children:Ka.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsx("h4",{className:"font-medium text-purple-800 dark:text-purple-300 mb-3",children:'Row Range ("At the Same Time")'}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300 mb-1",children:"Start Row"}),e.jsx("input",{type:"number",value:u.startRow,onChange:x=>v({...u,startRow:x.target.value}),placeholder:"e.g., 45",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300 mb-1",children:"End Row"}),e.jsx("input",{type:"number",value:u.endRow,onChange:x=>v({...u,endRow:x.target.value}),placeholder:"e.g., 80",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.isRepeating,onChange:x=>v({...u,isRepeating:x.target.checked}),className:"w-4 h-4 text-purple-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Repeat every"})]}),u.isRepeating&&e.jsx("input",{type:"number",value:u.repeatInterval,onChange:x=>v({...u,repeatInterval:x.target.value}),placeholder:"N",className:"w-20 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm dark:bg-gray-700 dark:text-white"}),u.isRepeating&&e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"rows"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Linked Counter (optional)"}),e.jsxs("select",{value:u.counterId,onChange:x=>v({...u,counterId:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"No specific counter"}),s.map(x=>e.jsxs("option",{value:x.id,children:[x.name," (current: ",x.current_value,")"]},x.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority"}),e.jsx("select",{value:u.priority,onChange:x=>v({...u,priority:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",children:Bt.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Display Style"}),e.jsx("select",{value:u.displayStyle,onChange:x=>v({...u,displayStyle:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",children:Ga.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Alert Message *"}),e.jsx("textarea",{value:u.alertMessage,onChange:x=>v({...u,alertMessage:x.target.value}),placeholder:"e.g., AT THE SAME TIME: Begin armhole shaping - BO 4 sts at beg of next 2 rows",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Alert Type"}),e.jsx("select",{value:u.alertType,onChange:x=>v({...u,alertType:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",children:Wa.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>{m(!1),i()},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:"Create Marker"})]})]})]})})]})}function Fr({size:t="md",text:s,fullScreen:r=!1,className:y=""}){const l={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"},w={sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"},m=e.jsxs("div",{className:`flex flex-col items-center justify-center gap-3 ${y}`,children:[e.jsx(Ns,{className:`${l[t]} text-purple-600 dark:text-purple-400 animate-spin`,"aria-label":"Loading",role:"status"}),s&&e.jsx("p",{className:`${w[t]} text-gray-600 dark:text-gray-400 font-medium`,children:s})]});return r?e.jsx("div",{className:"fixed inset-0 bg-gray-50 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 flex items-center justify-center z-50",children:m}):m}lr.workerSrc="/pdf.worker.min.js";function Ot({patterns:t,mode:s="normal"}){const[r,y]=a.useState(null),[l,w]=a.useState([]),[m,C]=a.useState(null),[p,u]=a.useState(null),[v,o]=a.useState(1),[c,h]=a.useState(1),[g,N]=a.useState(!1);a.useEffect(()=>{t.length>0&&!r&&y(t[0])},[t]),a.useEffect(()=>{r&&F(r.id)},[r]),a.useEffect(()=>{if(l.length>0&&!m){const n=l.find(D=>D.file_type==="pdf");n&&C(n)}},[l]);const F=async n=>{try{N(!0);const R=(await S.get(`/api/uploads/patterns/${n}/files`)).data.data.files||[];w(R)}catch(D){console.error("Error fetching pattern files:",D),w([])}finally{N(!1)}},i=n=>{const D=t.find(R=>R.id===n);D&&(y(D),C(null),o(1))},j=n=>{const D=l.find(R=>R.id===n);D&&(C(D),o(1))},E=({numPages:n})=>{u(n)},_=()=>{o(n=>Math.max(n-1,1))},b=()=>{o(n=>Math.min(n+1,p||n))},P=()=>{h(n=>Math.min(n+.2,2))},x=()=>{h(n=>Math.max(n-.2,.5))},d=l.filter(n=>n.file_type==="pdf");return t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:`font-semibold text-gray-900 mb-4 ${s==="knitting"?"text-xl":"text-lg"}`,children:"Pattern Preview"}),e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No patterns linked to this project yet."}),e.jsx("p",{className:"text-sm mt-2",children:"Add a pattern to see it here."})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:`font-semibold text-gray-900 ${s==="knitting"?"text-xl":"text-lg"}`,children:"Pattern Preview"}),r&&e.jsxs(W,{to:`/patterns/${r.id}`,className:"text-purple-600 hover:text-purple-700 flex items-center gap-1 text-sm",children:["Open Full View ",e.jsx(ks,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Pattern"}),e.jsx("select",{value:r?.id||"",onChange:n=>i(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent",children:t.map(n=>e.jsxs("option",{value:n.id,children:[n.name," ",n.designer?`by ${n.designer}`:""]},n.id))})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select PDF File"}),e.jsx("select",{value:m?.id||"",onChange:n=>j(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent",children:d.map(n=>e.jsx("option",{value:n.id,children:n.original_filename},n.id))})]})]}),r?.description&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:r.description})})]}),g?e.jsx("div",{className:"flex items-center justify-center py-12 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):m&&m.file_type==="pdf"?e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:_,disabled:v<=1,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",v," of ",p||"?"]}),e.jsx("button",{onClick:b,disabled:v>=(p||0),className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Next"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x,disabled:c<=.5,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"-"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[Math.round(c*100),"%"]}),e.jsx("button",{onClick:P,disabled:c>=2,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"+"})]})]}),e.jsx("div",{className:"overflow-auto bg-gray-50",style:{maxHeight:s==="knitting"?"600px":"500px"},children:e.jsx(or,{file:`/api/uploads/patterns/${r?.id}/files/${m.id}/download`,onLoadSuccess:E,loading:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}),error:e.jsx("div",{className:"flex items-center justify-center py-12 text-red-600",children:e.jsx("p",{children:"Failed to load PDF. Please try again."})}),children:e.jsx(ir,{pageNumber:v,scale:c,renderTextLayer:!0,renderAnnotationLayer:!0})})})]}):d.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("p",{className:"text-gray-500",children:"No PDF files found for this pattern."}),r&&e.jsx(W,{to:`/patterns/${r.id}`,className:"inline-block mt-2 text-purple-600 hover:text-purple-700 text-sm",children:"Upload a PDF file →"})]}):null]})}function Xa(){const{id:t}=dr(),s=fe(),{joinProject:r,leaveProject:y}=Ua(),[l,w]=a.useState(null),[m,C]=a.useState([]),[p,u]=a.useState(!0),[v,o]=a.useState(!1),[c,h]=a.useState(!1),[g,N]=a.useState(!1),[F,i]=a.useState(!1),[j,E]=a.useState([]),[_,b]=a.useState([]),[P,x]=a.useState("audio"),[d,n]=a.useState(!1),[D,R]=a.useState(""),[$,I]=a.useState(!1),[U,K]=a.useState(!1),[A,M]=a.useState(!1),[H,L]=a.useState(!1),[B,T]=a.useState([]),[O,Q]=a.useState([]),[Ie,$r]=a.useState([]),[ft,Mr]=a.useState([]),[Be,Oe]=a.useState(""),[Ue,Ye]=a.useState(""),[ne,Se]=a.useState({skeins:"",yards:""}),[qe,Ve]=a.useState(""),[le,jt]=a.useState(!1),[re,ce]=a.useState({name:"",description:"",designer:"",difficulty:"intermediate"}),[ve,He]=a.useState(null),[te,ue]=a.useState({name:"",description:"",status:"active",notes:"",recipientId:""});a.useEffect(()=>(se(),Ke(),_e(),De(),t&&r(t),()=>{t&&y(t)}),[t,r,y]);const[We,Fe]=a.useState(null),[vt,wt]=a.useState([]);a.useEffect(()=>{c&&(Pe(),Rr())},[c]);const Rr=async()=>{try{const f=await S.get(`/api/projects/${t}/sessions/active`);f.data.success&&f.data.data&&Fe(f.data.data)}catch{Fe(null)}},Pe=async()=>{try{const f=await S.get(`/api/projects/${t}/sessions`);wt(f.data.success?f.data.data.sessions||[]:[])}catch(f){console.error("Failed to fetch sessions:",f),wt([])}},se=async()=>{try{const z=(await S.get(`/api/projects/${t}`)).data.data.project;w(z),ue({name:z.name,description:z.description||"",status:z.status||"active",notes:z.notes||"",recipientId:z.recipient_id||""})}catch(f){console.error("Error fetching project:",f),k.error("Failed to load project"),s("/projects")}finally{u(!1)}},_e=async()=>{try{const[f,z,Y,J]=await Promise.all([S.get("/api/patterns"),S.get("/api/yarn"),S.get("/api/tools"),S.get("/api/recipients")]);T(f.data.data.patterns||[]),Q(z.data.data.yarn||[]),$r(Y.data.data.tools||[]),Mr(J.data.data.recipients||[])}catch(f){console.error("Error fetching available items:",f)}},Tr=async f=>{f.preventDefault();try{await S.put(`/api/projects/${t}`,te),k.success("Project updated successfully!"),o(!1),se()}catch(z){console.error("Error updating project:",z),k.error("Failed to update project")}},Ar=async()=>{if(confirm(`Are you sure you want to delete "${l?.name}"?`))try{await S.delete(`/api/projects/${t}`),k.success("Project deleted successfully"),s("/projects")}catch(f){console.error("Error deleting project:",f),k.error("Failed to delete project")}},Lr=()=>{R(l?.notes||""),n(!0)},zr=async()=>{try{await S.put(`/api/projects/${t}`,{name:l?.name,description:l?.description,status:l?.status,notes:D}),k.success("Notes saved successfully!"),n(!1),se()}catch(f){console.error("Error saving notes:",f),k.error("Failed to save notes")}},Ir=()=>{R(""),n(!1)},Br=async()=>{if(!Be){k.error("Please select a pattern");return}try{await S.post(`/api/projects/${t}/patterns`,{patternId:Be}),k.success("Pattern added to project!"),I(!1),Oe(""),se()}catch(f){console.error("Error adding pattern:",f),k.error(f.response?.data?.message||"Failed to add pattern")}},Or=async f=>{try{await S.delete(`/api/projects/${t}/patterns/${f}`),k.success("Pattern removed from project"),se()}catch(z){console.error("Error removing pattern:",z),k.error("Failed to remove pattern")}},Ur=async f=>{if(f.preventDefault(),!ve){k.error("Please select a pattern file to upload");return}if(!re.name.trim()){k.error("Please enter a pattern name");return}jt(!0);try{const Y=(await S.post("/api/patterns",re)).data.data.pattern;k.success("Pattern created!");const J=new FormData;J.append("file",ve),J.append("description","Pattern file"),await S.post(`/api/uploads/patterns/${Y.id}/files`,J,{headers:{"Content-Type":"multipart/form-data"}}),k.success("File uploaded!"),await S.post(`/api/projects/${t}/patterns`,{patternId:Y.id}),k.success("Pattern added to project!"),K(!1),ce({name:"",description:"",designer:"",difficulty:"intermediate"}),He(null),se(),_e()}catch(z){console.error("Error uploading pattern:",z),k.error(z.response?.data?.message||"Failed to upload pattern")}finally{jt(!1)}},Yr=async()=>{if(!Ue){k.error("Please select yarn");return}try{await S.post(`/api/projects/${t}/yarn`,{yarnId:Ue,skeinsUsed:ne.skeins?parseFloat(ne.skeins):void 0,yardsUsed:ne.yards?parseFloat(ne.yards):void 0}),k.success("Yarn added to project! Stash has been updated."),M(!1),Ye(""),Se({skeins:"",yards:""}),se(),_e()}catch(f){console.error("Error adding yarn:",f),k.error(f.response?.data?.message||"Failed to add yarn")}},qr=async f=>{if(confirm("Remove this yarn? The used amount will be restored to your stash."))try{await S.delete(`/api/projects/${t}/yarn/${f}`),k.success("Yarn removed and restored to stash"),se(),_e()}catch(z){console.error("Error removing yarn:",z),k.error("Failed to remove yarn")}},Vr=async()=>{if(!qe){k.error("Please select a tool");return}try{await S.post(`/api/projects/${t}/tools`,{toolId:qe}),k.success("Tool added to project!"),L(!1),Ve(""),se()}catch(f){console.error("Error adding tool:",f),k.error(f.response?.data?.message||"Failed to add tool")}},Hr=async f=>{try{await S.delete(`/api/projects/${t}/tools/${f}`),k.success("Tool removed from project"),se()}catch(z){console.error("Error removing tool:",z),k.error("Failed to remove tool")}},Ke=async()=>{try{const f=await S.get(`/api/uploads/projects/${t}/photos`);C(f.data.data.photos)}catch(f){console.error("Error fetching photos:",f)}},De=async()=>{try{const f=await S.get(`/api/projects/${t}/audio-notes`);E(f.data.data.audioNotes||[])}catch(f){console.error("Error fetching audio notes:",f)}},Nt=async()=>{try{const f=await S.get(`/api/projects/${t}/structured-memos`);b(f.data.data.memos||[])}catch(f){console.error("Error fetching structured memos:",f)}},kt=async(f,z,Y)=>{const J=new FormData;J.append("audio",f,"audio-note.webm"),J.append("durationSeconds",z.toString()),Y&&J.append("transcription",Y);try{await S.post(`/api/projects/${t}/audio-notes`,J,{headers:{"Content-Type":"multipart/form-data"}}),k.success("Audio note saved!"),De()}catch(Ft){throw console.error("Error saving audio note:",Ft),k.error("Failed to save audio note"),Ft}},Ct=async f=>{try{await S.delete(`/api/projects/${t}/audio-notes/${f}`),k.success("Audio note deleted"),De()}catch(z){throw console.error("Error deleting audio note:",z),k.error("Failed to delete audio note"),z}},St=async(f,z)=>{try{await S.put(`/api/projects/${t}/audio-notes/${f}`,{transcription:z}),k.success("Transcription updated"),De()}catch(Y){throw console.error("Error updating transcription:",Y),k.error("Failed to update transcription"),Y}},Wr=async(f,z)=>{try{await S.post(`/api/projects/${t}/structured-memos`,{templateType:f,data:z}),k.success("Memo saved!"),Nt()}catch(Y){throw console.error("Error saving memo:",Y),k.error("Failed to save memo"),Y}},Kr=async f=>{try{await S.delete(`/api/projects/${t}/structured-memos/${f}`),k.success("Memo deleted"),Nt()}catch(z){throw console.error("Error deleting memo:",z),k.error("Failed to delete memo"),z}},Gr=()=>{h(!c),c?k.info("Knitting Mode deactivated"):k.success("Knitting Mode activated! 🧶")},Qr=()=>{const f={};return l?.counters&&l.counters.forEach(z=>{f[z.id]=z.current_count||0}),f},Xr=async()=>{try{const f=await S.post(`/api/projects/${t}/sessions/start`,{mood:void 0,location:void 0,notes:"Knitting session"}),z=f.data.success?f.data.data.session:f.data;return Fe(z),await Pe(),k.success("Knitting session started! 🎉"),z}catch(f){throw console.error("Failed to start session:",f),k.error("Failed to start session"),f}},Zr=async(f,z)=>{if(We)try{await S.post(`/api/projects/${t}/sessions/${We.id}/end`,{notes:f,mood:z}),Fe(null),await Pe(),k.success("Session ended and saved!")}catch(Y){throw console.error("Failed to end session:",Y),k.error("Failed to end session"),Y}},Jr=async f=>{try{await S.delete(`/api/projects/${t}/sessions/${f}`),await Pe(),k.success("Session deleted")}catch(z){console.error("Failed to delete session:",z),k.error("Failed to delete session")}},es=async f=>{const z=new FormData;z.append("photo",f);try{await S.post(`/api/uploads/projects/${t}/photos`,z,{headers:{"Content-Type":"multipart/form-data"}}),k.success("Photo uploaded successfully!"),Ke()}catch(Y){throw console.error("Error uploading photo:",Y),k.error("Failed to upload photo"),Y}},ts=async f=>{try{await S.delete(`/api/uploads/projects/${t}/photos/${f}`),k.success("Photo deleted successfully"),Ke()}catch(z){console.error("Error deleting photo:",z),k.error("Failed to delete photo")}},Ge=f=>f?new Date(f).toLocaleDateString():"Not set",rs=f=>{switch(f){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paused":return"bg-yellow-100 text-yellow-800";case"planned":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},ss=f=>{const z=f.yarn_remaining||0,Y=f.yarn_total||1;return Math.max(0,Math.min(100,z/Y*100))};if(p)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Fr,{size:"lg",text:"Loading project..."})});if(!l)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Project not found"}),e.jsx(W,{to:"/projects",className:"text-purple-600 hover:text-purple-700 mt-4 inline-block",children:"Back to Projects"})]});const Qe=ft.find(f=>f.id===te.recipientId);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(W,{to:"/projects",className:"inline-flex items-center text-purple-600 hover:text-purple-700 mb-4",children:[e.jsx(cr,{className:"mr-2"}),"Back to Projects"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:l.name}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${rs(l.status)}`,children:l.status})]}),l.project_type&&e.jsxs("p",{className:"text-gray-600",children:["Type: ",l.project_type]}),Qe&&e.jsxs("p",{className:"text-gray-600 flex items-center mt-1",children:[e.jsx(Wt,{className:"mr-2 h-4 w-4"}),"Gift for: ",Qe.first_name," ",Qe.last_name]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:Gr,className:`px-4 py-3 md:py-2 rounded-lg transition flex items-center min-h-[48px] md:min-h-0 ${c?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[c?e.jsx(bt,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}):e.jsx(Le,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:c?"Exit Knitting Mode":"Knitting Mode"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"px-4 py-3 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center min-h-[48px] md:min-h-0",children:[e.jsx(ae,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Edit"})]}),e.jsxs("button",{onClick:Ar,className:"px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition flex items-center min-h-[48px] md:min-h-0",children:[e.jsx(X,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Delete"})]})]})]})]}),c?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[l.patterns&&l.patterns.length>0&&e.jsx(Ot,{patterns:l.patterns,mode:"knitting"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 md:p-6",children:e.jsx(zt,{projectId:t})})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:"Session Timer"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(!g),className:`p-2 rounded-lg transition ${g?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,title:"Voice Notes",children:e.jsx(ot,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>i(!F),className:`p-2 rounded-lg transition ${F?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,title:"History",children:e.jsx(ee,{className:"h-4 w-4"})})]})]}),e.jsx(kr,{projectId:t,currentSession:We,onStartSession:Xr,onEndSession:Zr,getCurrentCounterValues:Qr})]}),g&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4",children:"Voice Notes"}),e.jsx(It,{projectId:t,notes:j,onSaveNote:kt,onDeleteNote:Ct,onUpdateTranscription:St})]}),F&&vt.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4",children:"Session History"}),e.jsx(Cr,{sessions:vt,onDeleteSession:Jr})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.description&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:l.description})]}),l.patterns&&l.patterns.length>0&&e.jsx(Ot,{patterns:l.patterns,mode:"normal"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ur,{className:"h-5 w-5 text-purple-600 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Photos"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",m.length,")"]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(Aa,{onUpload:es})}),e.jsx(Ta,{photos:m,onDelete:ts})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsx(zt,{projectId:t})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(Qa,{projectId:t,counters:l?.counters||[]})}),e.jsx(Ba,{projectId:t,totalRows:0,getCurrentCounterValues:()=>({})}),e.jsxs("div",{id:"notes-section",className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 pt-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Notes"}),e.jsxs("nav",{className:"flex -mb-px gap-6",children:[e.jsx("button",{onClick:()=>x("audio"),className:`pb-3 text-sm font-medium border-b-2 ${P==="audio"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Audio Notes"}),e.jsx("button",{onClick:()=>x("handwritten"),className:`pb-3 text-sm font-medium border-b-2 ${P==="handwritten"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Handwritten"}),e.jsx("button",{onClick:()=>x("memos"),className:`pb-3 text-sm font-medium border-b-2 ${P==="memos"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Structured Memos"})]})]}),e.jsxs("div",{className:"p-6",children:[P==="audio"&&e.jsx(It,{projectId:t,notes:j,onSaveNote:kt,onDeleteNote:Ct,onUpdateTranscription:St}),P==="handwritten"&&e.jsx(Va,{projectId:t,onSave:async f=>{try{const Y=await(await fetch(f)).blob(),J=new FormData;J.append("image",Y,"handwritten-note.png"),await S.post(`/api/projects/${t}/handwritten-notes`,J,{headers:{"Content-Type":"multipart/form-data"}}),k.success("Handwritten note saved!")}catch(z){throw console.error("Error saving handwritten note:",z),z}}}),P==="memos"&&e.jsx(Ha,{projectId:t,memos:_,onSaveMemo:Wr,onDeleteMemo:Kr})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Timeline"}),e.jsxs("div",{className:"space-y-3",children:[l.start_date&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(Gt,{className:"mt-1 mr-3 h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Started"}),e.jsx("p",{className:"text-sm text-gray-600",children:Ge(l.start_date)})]})]}),l.target_completion_date&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(ee,{className:"mt-1 mr-3 h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Target Completion"}),e.jsx("p",{className:"text-sm text-gray-600",children:Ge(l.target_completion_date)})]})]}),l.completion_date&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(he,{className:"mt-1 mr-3 h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Completed"}),e.jsx("p",{className:"text-sm text-gray-600",children:Ge(l.completion_date)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),!d&&e.jsx("button",{onClick:Lr,className:"text-purple-600 hover:text-purple-700",title:"Edit notes",children:e.jsx(ae,{className:"h-4 w-4"})})]}),d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:D,onChange:f=>R(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",rows:6,placeholder:"Add notes about your project..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:zr,className:"flex-1 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm flex items-center justify-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Save"]}),e.jsxs("button",{onClick:Ir,className:"flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Cancel"]})]})]}):e.jsx("div",{children:l.notes?e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:l.notes}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No notes added yet"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patterns"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(!0),className:"text-purple-600 hover:text-purple-700 text-xs flex items-center gap-1",title:"Select existing pattern",children:[e.jsx(q,{className:"h-4 w-4"}),"Select"]}),e.jsxs("button",{onClick:()=>K(!0),className:"px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 flex items-center gap-1",title:"Upload new pattern",children:[e.jsx(q,{className:"h-3 w-3"}),"Upload"]})]})]}),l.patterns&&l.patterns.length>0?e.jsx("ul",{className:"space-y-2",children:l.patterns.map(f=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx(W,{to:`/patterns/${f.id}`,className:"text-purple-600 hover:text-purple-700 flex-1",children:f.name}),e.jsx("button",{onClick:()=>Or(f.id),className:"text-red-600 hover:text-red-700 ml-2",title:"Remove pattern",children:e.jsx(Z,{className:"h-4 w-4"})})]},f.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No patterns added"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Tools"}),e.jsx("button",{onClick:()=>L(!0),className:"text-purple-600 hover:text-purple-700",title:"Add tool",children:e.jsx(q,{className:"h-5 w-5"})})]}),l.tools&&l.tools.length>0?e.jsx("ul",{className:"space-y-2",children:l.tools.map(f=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-700 flex-1",children:[f.name,f.size&&e.jsxs("span",{className:"text-gray-500",children:[" (",f.size,")"]})]}),e.jsx("button",{onClick:()=>Hr(f.id),className:"text-red-600 hover:text-red-700 ml-2",title:"Remove tool",children:e.jsx(Z,{className:"h-4 w-4"})})]},f.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No tools added"})]}),l.yarn&&l.yarn.length>0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Yarn Usage"}),e.jsx("button",{onClick:()=>M(!0),className:"text-purple-600 hover:text-purple-700",title:"Add yarn",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"space-y-4",children:l.yarn.map(f=>{const z=ss(f),Y=f.low_stock_alert&&f.yards_remaining<=(f.low_stock_threshold||0);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:[f.brand," ",f.name,f.color&&e.jsxs("span",{className:"text-gray-600",children:[" - ",f.color]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:f.weight})]}),e.jsx("button",{onClick:()=>qr(f.id),className:"text-red-600 hover:text-red-700 p-1",title:"Remove yarn",children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Used in Project"}),e.jsxs("p",{className:"text-xs font-medium text-gray-900",children:[f.skeins_used||0," skeins, ",f.yards_used||0," yds"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining in Stash"}),e.jsxs("p",{className:"text-xs font-medium text-gray-900",children:[f.skeins_remaining||0," skeins, ",f.yards_remaining||0," yds"]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Stash Level"}),e.jsxs("span",{children:[z.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${z<20?"bg-red-500":z<50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${z}%`}})})]}),Y&&e.jsxs("div",{className:"flex items-center text-orange-600 text-xs mt-2",children:[e.jsx(de,{className:"mr-1 h-3 w-3"}),"Low stock! Only ",f.yards_remaining," yards remaining"]})]},f.id)})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Yarn Usage"}),e.jsx("button",{onClick:()=>M(!0),className:"text-purple-600 hover:text-purple-700",title:"Add yarn",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"No yarn added"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Project"})}),e.jsxs("form",{onSubmit:Tr,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name"}),e.jsx("input",{type:"text",value:te.name,onChange:f=>ue({...te,name:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:te.description,onChange:f=>ue({...te,description:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:te.status,onChange:f=>ue({...te,status:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gift Recipient (Optional)"}),e.jsxs("select",{value:te.recipientId,onChange:f=>ue({...te,recipientId:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"None"}),ft.map(f=>e.jsxs("option",{value:f.id,children:[f.first_name," ",f.last_name]},f.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:te.notes,onChange:f=>ue({...te,notes:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:5,placeholder:"Add notes about your project..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Save Changes"})]})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Pattern to Project"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Pattern"}),e.jsxs("select",{value:Be,onChange:f=>Oe(f.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Choose a pattern..."}),B.filter(f=>!l?.patterns?.some(z=>z.id===f.id)).map(f=>e.jsxs("option",{value:f.id,children:[f.name,f.designer&&` by ${f.designer}`]},f.id))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{I(!1),Oe("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Br,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Pattern"})]})]})]})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Upload New Pattern"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload a PDF pattern and add it to this project"})]}),e.jsxs("form",{onSubmit:Ur,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:re.name,onChange:f=>ce({...re,name:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Cable Knit Sweater",required:!0,disabled:le})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:re.designer,onChange:f=>ce({...re,designer:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Jane Doe",disabled:le})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:re.difficulty,onChange:f=>ce({...re,difficulty:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:le,children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:re.description,onChange:f=>ce({...re,description:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Brief description of the pattern...",disabled:le})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern File (PDF) *"}),e.jsx("input",{type:"file",accept:".pdf,application/pdf",onChange:f=>He(f.target.files?.[0]||null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100",required:!0,disabled:le}),ve&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",ve.name," (",(ve.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{K(!1),ce({name:"",description:"",designer:"",difficulty:"intermediate"}),He(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",disabled:le,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:le,children:le?"Uploading...":"Upload & Add to Project"})]})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Yarn to Project"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Yarn"}),e.jsxs("select",{value:Ue,onChange:f=>Ye(f.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose yarn..."}),O.filter(f=>f.skeins_remaining>0).map(f=>e.jsxs("option",{value:f.id,children:[f.brand," ",f.name," - ",f.color,"(",f.skeins_remaining," skeins, ",f.yards_remaining," yds available)"]},f.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Skeins to Use"}),e.jsx("input",{type:"number",value:ne.skeins,onChange:f=>Se({...ne,skeins:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yards to Use"}),e.jsx("input",{type:"number",value:ne.yards,onChange:f=>Se({...ne,yards:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0",min:"0",step:"1"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"The specified amount will be deducted from your stash automatically."}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{M(!1),Ye(""),Se({skeins:"",yards:""})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Yr,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Yarn"})]})]})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Tool to Project"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Tool"}),e.jsxs("select",{value:qe,onChange:f=>Ve(f.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Choose a tool..."}),Ie.filter(f=>!l?.tools?.some(z=>z.id===f.id)).map(f=>e.jsxs("option",{value:f.id,children:[f.name,f.size&&` (${f.size})`,f.type&&` - ${f.type}`]},f.id))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{L(!1),Ve("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Vr,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Tool"})]})]})]})})]})}const Za=[{name:"Yellow",value:"#FBBF24"},{name:"Red",value:"#EF4444"},{name:"Blue",value:"#3B82F6"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Pink",value:"#EC4899"}];function Pr({patternId:t,projectId:s,currentPage:r=1,currentZoom:y=1,onJumpToBookmark:l}){const[w,m]=a.useState([]),[C,p]=a.useState(!1),[u,v]=a.useState(null),[o,c]=a.useState({name:"",pageNumber:r,notes:"",color:"#FBBF24"});a.useEffect(()=>{h()},[t,s]);const h=async()=>{try{const b=s?{projectId:s}:{},P=await S.get(`/api/patterns/${t}/bookmarks`,{params:b});m(P.data.data.bookmarks)}catch(b){console.error("Error fetching bookmarks:",b)}},g=async()=>{if(!o.name.trim()){k.error("Please enter a bookmark name");return}try{await S.post(`/api/patterns/${t}/bookmarks`,{name:o.name,pageNumber:o.pageNumber,zoomLevel:y,notes:o.notes||null,color:o.color,projectId:s||null}),k.success("Bookmark created!"),p(!1),j(),h()}catch(b){console.error("Error creating bookmark:",b),k.error(b.response?.data?.message||"Failed to create bookmark")}},N=async()=>{if(u)try{await S.put(`/api/patterns/${t}/bookmarks/${u.id}`,{name:o.name,pageNumber:o.pageNumber,notes:o.notes||null,color:o.color}),k.success("Bookmark updated!"),v(null),j(),h()}catch(b){console.error("Error updating bookmark:",b),k.error(b.response?.data?.message||"Failed to update bookmark")}},F=async b=>{if(confirm("Delete this bookmark?"))try{await S.delete(`/api/patterns/${t}/bookmarks/${b}`),k.success("Bookmark deleted"),h()}catch(P){console.error("Error deleting bookmark:",P),k.error("Failed to delete bookmark")}},i=async()=>{try{await S.post(`/api/patterns/${t}/bookmarks`,{name:`Page ${r}`,pageNumber:r,zoomLevel:y,color:"#FBBF24",projectId:s||null}),k.success(`Bookmark added for page ${r}!`),h()}catch(b){console.error("Error creating quick bookmark:",b),k.error("Failed to create bookmark")}},j=()=>{c({name:"",pageNumber:r,notes:"",color:"#FBBF24"})},E=()=>{j(),p(!0)},_=b=>{c({name:b.name,pageNumber:b.page_number,notes:b.notes||"",color:b.color}),v(b)};return e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-5 w-5 text-yellow-400"}),e.jsx("h3",{className:"text-white font-semibold",children:"Bookmarks"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["(",w.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"p-2 bg-gray-600 hover:bg-gray-500 rounded text-white text-sm",title:"Quick bookmark current page",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsxs("button",{onClick:E,className:"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded text-white text-sm flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"New"]})]})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:w.length===0?e.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"No bookmarks yet"}):w.map(b=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 rounded-lg hover:bg-gray-750 cursor-pointer group",children:[e.jsx("div",{className:"w-1 h-12 rounded-full flex-shrink-0",style:{backgroundColor:b.color}}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>l(b),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-white font-medium truncate",children:b.name}),e.jsx(be,{className:"h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400",children:[e.jsxs("span",{children:["Page ",b.page_number]}),b.notes&&e.jsx("span",{className:"truncate max-w-xs",children:b.notes})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:P=>{P.stopPropagation(),_(b)},className:"p-1.5 hover:bg-gray-600 rounded text-blue-400",title:"Edit bookmark",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx("button",{onClick:P=>{P.stopPropagation(),F(b.id)},className:"p-1.5 hover:bg-gray-600 rounded text-red-400",title:"Delete bookmark",children:e.jsx(X,{className:"h-4 w-4"})})]})]},b.id))}),(C||u)&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:u?"Edit Bookmark":"New Bookmark"}),e.jsx("button",{onClick:()=>{p(!1),v(null),j()},className:"text-gray-400 hover:text-white",children:e.jsx(Z,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Bookmark Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:b=>c({...o,name:b.target.value}),placeholder:"e.g., Current row, Sleeve decreases",className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Page Number"}),e.jsx("input",{type:"number",value:o.pageNumber,onChange:b=>c({...o,pageNumber:parseInt(b.target.value)}),min:1,className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Za.map(b=>e.jsx("button",{onClick:()=>c({...o,color:b.value}),className:`w-full h-10 rounded border-2 ${o.color===b.value?"border-white":"border-gray-600 hover:border-gray-400"}`,style:{backgroundColor:b.value},title:b.name},b.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:o.notes,onChange:b=>c({...o,notes:b.target.value}),placeholder:"Additional notes or instructions",rows:3,className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{p(!1),v(null),j()},className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Cancel"}),e.jsx("button",{onClick:u?N:g,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:u?"Update":"Create"})]})]})]})})]})}const Ut=[{name:"Yellow",value:"#FBBF24"},{name:"Red",value:"#EF4444"},{name:"Blue",value:"#3B82F6"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Pink",value:"#EC4899"}];function Ja({patternId:t,projectId:s,pageNumber:r,isActive:y}){const[l,w]=a.useState([]),[m,C]=a.useState(!1),[p,u]=a.useState(null),[v,o]=a.useState(null),[c,h]=a.useState(Ut[0].value),[g,N]=a.useState(.3),[F,i]=a.useState(!0),j=a.useRef(null),E=a.useRef(null);a.useEffect(()=>{y&&_()},[t,s,r,y]),a.useEffect(()=>{y&&b()},[l,y]);const _=async()=>{try{const $={pageNumber:r};s&&($.projectId=s);const I=await S.get(`/api/patterns/${t}/highlights`,{params:$});w(I.data.data.highlights||[])}catch($){console.error("Error fetching highlights:",$)}},b=()=>{const $=j.current;if(!$)return;const I=$.getContext("2d");I&&(I.clearRect(0,0,$.width,$.height),l.forEach(U=>{I.fillStyle=U.color,I.globalAlpha=U.opacity,I.fillRect(U.coordinates.x,U.coordinates.y,U.coordinates.width,U.coordinates.height)}),v&&(I.fillStyle=c,I.globalAlpha=g,I.fillRect(v.x,v.y,v.width,v.height)),I.globalAlpha=1)},P=$=>{const I=j.current;if(!I)return{x:0,y:0};const U=I.getBoundingClientRect();return{x:$.clientX-U.left,y:$.clientY-U.top}},x=$=>{if(!y)return;const I=P($);u(I),C(!0)},d=$=>{if(!m||!p)return;const I=P($),U=I.x-p.x,K=I.y-p.y;o({x:U<0?I.x:p.x,y:K<0?I.y:p.y,width:Math.abs(U),height:Math.abs(K)}),b()},n=async()=>{if(!m||!v){C(!1);return}v.width>5&&v.height>5&&await D(v),C(!1),u(null),o(null)},D=async $=>{try{await S.post(`/api/patterns/${t}/highlights`,{pageNumber:r,coordinates:$,color:c,opacity:g,projectId:s||null}),k.success("Highlight saved!"),_()}catch(I){console.error("Error saving highlight:",I),k.error("Failed to save highlight")}},R=async()=>{if(confirm("Clear all highlights on this page?"))try{await Promise.all(l.map($=>S.delete(`/api/patterns/${t}/highlights/${$.id}`))),k.success("All highlights cleared"),w([])}catch($){console.error("Error clearing highlights:",$),k.error("Failed to clear highlights")}};return y?e.jsxs(e.Fragment,{children:[e.jsx("canvas",{ref:j,className:"absolute inset-0 w-full h-full z-30 pointer-events-auto",style:{cursor:m?"crosshair":"default"},width:E.current?.clientWidth||800,height:E.current?.clientHeight||1e3,onMouseDown:x,onMouseMove:d,onMouseUp:n,onMouseLeave:n}),e.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:"Highlighter"}),e.jsx("button",{onClick:()=>i(!F),className:"p-1 hover:bg-gray-700 rounded text-gray-400",children:F?e.jsx(bt,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]}),F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-300 bg-gray-700 rounded p-2",children:e.jsx("p",{children:"Click and drag to highlight"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ut.map($=>e.jsx("button",{onClick:()=>h($.value),className:`h-10 rounded border-2 ${c===$.value?"border-white":"border-gray-600"}`,style:{backgroundColor:$.value},title:$.name},$.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:["Opacity: ",Math.round(g*100),"%"]}),e.jsx("input",{type:"range",min:"0.1",max:"0.6",step:"0.1",value:g,onChange:$=>N(parseFloat($.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"text-xs text-gray-400 pt-2 border-t border-gray-700",children:[l.length," highlight",l.length!==1?"s":""," on this page"]}),l.length>0&&e.jsxs("button",{onClick:R,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Clear All"]})]})]})]}):null}const Yt=[{name:"Yellow",value:"#FBBF24",opacity:.3},{name:"Red",value:"#EF4444",opacity:.3},{name:"Blue",value:"#3B82F6",opacity:.3},{name:"Green",value:"#10B981",opacity:.3},{name:"Purple",value:"#8B5CF6",opacity:.3}];function en({pageNumber:t,onPositionChange:s}){const[r,y]=a.useState({x:50,y:50}),[l,w]=a.useState(3),[m,C]=a.useState(!1),[p,u]=a.useState(!1),[v,o]=a.useState(Yt[0].value),[c,h]=a.useState(.3),[g,N]=a.useState(!1),[F,i]=a.useState(!0),[j,E]=a.useState(!1),[_,b]=a.useState({x:0,y:0}),P=a.useCallback(R=>{g||(R.preventDefault(),C(!0),b({x:R.clientX-r.x*window.innerWidth/100,y:R.clientY-r.y*window.innerHeight/100}))},[g,r]),x=a.useCallback(R=>{if(!m||g)return;const $=(R.clientX-_.x)/window.innerWidth*100,I=(R.clientY-_.y)/window.innerHeight*100;y({x:Math.max(0,Math.min(100,$)),y:Math.max(0,Math.min(100-l,I))})},[m,g,_,l]),d=a.useCallback(()=>{m&&(C(!1),s?.(r)),u(!1)},[m,r,s]),n=a.useCallback(R=>{g||(R.stopPropagation(),u(!0))},[g]),D=a.useCallback(R=>{if(!p||g)return;const $=R.clientY/window.innerHeight*100-r.y;w(Math.max(1,Math.min(20,$)))},[p,g,r.y]);return a.useEffect(()=>{const R=$=>{if(F)switch($.key){case"ArrowUp":g||($.preventDefault(),y(I=>({...I,y:Math.max(0,I.y-1)})));break;case"ArrowDown":g||($.preventDefault(),y(I=>({...I,y:Math.min(100-l,I.y+1)})));break;case"l":case"L":($.ctrlKey||$.metaKey)&&($.preventDefault(),N(!g));break;case"h":case"H":($.ctrlKey||$.metaKey)&&($.preventDefault(),i(!F));break}};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[F,g,l]),a.useEffect(()=>{if(m)return window.addEventListener("mousemove",x),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",d)}},[m,x,d]),a.useEffect(()=>{if(p)return window.addEventListener("mousemove",D),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",d)}},[p,D,d]),F?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed z-40 transition-opacity ${m?"cursor-move":""} ${g?"pointer-events-none":"cursor-move"}`,style:{left:`${r.x}%`,top:`${r.y}%`,width:"90%",height:`${l}%`,backgroundColor:v,opacity:c,transform:"translate(-50%, 0)"},onMouseDown:P,onMouseEnter:()=>!g&&E(!0),onMouseLeave:()=>E(!1),children:[j&&!g&&e.jsxs("div",{className:"absolute top-0 right-0 flex items-center gap-1 bg-gray-900 bg-opacity-90 rounded-bl-lg p-1",children:[e.jsx("button",{onClick:R=>{R.stopPropagation(),i(!1)},className:"p-1 hover:bg-gray-700 rounded text-white",title:"Hide marker",children:e.jsx(bt,{className:"h-3 w-3"})}),e.jsx(gr,{className:"h-3 w-3 text-white",title:"Drag to move"})]}),!g&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize bg-gray-900 bg-opacity-50 hover:bg-opacity-75",onMouseDown:n,title:"Drag to resize"})]}),e.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:"Row Marker"}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 hover:bg-gray-700 rounded text-gray-400",title:"Hide marker (Ctrl+H)",children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"flex gap-2",children:Yt.map(R=>e.jsx("button",{onClick:()=>o(R.value),className:`w-8 h-8 rounded border-2 ${v===R.value?"border-white":"border-gray-600"}`,style:{backgroundColor:R.value},title:R.name},R.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:["Opacity: ",Math.round(c*100),"%"]}),e.jsx("input",{type:"range",min:"0.1",max:"0.8",step:"0.1",value:c,onChange:R=>h(parseFloat(R.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:["Height: ",l.toFixed(1),"%"]}),e.jsx("input",{type:"range",min:"1",max:"20",step:"0.5",value:l,onChange:R=>w(parseFloat(R.target.value)),className:"w-full"})]}),e.jsxs("button",{onClick:()=>N(!g),className:`w-full px-3 py-2 rounded text-sm font-medium ${g?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:[g?"🔒 Locked":"🔓 Unlocked"," (Ctrl+L)"]}),e.jsxs("div",{className:"text-xs text-gray-400 space-y-1 pt-2 border-t border-gray-700",children:[e.jsx("p",{children:"• Drag marker to move"}),e.jsx("p",{children:"• Drag bottom edge to resize"}),e.jsx("p",{children:"• Arrow keys to fine-tune"}),e.jsx("p",{children:"• Ctrl+L to lock/unlock"}),e.jsx("p",{children:"• Ctrl+H to hide/show"})]})]})]}):e.jsxs("button",{onClick:()=>i(!0),className:"fixed top-20 right-4 z-50 px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg shadow-lg flex items-center gap-2",title:"Show row marker (Ctrl+H)",children:[e.jsx(Le,{className:"h-4 w-4"}),"Show Marker"]})}lr.workerSrc="/pdf.worker.min.js";const Ee=[.5,.75,1,1.25,1.5,1.75,2];function _r({fileUrl:t,filename:s,patternId:r,projectId:y,onClose:l,fullscreen:w=!0}){const[m,C]=a.useState(0),[p,u]=a.useState(1),[v,o]=a.useState(2),[c,h]=a.useState(0),[g,N]=a.useState(""),[F,i]=a.useState(!1),[j,E]=a.useState(!1),[_,b]=a.useState(!!r),[P,x]=a.useState(!1),[d,n]=a.useState(!1),D=Ee[v];function R({numPages:T}){C(T),u(1),k.success(`PDF loaded: ${T} pages`)}function $(T){console.error("Error loading PDF:",T),k.error("Failed to load PDF file")}const I=a.useCallback(()=>{v<Ee.length-1&&o(T=>T+1)},[v]),U=a.useCallback(()=>{v>0&&o(T=>T-1)},[v]),K=a.useCallback(()=>{h(T=>(T+90)%360)},[]),A=a.useCallback(()=>{p<m&&u(T=>T+1)},[p,m]),M=a.useCallback(()=>{p>1&&u(T=>T-1)},[p]),H=a.useCallback(T=>{T>=1&&T<=m&&u(T)},[m]),L=a.useCallback(()=>{document.fullscreenElement?(document.exitFullscreen(),E(!1)):(document.documentElement.requestFullscreen(),E(!0))},[]),B=a.useCallback(T=>{if(u(T.page_number),T.zoom_level){const O=Ee.findIndex(Q=>Math.abs(Q-T.zoom_level)<.01);O!==-1&&o(O)}k.success(`Jumped to: ${T.name}`)},[]);return a.useEffect(()=>{const T=O=>{switch(O.key){case"ArrowRight":case"PageDown":A();break;case"ArrowLeft":case"PageUp":M();break;case"Home":u(1);break;case"End":u(m);break;case"+":case"=":I();break;case"-":U();break;case"f":case"F":(O.ctrlKey||O.metaKey)&&(O.preventDefault(),i(!0));break;case"Escape":i(!1);break}};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[p,m,A,M,I,U]),a.useEffect(()=>{const T=()=>{E(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",T),()=>document.removeEventListener("fullscreenchange",T)},[]),e.jsxs("div",{className:w?"fixed inset-0 bg-gray-900 z-50 flex flex-col":"bg-gray-900 flex flex-col h-full",children:[e.jsxs("div",{className:"bg-gray-800 text-white p-3 flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"font-semibold text-lg truncate max-w-md",children:s}),e.jsx("span",{className:"text-sm text-gray-400",children:m>0&&`${m} pages`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:M,disabled:p<=1,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous page (←)",children:e.jsx(Qt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:p,onChange:T=>H(parseInt(T.target.value)),className:"w-14 px-2 py-1 bg-gray-600 text-white text-center rounded border-none focus:ring-2 focus:ring-purple-500",min:1,max:m}),e.jsxs("span",{className:"text-gray-400",children:["/ ",m]})]}),e.jsx("button",{onClick:A,disabled:p>=m,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Next page (→)",children:e.jsx(be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:U,disabled:v<=0,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom out (-)",children:e.jsx(Xt,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-sm font-medium w-12 text-center",children:[Math.round(D*100),"%"]}),e.jsx("button",{onClick:I,disabled:v>=Ee.length-1,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom in (+)",children:e.jsx(nt,{className:"h-5 w-5"})})]}),e.jsx("button",{onClick:K,className:"p-2 hover:bg-gray-700 rounded-lg",title:"Rotate clockwise",children:e.jsx(rr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>i(!F),className:`p-2 hover:bg-gray-700 rounded-lg ${F?"bg-gray-700":""}`,title:"Search (Ctrl+F)",children:e.jsx(st,{className:"h-5 w-5"})}),r&&e.jsx("button",{onClick:()=>b(!_),className:`p-2 hover:bg-gray-700 rounded-lg ${_?"bg-gray-700":""}`,title:"Bookmarks",children:e.jsx(xr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>x(!P),className:`p-2 hover:bg-gray-700 rounded-lg ${P?"bg-gray-700":""}`,title:"Row marker",children:e.jsx(gr,{className:"h-5 w-5"})}),r&&e.jsx("button",{onClick:()=>n(!d),className:`p-2 hover:bg-gray-700 rounded-lg ${d?"bg-gray-700":""}`,title:"Highlighter",children:e.jsx(sr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:L,className:"p-2 hover:bg-gray-700 rounded-lg",title:"Toggle fullscreen",children:e.jsx(Cs,{className:"h-5 w-5"})}),l&&e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-700 rounded-lg ml-2",title:"Close viewer (Esc)",children:e.jsx(Z,{className:"h-5 w-5"})})]})]}),F&&e.jsx("div",{className:"bg-gray-800 border-t border-gray-700 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3 max-w-md",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",value:g,onChange:T=>N(T.target.value),placeholder:"Search in document...",className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border-none focus:ring-2 focus:ring-purple-500",autoFocus:!0})}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-gray-700 rounded-lg text-white",children:e.jsx(Z,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[_&&r&&e.jsx("div",{className:"w-80 flex-shrink-0 border-r border-gray-700 overflow-y-auto",children:e.jsx(Pr,{patternId:r,projectId:y,currentPage:p,currentZoom:D,onJumpToBookmark:B})}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-800 p-4",children:e.jsx("div",{className:"flex justify-center min-h-full",children:e.jsx(or,{file:t,onLoadSuccess:R,onLoadError:$,loading:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-white text-lg",children:"Loading PDF..."})}),error:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-red-500 text-lg",children:"Failed to load PDF"})}),children:e.jsx(ir,{pageNumber:p,scale:D,rotate:c,renderTextLayer:!0,renderAnnotationLayer:!0,className:"shadow-2xl",loading:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-white",children:"Loading page..."})})})})})})]}),e.jsxs("div",{className:"md:hidden bg-gray-800 text-white text-center py-2 border-t border-gray-700",children:["Page ",p," of ",m]}),P&&e.jsx(en,{pageNumber:p}),d&&r&&e.jsx(Ja,{patternId:r,projectId:y,pageNumber:p,isActive:d})]})}const tn=()=>{const[t,s]=a.useState([]),[r,y]=a.useState([]),[l,w]=a.useState(!1),[m,C]=a.useState("Pattern"),[p,u]=a.useState(!1),[v,o]=a.useState(null),[c,h]=a.useState(null);a.useEffect(()=>{g()},[]);const g=async()=>{try{const b=await S.get("/api/patterns");b.data.success&&s(b.data.data.patterns)}catch(b){console.error("Failed to fetch patterns:",b),h("Failed to load patterns")}},N=b=>{y(P=>P.includes(b)?P.filter(x=>x!==b):[...P,b])},F=b=>{if(b===0)return;const P=[...r];[P[b-1],P[b]]=[P[b],P[b-1]],y(P)},i=b=>{if(b===r.length-1)return;const P=[...r];[P[b],P[b+1]]=[P[b+1],P[b]],y(P)},j=async()=>{if(r.length===0){h("Please select at least one pattern");return}u(!0),h(null),o(null);try{const b=await S.post("/api/patterns/collate",{patternIds:r,addDividers:l,dividerText:m});b.data.success&&o(b.data.data.collation)}catch(b){console.error("Failed to collate patterns:",b),h(b.response?.data?.message||"Failed to merge PDFs")}finally{u(!1)}},E=b=>t.find(x=>x.id===b)?.name||"Unknown Pattern",_=b=>b<1024?b+" B":b<1024*1024?(b/1024).toFixed(2)+" KB":(b/(1024*1024)).toFixed(2)+" MB";return e.jsxs("div",{className:"pdf-collation",children:[e.jsxs("div",{className:"collation-header",children:[e.jsx("h2",{children:"Merge Pattern PDFs"}),e.jsx("p",{className:"description",children:"Select multiple patterns to merge into a single PDF file"})]}),c&&e.jsx("div",{className:"error-message",role:"alert",children:c}),e.jsxs("div",{className:"collation-content",children:[e.jsxs("div",{className:"pattern-selection",children:[e.jsx("h3",{children:"Available Patterns"}),e.jsx("div",{className:"pattern-list",children:t.map(b=>e.jsxs("div",{className:`pattern-item ${r.includes(b.id)?"selected":""}`,onClick:()=>N(b.id),children:[e.jsx("input",{type:"checkbox",checked:r.includes(b.id),onChange:()=>N(b.id),onClick:P=>P.stopPropagation()}),e.jsxs("div",{className:"pattern-info",children:[e.jsx("div",{className:"pattern-name",children:b.name}),b.designer&&e.jsxs("div",{className:"pattern-designer",children:["by ",b.designer]}),b.category&&e.jsx("span",{className:"pattern-category",children:b.category})]})]},b.id))})]}),r.length>0&&e.jsxs("div",{className:"selected-patterns",children:[e.jsxs("h3",{children:["Merge Order (",r.length," patterns)"]}),e.jsx("div",{className:"pattern-order-list",children:r.map((b,P)=>e.jsxs("div",{className:"pattern-order-item",children:[e.jsxs("span",{className:"order-number",children:[P+1,"."]}),e.jsx("span",{className:"pattern-name",children:E(b)}),e.jsxs("div",{className:"order-controls",children:[e.jsx("button",{onClick:()=>F(P),disabled:P===0,className:"btn-icon","aria-label":"Move up",children:"↑"}),e.jsx("button",{onClick:()=>i(P),disabled:P===r.length-1,className:"btn-icon","aria-label":"Move down",children:"↓"}),e.jsx("button",{onClick:()=>N(b),className:"btn-icon btn-remove","aria-label":"Remove",children:"×"})]})]},b))})]}),e.jsxs("div",{className:"collation-options",children:[e.jsx("h3",{children:"Options"}),e.jsx("div",{className:"option",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:l,onChange:b=>w(b.target.checked)}),"Add divider pages between patterns"]})}),l&&e.jsx("div",{className:"option",children:e.jsxs("label",{children:["Divider text:",e.jsx("input",{type:"text",value:m,onChange:b=>C(b.target.value),placeholder:"Pattern",maxLength:255})]})})]}),e.jsxs("div",{className:"collation-actions",children:[e.jsx("button",{onClick:j,disabled:p||r.length===0,className:"btn-primary",children:p?"Merging PDFs...":"Merge PDFs"}),r.length>0&&e.jsx("button",{onClick:()=>y([]),className:"btn-secondary",disabled:p,children:"Clear Selection"})]}),v&&e.jsxs("div",{className:"collation-result",children:[e.jsx("h3",{children:"✓ PDF Merged Successfully!"}),e.jsxs("div",{className:"result-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Patterns merged:"})," ",v.patternCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total pages:"})," ",v.pageCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"File size:"})," ",_(v.fileSize)]})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("a",{href:v.fileUrl,download:!0,className:"btn-primary",target:"_blank",rel:"noopener noreferrer",children:"Download Merged PDF"}),e.jsx("button",{onClick:()=>{o(null),y([])},className:"btn-secondary",children:"Merge More Patterns"})]})]})]}),e.jsx("style",{children:`
        .pdf-collation {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
        }

        .collation-header {
          margin-bottom: 30px;
        }

        .collation-header h2 {
          font-size: 24px;
          font-weight: 600;
          margin-bottom: 8px;
        }

        .description {
          color: #6b7280;
          font-size: 14px;
        }

        .error-message {
          background-color: #fef2f2;
          border: 1px solid #fecaca;
          color: #991b1b;
          padding: 12px 16px;
          border-radius: 6px;
          margin-bottom: 20px;
        }

        .collation-content {
          display: grid;
          gap: 30px;
        }

        .pattern-selection h3,
        .selected-patterns h3,
        .collation-options h3 {
          font-size: 18px;
          font-weight: 600;
          margin-bottom: 16px;
        }

        .pattern-list {
          display: grid;
          gap: 12px;
          max-height: 400px;
          overflow-y: auto;
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
        }

        .pattern-item {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          padding: 12px;
          border: 2px solid #e5e7eb;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.2s;
        }

        .pattern-item:hover {
          border-color: #3b82f6;
          background-color: #eff6ff;
        }

        .pattern-item.selected {
          border-color: #3b82f6;
          background-color: #dbeafe;
        }

        .pattern-item input[type='checkbox'] {
          margin-top: 2px;
          width: 18px;
          height: 18px;
          cursor: pointer;
        }

        .pattern-info {
          flex: 1;
        }

        .pattern-name {
          font-weight: 500;
          margin-bottom: 4px;
        }

        .pattern-designer {
          font-size: 14px;
          color: #6b7280;
          margin-bottom: 4px;
        }

        .pattern-category {
          display: inline-block;
          font-size: 12px;
          padding: 2px 8px;
          background-color: #f3f4f6;
          border-radius: 4px;
          color: #4b5563;
        }

        .pattern-order-list {
          display: grid;
          gap: 8px;
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
        }

        .pattern-order-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 10px 12px;
          background-color: #f9fafb;
          border-radius: 6px;
        }

        .order-number {
          font-weight: 600;
          color: #6b7280;
          min-width: 30px;
        }

        .pattern-order-item .pattern-name {
          flex: 1;
        }

        .order-controls {
          display: flex;
          gap: 4px;
        }

        .btn-icon {
          width: 32px;
          height: 32px;
          border: 1px solid #d1d5db;
          background-color: white;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        }

        .btn-icon:hover:not(:disabled) {
          background-color: #f3f4f6;
          border-color: #9ca3af;
        }

        .btn-icon:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-icon.btn-remove {
          color: #dc2626;
          font-size: 24px;
        }

        .btn-icon.btn-remove:hover:not(:disabled) {
          background-color: #fef2f2;
          border-color: #fca5a5;
        }

        .collation-options {
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 20px;
        }

        .option {
          margin-bottom: 16px;
        }

        .option:last-child {
          margin-bottom: 0;
        }

        .option label {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 14px;
        }

        .option input[type='checkbox'] {
          width: 18px;
          height: 18px;
          cursor: pointer;
        }

        .option input[type='text'] {
          margin-left: 8px;
          padding: 6px 12px;
          border: 1px solid #d1d5db;
          border-radius: 4px;
          font-size: 14px;
        }

        .collation-actions {
          display: flex;
          gap: 12px;
        }

        .btn-primary,
        .btn-secondary {
          padding: 12px 24px;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
          border: none;
          font-size: 14px;
        }

        .btn-primary {
          background-color: #3b82f6;
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          background-color: #2563eb;
        }

        .btn-primary:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: white;
          color: #374151;
          border: 1px solid #d1d5db;
        }

        .btn-secondary:hover:not(:disabled) {
          background-color: #f9fafb;
        }

        .collation-result {
          background-color: #f0fdf4;
          border: 2px solid #86efac;
          border-radius: 8px;
          padding: 24px;
        }

        .collation-result h3 {
          color: #166534;
          font-size: 20px;
          margin-bottom: 16px;
        }

        .result-info {
          margin-bottom: 20px;
        }

        .result-info p {
          margin-bottom: 8px;
          font-size: 14px;
          color: #166534;
        }

        .result-actions {
          display: flex;
          gap: 12px;
        }

        .result-actions a {
          text-decoration: none;
        }

        @media (max-width: 768px) {
          .pdf-collation {
            padding: 16px;
          }

          .collation-header h2 {
            font-size: 20px;
          }

          .collation-actions {
            flex-direction: column;
          }

          .result-actions {
            flex-direction: column;
          }

          .btn-primary,
          .btn-secondary {
            width: 100%;
          }
        }
      `})]})};function rn(){const t=fe(),[s,r]=a.useState([]),[y,l]=a.useState(!0),[w,m]=a.useState(!1),[C,p]=a.useState(!1),[u,v]=a.useState(!1),[o,c]=a.useState(null),[h,g]=a.useState([]),[N,F]=a.useState(!1),[i,j]=a.useState({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"});a.useEffect(()=>{E()},[]);const E=async()=>{try{const n=await S.get("/api/patterns");r(n.data.data.patterns)}catch(n){console.error("Error fetching patterns:",n),k.error("Failed to load patterns")}finally{l(!1)}},_=async n=>{n.preventDefault(),F(!0);try{const R=(await S.post("/api/patterns",i)).data.data.pattern;if(k.success("Pattern created!"),h.length>0){let $=0;for(const I of h)try{const U=new FormData;U.append("file",I),await S.post(`/api/uploads/patterns/${R.id}/files`,U,{headers:{"Content-Type":"multipart/form-data"}}),$++}catch(U){console.error(`Failed to upload ${I.name}:`,U)}$===h.length?k.success(`Pattern created with ${$} PDF${$>1?"s":""}!`):k.warning(`Pattern created but only ${$}/${h.length} files uploaded`)}m(!1),j({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"}),g([]),E()}catch(D){console.error("Error creating pattern:",D),k.error(D.response?.data?.message||"Failed to create pattern")}finally{F(!1)}},b=n=>{c(n),j({name:n.name||"",description:n.description||"",designer:n.designer||"",difficulty:n.difficulty||"intermediate",category:n.category||"sweater"}),p(!0)},P=async n=>{if(n.preventDefault(),!!o)try{await S.put(`/api/patterns/${o.id}`,i),k.success("Pattern updated successfully!"),p(!1),c(null),j({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"}),E()}catch(D){console.error("Error updating pattern:",D),k.error(D.response?.data?.message||"Failed to update pattern")}},x=async(n,D)=>{if(confirm(`Are you sure you want to delete "${D}"?`))try{await S.delete(`/api/patterns/${n}`),k.success("Pattern deleted successfully"),E()}catch(R){console.error("Error deleting pattern:",R),k.error("Failed to delete pattern")}},d=n=>{switch(n){case"beginner":return"bg-green-100 text-green-800";case"intermediate":return"bg-yellow-100 text-yellow-800";case"advanced":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading patterns..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Patterns"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your knitting pattern library"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",disabled:s.length===0,children:[e.jsx(pe,{className:"mr-2"}),"Merge PDFs"]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"New Pattern"]})]})]}),s.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(pe,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No patterns yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start building your pattern library"}),e.jsxs("button",{onClick:()=>m(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Your First Pattern"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(n=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition",children:[e.jsxs("div",{onClick:()=>t(`/patterns/${n.id}`),className:"cursor-pointer p-6 pb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1 hover:text-purple-600 transition",children:n.name}),n.difficulty&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${d(n.difficulty)}`,children:n.difficulty})]}),n.designer&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["by ",n.designer]}),n.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:n.description}),n.category&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Category: ",n.category]})]}),e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:D=>{D.stopPropagation(),b(n)},className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:D=>{D.stopPropagation(),x(n.id,n.name)},className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Delete"]})]})})]},n.id))}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add New Pattern"})}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:n=>j({...i,name:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Classic Raglan Sweater",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:i.designer,onChange:n=>j({...i,designer:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Pattern designer name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:i.difficulty,onChange:n=>j({...i,difficulty:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:i.category,onChange:n=>j({...i,category:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:n=>j({...i,description:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Pattern details, notes, etc."})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern PDF Files (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Upload one or more PDF files for this pattern"}),e.jsx("input",{type:"file",accept:".pdf,application/pdf",multiple:!0,onChange:n=>{n.target.files&&g(Array.from(n.target.files))},disabled:N,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed"}),h.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Selected files (",h.length,"):"]}),h.map((n,D)=>e.jsxs("div",{className:"text-sm text-gray-600 flex items-center justify-between bg-gray-50 px-3 py-2 rounded",children:[e.jsx("span",{children:n.name}),e.jsxs("span",{className:"text-gray-500",children:["(",(n.size/1024/1024).toFixed(2)," MB)"]})]},D))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{m(!1),g([])},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",disabled:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:N,children:N?"Creating & Uploading...":"Add Pattern"})]})]})]})}),C&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Pattern"})}),e.jsxs("form",{onSubmit:P,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:n=>j({...i,name:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Classic Raglan Sweater",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:i.designer,onChange:n=>j({...i,designer:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Pattern designer name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:i.difficulty,onChange:n=>j({...i,difficulty:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:i.category,onChange:n=>j({...i,category:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:n=>j({...i,description:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Pattern details, notes, etc."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),c(null),j({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Pattern"})]})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Merge Pattern PDFs"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),e.jsx("div",{className:"p-6",children:e.jsx(tn,{})})]})})]})}function sn({files:t,onUpload:s,onDelete:r,onDownload:y,patternId:l}){const[w,m]=a.useState(null),[C,p]=a.useState(""),[u,v]=a.useState(!1),[o,c]=a.useState(!1),[h,g]=a.useState(null),N=a.useRef(null),F=["application/pdf","application/x-pdf","application/acrobat","applications/vnd.pdf","text/pdf","text/x-pdf",".pdf","image/jpeg","image/jpg","image/png","image/webp","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].join(","),i=n=>{const D=n.name.toLowerCase(),$=[".pdf",".jpg",".jpeg",".png",".webp",".doc",".docx",".txt"].some(A=>D.endsWith(A)),U=F.split(",").map(A=>A.trim()).includes(n.type);if(!$&&!U){alert(`Invalid file type: ${n.type||"unknown"}

Accepted file types:
- PDF documents (.pdf)
- Images (.jpg, .png, .webp)
- Word documents (.doc, .docx)
- Text files (.txt)

Please make sure your file has the correct extension.`);return}const K=n.size/(1024*1024);if(K>25){alert(`File size (${K.toFixed(1)}MB) exceeds the 25MB limit.

Please choose a smaller file or compress your PDF.`);return}m(n)},j=n=>{const D=n.target.files?.[0];D&&i(D)},E=n=>{n.preventDefault(),n.stopPropagation(),c(!1);const D=n.dataTransfer.files?.[0];D&&i(D)},_=n=>{n.preventDefault(),n.stopPropagation(),n.type==="dragenter"||n.type==="dragover"?c(!0):n.type==="dragleave"&&c(!1)},b=async()=>{if(w){v(!0);try{await s(w,C),m(null),p(""),N.current&&(N.current.value="")}catch(n){console.error("Upload error:",n),alert("Failed to upload file. Please try again.")}finally{v(!1)}}},P=()=>{m(null),p(""),N.current&&(N.current.value="")},x=n=>{switch(n){case"pdf":return e.jsx(Xe,{className:"w-6 h-6 text-red-500"});case"image":return e.jsx(ur,{className:"w-6 h-6 text-blue-500"});case"document":return e.jsx(ke,{className:"w-6 h-6 text-blue-600"});default:return e.jsx(Xe,{className:"w-6 h-6 text-gray-500"})}},d=n=>n<1024?n+" B":n<1024*1024?(n/1024).toFixed(1)+" KB":(n/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Upload Pattern Files"}),e.jsxs("div",{className:`
            border-2 border-dashed rounded-lg p-8 text-center transition-colors
            ${o?"border-pink-500 bg-pink-50 dark:bg-pink-900/10":"border-gray-300 dark:border-gray-600 hover:border-pink-400 dark:hover:border-pink-500"}
          `,onDragEnter:_,onDragLeave:_,onDragOver:_,onDrop:E,children:[e.jsx(Zt,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:"PDF, Images, Word documents, or text files (MAX. 25MB)"}),e.jsx("input",{ref:N,type:"file",className:"hidden",accept:F,onChange:j}),e.jsx("button",{type:"button",onClick:()=>N.current?.click(),className:"mt-4 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors",children:"Select File"})]}),w&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Xe,{className:"w-6 h-6 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:w.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d(w.size)})]})]}),e.jsx("button",{onClick:P,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (optional)"}),e.jsx("input",{type:"text",value:C,onChange:n=>p(n.target.value),placeholder:"E.g., Main pattern, Size chart, Assembly instructions...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsx("button",{onClick:b,disabled:u,className:"w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"Uploading...":"Upload File"})]})]}),t.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Pattern Files (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-650 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[x(n.file_type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:n.original_filename}),n.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:n.description}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:[d(n.size)," • ",new Date(n.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[n.file_type==="pdf"&&l&&e.jsx("button",{onClick:()=>g(n),className:"p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors",title:"View PDF",children:e.jsx(Le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>y(n.id,n.original_filename),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Download",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this file?")&&r(n.id)},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(X,{className:"w-5 h-5"})})]})]},n.id))})]}),h&&h.file_type==="pdf"&&l&&e.jsx(_r,{fileUrl:`/api/uploads/patterns/${l}/files/${h.id}/download`,filename:h.original_filename,patternId:l,onClose:()=>g(null)})]})}function an(){const{id:t}=dr(),s=fe(),[r,y]=a.useState(null),[l,w]=a.useState([]),[m,C]=a.useState(!0),[p,u]=a.useState(!1),[v,o]=a.useState("overview"),[c,h]=a.useState(null),[g,N]=a.useState({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater",yarnRequirements:"",needleSize:"",gauge:"",sizesAvailable:"",notes:""});a.useEffect(()=>{t&&(F(),i())},[t]),a.useEffect(()=>{if(l.length>0&&!c){const n=l.find(D=>D.file_type==="pdf");n&&h(n)}},[l,c]);const F=async()=>{try{const n=await S.get(`/api/patterns/${t}`);y(n.data.data.pattern)}catch{k.error("Failed to load pattern"),s("/patterns")}finally{C(!1)}},i=async()=>{try{const n=await S.get(`/api/uploads/patterns/${t}/files`);w(n.data.data.files||[])}catch{}},j=()=>{r&&(N({name:r.name||"",description:r.description||"",designer:r.designer||"",difficulty:r.difficulty||"intermediate",category:r.category||"sweater",yarnRequirements:r.yarn_requirements||"",needleSize:r.needle_size||"",gauge:r.gauge||"",sizesAvailable:r.sizes_available||"",notes:r.notes||""}),u(!0))},E=async n=>{if(n.preventDefault(),!!r)try{await S.put(`/api/patterns/${r.id}`,g),k.success("Pattern updated successfully!"),u(!1),F()}catch(D){const R=D;k.error(R.response?.data?.message||"Failed to update pattern")}},_=async()=>{if(r&&confirm(`Are you sure you want to delete "${r.name}"? This will also delete all associated files.`))try{await S.delete(`/api/patterns/${r.id}`),k.success("Pattern deleted successfully"),s("/patterns")}catch{k.error("Failed to delete pattern")}},b=async(n,D)=>{const R=new FormData;R.append("file",n),D&&R.append("description",D);try{await S.post(`/api/uploads/patterns/${t}/files`,R,{headers:{"Content-Type":"multipart/form-data"}}),k.success("File uploaded successfully!"),i()}catch($){const I=$;throw k.error(I.response?.data?.message||"Failed to upload file"),$}},P=async(n,D)=>{try{const R=await S.get(`/api/uploads/patterns/${t}/files/${n}/download`,{responseType:"blob"}),$=window.URL.createObjectURL(new Blob([R.data])),I=document.createElement("a");I.href=$,I.setAttribute("download",D),document.body.appendChild(I),I.click(),I.remove(),window.URL.revokeObjectURL($)}catch{k.error("Failed to download file")}},x=async n=>{try{await S.delete(`/api/uploads/patterns/${t}/files/${n}`),k.success("File deleted successfully"),i()}catch{k.error("Failed to delete file")}},d=n=>{switch(n){case"beginner":return"bg-green-100 text-green-800";case"intermediate":return"bg-yellow-100 text-yellow-800";case"advanced":return"bg-orange-100 text-orange-800";case"expert":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Fr,{size:"lg",text:"Loading pattern..."})}):r?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("button",{onClick:()=>s("/patterns"),className:"flex items-center text-purple-600 hover:text-purple-700 mb-3 md:mb-4 min-h-[48px]",children:[e.jsx(cr,{className:"mr-2 h-5 w-5"}),e.jsx("span",{className:"text-base md:text-sm",children:"Back to Patterns"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:r.name}),r.difficulty&&e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full self-start ${d(r.difficulty)}`,children:r.difficulty})]}),r.designer&&e.jsxs("p",{className:"text-base md:text-sm text-gray-600",children:["by ",r.designer]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:j,className:"flex items-center justify-center px-4 py-3 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition min-h-[48px] md:min-h-0 flex-1 sm:flex-none",children:[e.jsx(ae,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Edit"})]}),e.jsxs("button",{onClick:_,className:"flex items-center justify-center px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition min-h-[48px] md:min-h-0 flex-1 sm:flex-none",children:[e.jsx(X,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Delete"})]})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-4 md:mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>o("overview"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${v==="overview"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"})]})}),e.jsx("button",{onClick:()=>o("viewer"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${v==="viewer"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} ${c?"":"opacity-50 cursor-not-allowed"}`,disabled:!c,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PDF Viewer"})]})}),e.jsx("button",{onClick:()=>o("charts"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${v==="charts"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Charts"})]})}),e.jsx("button",{onClick:()=>o("tools"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${v==="tools"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Tools"})]})})]})})}),v==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pattern Information"}),r.description&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-600",children:r.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.category&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Category"}),e.jsx("p",{className:"text-gray-900",children:r.category})]}),r.needle_size&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Needle Size"}),e.jsx("p",{className:"text-gray-900",children:r.needle_size})]}),r.gauge&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Gauge"}),e.jsx("p",{className:"text-gray-900",children:r.gauge})]}),r.sizes_available&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Sizes Available"}),e.jsx("p",{className:"text-gray-900",children:r.sizes_available})]})]}),r.yarn_requirements&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Yarn Requirements"}),e.jsx("p",{className:"text-gray-600",children:r.yarn_requirements})]}),r.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:r.notes})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Statistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Times Used"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r.times_used||0})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Files Attached"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l.length})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Created"}),e.jsx("p",{className:"text-gray-600",children:new Date(r.created_at).toLocaleDateString()})]}),r.updated_at&&r.updated_at!==r.created_at&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Last Updated"}),e.jsx("p",{className:"text-gray-600",children:new Date(r.updated_at).toLocaleDateString()})]})]})]})]}),e.jsx(sn,{files:l,onUpload:b,onDelete:x,onDownload:P,patternId:t}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsx(Pr,{patternId:t,onJumpToBookmark:n=>{k.info(`Jumping to page ${n.page_number}`),o("viewer")}})})]}),v==="viewer"&&c&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",style:{height:"800px"},children:e.jsx(_r,{fileUrl:`/api/uploads/patterns/${t}/files/${c.id}/download`,filename:c.original_filename,patternId:t,fullscreen:!1})}),v==="charts"&&e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Dt,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chart Viewer"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Interactive knitting chart viewer with zoom and rotation"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Charts will be displayed here when chart data is available.",e.jsx("br",{}),"Future enhancement: Add chart upload/creation functionality."]})]})}),v==="tools"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pattern Tools"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Pattern Sections"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Organize your pattern into sections for easier navigation"}),e.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Manage Sections"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Pattern Annotations"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Add notes and annotations directly to your pattern"}),e.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Add Annotations"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Pattern Collation"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Combine multiple PDFs into a single pattern document"}),e.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Collate PDFs"})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Pattern"})}),e.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:n=>N({...g,name:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:g.designer,onChange:n=>N({...g,designer:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:g.difficulty,onChange:n=>N({...g,difficulty:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:g.category,onChange:n=>N({...g,category:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Needle Size"}),e.jsx("input",{type:"text",value:g.needleSize,onChange:n=>N({...g,needleSize:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7, 4.5mm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gauge"}),e.jsx("input",{type:"text",value:g.gauge,onChange:n=>N({...g,gauge:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 20 sts x 28 rows = 4 inches"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sizes Available"}),e.jsx("input",{type:"text",value:g.sizesAvailable,onChange:n=>N({...g,sizesAvailable:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., XS, S, M, L, XL"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:g.description,onChange:n=>N({...g,description:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yarn Requirements"}),e.jsx("textarea",{value:g.yarnRequirements,onChange:n=>N({...g,yarnRequirements:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:2,placeholder:"e.g., 800 yards worsted weight yarn"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:g.notes,onChange:n=>N({...g,notes:n.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Additional notes, modifications, tips, etc."})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Pattern"})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Pattern not found"})})}function nn(){const[t,s]=a.useState([]),[r,y]=a.useState(!0),[l,w]=a.useState(!1),[m,C]=a.useState(!1),[p,u]=a.useState(null),[v,o]=a.useState([]),[c,h]=a.useState(!1),[g,N]=a.useState({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1});a.useEffect(()=>{F()},[]);const F=async()=>{try{const d=await S.get("/api/yarn");s(d.data.data.yarn)}catch(d){console.error("Error fetching yarn:",d),k.error("Failed to load yarn")}finally{y(!1)}},i=async d=>{d.preventDefault();try{await S.post("/api/yarn",g),k.success("Yarn added successfully!"),w(!1),N({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1}),F()}catch(n){console.error("Error creating yarn:",n),k.error(n.response?.data?.message||"Failed to add yarn")}},j=async d=>{u(d),N({brand:d.brand||"",name:d.name||"",color:d.color||"",weight:d.weight||"worsted",fiberContent:d.fiber_content||"",yardsTotal:d.yards_total?.toString()||"",skeinsTotal:d.skeins_total?.toString()||"1",lowStockThreshold:d.low_stock_threshold?.toString()||"",lowStockAlert:d.low_stock_alert||!1});try{const n=await S.get(`/api/uploads/yarn/${d.id}/photos`);o(n.data.data.photos||[])}catch(n){console.error("Error fetching yarn photos:",n),o([])}C(!0)},E=async d=>{if(!p||!d.target.files||d.target.files.length===0)return;const n=d.target.files[0];h(!0);try{const D=new FormData;D.append("photo",n);const R=await S.post(`/api/uploads/yarn/${p.id}/photos`,D,{headers:{"Content-Type":"multipart/form-data"}});k.success("Photo uploaded successfully!"),o([...v,R.data.data.photo]),d.target.value=""}catch(D){console.error("Error uploading photo:",D),k.error(D.response?.data?.message||"Failed to upload photo")}finally{h(!1)}},_=async d=>{if(p&&confirm("Are you sure you want to delete this photo?"))try{await S.delete(`/api/uploads/yarn/${p.id}/photos/${d}`),k.success("Photo deleted successfully"),o(v.filter(n=>n.id!==d))}catch(n){console.error("Error deleting photo:",n),k.error("Failed to delete photo")}},b=async d=>{if(d.preventDefault(),!!p)try{await S.put(`/api/yarn/${p.id}`,g),k.success("Yarn updated successfully!"),C(!1),u(null),N({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1}),F()}catch(n){console.error("Error updating yarn:",n),k.error(n.response?.data?.message||"Failed to update yarn")}},P=async(d,n)=>{if(confirm(`Are you sure you want to delete "${n}"?`))try{await S.delete(`/api/yarn/${d}`),k.success("Yarn deleted successfully"),F()}catch(D){console.error("Error deleting yarn:",D),k.error("Failed to delete yarn")}},x=d=>({lace:"bg-purple-100 text-purple-800",fingering:"bg-blue-100 text-blue-800",sport:"bg-green-100 text-green-800",dk:"bg-yellow-100 text-yellow-800",worsted:"bg-orange-100 text-orange-800",bulky:"bg-red-100 text-red-800"})[d?.toLowerCase()]||"bg-gray-100 text-gray-800";return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading yarn stash..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Yarn Stash"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your yarn inventory"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Yarn"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(ge,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No yarn in stash"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking your yarn collection"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Your First Yarn"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(d=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[d.brand&&`${d.brand} `,d.name]}),d.color&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:d.color})]}),d.weight&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${x(d.weight)}`,children:d.weight})]}),d.fiber_content&&e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:d.fiber_content}),e.jsxs("div",{className:"space-y-2 mb-4",children:[d.skeins_remaining!==void 0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Skeins:"}),e.jsx("span",{className:"font-medium text-gray-900",children:d.skeins_remaining})]}),d.yards_remaining!==void 0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Yards:"}),e.jsx("span",{className:"font-medium text-gray-900",children:d.yards_remaining})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>j(d),className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>P(d.id,d.name),className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},d.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Yarn to Stash"})}),e.jsxs("form",{onSubmit:i,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:g.brand,onChange:d=>N({...g,brand:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Lion Brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yarn Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:d=>N({...g,name:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Wool-Ease",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("input",{type:"text",value:g.color,onChange:d=>N({...g,color:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Navy Blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight"}),e.jsxs("select",{value:g.weight,onChange:d=>N({...g,weight:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"lace",children:"Lace"}),e.jsx("option",{value:"fingering",children:"Fingering"}),e.jsx("option",{value:"sport",children:"Sport"}),e.jsx("option",{value:"dk",children:"DK"}),e.jsx("option",{value:"worsted",children:"Worsted"}),e.jsx("option",{value:"bulky",children:"Bulky"}),e.jsx("option",{value:"super-bulky",children:"Super Bulky"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiber Content"}),e.jsx("input",{type:"text",value:g.fiberContent,onChange:d=>N({...g,fiberContent:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 100% Wool, 80% Acrylic 20% Wool"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Skeins"}),e.jsx("input",{type:"number",value:g.skeinsTotal,onChange:d=>N({...g,skeinsTotal:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yards per Skein"}),e.jsx("input",{type:"number",value:g.yardsTotal,onChange:d=>N({...g,yardsTotal:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 364"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add to Stash"})]})]})]})}),m&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Yarn"})}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:g.brand,onChange:d=>N({...g,brand:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Lion Brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yarn Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:d=>N({...g,name:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Wool-Ease",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("input",{type:"text",value:g.color,onChange:d=>N({...g,color:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Navy Blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight"}),e.jsxs("select",{value:g.weight,onChange:d=>N({...g,weight:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"lace",children:"Lace"}),e.jsx("option",{value:"fingering",children:"Fingering"}),e.jsx("option",{value:"sport",children:"Sport"}),e.jsx("option",{value:"dk",children:"DK"}),e.jsx("option",{value:"worsted",children:"Worsted"}),e.jsx("option",{value:"bulky",children:"Bulky"}),e.jsx("option",{value:"super-bulky",children:"Super Bulky"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiber Content"}),e.jsx("input",{type:"text",value:g.fiberContent,onChange:d=>N({...g,fiberContent:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 100% Wool, 80% Acrylic 20% Wool"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Skeins"}),e.jsx("input",{type:"number",value:g.skeinsTotal,onChange:d=>N({...g,skeinsTotal:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yards per Skein"}),e.jsx("input",{type:"number",value:g.yardsTotal,onChange:d=>N({...g,yardsTotal:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 364"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Photos"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Add photo to visualize your yarn"}),e.jsx("input",{type:"file",accept:"image/*",onChange:E,disabled:c,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed"}),c&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Uploading..."})]}),v.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(d=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:d.thumbnail_path,alt:d.original_filename,className:"w-full h-24 object-cover rounded-lg border border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>_(d.id),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete photo",children:e.jsx(X,{className:"h-3 w-3"})})]},d.id))}),v.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4 bg-gray-50 rounded-lg",children:"No photos yet. Upload a photo to see what your yarn looks like!"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Low Stock Alerts"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Low Stock Threshold (yards)"}),e.jsx("input",{type:"number",value:g.lowStockThreshold,onChange:d=>N({...g,lowStockThreshold:d.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 100",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get notified when yards drop below this amount"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.lowStockAlert,onChange:d=>N({...g,lowStockAlert:d.target.checked}),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Enable low stock alerts"})]})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{C(!1),u(null),o([]),N({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Yarn"})]})]})]})})]})}function ln(){const[t,s]=a.useState([]),[r,y]=a.useState(!0),[l,w]=a.useState(!1),[m,C]=a.useState(!1),[p,u]=a.useState(null),[v,o]=a.useState({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"});a.useEffect(()=>{c()},[]);const c=async()=>{try{const j=await S.get("/api/tools");s(j.data.data.tools)}catch(j){console.error("Error fetching tools:",j),k.error("Failed to load tools")}finally{y(!1)}},h=async j=>{j.preventDefault();try{await S.post("/api/tools",v),k.success("Tool added successfully!"),w(!1),o({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"}),c()}catch(E){console.error("Error creating tool:",E),k.error(E.response?.data?.message||"Failed to add tool")}},g=j=>{u(j),o({name:j.name||"",type:j.type||"needle",size:j.size||"",material:j.material||"",brand:j.brand||"",quantity:j.quantity?.toString()||"1"}),C(!0)},N=async j=>{if(j.preventDefault(),!!p)try{await S.put(`/api/tools/${p.id}`,v),k.success("Tool updated successfully!"),C(!1),u(null),o({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"}),c()}catch(E){console.error("Error updating tool:",E),k.error(E.response?.data?.message||"Failed to update tool")}},F=async(j,E)=>{if(confirm(`Are you sure you want to delete "${E}"?`))try{await S.delete(`/api/tools/${j}`),k.success("Tool deleted successfully"),c()}catch(_){console.error("Error deleting tool:",_),k.error("Failed to delete tool")}},i=j=>({needle:"bg-blue-100 text-blue-800",hook:"bg-purple-100 text-purple-800",circular:"bg-green-100 text-green-800",dpn:"bg-yellow-100 text-yellow-800",accessory:"bg-gray-100 text-gray-800"})[j?.toLowerCase()]||"bg-gray-100 text-gray-800";return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading tools..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tools"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your knitting tools inventory"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Tool"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(pt,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tools yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking your knitting tools"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Your First Tool"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(j=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:j.name}),j.size&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Size ",j.size]})]}),j.type&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${i(j.type)}`,children:j.type})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[j.brand&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Brand:"})," ",j.brand]}),j.material&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Material:"})," ",j.material]}),j.quantity&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",j.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>g(j),className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>F(j.id,j.name),className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},j.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Tool"})}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tool Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:j=>o({...v,name:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7 Circular Needles",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:v.type,onChange:j=>o({...v,type:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"needle",children:"Straight Needle"}),e.jsx("option",{value:"circular",children:"Circular Needle"}),e.jsx("option",{value:"dpn",children:"Double-Pointed Needles (DPN)"}),e.jsx("option",{value:"hook",children:"Crochet Hook"}),e.jsx("option",{value:"accessory",children:"Accessory"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Size"}),e.jsx("input",{type:"text",value:v.size,onChange:j=>o({...v,size:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7, 4.5mm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Material"}),e.jsx("input",{type:"text",value:v.material,onChange:j=>o({...v,material:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Bamboo, Metal, Wood"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:v.brand,onChange:j=>o({...v,brand:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Clover, Addi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:v.quantity,onChange:j=>o({...v,quantity:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Tool"})]})]})]})}),m&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Tool"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tool Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:j=>o({...v,name:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7 Circular Needles",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:v.type,onChange:j=>o({...v,type:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"needle",children:"Straight Needle"}),e.jsx("option",{value:"circular",children:"Circular Needle"}),e.jsx("option",{value:"dpn",children:"Double-Pointed Needles (DPN)"}),e.jsx("option",{value:"hook",children:"Crochet Hook"}),e.jsx("option",{value:"accessory",children:"Accessory"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Size"}),e.jsx("input",{type:"text",value:v.size,onChange:j=>o({...v,size:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7, 4.5mm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Material"}),e.jsx("input",{type:"text",value:v.material,onChange:j=>o({...v,material:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Bamboo, Metal, Wood"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:v.brand,onChange:j=>o({...v,brand:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Clover, Addi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:v.quantity,onChange:j=>o({...v,quantity:j.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{C(!1),u(null),o({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Tool"})]})]})]})})]})}function on(){const[t,s]=a.useState([]),[r,y]=a.useState(!0),[l,w]=a.useState(!1),[m,C]=a.useState(!1),[p,u]=a.useState(null),[v,o]=a.useState({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""});a.useEffect(()=>{c()},[]);const c=async()=>{try{const i=await S.get("/api/recipients");s(i.data.data.recipients)}catch(i){console.error("Error fetching recipients:",i),k.error("Failed to load recipients")}finally{y(!1)}},h=async i=>{i.preventDefault();try{await S.post("/api/recipients",v),k.success("Recipient added successfully!"),w(!1),o({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""}),c()}catch(j){console.error("Error creating recipient:",j),k.error(j.response?.data?.message||"Failed to add recipient")}},g=i=>{u(i),o({firstName:i.first_name||"",lastName:i.last_name||"",relationship:i.relationship||"",clothingSize:i.clothing_size||"",notes:i.notes||""}),C(!0)},N=async i=>{if(i.preventDefault(),!!p)try{await S.put(`/api/recipients/${p.id}`,v),k.success("Recipient updated successfully!"),C(!1),u(null),o({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""}),c()}catch(j){console.error("Error updating recipient:",j),k.error(j.response?.data?.message||"Failed to update recipient")}},F=async(i,j)=>{if(confirm(`Are you sure you want to delete "${j}"?`))try{await S.delete(`/api/recipients/${i}`),k.success("Recipient deleted successfully"),c()}catch(E){console.error("Error deleting recipient:",E),k.error("Failed to delete recipient")}};return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading recipients..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Recipients"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage gift recipients and their preferences"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Recipient"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(Ae,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No recipients yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking people you knit for"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(q,{className:"mr-2"}),"Add Your First Recipient"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(i=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[i.first_name," ",i.last_name]}),i.relationship&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:i.relationship}),i.clothing_size&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",i.clothing_size]}),i.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-3 line-clamp-2",children:i.notes}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200 mt-4",children:[e.jsxs("button",{onClick:()=>g(i),className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>F(i.id,`${i.first_name} ${i.last_name}`),className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},i.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Recipient"})}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:v.firstName,onChange:i=>o({...v,firstName:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:v.lastName,onChange:i=>o({...v,lastName:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship"}),e.jsx("input",{type:"text",value:v.relationship,onChange:i=>o({...v,relationship:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Friend, Family, Child"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Clothing Size"}),e.jsx("input",{type:"text",value:v.clothingSize,onChange:i=>o({...v,clothingSize:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Medium, Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:v.notes,onChange:i=>o({...v,notes:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Preferences, measurements, color likes/dislikes, etc."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Recipient"})]})]})]})}),m&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Recipient"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:v.firstName,onChange:i=>o({...v,firstName:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:v.lastName,onChange:i=>o({...v,lastName:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship"}),e.jsx("input",{type:"text",value:v.relationship,onChange:i=>o({...v,relationship:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Friend, Family, Child"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Clothing Size"}),e.jsx("input",{type:"text",value:v.clothingSize,onChange:i=>o({...v,clothingSize:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Medium, Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:v.notes,onChange:i=>o({...v,notes:i.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Preferences, measurements, color likes/dislikes, etc."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{C(!1),u(null),o({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Recipient"})]})]})]})})]})}function dn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})})}function Dr(t){if(t<60)return`${t}s`;if(t<3600)return`${Math.floor(t/60)}m`;const s=Math.floor(t/3600),r=Math.floor(t%3600/60);if(s>=24){const y=Math.floor(s/24),l=s%24;return l>0?`${y}d ${l}h`:`${y}d`}return r>0?`${s}h ${r}m`:`${s}h`}function $e({value:t,label:s,icon:r,color:y,loading:l,sublabel:w}){return l?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 animate-pulse",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"h-12 w-12 bg-gray-200 dark:bg-gray-700 rounded-lg"})}),e.jsx("div",{className:"h-8 w-20 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`${y} p-3 rounded-lg`,children:r}),w&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:w})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-1",children:typeof t=="number"?t.toLocaleString():t}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]})}function cn({data:t,loading:s}){if(s)return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 dark:bg-gray-700 rounded animate-pulse"})]});if(!t||t.length===0)return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Activity Over Time"}),e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ht,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Start knitting to see your activity!"})]})})]});const r=l=>new Date(l).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),y=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Activity Over Time"}),e.jsx("div",{className:"h-64",children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(_s,{data:t,margin:{top:5,right:20,left:10,bottom:5},children:[e.jsx(Ds,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),e.jsx(Es,{dataKey:"date",tickFormatter:y,stroke:"#9CA3AF",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx($s,{stroke:"#9CA3AF",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:l=>l.toLocaleString()}),e.jsx(Ms,{labelFormatter:r,formatter:l=>[`${l.toLocaleString()} rows`,"Rows Knitted"],contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"8px",color:"#F9FAFB"}}),e.jsx(Rs,{type:"monotone",dataKey:"rows",stroke:"#8B5CF6",strokeWidth:2,dot:{fill:"#8B5CF6",strokeWidth:0,r:4},activeDot:{r:6,fill:"#8B5CF6"}})]})})})]})}function un({projects:t,loading:s}){if(s)return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:[e.jsx("div",{className:"h-6 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),[1,2,3].map(y=>e.jsxs("div",{className:"flex items-center p-4 animate-pulse",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded-lg mr-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]},y))]});if(!t||t.length===0)return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Recent Projects"}),e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No projects yet. Create one to get started!"}),e.jsx(W,{to:"/projects",className:"mt-4 inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Create Project"})]})]});const r=y=>{switch(y){case"active":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Recent Projects"}),e.jsxs(W,{to:"/projects",className:"text-sm text-purple-600 hover:text-purple-700 dark:text-purple-400 flex items-center",children:["View all",e.jsx(be,{className:"h-4 w-4 ml-1"})]})]}),e.jsx("div",{className:"space-y-2",children:t.map(y=>e.jsxs(W,{to:`/projects/${y.id}`,className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition group",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2.5 rounded-lg mr-4",children:e.jsx(oe,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition",children:y.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[y.rows_completed.toLocaleString()," rows",y.total_seconds>0&&` in ${Dr(y.total_seconds)}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2.5 py-1 rounded-full capitalize ${r(y.status)}`,children:y.status}),e.jsx(be,{className:"h-5 w-5 text-gray-400 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition"})]})]},y.id))})]})}function xn(){const[t,s]=a.useState(null),[r,y]=a.useState(!0),[l,w]=a.useState("week");a.useEffect(()=>{m()},[l]);const m=async()=>{try{y(!0);const p=await S.get(`/api/stats?period=${l}`);p.data.success&&s(p.data.data.stats)}catch(p){console.error("Failed to fetch stats:",p)}finally{y(!1)}},C={today:"Today",week:"This Week",month:"This Month",all:"All Time"};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Your Knitting Stats"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track your progress and celebrate your achievements"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:Object.keys(C).map(p=>e.jsx("button",{onClick:()=>w(p),className:`px-4 py-2 rounded-lg font-medium transition ${l===p?"bg-purple-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-700"}`,children:C[p]},p))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx($e,{value:t?.totalCompleted||0,label:"Projects Completed",icon:e.jsx(Te,{className:"h-6 w-6 text-white"}),color:"bg-green-500",loading:r}),e.jsx($e,{value:t?.totalRows||0,label:"Rows Knitted",icon:e.jsx(Ss,{className:"h-6 w-6 text-white"}),color:"bg-purple-500",loading:r}),e.jsx($e,{value:t?Dr(t.totalSeconds):"0h",label:"Time Knitting",icon:e.jsx(ee,{className:"h-6 w-6 text-white"}),color:"bg-blue-500",loading:r}),e.jsx($e,{value:t?.currentStreak||0,label:"Day Streak",icon:e.jsx(ht,{className:"h-6 w-6 text-white"}),color:"bg-orange-500",loading:r,sublabel:t&&t.longestStreak>0?`Best: ${t.longestStreak}`:void 0})]}),!r&&t&&t.currentStreak>=3&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-pink-500 rounded-xl p-6 mb-8 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(Fs,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:[t.currentStreak," Day Streak!"]}),e.jsxs("p",{className:"text-white/80",children:["You've been knitting for ",t.currentStreak," days in a row. Keep it up!"]})]})]})}),e.jsx("div",{className:"mb-8",children:e.jsx(cn,{data:t?.activityData||[],loading:r})}),e.jsx(un,{projects:t?.recentProjects||[],loading:r})]})}function gn(){const[t,s]=a.useState(""),[r,y]=a.useState(""),[l,w]=a.useState(!1),[m,C]=a.useState(!1),p=fe(),u=je(o=>o.login),v=async o=>{if(o.preventDefault(),!t||!r){k.error("Please fill in all fields");return}C(!0);try{await u(t,r,l),k.success("Login successful!"),p("/dashboard")}catch(c){console.error("Login error:",c);const h=c.response?.data?.message||"Login failed. Please check your credentials.";k.error(h)}finally{C(!1)}};return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-8 transition-colors duration-200",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2",children:"Rowly"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Sign in to your account"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:t,onChange:o=>s(o.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition",placeholder:"you@example.com",disabled:m,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:r,onChange:o=>y(o.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition",placeholder:"••••••••",disabled:m,required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:o=>w(o.target.checked),className:"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",disabled:m}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Remember me for 30 days"})]}),e.jsx(W,{to:"/forgot-password",className:"text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition",children:"Forgot password?"})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-purple-600 dark:bg-purple-700 text-white py-2 px-4 rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 transition disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:m?"Signing in...":"Sign In"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Don't have an account?"," ",e.jsx(W,{to:"/register",className:"text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 font-medium transition",children:"Sign up"})]})}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["Demo account: ",e.jsx("span",{className:"font-mono",children:"demo@rowlyknit.com"})," / ",e.jsx("span",{className:"font-mono",children:"Demo123!@#"})]})})]})})}function mn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Register"})})}function pn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"ForgotPassword"})})}function hn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"ResetPassword"})})}function bn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"VerifyEmail"})})}function yn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"NotFound"})})}function fn({children:t}){const{isAuthenticated:s}=je();return s?e.jsx(e.Fragment,{children:t}):e.jsx(yt,{to:"/login",replace:!0})}function rt({children:t}){const{isAuthenticated:s}=je();return s?e.jsx(yt,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:t})}function jn(){return e.jsxs(e.Fragment,{children:[e.jsx(Us,{}),e.jsx(Os,{}),e.jsxs(Ts,{children:[e.jsxs(G,{element:e.jsx($a,{}),children:[e.jsx(G,{path:"/login",element:e.jsx(rt,{children:e.jsx(gn,{})})}),e.jsx(G,{path:"/register",element:e.jsx(rt,{children:e.jsx(mn,{})})}),e.jsx(G,{path:"/forgot-password",element:e.jsx(rt,{children:e.jsx(pn,{})})}),e.jsx(G,{path:"/reset-password",element:e.jsx(hn,{})}),e.jsx(G,{path:"/verify-email",element:e.jsx(bn,{})})]}),e.jsxs(G,{element:e.jsx(fn,{children:e.jsx(Ea,{})}),children:[e.jsx(G,{path:"/",element:e.jsx(yt,{to:"/dashboard",replace:!0})}),e.jsx(G,{path:"/dashboard",element:e.jsx(Ma,{})}),e.jsx(G,{path:"/projects",element:e.jsx(Ra,{})}),e.jsx(G,{path:"/projects/:id",element:e.jsx(Xa,{})}),e.jsx(G,{path:"/patterns",element:e.jsx(rn,{})}),e.jsx(G,{path:"/patterns/:id",element:e.jsx(an,{})}),e.jsx(G,{path:"/yarn",element:e.jsx(nn,{})}),e.jsx(G,{path:"/tools",element:e.jsx(ln,{})}),e.jsx(G,{path:"/recipients",element:e.jsx(on,{})}),e.jsx(G,{path:"/profile",element:e.jsx(dn,{})}),e.jsx(G,{path:"/stats",element:e.jsx(xn,{})})]}),e.jsx(G,{path:"*",element:e.jsx(yn,{})})]})]})}class vn extends a.Component{state={hasError:!1,error:null,errorInfo:null};static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),this.setState({error:s,errorInfo:r})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-red-100 dark:bg-red-900/20 rounded-full mx-auto mb-4 md:mb-6",children:e.jsx(at,{className:"w-8 h-8 md:w-10 md:h-10 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white text-center mb-3 md:mb-4",children:"Something went wrong"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 dark:text-gray-400 text-center mb-6 md:mb-8",children:"We're sorry for the inconvenience. The app encountered an unexpected error."}),!1,e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 px-6 py-3 md:py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors min-h-[56px] md:min-h-[64px]",children:[e.jsx(mt,{className:"w-5 h-5 md:w-6 md:h-6"}),e.jsx("span",{className:"text-base md:text-lg",children:"Reload App"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 dark:text-gray-400 text-center mt-4 md:mt-6",children:"If this problem persists, please contact support"})]})}):this.props.children}}S.defaults.baseURL="http://localhost:5000";S.defaults.timeout=3e4;S.defaults.withCredentials=!0;S.defaults.headers.common["Content-Type"]="application/json";let Ce=null;async function Er(){try{return Ce=(await S.get("/api/csrf-token")).data.csrfToken,Ce||""}catch(t){return console.error("Failed to fetch CSRF token:",t),""}}async function wn(){return Ce||Er()}S.interceptors.request.use(async t=>{const s=["POST","PUT","DELETE","PATCH"];if(t.method&&s.includes(t.method.toUpperCase()))try{const r=await wn();r&&(t.headers["x-csrf-token"]=r)}catch(r){console.error("Failed to attach CSRF token:",r)}return t},t=>Promise.reject(t));S.interceptors.response.use(t=>t,async t=>{const s=t.config;if(t.response?.status===401){Ce=null;const r=window.location.pathname;return["/login","/register","/forgot-password","/reset-password","/verify-email"].some(l=>r.includes(l))||(window.location.href="/login"),Promise.reject(t)}if(t.response?.status===403&&t.response.data.error?.includes("CSRF")&&s&&!s._retry){s._retry=!0;try{return await Er(),S(s)}catch(y){return console.error("Failed to retry request after CSRF refresh:",y),Promise.reject(t)}}if(!t.response&&s){const y=s._retryCount||0;if(y<3){s._retryCount=y+1;const l=Math.pow(2,y)*1e3;return await new Promise(w=>setTimeout(w,l)),S(s)}}if(t.response?.status===404&&console.warn("Resource not found:",s?.url),t.response?.status===429){const r=t.response.headers["retry-after"];console.warn("Rate limit exceeded. Retry after:",r)}return t.response?.status===500&&console.error("Server error:",t.response.data),t.response?.status===503&&console.error("Service unavailable. Server might be down."),Promise.reject(t)});window.addEventListener("error",t=>{console.error("Global error:",t.error),console.error("Error message:",t.message),console.error("Error source:",t.filename,t.lineno,t.colno)});window.addEventListener("unhandledrejection",t=>{console.error("Unhandled promise rejection:",t.reason)});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const t=await navigator.serviceWorker.getRegistrations();for(const r of t)console.log("Unregistering old service worker..."),await r.unregister();if("caches"in window){const r=await caches.keys();for(const y of r)console.log("Deleting cache:",y),await caches.delete(y)}console.log("✅ All service workers unregistered and caches cleared");const s=await navigator.serviceWorker.register("/sw.js");console.log("✅ New ServiceWorker registered:",s)}catch(t){console.error("❌ ServiceWorker error:",t)}});const Nn=new As({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1,refetchOnWindowFocus:!1}}});try{const t=document.getElementById("root");if(!t)throw new Error("Root element not found! DOM might not be ready.");console.log("Initializing React app..."),console.log("React version:",Re.version),console.log("Environment:","production"),Ls.createRoot(t).render(e.jsx(Re.StrictMode,{children:e.jsx(vn,{children:e.jsx(zs,{client:Nn,children:e.jsx(Is,{children:e.jsxs(Oa,{children:[e.jsx(jn,{}),e.jsx(Bs,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})})})})),console.log("✅ React app initialized successfully")}catch(t){console.error("❌ Failed to initialize React app:",t);const s=document.getElementById("root");s&&(s.innerHTML=`
      <div style="padding: 20px; font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto;">
        <h1 style="color: #dc2626;">Application Error</h1>
        <p>The application failed to start. Please check the browser console for details.</p>
        <pre style="background: #f3f4f6; padding: 15px; border-radius: 5px; overflow: auto;">
          ${t instanceof Error?t.message:String(t)}
          ${t instanceof Error&&t.stack?`

`+t.stack:""}
        </pre>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer;">
          Reload Page
        </button>
      </div>
    `)}
//# sourceMappingURL=index-BF3f87B4.js.map
