{"version":3,"mappings":"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","names":["useAuthStore","create","persist","set","get","email","password","rememberMe","response","axios","user","accessToken","data","error","token","_a","newToken","state","initAuth","PWAInstallPrompt","deferredPrompt","setDeferredPrompt","useState","showPrompt","setShowPrompt","useEffect","handleBeforeInstallPrompt","e","handleInstall","outcome","handleDismiss","dismissedUntil","jsxs","jsx","FiX","FiDownload","OfflineIndicator","isOnline","setIsOnline","showBanner","setShowBanner","handleOnline","handleOffline","Fragment","FiWifi","FiWifiOff","RateLimitNotifier","handleRateLimitExceeded","event","customEvent","message","tier","limit","retryAfter","retryMessage","minutes","seconds","toast","GlobalSearch","isOpen","setIsOpen","query","setQuery","results","setResults","loading","setLoading","inputRef","useRef","navigate","useNavigate","handleKeyDown","timer","performSearch","searchQuery","projects","patterns","yarn","recipients","tools","searchResults","p","_b","_c","y","_d","r","_e","t","handleResultClick","result","getTypeColor","type","FiSearch","useThemeStore","newTheme","applyTheme","theme","root","ThemeToggle","toggleTheme","FiMoon","FiSun","DB_NAME","DB_VERSION","dbInstance","initDB","openDB","db","_oldVersion","_newVersion","_transaction","counterStore","syncStore","sessionStore","noteStore","getDB","cachePattern","pattern","getPatternFromCache","patternId","getAllCachedPatterns","cachePDF","blob","getPDFFromCache","cacheCounter","counter","synced","getCounterFromCache","counterId","getProjectCountersFromCache","projectId","addToSyncQueue","item","getSyncQueue","getUnsyncedItems","markSyncItemComplete","id","incrementSyncRetry","deleteSyncItem","cacheProject","project","getProjectFromCache","cacheSession","session","getSessionFromCache","sessionId","getProjectSessionsFromCache","s","cacheNote","note","getNoteFromCache","noteId","getUnsyncedNotes","clearCache","stores","store","getCacheSize","MAX_RETRIES","RETRY_DELAY","SyncManager","__publicField","callback","status","listener","pending","failed","unsyncedItems","delay","config","queue","__vitePreload","m","ms","resolve","syncManager","SyncIndicator","syncStatus","setSyncStatus","showDetails","setShowDetails","failedItems","setFailedItems","React","unsubscribe","handleManualSync","handleRetryFailed","handleShowDetails","items","getStatusColor","getStatusIcon","FiRefreshCw","FiAlertCircle","FiCloud","FiCheckCircle","FiCloudOff","getStatusText","index","ConflictResolver","conflicts","onResolve","onResolveAll","expandedConflict","setExpandedConflict","resolving","setResolving","handleResolve","conflictId","resolution","handleResolveAll","toggleExpand","renderValue","value","getResourceTypeLabel","FiAlertTriangle","conflict","isExpanded","isResolving","FiChevronUp","FiChevronDown","MainLayout","logout","location","useLocation","setConflicts","handleLogout","handleResolveConflict","prev","c","handleResolveAllConflicts","navigation","FiHome","FiFolder","FiBook","FiGrid","FiPackage","FiTool","FiUsers","mainNavigation","Icon","isActive","Link","FiUser","FiLogOut","Outlet","AuthLayout","Dashboard","stats","setStats","recentProjects","setRecentProjects","lowStockYarn","setLowStockYarn","fetchDashboardData","projectsRes","patternsRes","yarnRes","recipientsRes","recentProjectsRes","allYarnRes","lowStock","quickActions","stat","action","currentQty","threshold","percentRemaining","FiPlus","Projects","setProjects","showCreateModal","setShowCreateModal","isSubmitting","setIsSubmitting","deletingId","setDeletingId","setSearchQuery","statusFilter","setStatusFilter","typeFilter","setTypeFilter","formData","setFormData","fetchProjects","handleCreateProject","axiosError","handleDeleteProject","name","formatDate","dateString","filteredProjects","useMemo","searchLower","matchesSearch","matchesStatus","matchesType","projectTypes","types","clearFilters","hasActiveFilters","FiClock","FiCalendar","FiTrash2","PhotoGallery","photos","onDelete","selectedIndex","setSelectedIndex","zoom","setZoom","openLightbox","closeLightbox","goToPrevious","goToNext","handleDownload","photo","link","handleZoomIn","handleZoomOut","selectedPhoto","FiZoomIn","FiChevronLeft","FiChevronRight","FiZoomOut","FileUpload","onUpload","accept","maxSize","selectedFile","setSelectedFile","preview","setPreview","uploading","setUploading","dragActive","setDragActive","fileInputRef","handleFileSelect","file","reader","handleInputChange","handleDrop","handleDrag","handleUpload","handleCancel","FiUpload","WebSocketContext","createContext","WebSocketProvider","children","socket","setSocket","isConnected","setIsConnected","refreshToken","socketRef","isRefreshingRef","newSocket","io","reason","errorMessage","refreshError","joinProject","useCallback","leaveProject","emitCounterUpdate","currentValue","emitCounterIncrement","emitCounterDecrement","emitCounterReset","onCounterUpdate","offCounterUpdate","useWebSocket","context","useContext","preventDoubleTap","func","lastCall","args","now","CounterCard","_onUpdate","onEdit","onToggleVisibility","count","setCount","isListening","setIsListening","showMenu","setShowMenu","recognitionRef","menuRef","cardRef","handleIncrementRef","handleDecrementRef","touchStart","setTouchStart","touchEnd","setTouchEnd","handleClickOutside","handleCounterUpdate","triggerHaptic","intensity","updateCountOnServer","newValue","calculateIncrement","handleIncrementInternal","increment","prevCount","newCount","playFeedbackSound","handleDecrementInternal","handleIncrement","handleDecrement","handleVoiceIncrement","handleVoiceDecrement","handleResetInternal","resetValue","handleReset","handleTouchStart","handleTouchMove","handleTouchEnd","distance","isLeftSwipe","isRightSwipe","audioContext","oscillator","gainNode","SpeechRecognition","last","command","confidence","toggleVoiceControl","progress","FiMic","FiMicOff","FiMoreVertical","FiEyeOff","FiEye","FiMinus","COUNTER_COLORS","INCREMENT_PATTERNS","CounterForm","onSave","onCancel","setName","setType","setCurrentValue","targetValue","setTargetValue","incrementBy","minValue","setMinValue","maxValue","setMaxValue","displayColor","setDisplayColor","notes","setNotes","incrementPattern","setIncrementPattern","customIncrement","setCustomIncrement","handleSubmit","color","CounterHistory","onClose","onUpdate","history","setHistory","fetchHistory","handleUndo","historyId","formatTime","timestamp","date","diff","hours","days","getActionColor","getActionIcon","entry","FiRotateCcw","LinkCounterModal","counters","links","setLinks","sourceCounterId","setSourceCounterId","targetCounterId","setTargetCounterId","linkType","setLinkType","triggerOperator","setTriggerOperator","triggerValue","setTriggerValue","actionType","setActionType","actionValue","setActionValue","fetchLinks","handleCreateLink","linkData","handleDeleteLink","linkId","getCounterName","describeLinkType","source","target","_f","FiLink","CounterManager","setCounters","showForm","setShowForm","showHistory","setShowHistory","showCounterSelector","setShowCounterSelector","showLinkModal","setShowLinkModal","editingCounter","setEditingCounter","selectedCounter","setSelectedCounter","fetchCounters","a","handleCreateCounter","counterData","maxSortOrder","handleUpdateCounter","handleDeleteCounter","handleToggleVisibility","visibleCounters","SessionTimer","_projectId","currentSession","onStartSession","onEndSession","onPauseSession","_getCurrentCounterValues","elapsedTime","setElapsedTime","isRunning","setIsRunning","showEndModal","setShowEndModal","endNotes","setEndNotes","mood","setMood","intervalRef","startTime","handleStart","handlePause","handleStop","handleConfirmEnd","secs","FiPause","FiSquare","FiPlay","SessionHistory","sessions","onDeleteSession","expandedSession","setExpandedSession","formatDuration","calculateRowsPerHour","getMoodEmoji","getMoodColor","totalDuration","sum","totalRows","averageRowsPerHour","rowsPerHour","format","FiTrendingUp","FiMapPin","startValue","endValue","ProjectTimer","milestones","totalTimeSeconds","completedRows","onAddMilestone","onUpdateMilestone","onDeleteMilestone","showAddModal","setShowAddModal","_editingMilestone","_setEditingMilestone","newMilestone","setNewMilestone","calculateEstimatedCompletion","estimatedHours","handleAddMilestone","handleCompleteMilestone","milestone","progressPercentage","FiCircle","b","isCompleted","milestoneProgress","SessionManager","getCurrentCounterValues","setCurrentSession","setSessions","setMilestones","activeTab","setActiveTab","fetchSessions","fetchMilestones","checkActiveSession","handleStartSession","newSession","handleEndSession","handleDeleteSession","handleUpdateMilestone","milestoneId","updates","updatedMilestone","handleDeleteMilestone","AudioNotes","_patternId","onSaveNote","onDeleteNote","onUpdateTranscription","isRecording","setIsRecording","recordingTime","setRecordingTime","playingNoteId","setPlayingNoteId","editingNoteId","setEditingNoteId","editTranscription","setEditTranscription","mediaRecorderRef","audioChunksRef","recordingIntervalRef","recordingTimeRef","audioElementsRef","recordingMimeTypeRef","audio","getSupportedMimeType","startRecording","stream","mimeType","options","mediaRecorder","actualMimeType","audioBlob","track","duration","stopRecording","playAudio","currentAudio","handleDeleteNote","startEditTranscription","saveTranscription","cancelEditTranscription","mins","formatDistanceToNow","FiCheck","FiEdit2","key","COLORS","LINE_WIDTHS","HandwrittenNotes","_pageNumber","initialData","canvasRef","containerRef","isDrawing","setIsDrawing","currentPath","setCurrentPath","paths","setPaths","undoStack","setUndoStack","redoStack","setRedoStack","tool","setTool","setColor","lineWidth","setLineWidth","showColorPicker","setShowColorPicker","showWidthPicker","setShowWidthPicker","canvas","container","rect","ctx","img","path","i","getCanvasPoint","clientX","clientY","startDrawing","point","draw","lastPoint","endDrawing","newPath","previousState","handleRedo","nextState","handleClear","handleExport","imageData","FiRotateCw","FiEdit3","FiTrash","FiDroplet","width","TEMPLATE_INFO","StructuredMemoTemplates","memos","onSaveMemo","onDeleteMemo","showNewMemoModal","setShowNewMemoModal","selectedTemplate","setSelectedTemplate","handleOpenNewMemo","templateType","handleSaveMemo","handleDeleteMemo","memoId","exportMemo","memo","text","renderMemoAsText","url","title","content","gauge","fit","finish","renderTemplateForm","renderMemoCard","info","FiFileText","TRIGGER_TYPES","ALERT_TYPES","MagicMarkerManager","markers","setMarkers","showModal","setShowModal","_editingMarker","_setEditingMarker","fetchMarkers","handleCreate","triggerCondition","counterValue","rowInterval","stitchCount","timeInterval","resetForm","handleToggle","markerId","handleDelete","getTriggerDescription","marker","condition","FiToggleRight","FiToggleLeft","LoadingSpinner","size","fullScreen","className","sizeClasses","textSizeClasses","spinner","FiLoader","pdfjs.GlobalWorkerOptions","PatternPreview","mode","selectedPattern","setSelectedPattern","patternFiles","setPatternFiles","numPages","setNumPages","pageNumber","setPageNumber","scale","setScale","fetchPatternFiles","firstPdf","f","files","handlePatternChange","handleFileChange","fileId","onDocumentLoadSuccess","previousPage","nextPage","zoomIn","zoomOut","pdfFiles","FiExternalLink","Document","Page","ProjectDetail","useParams","setProject","setPhotos","showEditModal","setShowEditModal","knittingMode","setKnittingMode","showKnittingVoiceNotes","setShowKnittingVoiceNotes","showKnittingHistory","setShowKnittingHistory","audioNotes","setAudioNotes","structuredMemos","setStructuredMemos","notesTab","setNotesTab","editingNotes","setEditingNotes","notesText","setNotesText","showAddPatternModal","setShowAddPatternModal","showUploadPatternModal","setShowUploadPatternModal","showAddYarnModal","setShowAddYarnModal","showAddToolModal","setShowAddToolModal","availablePatterns","setAvailablePatterns","availableYarn","setAvailableYarn","availableTools","setAvailableTools","availableRecipients","setAvailableRecipients","selectedPatternId","setSelectedPatternId","selectedYarnId","setSelectedYarnId","yarnQuantity","setYarnQuantity","selectedToolId","setSelectedToolId","uploadingPattern","setUploadingPattern","newPatternData","setNewPatternData","patternFile","setPatternFile","isMountedRef","isFetchingRef","fetchProject","fetchPhotos","fetchAvailableItems","fetchAudioNotes","fetchStructuredMemos","projectData","toolsRes","handleUpdate","handleEditNotes","handleSaveNotes","handleCancelNotes","handleAddPattern","handleRemovePattern","handleUploadPattern","newPattern","fileFormData","handleAddYarn","handleRemoveYarn","yarnId","handleAddTool","handleRemoveTool","toolId","handleSaveAudioNote","durationSeconds","transcription","handleDeleteAudioNote","handleUpdateAudioTranscription","handleSaveStructuredMemo","handleDeleteStructuredMemo","handleToggleKnittingMode","counterValues","handlePhotoUpload","handlePhotoDelete","photoId","getYarnPercentage","remaining","total","selectedRecipient","FiArrowLeft","FiImage","percentage","isLowStock","pp","pt","BOOKMARK_COLORS","BookmarkManager","currentPage","currentZoom","onJumpToBookmark","bookmarks","setBookmarks","editingBookmark","setEditingBookmark","fetchBookmarks","params","handleCreateBookmark","handleUpdateBookmark","handleDeleteBookmark","bookmarkId","handleQuickBookmark","openCreateModal","openEditModal","bookmark","FiBookmark","HIGHLIGHT_COLORS","PatternHighlighter","highlights","setHighlights","startPos","setStartPos","currentRect","setCurrentRect","selectedColor","setSelectedColor","opacity","setOpacity","showControls","setShowControls","fetchHighlights","drawHighlights","highlight","getMousePos","handleMouseDown","pos","handleMouseMove","height","handleMouseUp","saveHighlight","coordinates","handleClearAll","h","MARKER_COLORS","RowMarker","onPositionChange","position","setPosition","setHeight","isDragging","setIsDragging","isResizing","setIsResizing","isLocked","setIsLocked","isVisible","setIsVisible","dragStart","setDragStart","newX","newY","handleResizeStart","handleResize","newHeight","FiMove","ZOOM_LEVELS","PatternViewer","fileUrl","filename","fullscreen","initialPage","initialZoom","setCurrentPage","zoomIndex","setZoomIndex","curr","idx","rotation","setRotation","searchText","setSearchText","showSearch","setShowSearch","_isFullscreen","setIsFullscreen","showBookmarks","setShowBookmarks","showRowMarker","setShowRowMarker","showHighlighter","setShowHighlighter","zoomLevel","closestIndex","onDocumentLoadError","handleRotate","handleNextPage","handlePrevPage","handlePageJump","page","toggleFullscreen","handleJumpToBookmark","zoomIdx","z","handleFullscreenChange","FiMaximize","PDFCollation","setPatterns","selectedPatterns","setSelectedPatterns","addDividers","setAddDividers","dividerText","setDividerText","collationResult","setCollationResult","setError","fetchPatterns","err","handlePatternToggle","handleMoveUp","newOrder","handleMoveDown","handleCollate","getPatternName","formatFileSize","bytes","ChartViewer","chartData","symbols","rows","cols","isInTheRound","pan","setPan","showLegend","setShowLegend","highlightedRow","setHighlightedRow","highlightedCell","setHighlightedCell","currentRow","setCurrentRow","canvasSize","setCanvasSize","historyIndex","setHistoryIndex","CELL_SIZE","PADDING","updateSize","resizeObserver","newRow","newCol","saveToHistory","newState","newHistory","undo","newIndex","redo","renderChart","forPrint","targetCanvas","chartWidth","chartHeight","startX","startY","row","col","displayRow","x","rowIndex","cell","symbol","handleWheel","delta","newZoom","getTouchDistance","touches","dx","dy","dist","midX","midY","newDist","handleCanvasClick","adjustedX","adjustedY","newRotation","resetView","exportToPNG","handlePrint","printCanvas","printWindow","moveToNextRow","moveToPrevRow","FiInfo","FiPrinter","Patterns","showCollationModal","setShowCollationModal","editingPattern","setEditingPattern","uploadingFiles","setUploadingFiles","difficultyFilter","setDifficultyFilter","categoryFilter","setCategoryFilter","handleCreatePattern","uploadedCount","handleEditClick","handleUpdatePattern","handleDeletePattern","getDifficultyColor","difficulty","filteredPatterns","matchesDifficulty","matchesCategory","categories","cats","cat","FiSettings","PatternFileUpload","onDownload","description","setDescription","viewingFile","setViewingFile","acceptedTypes","fileName","hasValidExtension","ext","hasValidMimeType","fileSizeMB","getFileIcon","fileType","FiFile","ChartEditor","setTitle","setRows","setCols","setIsInTheRound","cells","setCells","availableSymbols","setAvailableSymbols","selectedSymbol","setSelectedSymbol","activeTool","setActiveTool","saving","setSaving","fetchSymbols","addToHistory","newCells","getCellSymbol","handleCellClick","handleMouseEnter","handleSave","usedSymbolIds","payload","handleGridResize","newRows","newCols","clearChart","renderGrid","grid","cellSymbolId","renderSymbolPalette","category","FiSave","ChartUpload","setFile","parseFile","parseJsonFormat","parseCsvFormat","parseTextFormat","lines","maxRow","maxCol","symbolSet","startIndex","parts","gridLines","inGrid","line","l","symbolMap","symbolCounter","char","droppedFile","dataTransfer","handleDragOver","PatternSectionsManager","sections","setSections","editingSection","setEditingSection","fetchSections","sectionId","handleEdit","section","PatternAnnotationsManager","annotations","setAnnotations","showBookmarkForm","setShowBookmarkForm","showAnnotationForm","setShowAnnotationForm","bookmarkForm","setBookmarkForm","annotationForm","setAnnotationForm","fetchData","handleCreateAnnotation","handleDeleteHighlight","highlightId","handleDeleteAnnotation","annotationId","FiEdit","annotation","PatternDetail","setPattern","setFiles","selectedPdfFile","setSelectedPdfFile","showSectionsModal","setShowSectionsModal","showAnnotationsModal","setShowAnnotationsModal","charts","setCharts","selectedChart","setSelectedChart","showChartEditor","setShowChartEditor","showChartUpload","setShowChartUpload","showChartViewer","setShowChartViewer","editingChart","setEditingChart","targetPage","setTargetPage","targetZoom","setTargetZoom","fetchPattern","fetchCharts","pdfFile","handleFileUpload","handleFileDownload","handleFileDelete","fetchChartDetail","chartId","handleChartSaved","handleChartEdit","chart","chartDetail","handleChartView","handleChartDelete","chartTitle","handleChartUpload","csrfToken","fetchCsrfToken","getCsrfToken","unsafeMethods","isRefreshing","failedQueue","processQueue","prom","refreshAccessToken","originalRequest","reject","retryError","rateLimitRetryCount","retryAfterHeader","retryAfterSeconds","errorData","retryCount","_g","_h","_i","_j","_l","_k","KNITTING_SYMBOLS","getAllSymbols","allSymbols","categoryKey","searchSymbols","lowerQuery","getCategories","SYMBOL_COUNT","TOTAL_SYMBOL_COUNT","DEFAULT_SYMBOL","PatternBuilder","searchParams","useSearchParams","chartIdFromUrl","selectedCategory","setSelectedCategory","gridData","setGridData","patternName","setPatternName","setChartId","currentPatternId","setCurrentPatternId","eraserMode","setEraserMode","loadExistingChart","parseChartData","convertChartDataToGrid","newGridData","foundSymbol","occupiedKey","patternResponse","chartResponse","chartsResponse","placeSymbol","symbolData","symbolWidth","existingCell","parentKey","parentCell","parentWidth","newData","pRow","pCol","clearGrid","deleteSymbol","cellData","exportPattern","exportData","_","json","generateInstructions","instructions","rowInstructions","savePattern","targetPatternId","getDisplaySymbols","handleCategoryChange","renderSymbol","sizeClass","widthBadge","FiXCircle","isOccupied","droppedSymbol","YarnStash","setYarn","editingYarn","setEditingYarn","yarnPhotos","setYarnPhotos","uploadingPhoto","setUploadingPhoto","fetchYarn","handleCreateYarn","handleUpdateYarn","handleDeleteYarn","getWeightColor","weight","Tools","setTools","editingTool","setEditingTool","fetchTools","handleCreateTool","handleUpdateTool","handleDeleteTool","Recipients","setRecipients","editingRecipient","setEditingRecipient","fetchRecipients","handleCreateRecipient","recipient","handleUpdateRecipient","handleDeleteRecipient","EMAIL_REGEX","Profile","setUser","editMode","setEditMode","profileForm","setProfileForm","passwordForm","setPasswordForm","fetchStats","yarnsRes","activeProjects","completedProjects","handleUpdateProfile","handleChangePassword","handleResendVerification","FiLock","FiBarChart2","Login","setEmail","setPassword","setRememberMe","isLoading","setIsLoading","errors","setErrors","login","validateForm","newErrors","Register","ForgotPassword","ResetPassword","VerifyEmail","NotFound","PrivateRoute","isAuthenticated","Navigate","PublicRoute","App","Routes","Route","ErrorBoundary","Component","errorInfo","registrations","registration","cacheNames","cacheName","queryClient","QueryClient","rootElement","ReactDOM","QueryClientProvider","BrowserRouter","ToastContainer"],"ignoreList":[],"sources":["../../src/stores/authStore.ts","../../src/components/PWAInstallPrompt.tsx","../../src/components/OfflineIndicator.tsx","../../src/components/RateLimitNotifier.tsx","../../src/components/GlobalSearch.tsx","../../src/stores/themeStore.ts","../../src/components/ThemeToggle.tsx","../../src/utils/offline/db.ts","../../src/utils/offline/syncManager.tsx","../../src/components/offline/SyncIndicator.tsx","../../src/components/offline/ConflictResolver.tsx","../../src/components/layouts/MainLayout.tsx","../../src/components/layouts/AuthLayout.tsx","../../src/pages/Dashboard.tsx","../../src/pages/Projects.tsx","../../src/components/PhotoGallery.tsx","../../src/components/FileUpload.tsx","../../src/contexts/WebSocketContext.tsx","../../src/utils/debounce.ts","../../src/components/counters/CounterCard.tsx","../../src/components/counters/CounterForm.tsx","../../src/components/counters/CounterHistory.tsx","../../src/components/counters/LinkCounterModal.tsx","../../src/components/counters/CounterManager.tsx","../../src/components/sessions/SessionTimer.tsx","../../src/components/sessions/SessionHistory.tsx","../../src/components/sessions/ProjectTimer.tsx","../../src/components/sessions/SessionManager.tsx","../../src/components/notes/AudioNotes.tsx","../../src/components/notes/HandwrittenNotes.tsx","../../src/components/notes/StructuredMemoTemplates.tsx","../../src/components/magic-markers/MagicMarkerManager.tsx","../../src/components/LoadingSpinner.tsx","../../src/components/PatternPreview.tsx","../../src/pages/ProjectDetail.tsx","../../src/components/patterns/BookmarkManager.tsx","../../src/components/patterns/PatternHighlighter.tsx","../../src/components/patterns/RowMarker.tsx","../../src/components/patterns/PatternViewer.tsx","../../src/components/patterns/PDFCollation.tsx","../../src/components/patterns/ChartViewer.tsx","../../src/pages/Patterns.tsx","../../src/components/PatternFileUpload.tsx","../../src/components/patterns/ChartEditor.tsx","../../src/components/patterns/ChartUpload.tsx","../../src/components/patterns/PatternSectionsManager.tsx","../../src/components/patterns/PatternAnnotationsManager.tsx","../../src/pages/PatternDetail.tsx","../../src/lib/axios.ts","../../src/data/knitting-symbols-library.ts","../../src/pages/PatternBuilder.tsx","../../src/pages/YarnStash.tsx","../../src/pages/Tools.tsx","../../src/pages/Recipients.tsx","../../src/pages/Profile.tsx","../../src/pages/auth/Login.tsx","../../src/pages/auth/Register.tsx","../../src/pages/auth/ForgotPassword.tsx","../../src/pages/auth/ResetPassword.tsx","../../src/pages/auth/VerifyEmail.tsx","../../src/pages/NotFound.tsx","../../src/App.tsx","../../src/components/ErrorBoundary.tsx","../../src/main.tsx"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport axios from 'axios'; // Uses globally configured axios from lib/axios\n\ninterface User {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  emailVerified: boolean;\n}\n\ninterface AuthState {\n  user: User | null;\n  accessToken: string | null;\n  isAuthenticated: boolean;\n  login: (email: string, password: string, rememberMe?: boolean) => Promise<void>;\n  register: (data: any) => Promise<void>;\n  logout: () => Promise<void>;\n  setUser: (user: User) => void;\n  setToken: (token: string) => void;\n  checkAuth: () => Promise<void>;\n  refreshToken: () => Promise<string | null>;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set, get) => ({\n      user: null,\n      accessToken: null,\n      isAuthenticated: false,\n\n      login: async (email: string, password: string, rememberMe?: boolean) => {\n        const response = await axios.post('/api/auth/login', {\n          email,\n          password,\n          rememberMe,\n        });\n\n        const { user, accessToken } = response.data.data;\n\n        set({\n          user,\n          accessToken,\n          isAuthenticated: true,\n        });\n\n        // Set axios default header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n      },\n\n      register: async (data: any) => {\n        await axios.post('/api/auth/register', data);\n      },\n\n      logout: async () => {\n        try {\n          await axios.post('/api/auth/logout');\n        } catch (error) {\n          console.error('Logout error:', error);\n        } finally {\n          set({\n            user: null,\n            accessToken: null,\n            isAuthenticated: false,\n          });\n\n          delete axios.defaults.headers.common['Authorization'];\n        }\n      },\n\n      setUser: (user: User) => {\n        set({ user });\n      },\n\n      setToken: (token: string) => {\n        set({ accessToken: token });\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      },\n\n      refreshToken: async (): Promise<string | null> => {\n        try {\n          const response = await axios.post('/api/auth/refresh');\n          if (response.data.success && response.data.data?.accessToken) {\n            const newToken = response.data.data.accessToken;\n\n            set({ accessToken: newToken });\n            axios.defaults.headers.common['Authorization'] = `Bearer ${newToken}`;\n\n            return newToken;\n          }\n          return null;\n        } catch (error) {\n          console.error('Token refresh failed:', error);\n          // Clear auth state on refresh failure\n          set({\n            user: null,\n            accessToken: null,\n            isAuthenticated: false,\n          });\n          delete axios.defaults.headers.common['Authorization'];\n          return null;\n        }\n      },\n\n      checkAuth: async () => {\n        const { accessToken } = get();\n\n        if (!accessToken) {\n          return;\n        }\n\n        try {\n          axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n\n          const response = await axios.get('/api/auth/profile');\n          const { user } = response.data.data;\n\n          set({\n            user,\n            isAuthenticated: true,\n          });\n        } catch (error) {\n          console.error('Auth check failed:', error);\n          set({\n            user: null,\n            accessToken: null,\n            isAuthenticated: false,\n          });\n\n          delete axios.defaults.headers.common['Authorization'];\n        }\n      },\n    }),\n    {\n      name: 'rowly-auth',\n      partialize: (state) => ({\n        user: state.user,\n        accessToken: state.accessToken,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n);\n\n// Initialize auth on app load - Re-enabled with safety checks\n// Only run checkAuth in browser environment after hydration\nif (typeof window !== 'undefined') {\n  // Delay checkAuth to avoid blocking initial render\n  // Only run if we have a token in storage\n  // Use requestIdleCallback if available, fallback to setTimeout\n  const initAuth = () => {\n    const state = useAuthStore.getState();\n    if (state.accessToken) {\n      state.checkAuth().catch((error) => {\n        console.error('checkAuth failed on initialization:', error);\n        // Silently fail - user will be redirected to login if needed\n      });\n    }\n  };\n\n  if ('requestIdleCallback' in window) {\n    // Run during browser idle time for better performance\n    window.requestIdleCallback(initAuth, { timeout: 2000 });\n  } else {\n    // Fallback with longer delay for older browsers\n    setTimeout(initAuth, 1000);\n  }\n}\n","import { useState, useEffect } from 'react';\nimport { FiDownload, FiX } from 'react-icons/fi';\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\nexport default function PWAInstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n\n  useEffect(() => {\n    const handleBeforeInstallPrompt = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n\n      // Check if user has dismissed the prompt before\n      const dismissed = localStorage.getItem('pwa-install-dismissed');\n      if (!dismissed) {\n        setShowPrompt(true);\n      }\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    };\n  }, []);\n\n  const handleInstall = async () => {\n    if (!deferredPrompt) return;\n\n    // Show the install prompt\n    await deferredPrompt.prompt();\n\n    // Wait for the user's response\n    const { outcome } = await deferredPrompt.userChoice;\n\n    if (outcome === 'accepted') {\n      console.log('User accepted the install prompt');\n    } else {\n      console.log('User dismissed the install prompt');\n    }\n\n    // Clear the deferred prompt\n    setDeferredPrompt(null);\n    setShowPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    // Remember dismissal for 30 days\n    const dismissedUntil = Date.now() + (30 * 24 * 60 * 60 * 1000);\n    localStorage.setItem('pwa-install-dismissed', dismissedUntil.toString());\n  };\n\n  if (!showPrompt || !deferredPrompt) {\n    return null;\n  }\n\n  return (\n    <div\n      className=\"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-purple-200 dark:border-purple-700 p-6 z-50 animate-slide-up\"\n      role=\"dialog\"\n      aria-labelledby=\"pwa-install-title\"\n      aria-describedby=\"pwa-install-description\"\n    >\n      <button\n        onClick={handleDismiss}\n        className=\"absolute top-2 right-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition\"\n        aria-label=\"Dismiss install prompt\"\n      >\n        <FiX className=\"h-5 w-5\" aria-hidden=\"true\" />\n      </button>\n\n      <div className=\"flex items-start gap-4\">\n        <div className=\"flex-shrink-0\">\n          <div className=\"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center\">\n            <FiDownload className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" aria-hidden=\"true\" />\n          </div>\n        </div>\n\n        <div className=\"flex-1\">\n          <h3\n            id=\"pwa-install-title\"\n            className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-1\"\n          >\n            Install Rowly App\n          </h3>\n          <p\n            id=\"pwa-install-description\"\n            className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\"\n          >\n            Install Rowly on your device for quick access and offline use!\n          </p>\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={handleInstall}\n              className=\"flex-1 px-4 py-2 bg-purple-600 dark:bg-purple-700 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition font-medium\"\n              aria-label=\"Install Rowly app\"\n            >\n              Install\n            </button>\n            <button\n              onClick={handleDismiss}\n              className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\n              aria-label=\"Dismiss for now\"\n            >\n              Not now\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiWifiOff, FiWifi } from 'react-icons/fi';\n\nexport default function OfflineIndicator() {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [showBanner, setShowBanner] = useState(false);\n\n  useEffect(() => {\n    const handleOnline = () => {\n      setIsOnline(true);\n      setShowBanner(true);\n      setTimeout(() => setShowBanner(false), 3000);\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      setShowBanner(true);\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  if (!showBanner && isOnline) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ${\n        showBanner ? 'translate-y-0' : '-translate-y-full'\n      }`}\n      role=\"status\"\n      aria-live=\"polite\"\n      aria-atomic=\"true\"\n    >\n      <div\n        className={`px-4 py-3 text-center text-white font-medium ${\n          isOnline ? 'bg-green-600' : 'bg-orange-600'\n        }`}\n      >\n        <div className=\"flex items-center justify-center gap-2\">\n          {isOnline ? (\n            <>\n              <FiWifi className=\"h-5 w-5\" aria-hidden=\"true\" />\n              <span>Back online! Your changes will sync automatically.</span>\n            </>\n          ) : (\n            <>\n              <FiWifiOff className=\"h-5 w-5\" aria-hidden=\"true\" />\n              <span>You're offline. Changes will sync when you reconnect.</span>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useEffect } from 'react';\nimport { toast } from 'react-toastify';\n\n/**\n * RateLimitNotifier Component\n *\n * Listens for rate limit events from the axios interceptor\n * and displays user-friendly toast notifications\n */\nexport const RateLimitNotifier = () => {\n  useEffect(() => {\n    const handleRateLimitExceeded = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { message, tier, limit, retryAfter } = customEvent.detail;\n\n      // Format retry time\n      let retryMessage = '';\n      if (retryAfter) {\n        const minutes = Math.ceil(retryAfter / 60);\n        const seconds = retryAfter % 60;\n\n        if (minutes > 0) {\n          retryMessage = minutes === 1 ? '1 minute' : `${minutes} minutes`;\n        } else {\n          retryMessage = seconds === 1 ? '1 second' : `${seconds} seconds`;\n        }\n      }\n\n      // Show user-friendly toast\n      toast.warning(\n        <div>\n          <strong>Rate Limit Reached</strong>\n          <p style={{ margin: '8px 0 0 0', fontSize: '14px' }}>\n            {message || `You've reached your ${tier} tier limit of ${limit} requests.`}\n          </p>\n          {retryMessage && (\n            <p style={{ margin: '4px 0 0 0', fontSize: '13px', opacity: 0.9 }}>\n              Please wait {retryMessage} before trying again.\n            </p>\n          )}\n        </div>,\n        {\n          autoClose: retryAfter ? Math.min(retryAfter * 1000, 10000) : 5000,\n          closeOnClick: true,\n          pauseOnHover: true,\n          draggable: true,\n        }\n      );\n    };\n\n    // Listen for rate limit events\n    window.addEventListener('rate-limit-exceeded', handleRateLimitExceeded);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener('rate-limit-exceeded', handleRateLimitExceeded);\n    };\n  }, []);\n\n  // This component doesn't render anything\n  return null;\n};\n","import { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { FiSearch, FiX } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface SearchResult {\n  id: string;\n  type: 'project' | 'pattern' | 'yarn' | 'recipient' | 'tool';\n  title: string;\n  subtitle?: string;\n  url: string;\n}\n\nexport default function GlobalSearch() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<SearchResult[]>([]);\n  const [loading, setLoading] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const navigate = useNavigate();\n\n  // Keyboard shortcut: Cmd/Ctrl + K\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n        e.preventDefault();\n        setIsOpen(true);\n      }\n      if (e.key === 'Escape') {\n        setIsOpen(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  // Focus input when modal opens\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isOpen]);\n\n  // Search debounced\n  useEffect(() => {\n    if (!query.trim()) {\n      setResults([]);\n      return;\n    }\n\n    const timer = setTimeout(async () => {\n      await performSearch(query);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [query]);\n\n  const performSearch = async (searchQuery: string) => {\n    setLoading(true);\n    try {\n      const [projects, patterns, yarn, recipients, tools] = await Promise.all([\n        axios.get(`/api/projects?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { projects: [] } } })),\n        axios.get(`/api/patterns?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { patterns: [] } } })),\n        axios.get(`/api/yarn?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { yarn: [] } } })),\n        axios.get(`/api/recipients?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { recipients: [] } } })),\n        axios.get(`/api/tools?search=${encodeURIComponent(searchQuery)}`).catch(() => ({ data: { data: { tools: [] } } })),\n      ]);\n\n      const searchResults: SearchResult[] = [];\n\n      // Projects\n      projects.data.data.projects?.slice(0, 5).forEach((p: any) => {\n        searchResults.push({\n          id: p.id,\n          type: 'project',\n          title: p.name,\n          subtitle: p.description || p.status,\n          url: `/projects/${p.id}`,\n        });\n      });\n\n      // Patterns\n      patterns.data.data.patterns?.slice(0, 3).forEach((p: any) => {\n        searchResults.push({\n          id: p.id,\n          type: 'pattern',\n          title: p.name,\n          subtitle: p.designer || p.pattern_type,\n          url: '/patterns',\n        });\n      });\n\n      // Yarn\n      yarn.data.data.yarn?.slice(0, 3).forEach((y: any) => {\n        searchResults.push({\n          id: y.id,\n          type: 'yarn',\n          title: `${y.brand} ${y.name}`,\n          subtitle: `${y.color_name || ''} - ${y.weight || ''}`,\n          url: '/yarn',\n        });\n      });\n\n      // Recipients\n      recipients.data.data.recipients?.slice(0, 2).forEach((r: any) => {\n        searchResults.push({\n          id: r.id,\n          type: 'recipient',\n          title: r.name,\n          subtitle: r.relationship,\n          url: '/recipients',\n        });\n      });\n\n      // Tools\n      tools.data.data.tools?.slice(0, 2).forEach((t: any) => {\n        searchResults.push({\n          id: t.id,\n          type: 'tool',\n          title: t.name,\n          subtitle: t.tool_type,\n          url: '/tools',\n        });\n      });\n\n      setResults(searchResults);\n    } catch (error) {\n      console.error('Search error:', error);\n      toast.error('Search failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleResultClick = (result: SearchResult) => {\n    navigate(result.url);\n    setIsOpen(false);\n    setQuery('');\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'project': return 'bg-purple-100 text-purple-800';\n      case 'pattern': return 'bg-blue-100 text-blue-800';\n      case 'yarn': return 'bg-pink-100 text-pink-800';\n      case 'recipient': return 'bg-green-100 text-green-800';\n      case 'tool': return 'bg-orange-100 text-orange-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (!isOpen) {\n    return (\n      <button\n        onClick={() => setIsOpen(true)}\n        className=\"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition\"\n        aria-label=\"Open global search\"\n        title=\"Search (K)\"\n      >\n        <FiSearch className=\"h-4 w-4\" />\n        <span>Search</span>\n        <kbd className=\"hidden sm:inline-block px-2 py-0.5 text-xs font-semibold text-gray-500 bg-gray-200 border border-gray-300 rounded\">\n          K\n        </kbd>\n      </button>\n    );\n  }\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20 px-4\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Global search\"\n      onClick={(e) => {\n        if (e.target === e.currentTarget) {\n          setIsOpen(false);\n          setQuery('');\n        }\n      }}\n    >\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[60vh] flex flex-col\">\n        {/* Search Input */}\n        <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center gap-3\">\n            <FiSearch className=\"h-5 w-5 text-gray-400\" aria-hidden=\"true\" />\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Search projects, patterns, yarn, and more...\"\n              className=\"flex-1 outline-none text-lg bg-transparent text-gray-900 dark:text-gray-100\"\n              aria-label=\"Search input\"\n              autoComplete=\"off\"\n            />\n            <button\n              onClick={() => {\n                setIsOpen(false);\n                setQuery('');\n              }}\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              aria-label=\"Close search\"\n            >\n              <FiX className=\"h-5 w-5\" aria-hidden=\"true\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Results */}\n        <div\n          className=\"flex-1 overflow-y-auto p-2\"\n          role=\"region\"\n          aria-live=\"polite\"\n          aria-label=\"Search results\"\n        >\n          {loading && (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\" role=\"status\">\n              Searching...\n            </div>\n          )}\n\n          {!loading && query && results.length === 0 && (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\" role=\"status\">\n              No results found\n            </div>\n          )}\n\n          {!loading && results.length > 0 && (\n            <div className=\"space-y-1\" role=\"list\">\n              {results.map((result) => (\n                <button\n                  key={`${result.type}-${result.id}`}\n                  onClick={() => handleResultClick(result)}\n                  className=\"w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition flex items-center justify-between\"\n                  role=\"listitem\"\n                  aria-label={`${result.type}: ${result.title}${result.subtitle ? ` - ${result.subtitle}` : ''}`}\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium text-gray-900 dark:text-gray-100\">{result.title}</div>\n                    {result.subtitle && (\n                      <div className=\"text-sm text-gray-500 dark:text-gray-400\">{result.subtitle}</div>\n                    )}\n                  </div>\n                  <span className={`px-2 py-1 text-xs font-medium rounded ${getTypeColor(result.type)}`}>\n                    {result.type}\n                  </span>\n                </button>\n              ))}\n            </div>\n          )}\n\n          {!loading && !query && (\n            <div className=\"py-8 text-center text-gray-500 dark:text-gray-400\">\n              <p className=\"mb-2\">Start typing to search</p>\n              <p className=\"text-sm\">Projects, patterns, yarn, recipients, and tools</p>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between\">\n          <span>Press ESC to close</span>\n          <span>K to open</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\ntype Theme = 'light' | 'dark';\n\ninterface ThemeState {\n  theme: Theme;\n  toggleTheme: () => void;\n  setTheme: (theme: Theme) => void;\n}\n\nexport const useThemeStore = create<ThemeState>()(\n  persist(\n    (set) => ({\n      theme: 'light',\n\n      toggleTheme: () => {\n        set((state) => {\n          const newTheme = state.theme === 'light' ? 'dark' : 'light';\n          applyTheme(newTheme);\n          return { theme: newTheme };\n        });\n      },\n\n      setTheme: (theme: Theme) => {\n        applyTheme(theme);\n        set({ theme });\n      },\n    }),\n    {\n      name: 'rowly-theme',\n      onRehydrateStorage: () => (state) => {\n        // Apply theme after rehydration\n        if (state?.theme) {\n          applyTheme(state.theme);\n        }\n      },\n    }\n  )\n);\n\n// Helper function to apply theme to document\nfunction applyTheme(theme: Theme) {\n  const root = window.document.documentElement;\n\n  if (theme === 'dark') {\n    root.classList.add('dark');\n  } else {\n    root.classList.remove('dark');\n  }\n}\n\n// Initialize theme on load\nconst { theme } = useThemeStore.getState();\napplyTheme(theme);\n","import { FiSun, FiMoon } from 'react-icons/fi';\nimport { useThemeStore } from '../stores/themeStore';\n\nexport default function ThemeToggle() {\n  const { theme, toggleTheme } = useThemeStore();\n\n  return (\n    <button\n      onClick={toggleTheme}\n      className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200\"\n      aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}\n      title={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}\n    >\n      {theme === 'light' ? (\n        <FiMoon className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" />\n      ) : (\n        <FiSun className=\"w-5 h-5 text-yellow-500\" />\n      )}\n    </button>\n  );\n}\n","import { openDB, DBSchema, IDBPDatabase } from 'idb';\n\ninterface RowlyOfflineDB extends DBSchema {\n  patterns: {\n    key: string;\n    value: {\n      id: string;\n      name: string;\n      file_url: string;\n      data: any;\n      cached_at: string;\n    };\n  };\n  'pdf-cache': {\n    key: string;\n    value: {\n      patternId: string;\n      blob: Blob;\n      cached_at: string;\n    };\n  };\n  counters: {\n    key: string;\n    value: {\n      id: string;\n      project_id: string;\n      value: number;\n      updated_at: number;\n      synced: boolean;\n    };\n  };\n  'sync-queue': {\n    key: number;\n    value: {\n      id?: number;\n      type: string;\n      endpoint: string;\n      method: 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n      data: any;\n      timestamp: number;\n      synced: boolean;\n      retries: number;\n    };\n    autoIncrement: true;\n  };\n  projects: {\n    key: string;\n    value: {\n      id: string;\n      data: any;\n      cached_at: string;\n    };\n  };\n  sessions: {\n    key: string;\n    value: {\n      id: string;\n      project_id: string;\n      data: any;\n      cached_at: string;\n      synced: boolean;\n    };\n  };\n  notes: {\n    key: string;\n    value: {\n      id: string;\n      type: 'audio' | 'handwritten' | 'structured';\n      data: any;\n      cached_at: string;\n      synced: boolean;\n    };\n  };\n}\n\nconst DB_NAME = 'rowly-offline';\nconst DB_VERSION = 1;\n\nlet dbInstance: IDBPDatabase<RowlyOfflineDB> | null = null;\n\nexport const initDB = async (): Promise<IDBPDatabase<RowlyOfflineDB>> => {\n  if (dbInstance) return dbInstance;\n    // @ts-ignore\n\n  dbInstance = await openDB<RowlyOfflineDB>(DB_NAME, DB_VERSION, {\n    upgrade(db, _oldVersion, _newVersion, _transaction) {\n      // Pattern files\n      if (!db.objectStoreNames.contains('patterns')) {\n        db.createObjectStore('patterns', { keyPath: 'id' });\n      }\n\n      // PDF cache\n      if (!db.objectStoreNames.contains('pdf-cache')) {\n        db.createObjectStore('pdf-cache', { keyPath: 'patternId' });\n      }\n\n      // Counters\n      if (!db.objectStoreNames.contains('counters')) {\n        const counterStore = db.createObjectStore('counters', { keyPath: 'id' });\n        // @ts-ignore - IndexedDB typing complexity\n        counterStore.createIndex('project_id', 'project_id');\n        // @ts-ignore - IndexedDB typing complexity\n        counterStore.createIndex('synced', 'synced');\n      }\n\n      // Sync queue\n      if (!db.objectStoreNames.contains('sync-queue')) {\n        const syncStore = db.createObjectStore('sync-queue', {\n          keyPath: 'id',\n          autoIncrement: true,\n        });\n        // @ts-ignore - IndexedDB typing complexity\n        syncStore.createIndex('synced', 'synced');\n        // @ts-ignore - IndexedDB typing complexity\n        syncStore.createIndex('timestamp', 'timestamp');\n      }\n\n      // Projects\n      if (!db.objectStoreNames.contains('projects')) {\n        db.createObjectStore('projects', { keyPath: 'id' });\n      }\n\n      // Sessions\n      if (!db.objectStoreNames.contains('sessions')) {\n        const sessionStore = db.createObjectStore('sessions', { keyPath: 'id' });\n        // @ts-ignore - IndexedDB typing complexity\n        sessionStore.createIndex('project_id', 'project_id');\n        // @ts-ignore - IndexedDB typing complexity\n        sessionStore.createIndex('synced', 'synced');\n      }\n\n      // Notes\n      if (!db.objectStoreNames.contains('notes')) {\n        const noteStore = db.createObjectStore('notes', { keyPath: 'id' });\n        // @ts-ignore - IndexedDB typing complexity\n        noteStore.createIndex('type', 'type');\n        // @ts-ignore - IndexedDB typing complexity\n        noteStore.createIndex('synced', 'synced');\n      }\n    },\n  });\n\n  return dbInstance;\n};\n\nexport const getDB = async (): Promise<IDBPDatabase<RowlyOfflineDB>> => {\n  if (!dbInstance) {\n    return initDB();\n  }\n  return dbInstance;\n};\n\n// Pattern operations\nexport const cachePattern = async (pattern: any) => {\n  const db = await getDB();\n  await db.put('patterns', {\n    id: pattern.id,\n    name: pattern.name,\n    file_url: pattern.file_url,\n    data: pattern,\n    cached_at: new Date().toISOString(),\n  });\n};\n\nexport const getPatternFromCache = async (patternId: string) => {\n  const db = await getDB();\n  return db.get('patterns', patternId);\n};\n\nexport const getAllCachedPatterns = async () => {\n  const db = await getDB();\n  return db.getAll('patterns');\n};\n\n// PDF cache operations\nexport const cachePDF = async (patternId: string, blob: Blob) => {\n  const db = await getDB();\n  await db.put('pdf-cache', {\n    patternId,\n    blob,\n    cached_at: new Date().toISOString(),\n  });\n};\n\nexport const getPDFFromCache = async (patternId: string) => {\n  const db = await getDB();\n  return db.get('pdf-cache', patternId);\n};\n\n// Counter operations\nexport const cacheCounter = async (counter: any, synced = true) => {\n  const db = await getDB();\n  await db.put('counters', {\n    id: counter.id,\n    project_id: counter.project_id,\n    value: counter.current_value,\n    updated_at: Date.now(),\n    synced,\n  });\n};\n\nexport const getCounterFromCache = async (counterId: string) => {\n  const db = await getDB();\n  return db.get('counters', counterId);\n};\n\nexport const getProjectCountersFromCache = async (projectId: string) => {\n  const db = await getDB();\n  // @ts-expect-error - index exists at runtime but not in schema type\n  const index = db.transaction('counters').store.index('project_id');\n  // @ts-expect-error - IDB allows string keys at runtime\n  return index.getAll(projectId);\n};\n\n// Sync queue operations\nexport const addToSyncQueue = async (item: {\n  type: string;\n  endpoint: string;\n  method: 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n  data: any;\n}) => {\n  const db = await getDB();\n  await db.add('sync-queue', {\n    ...item,\n    timestamp: Date.now(),\n    synced: false,\n    retries: 0,\n  });\n};\n\nexport const getSyncQueue = async () => {\n  const db = await getDB();\n  return db.getAll('sync-queue');\n};\n\nexport const getUnsyncedItems = async () => {\n  const db = await getDB();\n  // @ts-expect-error - index exists at runtime but not in schema type\n  const index = db.transaction('sync-queue').store.index('synced');\n  // @ts-expect-error - IDB allows boolean keys at runtime\n  return index.getAll(false);\n};\n\nexport const markSyncItemComplete = async (id: number) => {\n  const db = await getDB();\n  const item = await db.get('sync-queue', id);\n  if (item) {\n    await db.put('sync-queue', { ...item, synced: true });\n  }\n};\n\nexport const incrementSyncRetry = async (id: number) => {\n  const db = await getDB();\n  const item = await db.get('sync-queue', id);\n  if (item) {\n    await db.put('sync-queue', { ...item, retries: item.retries + 1 });\n  }\n};\n\nexport const deleteSyncItem = async (id: number) => {\n  const db = await getDB();\n  await db.delete('sync-queue', id);\n};\n\n// Project operations\nexport const cacheProject = async (project: any) => {\n  const db = await getDB();\n  await db.put('projects', {\n    id: project.id,\n    data: project,\n    cached_at: new Date().toISOString(),\n  });\n};\n\nexport const getProjectFromCache = async (projectId: string) => {\n  const db = await getDB();\n  return db.get('projects', projectId);\n};\n\n// Session operations\nexport const cacheSession = async (session: any, synced = true) => {\n  const db = await getDB();\n  await db.put('sessions', {\n    id: session.id,\n    project_id: session.project_id,\n    data: session,\n    cached_at: new Date().toISOString(),\n    synced,\n  });\n};\n\nexport const getSessionFromCache = async (sessionId: string) => {\n  const db = await getDB();\n  return db.get('sessions', sessionId);\n};\n\nexport const getProjectSessionsFromCache = async (projectId: string) => {\n  const db = await getDB();\n  // @ts-expect-error - index exists at runtime but not in schema type\n  const index = db.transaction('sessions').store.index('project_id');\n  // @ts-expect-error - IDB allows string keys at runtime\n  const sessions = await index.getAll(projectId);\n  return sessions.map((s: { data: unknown }) => s.data);\n};\n\n// Note operations\nexport const cacheNote = async (note: any, type: 'audio' | 'handwritten' | 'structured', synced = true) => {\n  const db = await getDB();\n  await db.put('notes', {\n    id: note.id,\n    type,\n    data: note,\n    cached_at: new Date().toISOString(),\n    synced,\n  });\n};\n\nexport const getNoteFromCache = async (noteId: string) => {\n  const db = await getDB();\n  return db.get('notes', noteId);\n};\n\nexport const getUnsyncedNotes = async () => {\n  const db = await getDB();\n  // @ts-expect-error - index exists at runtime but not in schema type\n  const index = db.transaction('notes').store.index('synced');\n  // @ts-expect-error - IDB allows boolean keys at runtime\n  return index.getAll(false);\n};\n\n// Clear all cache\nexport const clearCache = async () => {\n  const db = await getDB();\n  const stores = ['patterns', 'pdf-cache', 'counters', 'projects', 'sessions', 'notes'];\n\n  for (const store of stores) {\n    await db.clear(store as any);\n  }\n};\n\n// Get cache size estimate\nexport const getCacheSize = async (): Promise<number> => {\n  if ('storage' in navigator && 'estimate' in navigator.storage) {\n    const estimate = await navigator.storage.estimate();\n    return estimate.usage || 0;\n  }\n  return 0;\n};\n","import React from 'react';\nimport axios from 'axios';\nimport {\n  getUnsyncedItems,\n  markSyncItemComplete,\n  incrementSyncRetry,\n  deleteSyncItem,\n  getSyncQueue,\n} from './db';\n\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY = 2000; // Start with 2 seconds\n\nexport interface SyncStatus {\n  isSyncing: boolean;\n  pendingCount: number;\n  failedCount: number;\n  lastSyncTime?: Date;\n}\n\nclass SyncManager {\n  private isSyncing = false;\n  private syncListeners: Set<(status: SyncStatus) => void> = new Set();\n\n  constructor() {\n    // Listen for online/offline events\n    window.addEventListener('online', () => this.handleOnline());\n    window.addEventListener('offline', () => this.handleOffline());\n  }\n\n  /**\n   * Subscribe to sync status updates\n   */\n  onSyncStatusChange(callback: (status: SyncStatus) => void) {\n    this.syncListeners.add(callback);\n    return () => this.syncListeners.delete(callback);\n  }\n\n  /**\n   * Notify all listeners of sync status change\n   */\n  private notifyListeners(status: SyncStatus) {\n    this.syncListeners.forEach((listener) => listener(status));\n  }\n\n  /**\n   * Get current sync status\n   */\n  async getSyncStatus(): Promise<SyncStatus> {\n    const queue = await getSyncQueue();\n    const pending = queue.filter((item) => !item.synced);\n    const failed = pending.filter((item) => item.retries >= MAX_RETRIES);\n\n    return {\n      isSyncing: this.isSyncing,\n      pendingCount: pending.length,\n      failedCount: failed.length,\n      lastSyncTime: undefined, // Could track this in localStorage\n    };\n  }\n\n  /**\n   * Handle when device comes online\n   */\n  private async handleOnline() {\n    console.log('Device is online, starting sync...');\n    await this.processSyncQueue();\n  }\n\n  /**\n   * Handle when device goes offline\n   */\n  private handleOffline() {\n    console.log('Device is offline');\n    this.isSyncing = false;\n  }\n\n  /**\n   * Process the sync queue\n   */\n  async processSyncQueue(): Promise<void> {\n    if (this.isSyncing) {\n      console.log('Sync already in progress');\n      return;\n    }\n\n    if (!navigator.onLine) {\n      console.log('Device is offline, skipping sync');\n      return;\n    }\n\n    this.isSyncing = true;\n    this.notifyListeners(await this.getSyncStatus());\n\n    try {\n      const unsyncedItems = await getUnsyncedItems();\n      console.log(`Processing ${unsyncedItems.length} unsynced items`);\n\n      for (const item of unsyncedItems) {\n        // Skip items that have exceeded max retries\n        if (item.retries >= MAX_RETRIES) {\n          console.error(`Item ${item.id} has exceeded max retries, skipping`);\n          continue;\n        }\n\n        try {\n          await this.syncItem(item);\n          await markSyncItemComplete(item.id!);\n          console.log(`Successfully synced item ${item.id}`);\n        } catch (error) {\n          console.error(`Failed to sync item ${item.id}:`, error);\n          await incrementSyncRetry(item.id!);\n\n          // Exponential backoff\n          const delay = RETRY_DELAY * Math.pow(2, item.retries);\n          await this.sleep(delay);\n        }\n      }\n\n      // Notify listeners that sync is complete\n      this.notifyListeners(await this.getSyncStatus());\n    } catch (error) {\n      console.error('Error processing sync queue:', error);\n    } finally {\n      this.isSyncing = false;\n    }\n  }\n\n  /**\n   * Sync a single item\n   */\n  private async syncItem(item: any): Promise<void> {\n    const config = {\n      method: item.method,\n      url: item.endpoint,\n      data: item.data,\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    await axios(config);\n  }\n\n  /**\n   * Manually trigger sync\n   */\n  async sync(): Promise<void> {\n    return this.processSyncQueue();\n  }\n\n  /**\n   * Clear sync queue (useful for debugging/testing)\n   */\n  async clearQueue(): Promise<void> {\n    const queue = await getSyncQueue();\n    for (const item of queue) {\n      if (item.id) {\n        await deleteSyncItem(item.id);\n      }\n    }\n    this.notifyListeners(await this.getSyncStatus());\n  }\n\n  /**\n   * Get failed sync items (exceeded max retries)\n   */\n  async getFailedItems() {\n    const queue = await getSyncQueue();\n    return queue.filter((item) => !item.synced && item.retries >= MAX_RETRIES);\n  }\n\n  /**\n   * Retry failed items\n   */\n  async retryFailed(): Promise<void> {\n    const failed = await this.getFailedItems();\n    for (const item of failed) {\n      if (item.id) {\n        // Reset retries to 0\n        const db = await import('./db').then((m) => m.getDB());\n        await db.put('sync-queue', { ...item, retries: 0 });\n      }\n    }\n    await this.processSyncQueue();\n  }\n\n  /**\n   * Sleep utility\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\n// Singleton instance\nexport const syncManager = new SyncManager();\n\n/**\n * React hook for sync status\n */\n      // Cleanup\n      // @ts-ignore - cleanup function return type\nexport const useSyncStatus = (callback: (status: SyncStatus) => void) => {\n    // @ts-ignore\n  React.useEffect(() => {\n    const unsubscribe = syncManager.onSyncStatusChange(callback);\n\n    // Get initial status\n    syncManager.getSyncStatus().then(callback);\n\n    return unsubscribe;\n  }, [callback]);\n};\n","import React, { useState } from 'react';\nimport { FiCloud, FiCloudOff, FiRefreshCw, FiAlertCircle, FiCheckCircle, FiX } from 'react-icons/fi';\nimport { syncManager, SyncStatus } from '../../utils/offline/syncManager';\n\nexport const SyncIndicator: React.FC = () => {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [syncStatus, setSyncStatus] = useState<SyncStatus>({\n    isSyncing: false,\n    pendingCount: 0,\n    failedCount: 0,\n  });\n  const [showDetails, setShowDetails] = useState(false);\n  const [failedItems, setFailedItems] = useState<any[]>([]);\n\n  // Update online status\n  React.useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  // Subscribe to sync status updates\n  React.useEffect(() => {\n    const unsubscribe = syncManager.onSyncStatusChange((status) => {\n      setSyncStatus(status);\n    });\n\n    // Get initial status\n    syncManager.getSyncStatus().then(setSyncStatus);\n\n    return () => {\n      if (typeof unsubscribe === 'function') {\n        unsubscribe();\n      }\n    };\n  }, []);\n\n  const handleManualSync = async () => {\n    try {\n      await syncManager.sync();\n    } catch (error) {\n      console.error('Manual sync failed:', error);\n    }\n  };\n\n  const handleRetryFailed = async () => {\n    try {\n      await syncManager.retryFailed();\n      setShowDetails(false);\n    } catch (error) {\n      console.error('Retry failed:', error);\n    }\n  };\n\n  const handleShowDetails = async () => {\n    setShowDetails(true);\n    const items = await syncManager.getFailedItems();\n    setFailedItems(items);\n  };\n\n  // Determine indicator color and icon\n  const getStatusColor = () => {\n    if (!isOnline) return 'text-gray-500';\n    if (syncStatus.failedCount > 0) return 'text-red-600';\n    if (syncStatus.pendingCount > 0) return 'text-yellow-600';\n    return 'text-green-600';\n  };\n\n  const getStatusIcon = () => {\n    if (!isOnline) return <FiCloudOff className=\"w-5 h-5\" />;\n    if (syncStatus.isSyncing) return <FiRefreshCw className=\"w-5 h-5 animate-spin\" />;\n    if (syncStatus.failedCount > 0) return <FiAlertCircle className=\"w-5 h-5\" />;\n    if (syncStatus.pendingCount > 0) return <FiCloud className=\"w-5 h-5\" />;\n    return <FiCheckCircle className=\"w-5 h-5\" />;\n  };\n\n  const getStatusText = () => {\n    if (!isOnline) return 'Offline';\n    if (syncStatus.isSyncing) return 'Syncing...';\n    if (syncStatus.failedCount > 0)\n      return `${syncStatus.failedCount} failed`;\n    if (syncStatus.pendingCount > 0)\n      return `${syncStatus.pendingCount} pending`;\n    return 'Synced';\n  };\n\n  return (\n    <>\n      {/* Sync Indicator Button */}\n      <button\n        onClick={isOnline ? handleManualSync : undefined}\n        className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${\n          isOnline\n            ? 'hover:bg-gray-100 dark:hover:bg-gray-700'\n            : 'cursor-not-allowed opacity-70'\n        }`}\n        title={isOnline ? 'Click to sync now' : 'Device is offline'}\n      >\n        <span className={getStatusColor()}>{getStatusIcon()}</span>\n        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n          {getStatusText()}\n        </span>\n      </button>\n\n      {/* Failed Items Details Link */}\n      {syncStatus.failedCount > 0 && (\n        <button\n          onClick={handleShowDetails}\n          className=\"text-xs text-red-600 hover:text-red-700 dark:text-red-400 underline ml-2\"\n        >\n          View failed items\n        </button>\n      )}\n\n      {/* Failed Items Modal */}\n      {showDetails && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[80vh] overflow-y-auto\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n                <FiAlertCircle className=\"w-6 h-6 text-red-600\" />\n                Sync Conflicts\n              </h3>\n              <button\n                onClick={() => setShowDetails(false)}\n                className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\n              >\n                <FiX className=\"w-6 h-6\" />\n              </button>\n            </div>\n\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n              The following changes could not be synced after {3} attempts. You can retry\n              syncing or resolve them manually.\n            </p>\n\n            {failedItems.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                <FiCheckCircle className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                <p>No failed items</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3 mb-6\">\n                {failedItems.map((item, index) => (\n                  <div\n                    key={item.id || index}\n                    className=\"border border-red-200 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900/20\"\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div>\n                        <div className=\"font-medium text-gray-900 dark:text-white\">\n                          {item.type}\n                        </div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          {item.method} {item.endpoint}\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-red-600 dark:text-red-400\">\n                        {item.retries} retries\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n                      Timestamp: {new Date(item.timestamp).toLocaleString()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setShowDetails(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Close\n              </button>\n              <button\n                onClick={handleRetryFailed}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                Retry All\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiAlertTriangle, FiChevronDown, FiChevronUp } from 'react-icons/fi';\n\nexport interface DataConflict {\n  id: string;\n  resourceType: 'counter' | 'session' | 'note' | 'project';\n  resourceId: string;\n  localValue: any;\n  serverValue: any;\n  lastSyncedValue?: any;\n  field: string;\n  timestamp: number;\n}\n\ninterface ConflictResolverProps {\n  conflicts: DataConflict[];\n  onResolve: (conflictId: string, resolution: 'local' | 'server' | 'merge') => Promise<void>;\n  onResolveAll: (resolution: 'local' | 'server') => Promise<void>;\n}\n\nexport const ConflictResolver: React.FC<ConflictResolverProps> = ({\n  conflicts,\n  onResolve,\n  onResolveAll,\n}) => {\n  const [expandedConflict, setExpandedConflict] = useState<string | null>(null);\n  const [resolving, setResolving] = useState<string | null>(null);\n\n  if (conflicts.length === 0) {\n    return null;\n  }\n\n  const handleResolve = async (conflictId: string, resolution: 'local' | 'server' | 'merge') => {\n    setResolving(conflictId);\n    try {\n      await onResolve(conflictId, resolution);\n    } catch (error) {\n      console.error('Failed to resolve conflict:', error);\n      alert('Failed to resolve conflict');\n    } finally {\n      setResolving(null);\n    }\n  };\n\n  const handleResolveAll = async (resolution: 'local' | 'server') => {\n    if (\n      !confirm(\n        `Are you sure you want to use ${resolution === 'local' ? 'local' : 'server'} version for all conflicts?`\n      )\n    ) {\n      return;\n    }\n\n    try {\n      await onResolveAll(resolution);\n    } catch (error) {\n      console.error('Failed to resolve all conflicts:', error);\n      alert('Failed to resolve conflicts');\n    }\n  };\n\n  const toggleExpand = (conflictId: string) => {\n    setExpandedConflict(expandedConflict === conflictId ? null : conflictId);\n  };\n\n  const renderValue = (value: any): string => {\n    if (typeof value === 'object') {\n      return JSON.stringify(value, null, 2);\n    }\n    return String(value);\n  };\n\n  const getResourceTypeLabel = (type: string): string => {\n    switch (type) {\n      case 'counter':\n        return 'Counter';\n      case 'session':\n        return 'Session';\n      case 'note':\n        return 'Note';\n      case 'project':\n        return 'Project';\n      default:\n        return type;\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-2 border-orange-500\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <FiAlertTriangle className=\"w-6 h-6 text-orange-600\" />\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Sync Conflicts Detected\n        </h3>\n      </div>\n\n      <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n        {conflicts.length} conflict{conflicts.length !== 1 ? 's' : ''} found between your local\n        changes and the server. Please review and resolve each conflict.\n      </p>\n\n      {/* Bulk Actions */}\n      <div className=\"flex gap-3 mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n        <button\n          onClick={() => handleResolveAll('local')}\n          className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm\"\n        >\n          Use Local for All\n        </button>\n        <button\n          onClick={() => handleResolveAll('server')}\n          className=\"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors text-sm\"\n        >\n          Use Server for All\n        </button>\n      </div>\n\n      {/* Conflict List */}\n      <div className=\"space-y-3\">\n        {conflicts.map((conflict) => {\n          const isExpanded = expandedConflict === conflict.id;\n          const isResolving = resolving === conflict.id;\n\n          return (\n            <div\n              key={conflict.id}\n              className=\"border border-orange-200 dark:border-orange-800 rounded-lg overflow-hidden\"\n            >\n              {/* Conflict Header */}\n              <button\n                onClick={() => toggleExpand(conflict.id)}\n                className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors\"\n              >\n                <div className=\"flex items-center gap-3 text-left\">\n                  <FiAlertTriangle className=\"w-5 h-5 text-orange-600 flex-shrink-0\" />\n                  <div>\n                    <div className=\"font-medium text-gray-900 dark:text-white\">\n                      {getResourceTypeLabel(conflict.resourceType)} - {conflict.field}\n                    </div>\n                    <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                      ID: {conflict.resourceId.slice(0, 8)}...\n                    </div>\n                  </div>\n                </div>\n                {isExpanded ? (\n                  <FiChevronUp className=\"w-5 h-5 text-gray-400\" />\n                ) : (\n                  <FiChevronDown className=\"w-5 h-5 text-gray-400\" />\n                )}\n              </button>\n\n              {/* Conflict Details */}\n              {isExpanded && (\n                <div className=\"px-4 py-4 bg-orange-50 dark:bg-orange-900/20 border-t border-orange-200 dark:border-orange-800\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                    {/* Local Version */}\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Your Local Version\n                      </div>\n                      <div className=\"bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-800\">\n                        <pre className=\"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap\">\n                          {renderValue(conflict.localValue)}\n                        </pre>\n                      </div>\n                    </div>\n\n                    {/* Server Version */}\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Server Version\n                      </div>\n                      <div className=\"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700\">\n                        <pre className=\"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap\">\n                          {renderValue(conflict.serverValue)}\n                        </pre>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Last Synced Value (if available) */}\n                  {conflict.lastSyncedValue && (\n                    <div className=\"mb-4\">\n                      <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Last Synced Value (for reference)\n                      </div>\n                      <div className=\"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700\">\n                        <pre className=\"text-xs text-gray-500 dark:text-gray-400 overflow-x-auto whitespace-pre-wrap\">\n                          {renderValue(conflict.lastSyncedValue)}\n                        </pre>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Resolution Actions */}\n                  <div className=\"flex gap-3\">\n                    <button\n                      onClick={() => handleResolve(conflict.id, 'local')}\n                      disabled={isResolving}\n                      className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors\"\n                    >\n                      {isResolving ? 'Resolving...' : 'Use Local'}\n                    </button>\n                    <button\n                      onClick={() => handleResolve(conflict.id, 'server')}\n                      disabled={isResolving}\n                      className=\"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors\"\n                    >\n                      {isResolving ? 'Resolving...' : 'Use Server'}\n                    </button>\n                  </div>\n\n                  <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-3\">\n                    Conflict detected at:{' '}\n                    {new Date(conflict.timestamp).toLocaleString()}\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","import { useState } from 'react';\nimport { Outlet, Link, useNavigate, useLocation } from 'react-router-dom';\nimport { useAuthStore } from '../../stores/authStore';\nimport GlobalSearch from '../GlobalSearch';\nimport ThemeToggle from '../ThemeToggle';\nimport { SyncIndicator } from '../offline/SyncIndicator';\nimport { ConflictResolver, DataConflict } from '../offline/ConflictResolver';\nimport {\n  FiHome,\n  FiFolder,\n  FiBook,\n  FiPackage,\n  FiTool,\n  FiUsers,\n  FiUser,\n  FiLogOut,\n  FiGrid\n} from 'react-icons/fi';\n\nexport default function MainLayout() {\n  const { user, logout } = useAuthStore();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [conflicts, setConflicts] = useState<DataConflict[]>([]);\n\n  const handleLogout = async () => {\n    await logout();\n    navigate('/login');\n  };\n\n  const handleResolveConflict = async (conflictId: string, resolution: 'local' | 'server' | 'merge') => {\n    // Remove resolved conflict from state\n    setConflicts(prev => prev.filter(c => c.id !== conflictId));\n    // In a real app, this would sync the resolution to the server\n    console.log(`Resolved conflict ${conflictId} with ${resolution}`);\n  };\n\n  const handleResolveAllConflicts = async (resolution: 'local' | 'server') => {\n    setConflicts([]);\n    console.log(`Resolved all conflicts with ${resolution}`);\n  };\n\n  const navigation = [\n    { name: 'Dashboard', href: '/dashboard', icon: FiHome, shortName: 'Home' },\n    { name: 'Projects', href: '/projects', icon: FiFolder, shortName: 'Projects' },\n    { name: 'Patterns', href: '/patterns', icon: FiBook, shortName: 'Patterns' },\n    { name: 'Pattern Builder', href: '/pattern-builder', icon: FiGrid, shortName: 'Builder' },\n    { name: 'Yarn Stash', href: '/yarn', icon: FiPackage, shortName: 'Stash' },\n    { name: 'Tools', href: '/tools', icon: FiTool, shortName: 'Tools' },\n    { name: 'Recipients', href: '/recipients', icon: FiUsers, shortName: 'Recipients' },\n  ];\n\n  const mainNavigation = navigation.slice(0, 5); // First 5 for mobile bottom nav\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200 pb-20 md:pb-0\">\n      {/* Desktop Sidebar - Hidden on mobile */}\n      <aside className=\"hidden md:fixed md:inset-y-0 md:left-0 md:w-64 md:block bg-white dark:bg-gray-800 shadow-lg transition-colors duration-200\">\n        <div className=\"flex flex-col h-full\">\n          {/* Logo */}\n          <div className=\"flex items-center justify-between px-4 h-16 bg-purple-600 dark:bg-purple-700\">\n            <h1 className=\"text-2xl font-bold text-white\">Rowly</h1>\n            <ThemeToggle />\n          </div>\n\n          {/* Search */}\n          <div className=\"px-4 py-3\">\n            <GlobalSearch />\n          </div>\n\n          {/* Navigation */}\n          <nav className=\"flex-1 overflow-y-auto py-4\" aria-label=\"Main navigation\">\n            {navigation.map((item) => {\n              const Icon = item.icon;\n              const isActive = location.pathname === item.href;\n              return (\n                <Link\n                  key={item.name}\n                  to={item.href}\n                  className={`flex items-center px-6 py-3 text-sm font-medium transition ${\n                    isActive\n                      ? 'bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 border-r-4 border-purple-600 dark:border-purple-400'\n                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-purple-600 dark:hover:text-purple-400'\n                  }`}\n                  aria-label={item.name}\n                  aria-current={isActive ? 'page' : undefined}\n                >\n                  <Icon className=\"mr-3 h-5 w-5\" aria-hidden=\"true\" />\n                  {item.name}\n                </Link>\n              );\n            })}\n          </nav>\n\n          {/* User section */}\n          <div className=\"border-t border-gray-200 dark:border-gray-700 p-4\">\n            <div className=\"flex items-center mb-3\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"h-10 w-10 rounded-full bg-purple-600 dark:bg-purple-700 flex items-center justify-center text-white font-semibold\">\n                  {user?.firstName?.[0]}{user?.lastName?.[0]}\n                </div>\n              </div>\n              <div className=\"ml-3 flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100 truncate\">\n                  {user?.firstName} {user?.lastName}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">{user?.email}</p>\n              </div>\n            </div>\n\n            <Link\n              to=\"/profile\"\n              className=\"flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg mb-2 transition\"\n            >\n              <FiUser className=\"mr-2 h-4 w-4\" />\n              Profile\n            </Link>\n\n            <button\n              onClick={handleLogout}\n              className=\"w-full flex items-center px-3 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\n            >\n              <FiLogOut className=\"mr-2 h-4 w-4\" />\n              Logout\n            </button>\n          </div>\n        </div>\n      </aside>\n\n      {/* Mobile Bottom Navigation */}\n      <nav className=\"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 md:hidden z-40\" aria-label=\"Main navigation\">\n        <div className=\"flex justify-around items-center h-20\">\n          {mainNavigation.map((item) => {\n            const Icon = item.icon;\n            const isActive = location.pathname === item.href;\n            return (\n              <Link\n                key={item.name}\n                to={item.href}\n                className={`flex flex-col items-center justify-center flex-1 h-full min-w-0 ${\n                  isActive\n                    ? 'text-purple-600 dark:text-purple-400'\n                    : 'text-gray-600 dark:text-gray-400'\n                }`}\n                aria-label={item.name}\n                aria-current={isActive ? 'page' : undefined}\n              >\n                <Icon className=\"h-7 w-7 mb-1\" aria-hidden=\"true\" />\n                <span className=\"text-xs font-medium truncate\">{item.shortName}</span>\n              </Link>\n            );\n          })}\n        </div>\n      </nav>\n\n      {/* Main content */}\n      <div className=\"md:ml-64\">\n        {/* Sync Indicator - Fixed position */}\n        <div className=\"fixed top-4 right-4 z-50\">\n          <SyncIndicator />\n        </div>\n\n        {/* Conflict Resolver - Top of content area */}\n        {conflicts.length > 0 && (\n          <div className=\"p-4 md:p-6 lg:p-8 pb-0\">\n            <ConflictResolver\n              conflicts={conflicts}\n              onResolve={handleResolveConflict}\n              onResolveAll={handleResolveAllConflicts}\n            />\n          </div>\n        )}\n\n        <main className=\"p-4 md:p-6 lg:p-8\">\n          <Outlet />\n        </main>\n      </div>\n    </div>\n  );\n}\n","import { Outlet } from 'react-router-dom';\nimport ThemeToggle from '../ThemeToggle';\n\nexport default function AuthLayout() {\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center transition-colors duration-200\">\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle />\n      </div>\n      <div className=\"max-w-md w-full px-4\">\n        <Outlet />\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FiFolder, FiBook, FiPackage, FiUsers, FiPlus, FiAlertCircle } from 'react-icons/fi';\nimport { useAuthStore } from '../stores/authStore';\nimport axios from 'axios';\n\nexport default function Dashboard() {\n  const { user } = useAuthStore();\n  const [stats, setStats] = useState([\n    {\n      name: 'Active Projects',\n      value: '0',\n      icon: FiFolder,\n      href: '/projects',\n      color: 'bg-purple-500',\n    },\n    {\n      name: 'Patterns',\n      value: '0',\n      icon: FiBook,\n      href: '/patterns',\n      color: 'bg-blue-500',\n    },\n    {\n      name: 'Yarn Skeins',\n      value: '0',\n      icon: FiPackage,\n      href: '/yarn',\n      color: 'bg-green-500',\n    },\n    {\n      name: 'Recipients',\n      value: '0',\n      icon: FiUsers,\n      href: '/recipients',\n      color: 'bg-orange-500',\n    },\n  ]);\n  const [loading, setLoading] = useState(true);\n  const [recentProjects, setRecentProjects] = useState<any[]>([]);\n  const [lowStockYarn, setLowStockYarn] = useState<any[]>([]);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, []);\n\n  const fetchDashboardData = async () => {\n    try {\n      const [projectsRes, patternsRes, yarnRes, recipientsRes, recentProjectsRes, allYarnRes] = await Promise.all([\n        axios.get('/api/projects/stats'),\n        axios.get('/api/patterns/stats'),\n        axios.get('/api/yarn/stats'),\n        axios.get('/api/recipients/stats'),\n        axios.get('/api/projects?limit=5'),\n        axios.get('/api/yarn'),\n      ]);\n\n      setStats([\n        {\n          name: 'Active Projects',\n          value: String(projectsRes.data.data.stats.active_count || 0),\n          icon: FiFolder,\n          href: '/projects',\n          color: 'bg-purple-500',\n        },\n        {\n          name: 'Patterns',\n          value: String(patternsRes.data.data.stats.total_count || 0),\n          icon: FiBook,\n          href: '/patterns',\n          color: 'bg-blue-500',\n        },\n        {\n          name: 'Yarn Skeins',\n          value: String(yarnRes.data.data.stats.total_skeins || 0),\n          icon: FiPackage,\n          href: '/yarn',\n          color: 'bg-green-500',\n        },\n        {\n          name: 'Recipients',\n          value: String(recipientsRes.data.data.stats.total_count || 0),\n          icon: FiUsers,\n          href: '/recipients',\n          color: 'bg-orange-500',\n        },\n      ]);\n\n      setRecentProjects(recentProjectsRes.data.data.projects || []);\n\n      // Filter yarn items with low stock alerts\n      const allYarn = allYarnRes.data.data.yarn || [];\n      const lowStock = allYarn.filter((y: any) => {\n        if (!y.low_stock_alert || !y.low_stock_threshold) return false;\n        const currentQuantity = y.quantity_remaining || y.skeins || 0;\n        return currentQuantity <= y.low_stock_threshold;\n      });\n      setLowStockYarn(lowStock);\n    } catch (error) {\n      console.error('Error fetching dashboard data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const quickActions = [\n    {\n      name: 'New Project',\n      description: 'Start tracking a new knitting project',\n      href: '/projects',\n      icon: FiFolder,\n      color: 'text-purple-600 bg-purple-50 hover:bg-purple-100',\n    },\n    {\n      name: 'Add Pattern',\n      description: 'Save a new knitting pattern',\n      href: '/patterns',\n      icon: FiBook,\n      color: 'text-blue-600 bg-blue-50 hover:bg-blue-100',\n    },\n    {\n      name: 'Add Yarn',\n      description: 'Add yarn to your stash',\n      href: '/yarn',\n      icon: FiPackage,\n      color: 'text-green-600 bg-green-50 hover:bg-green-100',\n    },\n  ];\n\n  return (\n    <div>\n      {/* Welcome Section */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n          Welcome back, {user?.firstName}!\n        </h1>\n        <p className=\"text-gray-600\">\n          Here's what's happening with your knitting projects today.\n        </p>\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n        {loading ? (\n          <div className=\"col-span-full text-center py-8\">\n            <div className=\"text-gray-500\">Loading statistics...</div>\n          </div>\n        ) : (\n          stats.map((stat) => {\n            const Icon = stat.icon;\n            return (\n              <Link\n                key={stat.name}\n                to={stat.href}\n                className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">{stat.name}</p>\n                    <p className=\"text-3xl font-bold text-gray-900 mt-2\">{stat.value}</p>\n                  </div>\n                  <div className={`${stat.color} p-3 rounded-lg`}>\n                    <Icon className=\"h-6 w-6 text-white\" />\n                  </div>\n                </div>\n              </Link>\n            );\n          })\n        )}\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"mb-8\">\n        <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Quick Actions</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link\n                key={action.name}\n                to={action.href}\n                className={`${action.color} rounded-lg p-6 transition`}\n              >\n                <div className=\"flex items-start\">\n                  <div className=\"flex-shrink-0\">\n                    <Icon className=\"h-6 w-6\" />\n                  </div>\n                  <div className=\"ml-4\">\n                    <h3 className=\"text-sm font-semibold\">{action.name}</h3>\n                    <p className=\"text-xs mt-1 opacity-75\">{action.description}</p>\n                  </div>\n                </div>\n              </Link>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Low Stock Alerts */}\n      {!loading && lowStockYarn.length > 0 && (\n        <div className=\"mb-8\">\n          <div className=\"bg-orange-50 border-l-4 border-orange-500 rounded-lg p-6\">\n            <div className=\"flex items-start mb-4\">\n              <FiAlertCircle className=\"h-6 w-6 text-orange-600 mr-3 flex-shrink-0\" />\n              <div>\n                <h2 className=\"text-xl font-bold text-orange-900 mb-1\">\n                  Low Stock Alerts\n                </h2>\n                <p className=\"text-sm text-orange-700\">\n                  The following yarn items are running low and need restocking:\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              {lowStockYarn.map((yarn) => {\n                const currentQty = yarn.quantity_remaining || yarn.skeins || 0;\n                const threshold = yarn.low_stock_threshold || 0;\n                const percentRemaining = threshold > 0 ? (currentQty / threshold) * 100 : 0;\n\n                return (\n                  <Link\n                    key={yarn.id}\n                    to=\"/yarn\"\n                    className=\"flex items-center justify-between p-4 bg-white rounded-lg hover:shadow-md transition\"\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <h3 className=\"font-semibold text-gray-900\">\n                          {yarn.brand} {yarn.name}\n                        </h3>\n                        <span className=\"text-sm font-medium text-orange-600\">\n                          {currentQty} / {threshold} {yarn.unit}\n                        </span>\n                      </div>\n\n                      {/* Progress bar */}\n                      <div className=\"w-full bg-gray-200 rounded-full h-2 mb-2\">\n                        <div\n                          className=\"bg-orange-500 h-2 rounded-full transition-all\"\n                          style={{ width: `${Math.min(100, percentRemaining)}%` }}\n                        />\n                      </div>\n\n                      <div className=\"flex items-center text-sm text-gray-600\">\n                        <FiPackage className=\"mr-2 h-4 w-4\" />\n                        {yarn.color && <span className=\"mr-3\">Color: {yarn.color}</span>}\n                        {yarn.weight && <span>Weight: {yarn.weight}</span>}\n                      </div>\n                    </div>\n                  </Link>\n                );\n              })}\n            </div>\n\n            <div className=\"mt-4 pt-4 border-t border-orange-200\">\n              <Link\n                to=\"/yarn\"\n                className=\"text-sm font-medium text-orange-700 hover:text-orange-800 flex items-center\"\n              >\n                View all yarn in stash\n                <span className=\"ml-2\"></span>\n              </Link>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Recent Activity */}\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Recent Projects</h2>\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-500\">Loading recent projects...</div>\n          </div>\n        ) : recentProjects.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <FiFolder className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <p className=\"text-gray-500 mb-4\">No projects yet</p>\n            <Link\n              to=\"/projects\"\n              className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n            >\n              <FiPlus className=\"mr-2 h-4 w-4\" />\n              Create Your First Project\n            </Link>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {recentProjects.map((project) => (\n              <Link\n                key={project.id}\n                to={`/projects/${project.id}`}\n                className=\"flex items-center justify-between p-4 hover:bg-gray-50 rounded-lg transition\"\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"bg-purple-100 p-3 rounded-lg\">\n                    <FiFolder className=\"h-5 w-5 text-purple-600\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900\">{project.name}</h3>\n                    <p className=\"text-sm text-gray-500\">\n                      {project.type && (\n                        <span className=\"capitalize\">{project.type}</span>\n                      )}\n                      {project.status && (\n                        <span className=\"ml-2 capitalize\">{project.status}</span>\n                      )}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"text-sm text-gray-500\">\n                  {new Date(project.created_at).toLocaleDateString()}\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect, useMemo } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FiPlus, FiTrash2, FiCalendar, FiClock, FiSearch, FiX } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string;\n  project_type: string;\n  status: string;\n  start_date: string;\n  target_completion_date: string;\n  completion_date: string;\n  created_at: string;\n}\n\nexport default function Projects() {\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n\n  // Search and filter state\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    projectType: 'sweater',\n    startDate: new Date().toISOString().split('T')[0],\n    targetCompletionDate: '',\n  });\n\n  useEffect(() => {\n    fetchProjects();\n  }, []);\n\n  const fetchProjects = async () => {\n    try {\n      const response = await axios.get('/api/projects');\n      setProjects(response.data.data.projects);\n    } catch (error: any) {\n      console.error('Error fetching projects:', error);\n      toast.error('Failed to load projects');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateProject = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (isSubmitting) return;\n\n    setIsSubmitting(true);\n    try {\n      await axios.post('/api/projects', formData);\n      toast.success('Project created successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        name: '',\n        description: '',\n        projectType: 'sweater',\n        startDate: new Date().toISOString().split('T')[0],\n        targetCompletionDate: '',\n      });\n      fetchProjects();\n    } catch (error) {\n      console.error('Error creating project:', error);\n      const axiosError = error as { response?: { data?: { message?: string } } };\n      toast.error(axiosError.response?.data?.message || 'Failed to create project');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleDeleteProject = async (id: string, name: string) => {\n    if (deletingId) return;\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n\n    setDeletingId(id);\n    try {\n      await axios.delete(`/api/projects/${id}`);\n      toast.success('Project deleted successfully');\n      fetchProjects();\n    } catch (error) {\n      console.error('Error deleting project:', error);\n      toast.error('Failed to delete project');\n    } finally {\n      setDeletingId(null);\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active':\n        return 'bg-green-100 text-green-800';\n      case 'completed':\n        return 'bg-blue-100 text-blue-800';\n      case 'paused':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'archived':\n        return 'bg-gray-100 text-gray-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return 'Not set';\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  // Filter and search projects\n  const filteredProjects = useMemo(() => {\n    return projects.filter((project) => {\n      // Search filter\n      const searchLower = searchQuery.toLowerCase();\n      const matchesSearch =\n        !searchQuery ||\n        project.name.toLowerCase().includes(searchLower) ||\n        project.description?.toLowerCase().includes(searchLower) ||\n        project.project_type?.toLowerCase().includes(searchLower);\n\n      // Status filter\n      const matchesStatus =\n        statusFilter === 'all' || project.status === statusFilter;\n\n      // Type filter\n      const matchesType =\n        typeFilter === 'all' || project.project_type === typeFilter;\n\n      return matchesSearch && matchesStatus && matchesType;\n    });\n  }, [projects, searchQuery, statusFilter, typeFilter]);\n\n  // Get unique project types for filter dropdown\n  const projectTypes = useMemo(() => {\n    const types = new Set(projects.map((p) => p.project_type).filter(Boolean));\n    return Array.from(types).sort();\n  }, [projects]);\n\n  const clearFilters = () => {\n    setSearchQuery('');\n    setStatusFilter('all');\n    setTypeFilter('all');\n  };\n\n  const hasActiveFilters = searchQuery || statusFilter !== 'all' || typeFilter !== 'all';\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading projects...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Projects</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your knitting projects</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          New Project\n        </button>\n      </div>\n\n      {/* Search and Filter Bar */}\n      {projects.length > 0 && (\n        <div className=\"bg-white rounded-lg shadow p-4 mb-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            {/* Search Input */}\n            <div className=\"flex-1 relative\">\n              <FiSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search projects...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              />\n            </div>\n\n            {/* Status Filter */}\n            <select\n              value={statusFilter}\n              onChange={(e) => setStatusFilter(e.target.value)}\n              className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            >\n              <option value=\"all\">All Statuses</option>\n              <option value=\"active\">Active</option>\n              <option value=\"paused\">Paused</option>\n              <option value=\"completed\">Completed</option>\n              <option value=\"archived\">Archived</option>\n            </select>\n\n            {/* Type Filter */}\n            <select\n              value={typeFilter}\n              onChange={(e) => setTypeFilter(e.target.value)}\n              className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            >\n              <option value=\"all\">All Types</option>\n              {projectTypes.map((type) => (\n                <option key={type} value={type}>\n                  {type.charAt(0).toUpperCase() + type.slice(1)}\n                </option>\n              ))}\n            </select>\n\n            {/* Clear Filters */}\n            {hasActiveFilters && (\n              <button\n                onClick={clearFilters}\n                className=\"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 transition\"\n              >\n                <FiX className=\"mr-2\" />\n                Clear\n              </button>\n            )}\n          </div>\n\n          {/* Results count */}\n          {hasActiveFilters && (\n            <div className=\"mt-3 text-sm text-gray-600\">\n              Showing {filteredProjects.length} of {projects.length} projects\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Projects Grid */}\n      {projects.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiClock className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No projects yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking your knitting projects</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Create Your First Project\n          </button>\n        </div>\n      ) : filteredProjects.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiSearch className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No matching projects</h3>\n          <p className=\"text-gray-500 mb-4\">Try adjusting your search or filters</p>\n          <button\n            onClick={clearFilters}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiX className=\"mr-2\" />\n            Clear Filters\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {filteredProjects.map((project) => (\n            <div\n              key={project.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <h3 className=\"text-lg font-semibold text-gray-900 flex-1\">\n                  {project.name}\n                </h3>\n                <span\n                  className={`px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(\n                    project.status\n                  )}`}\n                >\n                  {project.status || 'active'}\n                </span>\n              </div>\n\n              {project.description && (\n                <p className=\"text-gray-600 text-sm mb-4 line-clamp-2\">\n                  {project.description}\n                </p>\n              )}\n\n              <div className=\"space-y-2 mb-4\">\n                {project.project_type && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Type:</span> {project.project_type}\n                  </div>\n                )}\n                {project.start_date && (\n                  <div className=\"flex items-center text-sm text-gray-500\">\n                    <FiCalendar className=\"mr-2 h-4 w-4\" />\n                    Started: {formatDate(project.start_date)}\n                  </div>\n                )}\n                {project.target_completion_date && (\n                  <div className=\"flex items-center text-sm text-gray-500\">\n                    <FiClock className=\"mr-2 h-4 w-4\" />\n                    Due: {formatDate(project.target_completion_date)}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                <Link\n                  to={`/projects/${project.id}`}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition text-center text-sm font-medium\"\n                >\n                  View Details\n                </Link>\n                <button\n                  onClick={() => handleDeleteProject(project.id, project.name)}\n                  disabled={deletingId === project.id}\n                  className=\"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                  title=\"Delete project\"\n                >\n                  {deletingId === project.id ? (\n                    <span className=\"h-4 w-4 animate-spin rounded-full border-2 border-red-600 border-t-transparent inline-block\" />\n                  ) : (\n                    <FiTrash2 className=\"h-4 w-4\" />\n                  )}\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Project Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Create New Project</h2>\n            </div>\n\n            <form onSubmit={handleCreateProject} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Project Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Cozy Winter Sweater\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Describe your project...\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Project Type\n                </label>\n                <select\n                  value={formData.projectType}\n                  onChange={(e) => setFormData({ ...formData, projectType: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                >\n                  <option value=\"sweater\">Sweater</option>\n                  <option value=\"scarf\">Scarf</option>\n                  <option value=\"hat\">Hat</option>\n                  <option value=\"blanket\">Blanket</option>\n                  <option value=\"socks\">Socks</option>\n                  <option value=\"shawl\">Shawl</option>\n                  <option value=\"toy\">Toy/Amigurumi</option>\n                  <option value=\"other\">Other</option>\n                </select>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Start Date\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={formData.startDate}\n                    onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Target Completion\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={formData.targetCompletionDate}\n                    onChange={(e) =>\n                      setFormData({ ...formData, targetCompletionDate: e.target.value })\n                    }\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  disabled={isSubmitting}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={isSubmitting}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {isSubmitting ? 'Creating...' : 'Create Project'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { FiX, FiChevronLeft, FiChevronRight, FiTrash2, FiDownload, FiZoomIn, FiZoomOut } from 'react-icons/fi';\n\ninterface Photo {\n  id: string;\n  filename: string;\n  thumbnail_path: string;\n  file_path: string;\n  caption?: string;\n  created_at: string;\n}\n\ninterface PhotoGalleryProps {\n  photos: Photo[];\n  onDelete?: (photoId: string) => void;\n}\n\nexport default function PhotoGallery({ photos, onDelete }: PhotoGalleryProps) {\n  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);\n  const [zoom, setZoom] = useState(1);\n\n  const openLightbox = (index: number) => {\n    setSelectedIndex(index);\n    setZoom(1);\n  };\n\n  const closeLightbox = () => {\n    setSelectedIndex(null);\n    setZoom(1);\n  };\n\n  const goToPrevious = () => {\n    if (selectedIndex !== null && selectedIndex > 0) {\n      setSelectedIndex(selectedIndex - 1);\n      setZoom(1);\n    }\n  };\n\n  const goToNext = () => {\n    if (selectedIndex !== null && selectedIndex < photos.length - 1) {\n      setSelectedIndex(selectedIndex + 1);\n      setZoom(1);\n    }\n  };\n\n  const handleDownload = (photo: Photo) => {\n    const link = document.createElement('a');\n    link.href = photo.file_path;\n    link.download = photo.filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const handleZoomIn = () => {\n    setZoom(prev => Math.min(prev + 0.25, 3));\n  };\n\n  const handleZoomOut = () => {\n    setZoom(prev => Math.max(prev - 0.25, 0.5));\n  };\n\n  // Keyboard navigation\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (selectedIndex === null) return;\n\n    switch (e.key) {\n      case 'Escape':\n        closeLightbox();\n        break;\n      case 'ArrowLeft':\n        goToPrevious();\n        break;\n      case 'ArrowRight':\n        goToNext();\n        break;\n      case '+':\n      case '=':\n        handleZoomIn();\n        break;\n      case '-':\n      case '_':\n        handleZoomOut();\n        break;\n    }\n  };\n\n  if (photos.length === 0) {\n    return (\n      <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n        <p className=\"text-gray-500\">No photos yet. Upload your first photo!</p>\n      </div>\n    );\n  }\n\n  const selectedPhoto = selectedIndex !== null ? photos[selectedIndex] : null;\n\n  return (\n    <>\n      {/* Photo Grid */}\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n        {photos.map((photo, index) => (\n          <div\n            key={photo.id}\n            className=\"relative group cursor-pointer aspect-square overflow-hidden rounded-lg bg-gray-100\"\n            onClick={() => openLightbox(index)}\n          >\n            <img\n              src={photo.thumbnail_path}\n              alt={photo.caption || `Photo ${index + 1}`}\n              className=\"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110\"\n            />\n\n            {/* Hover Overlay */}\n            <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center\">\n              <FiZoomIn className=\"text-white opacity-0 group-hover:opacity-100 transition-opacity h-8 w-8\" />\n            </div>\n\n            {/* Delete Button */}\n            {onDelete && (\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  if (confirm('Are you sure you want to delete this photo?')) {\n                    onDelete(photo.id);\n                  }\n                }}\n                className=\"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700\"\n              >\n                <FiTrash2 className=\"h-4 w-4\" />\n              </button>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Lightbox Modal */}\n      {selectedPhoto && (\n        <div\n          className=\"fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center\"\n          onClick={closeLightbox}\n          onKeyDown={handleKeyDown}\n          tabIndex={0}\n        >\n          {/* Close Button */}\n          <button\n            onClick={closeLightbox}\n            className=\"absolute top-4 right-4 p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10\"\n            aria-label=\"Close\"\n          >\n            <FiX className=\"h-8 w-8\" />\n          </button>\n\n          {/* Previous Button */}\n          {selectedIndex! > 0 && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                goToPrevious();\n              }}\n              className=\"absolute left-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10\"\n              aria-label=\"Previous\"\n            >\n              <FiChevronLeft className=\"h-8 w-8\" />\n            </button>\n          )}\n\n          {/* Next Button */}\n          {selectedIndex! < photos.length - 1 && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                goToNext();\n              }}\n              className=\"absolute right-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10\"\n              aria-label=\"Next\"\n            >\n              <FiChevronRight className=\"h-8 w-8\" />\n            </button>\n          )}\n\n          {/* Image Container */}\n          <div\n            className=\"relative max-w-7xl max-h-full p-4 flex items-center justify-center\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <img\n              src={selectedPhoto.file_path}\n              alt={selectedPhoto.caption || 'Photo'}\n              className=\"max-w-full max-h-[80vh] object-contain rounded-lg\"\n              style={{ transform: `scale(${zoom})`, transition: 'transform 0.2s' }}\n            />\n          </div>\n\n          {/* Controls */}\n          <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-4 bg-black bg-opacity-75 px-6 py-3 rounded-full z-10\">\n            {/* Zoom Out */}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleZoomOut();\n              }}\n              disabled={zoom <= 0.5}\n              className=\"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              aria-label=\"Zoom out\"\n            >\n              <FiZoomOut className=\"h-5 w-5\" />\n            </button>\n\n            {/* Zoom Indicator */}\n            <span className=\"text-white text-sm font-medium min-w-[60px] text-center\">\n              {Math.round(zoom * 100)}%\n            </span>\n\n            {/* Zoom In */}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleZoomIn();\n              }}\n              disabled={zoom >= 3}\n              className=\"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              aria-label=\"Zoom in\"\n            >\n              <FiZoomIn className=\"h-5 w-5\" />\n            </button>\n\n            {/* Download */}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleDownload(selectedPhoto);\n              }}\n              className=\"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition\"\n              aria-label=\"Download\"\n            >\n              <FiDownload className=\"h-5 w-5\" />\n            </button>\n\n            {/* Counter */}\n            <span className=\"text-white text-sm\">\n              {selectedIndex! + 1} / {photos.length}\n            </span>\n          </div>\n\n          {/* Caption */}\n          {selectedPhoto.caption && (\n            <div className=\"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 px-6 py-2 rounded-full max-w-2xl\">\n              <p className=\"text-white text-sm text-center\">{selectedPhoto.caption}</p>\n            </div>\n          )}\n        </div>\n      )}\n    </>\n  );\n}\n","import { useState, useRef } from 'react';\nimport { FiUpload, FiX } from 'react-icons/fi';\nimport { toast } from 'react-toastify';\n\ninterface FileUploadProps {\n  onUpload: (file: File) => Promise<void>;\n  accept?: string;\n  maxSize?: number; // in MB\n}\n\nexport default function FileUpload({\n  onUpload,\n  accept = 'image/jpeg,image/jpg,image/png,image/webp',\n  maxSize = 10,\n}: FileUploadProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = (file: File) => {\n    // Validate file type\n    if (!accept.split(',').some(type => file.type.match(type.trim()))) {\n      toast.error(`Invalid file type. Accepted types: ${accept}`);\n      return;\n    }\n\n    // Validate file size\n    const fileSizeMB = file.size / (1024 * 1024);\n    if (fileSizeMB > maxSize) {\n      toast.error(`File size exceeds ${maxSize}MB limit`);\n      return;\n    }\n\n    setSelectedFile(file);\n\n    // Generate preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreview(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true);\n    } else if (e.type === 'dragleave') {\n      setDragActive(false);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    try {\n      await onUpload(selectedFile);\n      toast.success('File uploaded successfully!');\n      // Reset after successful upload\n      setSelectedFile(null);\n      setPreview(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } catch (error: any) {\n      console.error('Upload error:', error);\n      toast.error(error.response?.data?.message || error.message || 'Failed to upload file. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setSelectedFile(null);\n    setPreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Drop Zone */}\n      <div\n        onDragEnter={handleDrag}\n        onDragLeave={handleDrag}\n        onDragOver={handleDrag}\n        onDrop={handleDrop}\n        className={`relative border-2 border-dashed rounded-lg p-6 transition-colors ${\n          dragActive\n            ? 'border-purple-500 bg-purple-50'\n            : 'border-gray-300 hover:border-gray-400'\n        }`}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept={accept}\n          onChange={handleInputChange}\n          className=\"hidden\"\n        />\n\n        {!preview ? (\n          <div className=\"text-center\">\n            <FiUpload className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <div className=\"space-y-2\">\n              <button\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n                className=\"text-purple-600 hover:text-purple-700 font-medium\"\n              >\n                Click to upload\n              </button>\n              <span className=\"text-gray-600\"> or drag and drop</span>\n            </div>\n            <p className=\"text-sm text-gray-500 mt-2\">\n              PNG, JPG, or WebP up to {maxSize}MB\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {/* Preview */}\n            <div className=\"relative\">\n              <img\n                src={preview}\n                alt=\"Preview\"\n                className=\"max-w-full max-h-64 mx-auto rounded-lg object-contain\"\n              />\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                className=\"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition\"\n              >\n                <FiX className=\"h-4 w-4\" />\n              </button>\n            </div>\n\n            {/* File Info */}\n            <div className=\"text-sm text-gray-600\">\n              <p className=\"font-medium\">{selectedFile?.name}</p>\n              <p className=\"text-xs text-gray-500\">\n                {((selectedFile?.size || 0) / 1024 / 1024).toFixed(2)} MB\n              </p>\n            </div>\n\n            {/* Upload Button */}\n            <div className=\"flex space-x-2\">\n              <button\n                type=\"button\"\n                onClick={handleUpload}\n                disabled={uploading}\n                className=\"flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {uploading ? 'Uploading...' : 'Upload Photo'}\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                disabled={uploading}\n                className=\"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { createContext, useContext, useEffect, useState, useCallback, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { useAuthStore } from '../stores/authStore';\n\ninterface WebSocketContextType {\n  socket: Socket | null;\n  isConnected: boolean;\n  joinProject: (projectId: string) => void;\n  leaveProject: (projectId: string) => void;\n  emitCounterUpdate: (counterId: string, projectId: string, currentValue: number) => void;\n  emitCounterIncrement: (counterId: string, projectId: string, currentValue: number) => void;\n  emitCounterDecrement: (counterId: string, projectId: string, currentValue: number) => void;\n  emitCounterReset: (counterId: string, projectId: string) => void;\n  onCounterUpdate: (callback: (data: { counterId: string; projectId: string; currentValue: number }) => void) => void;\n  offCounterUpdate: (callback: (data: { counterId: string; projectId: string; currentValue: number }) => void) => void;\n}\n\nconst WebSocketContext = createContext<WebSocketContextType | undefined>(undefined);\n\nexport const WebSocketProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [socket, setSocket] = useState<Socket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const { accessToken, refreshToken } = useAuthStore();\n  const socketRef = useRef<Socket | null>(null);\n  const isRefreshingRef = useRef(false);\n\n  useEffect(() => {\n    if (!accessToken) {\n      // Disconnect if no token\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n        socketRef.current = null;\n        setSocket(null);\n        setIsConnected(false);\n      }\n      return;\n    }\n\n    // Create Socket.IO connection\n    const socketUrl = import.meta.env.VITE_API_URL || 'http://localhost:5000';\n\n    const newSocket = io(socketUrl, {\n      auth: {\n        token: accessToken,\n      },\n      transports: ['websocket', 'polling'],\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      reconnectionAttempts: 5,\n    });\n\n    newSocket.on('connect', () => {\n      console.log(' Socket.IO connected:', newSocket.id);\n      setIsConnected(true);\n      isRefreshingRef.current = false;\n    });\n\n    newSocket.on('disconnect', (reason) => {\n      console.log(' Socket.IO disconnected:', reason);\n      setIsConnected(false);\n    });\n\n    newSocket.on('connect_error', async (error) => {\n      console.error('Socket.IO connection error:', error);\n      setIsConnected(false);\n\n      // Check if it's an authentication error\n      const errorMessage = error.message.toLowerCase();\n      if (\n        (errorMessage.includes('auth') ||\n          errorMessage.includes('unauthorized') ||\n          errorMessage.includes('jwt') ||\n          errorMessage.includes('token')) &&\n        !isRefreshingRef.current\n      ) {\n        isRefreshingRef.current = true;\n        console.log(' Attempting to refresh token for Socket.IO...');\n\n        try {\n          const newToken = await refreshToken();\n\n          if (newToken) {\n            console.log(' Token refreshed successfully, reconnecting Socket.IO...');\n\n            // Update socket auth token\n            if (newSocket.auth) {\n              (newSocket.auth as any).token = newToken;\n            }\n\n            // Reconnect with new token\n            newSocket.connect();\n          } else {\n            console.error(' Token refresh failed, cannot reconnect Socket.IO');\n          }\n        } catch (refreshError) {\n          console.error(' Error during token refresh:', refreshError);\n        } finally {\n          isRefreshingRef.current = false;\n        }\n      }\n    });\n\n    // Listen for auth error events from server\n    newSocket.on('error', async (error: any) => {\n      console.error('Socket.IO error event:', error);\n\n      // Check if it's an authentication error\n      if (\n        (error.type === 'auth' ||\n          error.message?.includes('auth') ||\n          error.message?.includes('unauthorized') ||\n          error.message?.includes('token')) &&\n        !isRefreshingRef.current\n      ) {\n        isRefreshingRef.current = true;\n        console.log(' Auth error received, attempting to refresh token...');\n\n        try {\n          const newToken = await refreshToken();\n\n          if (newToken) {\n            console.log(' Token refreshed, reconnecting Socket.IO...');\n\n            // Disconnect and reconnect with new token\n            newSocket.disconnect();\n\n            if (newSocket.auth) {\n              (newSocket.auth as any).token = newToken;\n            }\n\n            newSocket.connect();\n          }\n        } catch (refreshError) {\n          console.error(' Error during token refresh:', refreshError);\n        } finally {\n          isRefreshingRef.current = false;\n        }\n      }\n    });\n\n    socketRef.current = newSocket;\n    setSocket(newSocket);\n\n    // Cleanup on unmount\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n        socketRef.current = null;\n      }\n    };\n  }, [accessToken, refreshToken]);\n\n  const joinProject = useCallback((projectId: string) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('join:project', projectId);\n      console.log(`Joined project room: ${projectId}`);\n    }\n  }, []);\n\n  const leaveProject = useCallback((projectId: string) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('leave:project', projectId);\n      console.log(`Left project room: ${projectId}`);\n    }\n  }, []);\n\n  const emitCounterUpdate = useCallback((counterId: string, projectId: string, currentValue: number) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:update', { counterId, projectId, currentValue });\n    }\n  }, []);\n\n  const emitCounterIncrement = useCallback((counterId: string, projectId: string, currentValue: number) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:increment', { counterId, projectId, currentValue });\n    }\n  }, []);\n\n  const emitCounterDecrement = useCallback((counterId: string, projectId: string, currentValue: number) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:decrement', { counterId, projectId, currentValue });\n    }\n  }, []);\n\n  const emitCounterReset = useCallback((counterId: string, projectId: string) => {\n    if (socketRef.current?.connected) {\n      socketRef.current.emit('counter:reset', { counterId, projectId });\n    }\n  }, []);\n\n  const onCounterUpdate = useCallback((callback: (data: any) => void) => {\n    if (socketRef.current) {\n      socketRef.current.on('counter:updated', callback);\n      socketRef.current.on('counter:incremented', callback);\n      socketRef.current.on('counter:decremented', callback);\n    }\n  }, []);\n\n  const offCounterUpdate = useCallback((callback: (data: any) => void) => {\n    if (socketRef.current) {\n      socketRef.current.off('counter:updated', callback);\n      socketRef.current.off('counter:incremented', callback);\n      socketRef.current.off('counter:decremented', callback);\n    }\n  }, []);\n\n  const value: WebSocketContextType = {\n    socket,\n    isConnected,\n    joinProject,\n    leaveProject,\n    emitCounterUpdate,\n    emitCounterIncrement,\n    emitCounterDecrement,\n    emitCounterReset,\n    onCounterUpdate,\n    offCounterUpdate,\n  };\n\n  return <WebSocketContext.Provider value={value}>{children}</WebSocketContext.Provider>;\n};\n\nexport const useWebSocket = (): WebSocketContextType => {\n  const context = useContext(WebSocketContext);\n  if (context === undefined) {\n    throw new Error('useWebSocket must be used within a WebSocketProvider');\n  }\n  return context;\n};\n","/**\n * Debounce utility for preventing rapid repeated function calls\n * Especially useful for touch events to prevent double-taps\n */\n\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number = 300\n): (...args: Parameters<T>) => void {\n  let timeout: ReturnType<typeof setTimeout> | null = null;\n\n  return function executedFunction(...args: Parameters<T>) {\n    const later = () => {\n      timeout = null;\n      func(...args);\n    };\n\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    timeout = setTimeout(later, wait);\n  };\n}\n\n/**\n * Throttle utility - ensures function is called at most once per interval\n * Better for continuous events like scrolling\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  limit: number = 300\n): (...args: Parameters<T>) => void {\n  let inThrottle: boolean = false;\n\n  return function executedFunction(...args: Parameters<T>) {\n    if (!inThrottle) {\n      func(...args);\n      inThrottle = true;\n      setTimeout(() => {\n        inThrottle = false;\n      }, limit);\n    }\n  };\n}\n\n/**\n * Hook-friendly debounce for React components\n * Prevents double-tap issues on touch devices\n */\nexport function useDebounce<T extends (...args: any[]) => any>(\n  callback: T,\n  delay: number = 300\n) {\n  let timeoutRef: ReturnType<typeof setTimeout> | null = null;\n\n  return (...args: Parameters<T>) => {\n    if (timeoutRef) {\n      clearTimeout(timeoutRef);\n    }\n\n    timeoutRef = setTimeout(() => {\n      callback(...args);\n    }, delay);\n  };\n}\n\n/**\n * Simple click/tap debouncing for preventing double-taps\n * Usage: const handleClick = preventDoubleTap(() => { your logic here });\n */\nexport function preventDoubleTap<T extends (...args: any[]) => any>(\n  func: T,\n  delay: number = 500\n): (...args: Parameters<T>) => void {\n  let lastCall = 0;\n\n  return function executedFunction(...args: Parameters<T>) {\n    const now = Date.now();\n\n    if (now - lastCall >= delay) {\n      lastCall = now;\n      func(...args);\n    }\n  };\n}\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { FiPlus, FiMinus, FiRefreshCw, FiMic, FiMicOff, FiMoreVertical, FiEye, FiEyeOff } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { useWebSocket } from '../../contexts/WebSocketContext';\nimport { preventDoubleTap } from '../../utils/debounce';\nimport type { Counter } from '../../types/counter.types';\n\ninterface CounterCardProps {\n  counter: Counter;\n  onUpdate: () => void;\n  onEdit?: (counter: Counter) => void;\n  onDelete?: (counterId: string) => void;\n  onToggleVisibility?: (counterId: string) => void;\n}\n\nexport default function CounterCard({ counter, onUpdate: _onUpdate, onEdit, onDelete, onToggleVisibility }: CounterCardProps) {\n  const [count, setCount] = useState(counter.current_value);\n  const [isListening, setIsListening] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const recognitionRef = useRef<any>(null);\n  const menuRef = useRef<HTMLDivElement>(null);\n  const cardRef = useRef<HTMLDivElement>(null);\n\n  // Refs to store latest handler functions to avoid stale closures in voice recognition\n  const handleIncrementRef = useRef<() => void>(() => {});\n  const handleDecrementRef = useRef<() => void>(() => {});\n\n  // Swipe gesture state\n  const [touchStart, setTouchStart] = useState<number | null>(null);\n  const [touchEnd, setTouchEnd] = useState<number | null>(null);\n\n  const { isConnected, emitCounterIncrement, emitCounterDecrement, emitCounterReset, onCounterUpdate, offCounterUpdate } = useWebSocket();\n\n  useEffect(() => {\n    setCount(counter.current_value);\n  }, [counter.current_value]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setShowMenu(false);\n      }\n    };\n\n    if (showMenu) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [showMenu]);\n\n  // Listen for real-time updates\n  useEffect(() => {\n    const handleCounterUpdate = (data: { counterId: string; projectId: string; currentValue: number }) => {\n      if (data.counterId === counter.id) {\n        setCount(data.currentValue);\n        triggerHaptic('light');\n        toast.info(`${counter.name} updated to ${data.currentValue}`, { autoClose: 1000 });\n      }\n    };\n\n    onCounterUpdate(handleCounterUpdate);\n    return () => offCounterUpdate(handleCounterUpdate);\n  }, [counter.id, counter.name, onCounterUpdate, offCounterUpdate]);\n\n  // Haptic feedback\n  const triggerHaptic = (intensity: 'light' | 'medium' | 'heavy') => {\n    if ('vibrate' in navigator) {\n      const patterns = {\n        light: [10],\n        medium: [20],\n        heavy: [30, 10, 30]\n      };\n      navigator.vibrate(patterns[intensity]);\n    }\n  };\n\n  const updateCountOnServer = async (newValue: number) => {\n    try {\n      await axios.put(`/api/projects/${counter.project_id}/counters/${counter.id}`, {\n        current_value: newValue,\n      });\n      // Don't call onUpdate() here to prevent unnecessary re-renders and screen blink\n      // Counter updates are handled by:\n      // 1. Optimistic local state update (setCount)\n      // 2. WebSocket real-time sync for multi-device updates\n    } catch (error) {\n      console.error('Error updating counter:', error);\n      toast.error('Failed to update counter');\n      setCount(counter.current_value);\n    }\n  };\n\n  const calculateIncrement = (): number => {\n    if (!counter.increment_pattern) {\n      return counter.increment_by;\n    }\n\n    const pattern = counter.increment_pattern;\n\n    switch (pattern.type) {\n      case 'simple':\n        return counter.increment_by;\n\n      case 'custom_fixed':\n        return pattern.increment || counter.increment_by;\n\n      case 'every_n':\n        // Increment only every N clicks\n        // This would need click tracking - simplified for now\n        return pattern.increment || 1;\n\n      default:\n        return counter.increment_by;\n    }\n  };\n\n  const handleIncrementInternal = () => {\n    const increment = calculateIncrement();\n\n    // Use functional setState to avoid stale closure issues with rapid voice commands\n    setCount(prevCount => {\n      const newCount = prevCount + increment;\n\n      console.log(`[Counter ${counter.name}] Increment: ${prevCount} -> ${newCount} (+${increment})`);\n\n      // Check max_value constraint\n      if (counter.max_value && newCount > counter.max_value) {\n        console.warn(`[Counter ${counter.name}] Cannot exceed max value ${counter.max_value}`);\n        toast.warning(`Cannot exceed maximum value of ${counter.max_value}`);\n        return prevCount; // Don't update if exceeds max\n      }\n\n      // Update server and emit WebSocket event with new value\n      updateCountOnServer(newCount);\n      emitCounterIncrement(counter.id, counter.project_id, newCount);\n\n      return newCount;\n    });\n\n    playFeedbackSound('increment');\n    triggerHaptic('light');\n  };\n\n  const handleDecrementInternal = () => {\n    const increment = calculateIncrement();\n\n    // Use functional setState to avoid stale closure issues\n    setCount(prevCount => {\n      const newCount = prevCount - increment;\n\n      console.log(`[Counter ${counter.name}] Decrement: ${prevCount} -> ${newCount} (-${increment})`);\n\n      // Check min_value constraint\n      if (newCount < counter.min_value) {\n        console.warn(`[Counter ${counter.name}] Cannot go below min value ${counter.min_value}`);\n        toast.warning(`Cannot go below minimum value of ${counter.min_value}`);\n        return prevCount; // Don't update if below min\n      }\n\n      // Update server and emit WebSocket event with new value\n      updateCountOnServer(newCount);\n      emitCounterDecrement(counter.id, counter.project_id, newCount);\n\n      return newCount;\n    });\n\n    playFeedbackSound('decrement');\n    triggerHaptic('light');\n  };\n\n  // Debounced versions to prevent double-taps (button clicks only)\n  const handleIncrement = useCallback(preventDoubleTap(handleIncrementInternal, 500), [count, counter]);\n  const handleDecrement = useCallback(preventDoubleTap(handleDecrementInternal, 500), [count, counter]);\n\n  // Update refs with latest handlers on every render to avoid stale closures\n  handleIncrementRef.current = handleIncrementInternal;\n  handleDecrementRef.current = handleDecrementInternal;\n\n  // Voice command handlers - NO debouncing for responsive voice control\n  const handleVoiceIncrement = () => {\n    console.log('[Voice] Increment command received');\n    handleIncrementRef.current(); // Use ref to always call the latest version\n    toast.success('Row added! ', { autoClose: 800 });\n  };\n\n  const handleVoiceDecrement = () => {\n    console.log('[Voice] Decrement command received');\n    handleDecrementRef.current(); // Use ref to always call the latest version\n    toast.info('Row removed! ', { autoClose: 800 });\n  };\n\n  const handleResetInternal = async () => {\n    if (confirm(`Reset \"${counter.name}\" to ${counter.min_value}?`)) {\n      const resetValue = counter.min_value;\n      setCount(resetValue);\n      updateCountOnServer(resetValue);\n      emitCounterReset(counter.id, counter.project_id);\n      triggerHaptic('medium');\n      toast.success('Counter reset');\n    }\n  };\n\n  // Debounced reset to prevent accidental double-taps\n  const handleReset = useCallback(preventDoubleTap(handleResetInternal, 500), [count, counter]);\n\n  // Swipe gesture handlers\n  const handleTouchStart = (e: React.TouchEvent) => {\n    setTouchEnd(null);\n    setTouchStart(e.targetTouches[0].clientX);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    setTouchEnd(e.targetTouches[0].clientX);\n  };\n\n  const handleTouchEnd = () => {\n    if (!touchStart || !touchEnd) return;\n\n    const distance = touchStart - touchEnd;\n    const isLeftSwipe = distance > 50;\n    const isRightSwipe = distance < -50;\n\n    if (isLeftSwipe) {\n      // Swipe left = increment\n      handleIncrement();\n    }\n\n    if (isRightSwipe) {\n      // Swipe right = decrement\n      handleDecrement();\n    }\n  };\n\n  const playFeedbackSound = (type: 'increment' | 'decrement') => {\n    try {\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n      const oscillator = audioContext.createOscillator();\n      const gainNode = audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n\n      oscillator.frequency.value = type === 'increment' ? 800 : 600;\n      oscillator.type = 'sine';\n\n      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\n\n      oscillator.start(audioContext.currentTime);\n      oscillator.stop(audioContext.currentTime + 0.1);\n    } catch (error) {\n      console.error('Audio feedback error:', error);\n    }\n  };\n\n  // Voice control with improved responsiveness\n  useEffect(() => {\n    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n      const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n      recognitionRef.current = new SpeechRecognition();\n\n      // Optimized settings for knitting counter voice control\n      recognitionRef.current.continuous = true;\n      recognitionRef.current.interimResults = false;\n      recognitionRef.current.lang = 'en-US';\n      recognitionRef.current.maxAlternatives = 1; // Faster processing with single best result\n\n      recognitionRef.current.onresult = (event: any) => {\n        const last = event.results.length - 1;\n        const command = event.results[last][0].transcript.toLowerCase().trim();\n        const confidence = event.results[last][0].confidence;\n\n        console.log(`[Voice] Recognized: \"${command}\" (confidence: ${(confidence * 100).toFixed(0)}%)`);\n\n        // Process voice commands immediately without debouncing\n        if (command.includes('next') || command.includes('plus') || command.includes('add')) {\n          handleVoiceIncrement();\n        } else if (command.includes('back') || command.includes('minus') || command.includes('undo')) {\n          handleVoiceDecrement();\n        } else if (command.includes('reset')) {\n          console.log('[Voice] Reset command received');\n          handleReset();\n        } else {\n          console.log(`[Voice] Unrecognized command: \"${command}\"`);\n        }\n      };\n\n      recognitionRef.current.onerror = (event: any) => {\n        console.error('[Voice] Recognition error:', event.error);\n\n        // Only show error toast for actual errors, not normal events\n        if (event.error !== 'no-speech' && event.error !== 'aborted') {\n          toast.error(`Voice error: ${event.error}`, { autoClose: 2000 });\n\n          // Stop listening on serious errors\n          if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {\n            setIsListening(false);\n          }\n        }\n      };\n\n      recognitionRef.current.onstart = () => {\n        console.log('[Voice] Recognition started');\n      };\n\n      recognitionRef.current.onend = () => {\n        console.log('[Voice] Recognition ended, isListening:', isListening);\n\n        // Auto-restart if still supposed to be listening\n        if (isListening) {\n          try {\n            // Small delay before restart to prevent rapid cycling\n            setTimeout(() => {\n              if (isListening && recognitionRef.current) {\n                recognitionRef.current.start();\n                console.log('[Voice] Recognition restarted');\n              }\n            }, 100);\n          } catch (e) {\n            console.error('[Voice] Error restarting recognition:', e);\n            setIsListening(false);\n          }\n        }\n      };\n    }\n\n    return () => {\n      if (recognitionRef.current && isListening) {\n        try {\n          recognitionRef.current.stop();\n          console.log('[Voice] Recognition stopped (cleanup)');\n        } catch (e) {\n          console.error('[Voice] Error stopping recognition:', e);\n        }\n      }\n    };\n  }, [isListening]);\n\n  const toggleVoiceControl = () => {\n    if (!recognitionRef.current) {\n      toast.error('Voice control not supported in this browser');\n      return;\n    }\n\n    if (isListening) {\n      recognitionRef.current.stop();\n      setIsListening(false);\n      toast.info('Voice control stopped');\n    } else {\n      try {\n        recognitionRef.current.start();\n        setIsListening(true);\n        toast.success('Voice control activated!');\n      } catch (e) {\n        toast.error('Failed to start voice control');\n      }\n    }\n  };\n\n  const progress = counter.target_value ? (count / counter.target_value) * 100 : 0;\n  const increment = calculateIncrement();\n\n  return (\n    <div\n      ref={cardRef}\n      className=\"border-2 rounded-xl p-4 md:p-6 bg-gradient-to-br from-white to-gray-50 shadow-sm hover:shadow-md transition-shadow select-none\"\n      style={{ borderColor: counter.display_color }}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <div\n            className=\"w-3 h-3 rounded-full flex-shrink-0\"\n            style={{ backgroundColor: counter.display_color }}\n          />\n          <h3 className=\"font-semibold text-lg md:text-base text-gray-900\">{counter.name}</h3>\n          <span className=\"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded-full whitespace-nowrap\">\n            {counter.type}\n          </span>\n        </div>\n\n        <div className=\"flex items-center gap-1 flex-shrink-0\">\n          <button\n            onClick={toggleVoiceControl}\n            className={`p-3 md:p-2 rounded-lg transition min-w-[48px] min-h-[48px] md:min-w-0 md:min-h-0 flex items-center justify-center ${\n              isListening\n                ? 'bg-red-100 text-red-600 hover:bg-red-200 animate-pulse'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n            title={isListening ? 'Stop voice control' : 'Start voice control'}\n            aria-label={isListening ? 'Stop voice control' : 'Start voice control'}\n            aria-pressed={isListening}\n          >\n            {isListening ? <FiMic className=\"h-5 w-5 md:h-4 md:w-4\" aria-hidden=\"true\" /> : <FiMicOff className=\"h-5 w-5 md:h-4 md:w-4\" aria-hidden=\"true\" />}\n          </button>\n\n          <div className=\"relative\" ref={menuRef}>\n            <button\n              onClick={() => setShowMenu(!showMenu)}\n              className=\"p-3 md:p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition min-w-[48px] min-h-[48px] md:min-w-0 md:min-h-0 flex items-center justify-center\"\n            >\n              <FiMoreVertical className=\"h-5 w-5 md:h-4 md:w-4\" />\n            </button>\n\n            {showMenu && (\n              <div className=\"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10\">\n                {onEdit && (\n                  <button\n                    onClick={() => {\n                      onEdit(counter);\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\n                  >\n                    Edit Counter\n                  </button>\n                )}\n                {onToggleVisibility && (\n                  <button\n                    onClick={() => {\n                      onToggleVisibility(counter.id);\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full text-left px-4 py-2 hover:bg-gray-100 text-sm flex items-center gap-2\"\n                  >\n                    {counter.is_visible ? <FiEyeOff className=\"h-4 w-4\" /> : <FiEye className=\"h-4 w-4\" />}\n                    {counter.is_visible ? 'Hide' : 'Show'}\n                  </button>\n                )}\n                {onDelete && (\n                  <button\n                    onClick={() => {\n                      if (confirm(`Delete \"${counter.name}\"?`)) {\n                        onDelete(counter.id);\n                      }\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full text-left px-4 py-2 hover:bg-red-50 text-red-600 text-sm border-t border-gray-100\"\n                  >\n                    Delete Counter\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Counter Display */}\n      <div className=\"text-center mb-6\">\n        <div\n          className=\"text-6xl md:text-7xl font-bold mb-2 tabular-nums\"\n          style={{ color: counter.display_color }}\n          role=\"status\"\n          aria-live=\"polite\"\n          aria-label={`Current count: ${count}`}\n        >\n          {count}\n        </div>\n        {counter.target_value && (\n          <p className=\"text-base md:text-sm text-gray-500\" aria-label={`Target: ${counter.target_value}`}>\n            of {counter.target_value}\n          </p>\n        )}\n        {counter.increment_pattern && counter.increment_pattern.description && (\n          <p className=\"text-sm md:text-xs text-gray-400 mt-1\">{counter.increment_pattern.description}</p>\n        )}\n      </div>\n\n      {/* Progress Bar */}\n      {counter.target_value && (\n        <div className=\"mb-6\">\n          <div className=\"w-full bg-gray-200 rounded-full h-4 overflow-hidden\">\n            <div\n              className=\"h-full rounded-full transition-all duration-300 ease-out\"\n              style={{\n                width: `${Math.min(progress, 100)}%`,\n                backgroundColor: counter.display_color\n              }}\n            />\n          </div>\n          <p className=\"text-xs text-gray-500 text-center mt-1\">\n            {Math.round(progress)}% complete\n          </p>\n        </div>\n      )}\n\n      {/* Controls - Large Touch Targets (80px mobile, 64px desktop) */}\n      <div className=\"flex items-center gap-2 md:gap-3\" role=\"group\" aria-label=\"Counter controls\">\n        <button\n          onClick={handleDecrement}\n          disabled={count <= counter.min_value}\n          className=\"flex-1 h-20 md:h-16 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 disabled:bg-gray-50 disabled:text-gray-300 text-gray-700 rounded-xl font-semibold transition flex items-center justify-center gap-2 text-xl md:text-lg touch-manipulation\"\n          aria-label={`Decrease ${counter.name} by ${increment}`}\n          aria-disabled={count <= counter.min_value}\n        >\n          <FiMinus className=\"h-7 w-7 md:h-6 md:w-6\" aria-hidden=\"true\" />\n          <span className=\"hidden sm:inline\">-{increment}</span>\n        </button>\n\n        <button\n          onClick={handleReset}\n          className=\"h-20 md:h-16 w-20 md:w-16 flex-shrink-0 bg-yellow-100 hover:bg-yellow-200 active:bg-yellow-300 text-yellow-700 rounded-xl transition flex items-center justify-center touch-manipulation\"\n          title=\"Reset counter\"\n          aria-label={`Reset ${counter.name} to ${counter.min_value}`}\n        >\n          <FiRefreshCw className=\"h-7 w-7 md:h-6 md:w-6\" aria-hidden=\"true\" />\n        </button>\n\n        <button\n          onClick={handleIncrement}\n          className=\"flex-1 h-20 md:h-16 text-white rounded-xl font-semibold transition flex items-center justify-center gap-2 text-xl md:text-lg touch-manipulation\"\n          style={{\n            backgroundColor: counter.display_color\n          }}\n          aria-label={`Increase ${counter.name} by ${increment}`}\n        >\n          <FiPlus className=\"h-7 w-7 md:h-6 md:w-6\" aria-hidden=\"true\" />\n          <span className=\"hidden sm:inline\">+{increment}</span>\n        </button>\n      </div>\n\n      {/* Notes */}\n      {counter.notes && (\n        <div className=\"mt-4 p-3 bg-blue-50 rounded-lg\">\n          <p className=\"text-sm text-gray-700\">{counter.notes}</p>\n        </div>\n      )}\n\n      {/* Real-time indicator */}\n      {isConnected && (\n        <div className=\"mt-3 flex items-center justify-center gap-2 text-xs text-green-600\">\n          <span className=\"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse\"></span>\n          Live sync\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { FiX } from 'react-icons/fi';\nimport type { Counter, IncrementPattern } from '../../types/counter.types';\n\ninterface CounterFormProps {\n  projectId: string;\n  counter?: Counter | null;\n  onSave: (data: Partial<Counter>) => void;\n  onCancel: () => void;\n}\n\nconst COUNTER_COLORS = [\n  '#3B82F6', // Blue\n  '#8B5CF6', // Purple\n  '#10B981', // Green\n  '#F59E0B', // Amber\n  '#EF4444', // Red\n  '#EC4899', // Pink\n  '#6366F1', // Indigo\n  '#14B8A6', // Teal\n];\n\nconst INCREMENT_PATTERNS: { value: string; label: string; description: string }[] = [\n  { value: 'simple', label: 'Simple (+1 each)', description: 'Standard counting, +1 per row' },\n  { value: 'every_n_garter', label: 'Garter Stitch Ridges', description: '+1 every 2 rows (ridge counting)' },\n  { value: 'every_n_cable', label: 'Cable Repeats', description: '+1 every 4 rows (cable pattern)' },\n  { value: 'custom', label: 'Custom Pattern', description: 'Define your own increment pattern' },\n];\n\nexport default function CounterForm({ counter, onSave, onCancel }: CounterFormProps) {\n  const [name, setName] = useState(counter?.name || '');\n  const [type, setType] = useState(counter?.type || 'rows');\n  const [currentValue, setCurrentValue] = useState(counter?.current_value || 0);\n  const [targetValue, setTargetValue] = useState(counter?.target_value || '');\n  const [incrementBy] = useState(counter?.increment_by || 1);\n  const [minValue, setMinValue] = useState(counter?.min_value || 0);\n  const [maxValue, setMaxValue] = useState(counter?.max_value || '');\n  const [displayColor, setDisplayColor] = useState(counter?.display_color || COUNTER_COLORS[0]);\n  const [notes, setNotes] = useState(counter?.notes || '');\n  const [incrementPattern, setIncrementPattern] = useState<string>(counter?.increment_pattern?.type || 'simple');\n  const [customIncrement, setCustomIncrement] = useState(counter?.increment_pattern?.increment || 1);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    let pattern: IncrementPattern | undefined;\n\n    if (incrementPattern === 'simple') {\n      pattern = { type: 'simple' };\n    } else if (incrementPattern === 'every_n_garter') {\n      pattern = {\n        type: 'every_n',\n        rule: 'every_n_rows',\n        n: 2,\n        increment: 1,\n        description: 'Garter stitch ridge counting'\n      };\n    } else if (incrementPattern === 'every_n_cable') {\n      pattern = {\n        type: 'every_n',\n        rule: 'every_n_rows',\n        n: 4,\n        increment: 1,\n        description: 'Cable pattern repeat'\n      };\n    } else if (incrementPattern === 'custom') {\n      pattern = {\n        type: 'custom_fixed',\n        increment: customIncrement,\n        description: `Custom: +${customIncrement} per action`\n      };\n    }\n\n    // Backend expects camelCase field names\n    const data: any = {\n      name,\n      type: type as any,\n      currentValue: currentValue,\n      targetValue: targetValue ? Number(targetValue) : undefined,\n      incrementBy: incrementBy,\n      minValue: minValue,\n      maxValue: maxValue ? Number(maxValue) : undefined,\n      displayColor: displayColor,\n      notes,\n      incrementPattern: pattern,\n    };\n\n    onSave(data);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between\">\n          <h2 className=\"text-xl font-bold text-gray-900\">\n            {counter ? 'Edit Counter' : 'Create Counter'}\n          </h2>\n          <button\n            onClick={onCancel}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition\"\n          >\n            <FiX className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n          {/* Basic Info */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Counter Name *\n            </label>\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              placeholder=\"e.g., Main Row Counter\"\n              required\n            />\n          </div>\n\n          {/* Counter Type */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Counter Type\n            </label>\n            <select\n              value={type}\n              onChange={(e) => setType(e.target.value as any)}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n            >\n              <option value=\"rows\">Row Counter</option>\n              <option value=\"stitches\">Stitch Counter</option>\n              <option value=\"repeats\">Repeat Counter</option>\n              <option value=\"custom\">Custom Counter</option>\n            </select>\n          </div>\n\n          {/* Values */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Current Value\n              </label>\n              <input\n                type=\"number\"\n                value={currentValue}\n                onChange={(e) => setCurrentValue(Number(e.target.value))}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Target Value (optional)\n              </label>\n              <input\n                type=\"number\"\n                value={targetValue}\n                onChange={(e) => setTargetValue(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n                placeholder=\"No limit\"\n              />\n            </div>\n          </div>\n\n          {/* Min/Max Values */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Minimum Value\n              </label>\n              <input\n                type=\"number\"\n                value={minValue}\n                onChange={(e) => setMinValue(Number(e.target.value))}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Maximum Value (optional)\n              </label>\n              <input\n                type=\"number\"\n                value={maxValue}\n                onChange={(e) => setMaxValue(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n                placeholder=\"No limit\"\n              />\n            </div>\n          </div>\n\n          {/* Increment Pattern */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Increment Pattern\n            </label>\n            <div className=\"space-y-2\">\n              {INCREMENT_PATTERNS.map((pattern) => (\n                <label\n                  key={pattern.value}\n                  className=\"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\"\n                >\n                  <input\n                    type=\"radio\"\n                    name=\"incrementPattern\"\n                    value={pattern.value}\n                    checked={incrementPattern === pattern.value}\n                    onChange={(e) => setIncrementPattern(e.target.value as any)}\n                    className=\"mt-1\"\n                  />\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{pattern.label}</div>\n                    <div className=\"text-sm text-gray-500\">{pattern.description}</div>\n                  </div>\n                </label>\n              ))}\n            </div>\n\n            {incrementPattern === 'custom' && (\n              <div className=\"mt-3\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Custom Increment Value\n                </label>\n                <input\n                  type=\"number\"\n                  value={customIncrement}\n                  onChange={(e) => setCustomIncrement(Number(e.target.value))}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n                  min=\"1\"\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Color Selection */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Counter Color\n            </label>\n            <div className=\"flex gap-2 flex-wrap\">\n              {COUNTER_COLORS.map((color) => (\n                <button\n                  key={color}\n                  type=\"button\"\n                  onClick={() => setDisplayColor(color)}\n                  className={`w-10 h-10 rounded-lg border-2 transition ${\n                    displayColor === color ? 'border-gray-900 scale-110' : 'border-gray-200'\n                  }`}\n                  style={{ backgroundColor: color }}\n                />\n              ))}\n            </div>\n          </div>\n\n          {/* Notes */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Notes (optional)\n            </label>\n            <textarea\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900\"\n              rows={3}\n              placeholder=\"Add any notes or reminders for this counter...\"\n            />\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-3 pt-4 border-t border-gray-200\">\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              className=\"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition\"\n            >\n              {counter ? 'Update Counter' : 'Create Counter'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiX, FiRotateCcw, FiClock } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport type { Counter, CounterHistory as CounterHistoryType } from '../../types/counter.types';\n\ninterface CounterHistoryProps {\n  counter: Counter;\n  onClose: () => void;\n  onUpdate: () => void;\n}\n\nexport default function CounterHistory({ counter, onClose, onUpdate }: CounterHistoryProps) {\n  const [history, setHistory] = useState<CounterHistoryType[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchHistory();\n  }, [counter.id]);\n\n  const fetchHistory = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(\n        `/api/projects/${counter.project_id}/counters/${counter.id}/history`\n      );\n      setHistory(response.data.data.history);\n    } catch (error) {\n      console.error('Error fetching history:', error);\n      toast.error('Failed to load history');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUndo = async (historyId: string) => {\n    try {\n      await axios.post(\n        `/api/projects/${counter.project_id}/counters/${counter.id}/undo/${historyId}`\n      );\n      toast.success('Counter reverted!');\n      fetchHistory();\n      onUpdate();\n    } catch (error) {\n      console.error('Error undoing action:', error);\n      toast.error('Failed to undo action');\n    }\n  };\n\n  const formatTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    const minutes = Math.floor(diff / 60000);\n    const hours = Math.floor(diff / 3600000);\n    const days = Math.floor(diff / 86400000);\n\n    if (minutes < 1) return 'Just now';\n    if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n    if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n    return `${days} day${days > 1 ? 's' : ''} ago`;\n  };\n\n  const getActionColor = (action: string) => {\n    switch (action) {\n      case 'increment':\n        return 'text-green-600 bg-green-50';\n      case 'decrement':\n        return 'text-yellow-600 bg-yellow-50';\n      case 'reset':\n        return 'text-red-600 bg-red-50';\n      case 'set':\n        return 'text-blue-600 bg-blue-50';\n      default:\n        return 'text-gray-600 bg-gray-50';\n    }\n  };\n\n  const getActionIcon = (action: string) => {\n    switch (action) {\n      case 'increment':\n        return '+';\n      case 'decrement':\n        return '-';\n      case 'reset':\n        return '';\n      case 'set':\n        return '=';\n      default:\n        return '';\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        <div className=\"border-b border-gray-200 px-6 py-4 flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900\">Counter History</h2>\n            <p className=\"text-sm text-gray-500\">{counter.name}</p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition\"\n          >\n            <FiX className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n            </div>\n          ) : history.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <FiClock className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n              <p className=\"text-gray-500\">No history yet</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {history.map((entry) => (\n                <div\n                  key={entry.id}\n                  className=\"border border-gray-200 rounded-lg p-4 hover:shadow-sm transition\"\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <span\n                          className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${getActionColor(\n                            entry.action\n                          )}`}\n                        >\n                          {getActionIcon(entry.action)}\n                        </span>\n                        <div>\n                          <div className=\"font-medium text-gray-900\">\n                            {entry.old_value}  {entry.new_value}\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            {entry.action.charAt(0).toUpperCase() + entry.action.slice(1)}\n                          </div>\n                        </div>\n                      </div>\n\n                      {entry.user_note && (\n                        <div className=\"ml-11 mb-2 text-sm text-gray-600 italic\">\n                          \"{entry.user_note}\"\n                        </div>\n                      )}\n\n                      <div className=\"ml-11 text-xs text-gray-400 flex items-center gap-2\">\n                        <FiClock className=\"h-3 w-3\" />\n                        {formatTime(entry.created_at)} {' '}\n                        {new Date(entry.created_at).toLocaleString()}\n                      </div>\n                    </div>\n\n                    <button\n                      onClick={() => {\n                        if (\n                          confirm(\n                            `Revert counter to ${entry.old_value}? This will create a new history entry.`\n                          )\n                        ) {\n                          handleUndo(entry.id);\n                        }\n                      }}\n                      className=\"ml-3 p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition\"\n                      title=\"Undo to this point\"\n                    >\n                      <FiRotateCcw className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className=\"border-t border-gray-200 px-6 py-4\">\n          <button\n            onClick={onClose}\n            className=\"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition\"\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiX, FiLink, FiTrash2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport type { Counter, CounterLink } from '../../types/counter.types';\n\ninterface LinkCounterModalProps {\n  projectId: string;\n  counters: Counter[];\n  onClose: () => void;\n  onSave: () => void;\n}\n\nexport default function LinkCounterModal({ projectId, counters, onClose/*, onSave */ }: LinkCounterModalProps) {\n  const [links, setLinks] = useState<CounterLink[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // Form state\n  const [sourceCounterId, setSourceCounterId] = useState('');\n  const [targetCounterId, setTargetCounterId] = useState('');\n  const [linkType, setLinkType] = useState<'reset_on_target' | 'advance_together' | 'conditional'>('reset_on_target');\n  const [triggerOperator, setTriggerOperator] = useState<'equals' | 'greater_than' | 'less_than'>('equals');\n  const [triggerValue, setTriggerValue] = useState('');\n  const [actionType, setActionType] = useState<'reset' | 'increment' | 'set'>('reset');\n  const [actionValue, setActionValue] = useState('');\n\n  useEffect(() => {\n    fetchLinks();\n  }, [projectId]);\n\n  const fetchLinks = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/projects/${projectId}/counter-links`);\n      setLinks(response.data.data.links);\n    } catch (error) {\n      console.error('Error fetching links:', error);\n      toast.error('Failed to load counter links');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateLink = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!sourceCounterId || !targetCounterId) {\n      toast.error('Please select both source and target counters');\n      return;\n    }\n\n    if (sourceCounterId === targetCounterId) {\n      toast.error('Cannot link a counter to itself');\n      return;\n    }\n\n    try {\n      // Backend expects camelCase field names\n      const linkData: any = {\n        sourceCounterId: sourceCounterId,\n        targetCounterId: targetCounterId,\n        linkType: linkType,\n        isActive: true,\n      };\n\n      if (linkType === 'reset_on_target' || linkType === 'conditional') {\n        linkData.triggerCondition = {\n          type: triggerOperator,\n          value: Number(triggerValue),\n        };\n\n        linkData.action = {\n          type: actionType,\n          value: actionType === 'reset' || actionType === 'set' ? Number(actionValue) : undefined,\n        };\n      }\n\n      await axios.post(`/api/projects/${projectId}/counter-links`, linkData);\n      toast.success('Counter link created!');\n\n      // Reset form\n      setSourceCounterId('');\n      setTargetCounterId('');\n      setTriggerValue('');\n      setActionValue('');\n\n      fetchLinks();\n    } catch (error: any) {\n      console.error('Error creating link:', error);\n      const message = error.response?.data?.message || 'Failed to create link';\n      toast.error(message);\n    }\n  };\n\n  const handleDeleteLink = async (linkId: string) => {\n    try {\n      await axios.delete(`/api/projects/${projectId}/counter-links/${linkId}`);\n      toast.success('Link deleted!');\n      fetchLinks();\n    } catch (error) {\n      console.error('Error deleting link:', error);\n      toast.error('Failed to delete link');\n    }\n  };\n\n  const getCounterName = (counterId: string) => {\n    return counters.find(c => c.id === counterId)?.name || 'Unknown';\n  };\n\n  const describeLinkType = (link: CounterLink) => {\n    const source = getCounterName(link.source_counter_id);\n    const target = getCounterName(link.target_counter_id);\n\n    switch (link.link_type) {\n      case 'reset_on_target':\n        return `When ${source} ${link.trigger_condition?.type} ${link.trigger_condition?.value}, reset ${target} to ${link.action?.value}`;\n      case 'conditional':\n        return `When ${source} ${link.trigger_condition?.type} ${link.trigger_condition?.value}, ${link.action?.type} ${target}`;\n      case 'advance_together':\n        return `${source} and ${target} advance together`;\n      default:\n        return 'Unknown link type';\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        <div className=\"border-b border-gray-200 px-6 py-4 flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900\">Link Counters</h2>\n            <p className=\"text-sm text-gray-500\">Create automatic counter relationships</p>\n          </div>\n          <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg transition\">\n            <FiX className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {/* Create Link Form */}\n          <form onSubmit={handleCreateLink} className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n            <h3 className=\"font-semibold text-gray-900 mb-4\">Create New Link</h3>\n\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Source Counter\n                  </label>\n                  <select\n                    value={sourceCounterId}\n                    onChange={(e) => setSourceCounterId(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                    required\n                  >\n                    <option value=\"\">Select counter...</option>\n                    {counters.map((counter) => (\n                      <option key={counter.id} value={counter.id}>\n                        {counter.name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Target Counter\n                  </label>\n                  <select\n                    value={targetCounterId}\n                    onChange={(e) => setTargetCounterId(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                    required\n                  >\n                    <option value=\"\">Select counter...</option>\n                    {counters.map((counter) => (\n                      <option key={counter.id} value={counter.id}>\n                        {counter.name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Link Type</label>\n                <select\n                  value={linkType}\n                  onChange={(e) => setLinkType(e.target.value as any)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                >\n                  <option value=\"reset_on_target\">Reset on Target</option>\n                  <option value=\"conditional\">Conditional Action</option>\n                  <option value=\"advance_together\">Advance Together</option>\n                </select>\n              </div>\n\n              {(linkType === 'reset_on_target' || linkType === 'conditional') && (\n                <>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Trigger Condition\n                      </label>\n                      <select\n                        value={triggerOperator}\n                        onChange={(e) => setTriggerOperator(e.target.value as any)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                      >\n                        <option value=\"equals\">Equals (=)</option>\n                        <option value=\"greater_than\">Greater than (&gt;)</option>\n                        <option value=\"less_than\">Less than (&lt;)</option>\n                      </select>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Trigger Value\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={triggerValue}\n                        onChange={(e) => setTriggerValue(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                        placeholder=\"e.g., 8\"\n                        required\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Action Type\n                      </label>\n                      <select\n                        value={actionType}\n                        onChange={(e) => setActionType(e.target.value as any)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                      >\n                        <option value=\"reset\">Reset to value</option>\n                        <option value=\"set\">Set to value</option>\n                        <option value=\"increment\">Increment</option>\n                      </select>\n                    </div>\n\n                    {(actionType === 'reset' || actionType === 'set') && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Action Value\n                        </label>\n                        <input\n                          type=\"number\"\n                          value={actionValue}\n                          onChange={(e) => setActionValue(e.target.value)}\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600\"\n                          placeholder=\"e.g., 1\"\n                          required\n                        />\n                      </div>\n                    )}\n                  </div>\n                </>\n              )}\n\n              <button\n                type=\"submit\"\n                className=\"w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition flex items-center justify-center gap-2\"\n              >\n                <FiLink className=\"h-4 w-4\" />\n                Create Link\n              </button>\n            </div>\n          </form>\n\n          {/* Existing Links */}\n          <div>\n            <h3 className=\"font-semibold text-gray-900 mb-3\">Existing Links</h3>\n\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n              </div>\n            ) : links.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                No links created yet\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {links.map((link) => (\n                  <div\n                    key={link.id}\n                    className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-sm transition\"\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <FiLink className=\"h-4 w-4 text-purple-600\" />\n                        <span className=\"text-sm text-gray-900\">{describeLinkType(link)}</span>\n                      </div>\n                      {!link.is_active && (\n                        <span className=\"text-xs text-yellow-600\">Inactive</span>\n                      )}\n                    </div>\n\n                    <button\n                      onClick={() => {\n                        if (confirm('Delete this link?')) {\n                          handleDeleteLink(link.id);\n                        }\n                      }}\n                      className=\"ml-3 p-2 text-red-600 hover:bg-red-50 rounded-lg transition\"\n                    >\n                      <FiTrash2 className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"border-t border-gray-200 px-6 py-4\">\n          <button\n            onClick={onClose}\n            className=\"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition\"\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiLink, FiClock } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport CounterCard from './CounterCard';\nimport CounterForm from './CounterForm';\nimport CounterHistory from './CounterHistory';\nimport LinkCounterModal from './LinkCounterModal';\nimport type { Counter } from '../../types/counter.types';\n\ninterface CounterManagerProps {\n  projectId: string;\n}\n\nexport default function CounterManager({ projectId }: CounterManagerProps) {\n  const [counters, setCounters] = useState<Counter[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showForm, setShowForm] = useState(false);\n  const [showHistory, setShowHistory] = useState(false);\n  const [showCounterSelector, setShowCounterSelector] = useState(false);\n  const [showLinkModal, setShowLinkModal] = useState(false);\n  const [editingCounter, setEditingCounter] = useState<Counter | null>(null);\n  const [selectedCounter, setSelectedCounter] = useState<Counter | null>(null);\n\n  useEffect(() => {\n    fetchCounters();\n  }, [projectId]);\n\n  const fetchCounters = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/projects/${projectId}/counters`);\n      setCounters(response.data.data.counters.sort((a: Counter, b: Counter) => a.sort_order - b.sort_order));\n    } catch (error) {\n      console.error('Error fetching counters:', error);\n      toast.error('Failed to load counters');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateCounter = async (counterData: Partial<Counter>) => {\n    try {\n      const maxSortOrder = counters.length > 0\n        ? Math.max(...counters.map(c => c.sort_order))\n        : 0;\n\n      await axios.post(`/api/projects/${projectId}/counters`, {\n        ...counterData,\n        sortOrder: maxSortOrder + 1\n      });\n\n      toast.success('Counter created!');\n      setShowForm(false);\n      fetchCounters();\n    } catch (error) {\n      console.error('Error creating counter:', error);\n      toast.error('Failed to create counter');\n    }\n  };\n\n  const handleUpdateCounter = async (counterId: string, counterData: Partial<Counter>) => {\n    try {\n      await axios.put(`/api/projects/${projectId}/counters/${counterId}`, counterData);\n      toast.success('Counter updated!');\n      setShowForm(false);\n      setEditingCounter(null);\n      fetchCounters();\n    } catch (error) {\n      console.error('Error updating counter:', error);\n      toast.error('Failed to update counter');\n    }\n  };\n\n  const handleDeleteCounter = async (counterId: string) => {\n    try {\n      await axios.delete(`/api/projects/${projectId}/counters/${counterId}`);\n      toast.success('Counter deleted!');\n      fetchCounters();\n    } catch (error) {\n      console.error('Error deleting counter:', error);\n      toast.error('Failed to delete counter');\n    }\n  };\n\n  const handleToggleVisibility = async (counterId: string) => {\n    const counter = counters.find(c => c.id === counterId);\n    if (!counter) return;\n\n    try {\n      await axios.put(`/api/projects/${projectId}/counters/${counterId}`, {\n        is_visible: !counter.is_visible\n      });\n      fetchCounters();\n    } catch (error) {\n      console.error('Error toggling visibility:', error);\n      toast.error('Failed to update counter');\n    }\n  };\n\n  const visibleCounters = counters.filter(c => c.is_visible && c.is_active);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Counters</h2>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={() => setShowCounterSelector(true)}\n            className=\"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition flex items-center gap-2\"\n          >\n            <FiClock className=\"h-4 w-4\" />\n            History\n          </button>\n          <button\n            onClick={() => setShowLinkModal(true)}\n            className=\"px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition flex items-center gap-2\"\n          >\n            <FiLink className=\"h-4 w-4\" />\n            Link Counters\n          </button>\n          <button\n            onClick={() => {\n              setEditingCounter(null);\n              setShowForm(true);\n            }}\n            className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition flex items-center gap-2\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n            Add Counter\n          </button>\n        </div>\n      </div>\n\n      {/* Counter Grid */}\n      {visibleCounters.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n          <p className=\"text-gray-500 mb-4\">No counters yet. Add your first counter to get started!</p>\n          <button\n            onClick={() => setShowForm(true)}\n            className=\"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2\"\n          >\n            <FiPlus className=\"h-5 w-5\" />\n            Add Counter\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {visibleCounters.map((counter) => (\n            <CounterCard\n              key={counter.id}\n              counter={counter}\n              onUpdate={fetchCounters}\n              onEdit={(counter) => {\n                setEditingCounter(counter);\n                setShowForm(true);\n              }}\n              onDelete={handleDeleteCounter}\n              onToggleVisibility={handleToggleVisibility}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Hidden Counters */}\n      {counters.filter(c => !c.is_visible && c.is_active).length > 0 && (\n        <details className=\"mt-6\">\n          <summary className=\"cursor-pointer text-sm text-gray-600 hover:text-gray-900\">\n            Show hidden counters ({counters.filter(c => !c.is_visible).length})\n          </summary>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4 opacity-50\">\n            {counters.filter(c => !c.is_visible && c.is_active).map((counter) => (\n              <CounterCard\n                key={counter.id}\n                counter={counter}\n                onUpdate={fetchCounters}\n                onEdit={(counter) => {\n                  setEditingCounter(counter);\n                  setShowForm(true);\n                }}\n                onDelete={handleDeleteCounter}\n                onToggleVisibility={handleToggleVisibility}\n              />\n            ))}\n          </div>\n        </details>\n      )}\n\n      {/* Counter Form Modal */}\n      {showForm && (\n        <CounterForm\n          projectId={projectId}\n          counter={editingCounter}\n          onSave={(data) => {\n            if (editingCounter) {\n              handleUpdateCounter(editingCounter.id, data);\n            } else {\n              handleCreateCounter(data);\n            }\n          }}\n          onCancel={() => {\n            setShowForm(false);\n            setEditingCounter(null);\n          }}\n        />\n      )}\n\n      {/* Counter Selector Modal for History */}\n      {showCounterSelector && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n                <FiClock className=\"h-5 w-5\" />\n                Select Counter for History\n              </h3>\n              <button\n                onClick={() => setShowCounterSelector(false)}\n                className=\"text-gray-400 hover:text-gray-600 text-2xl\"\n              >\n                \n              </button>\n            </div>\n\n            <div className=\"p-4 max-h-96 overflow-y-auto\">\n              {counters.length === 0 ? (\n                <p className=\"text-center text-gray-500 py-8\">No counters available</p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {counters.map((counter) => (\n                    <button\n                      key={counter.id}\n                      onClick={() => {\n                        setSelectedCounter(counter);\n                        setShowCounterSelector(false);\n                        setShowHistory(true);\n                      }}\n                      className=\"w-full text-left px-4 py-3 bg-gray-50 hover:bg-purple-50 rounded-lg transition flex items-center justify-between group\"\n                    >\n                      <div>\n                        <div className=\"font-medium text-gray-900\">{counter.name}</div>\n                        <div className=\"text-sm text-gray-500\">\n                          Current: {counter.current_value}\n                          {counter.target_value && ` / ${counter.target_value}`}\n                        </div>\n                      </div>\n                      <FiClock className=\"h-5 w-5 text-gray-400 group-hover:text-purple-600\" />\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            <div className=\"p-4 border-t border-gray-200\">\n              <button\n                onClick={() => setShowCounterSelector(false)}\n                className=\"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Counter History Modal */}\n      {showHistory && selectedCounter && (\n        <CounterHistory\n          counter={selectedCounter}\n          onClose={() => {\n            setShowHistory(false);\n            setSelectedCounter(null);\n          }}\n          onUpdate={fetchCounters}\n        />\n      )}\n\n      {/* Link Counter Modal */}\n      {showLinkModal && (\n        <LinkCounterModal\n          projectId={projectId}\n          counters={counters}\n          onClose={() => setShowLinkModal(false)}\n          onSave={() => {\n            setShowLinkModal(false);\n            fetchCounters();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport { FiClock, FiPlay, FiPause, FiSquare } from 'react-icons/fi';\nimport { KnittingSession } from '../../types/counter.types';\n\ninterface SessionTimerProps {\n  projectId: string;\n  currentSession: KnittingSession | null;\n  onStartSession: () => Promise<KnittingSession>;\n  onEndSession: (notes?: string, mood?: string) => Promise<void>;\n  onPauseSession?: () => Promise<void>;\n  getCurrentCounterValues: () => Record<string, number>;\n}\n\nexport const SessionTimer: React.FC<SessionTimerProps> = ({\n  projectId: _projectId,\n  currentSession,\n  onStartSession,\n  onEndSession,\n  onPauseSession,\n  getCurrentCounterValues: _getCurrentCounterValues,\n}) => {\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [isRunning, setIsRunning] = useState(false);\n  const [showEndModal, setShowEndModal] = useState(false);\n  const [endNotes, setEndNotes] = useState('');\n  const [mood, setMood] = useState<'productive' | 'frustrated' | 'relaxed' | undefined>();\n  const intervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  // Calculate elapsed time from current session\n  useEffect(() => {\n    if (currentSession && !currentSession.end_time) {\n      const startTime = new Date(currentSession.start_time).getTime();\n      const now = Date.now();\n      setElapsedTime(Math.floor((now - startTime) / 1000));\n      setIsRunning(true);\n    } else {\n      setElapsedTime(0);\n      setIsRunning(false);\n    }\n  }, [currentSession]);\n\n  // Update timer every second when running\n  useEffect(() => {\n    if (isRunning) {\n      intervalRef.current = setInterval(() => {\n        setElapsedTime((prev) => prev + 1);\n      }, 1000);\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [isRunning]);\n\n  const handleStart = async () => {\n    try {\n      await onStartSession();\n      setIsRunning(true);\n    } catch (error) {\n      console.error('Failed to start session:', error);\n    }\n  };\n\n  const handlePause = async () => {\n    if (onPauseSession) {\n      try {\n        await onPauseSession();\n        setIsRunning(false);\n      } catch (error) {\n        console.error('Failed to pause session:', error);\n      }\n    }\n  };\n\n  const handleStop = () => {\n    setShowEndModal(true);\n  };\n\n  const handleConfirmEnd = async () => {\n    try {\n      await onEndSession(endNotes, mood);\n      setShowEndModal(false);\n      setEndNotes('');\n      setMood(undefined);\n      setIsRunning(false);\n      setElapsedTime(0);\n    } catch (error) {\n      console.error('Failed to end session:', error);\n    }\n  };\n\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n\n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n          <FiClock className=\"w-5 h-5\" />\n          Knitting Session\n        </h3>\n      </div>\n\n      {/* Timer Display */}\n      <div className=\"text-center mb-6\">\n        <div className=\"text-6xl font-bold text-gray-900 dark:text-white tabular-nums mb-2\">\n          {formatTime(elapsedTime)}\n        </div>\n        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n          {isRunning ? 'Session in progress' : 'No active session'}\n        </div>\n      </div>\n\n      {/* Control Buttons */}\n      <div className=\"flex gap-3 justify-center\">\n        {!isRunning ? (\n          <button\n            onClick={handleStart}\n            className=\"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n          >\n            <FiPlay className=\"w-6 h-6\" />\n            Start Session\n          </button>\n        ) : (\n          <>\n            {onPauseSession && (\n              <button\n                onClick={handlePause}\n                className=\"flex items-center gap-2 px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n              >\n                <FiPause className=\"w-6 h-6\" />\n                Pause\n              </button>\n            )}\n            <button\n              onClick={handleStop}\n              className=\"flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n            >\n              <FiSquare className=\"w-6 h-6\" />\n              End Session\n            </button>\n          </>\n        )}\n      </div>\n\n      {/* End Session Modal */}\n      {showEndModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6\">\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\n              End Knitting Session\n            </h3>\n\n            {/* Session Summary */}\n            <div className=\"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"text-sm text-gray-600 dark:text-gray-300\">\n                Session Duration\n              </div>\n              <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                {formatTime(elapsedTime)}\n              </div>\n            </div>\n\n            {/* Mood Selection */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                How was this session?\n              </label>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setMood('productive')}\n                  className={`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${\n                    mood === 'productive'\n                      ? 'border-green-500 bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-green-500'\n                  }`}\n                >\n                   Productive\n                </button>\n                <button\n                  onClick={() => setMood('relaxed')}\n                  className={`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${\n                    mood === 'relaxed'\n                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-blue-500'\n                  }`}\n                >\n                   Relaxed\n                </button>\n                <button\n                  onClick={() => setMood('frustrated')}\n                  className={`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${\n                    mood === 'frustrated'\n                      ? 'border-orange-500 bg-orange-50 dark:bg-orange-900 text-orange-700 dark:text-orange-300'\n                      : 'border-gray-300 dark:border-gray-600 hover:border-orange-500'\n                  }`}\n                >\n                   Frustrated\n                </button>\n              </div>\n            </div>\n\n            {/* Session Notes */}\n            <div className=\"mb-6\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Session Notes (optional)\n              </label>\n              <textarea\n                value={endNotes}\n                onChange={(e) => setEndNotes(e.target.value)}\n                placeholder=\"Add any notes about this session...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={3}\n              />\n            </div>\n\n            {/* Modal Actions */}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setShowEndModal(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleConfirmEnd}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                End Session\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiClock, FiTrendingUp, FiMapPin } from 'react-icons/fi';\nimport { KnittingSession } from '../../types/counter.types';\nimport { format } from 'date-fns';\n\ninterface SessionHistoryProps {\n  sessions: KnittingSession[];\n  onDeleteSession?: (sessionId: string) => Promise<void>;\n}\n\nexport const SessionHistory: React.FC<SessionHistoryProps> = ({\n  sessions,\n  onDeleteSession,\n}) => {\n  const [expandedSession, setExpandedSession] = useState<string | null>(null);\n\n  const formatDuration = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n\n    if (hours > 0) {\n      return `${hours}h ${minutes}m`;\n    }\n    return `${minutes}m`;\n  };\n\n  const calculateRowsPerHour = (session: KnittingSession): number => {\n    if (!session.duration_seconds || session.duration_seconds === 0) return 0;\n    const hours = session.duration_seconds / 3600;\n    return Math.round(session.rows_completed / hours);\n  };\n\n  const getMoodEmoji = (mood?: string): string => {\n    switch (mood) {\n      case 'productive':\n        return '';\n      case 'relaxed':\n        return '';\n      case 'frustrated':\n        return '';\n      default:\n        return '';\n    }\n  };\n\n  const getMoodColor = (mood?: string): string => {\n    switch (mood) {\n      case 'productive':\n        return 'text-green-600 dark:text-green-400';\n      case 'relaxed':\n        return 'text-blue-600 dark:text-blue-400';\n      case 'frustrated':\n        return 'text-orange-600 dark:text-orange-400';\n      default:\n        return 'text-gray-600 dark:text-gray-400';\n    }\n  };\n\n  const toggleExpand = (sessionId: string) => {\n    setExpandedSession(expandedSession === sessionId ? null : sessionId);\n  };\n\n  // Calculate totals\n  const totalDuration = sessions.reduce(\n    (sum, session) => sum + (session.duration_seconds || 0),\n    0\n  );\n  const totalRows = sessions.reduce((sum, session) => sum + session.rows_completed, 0);\n  const averageRowsPerHour =\n    totalDuration > 0 ? Math.round((totalRows / totalDuration) * 3600) : 0;\n\n  if (sessions.length === 0) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4\">\n          <FiClock className=\"w-5 h-5\" />\n          Session History\n        </h3>\n        <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n          <FiClock className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n          <p>No sessions recorded yet</p>\n          <p className=\"text-sm mt-1\">Start a knitting session to track your progress</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4\">\n        <FiClock className=\"w-5 h-5\" />\n        Session History\n      </h3>\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n        <div className=\"text-center\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Sessions</div>\n          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {sessions.length}\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Time</div>\n          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {formatDuration(totalDuration)}\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Avg Pace</div>\n          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {averageRowsPerHour}\n          </div>\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">rows/hour</div>\n        </div>\n      </div>\n\n      {/* Session List */}\n      <div className=\"space-y-3\">\n        {sessions.map((session) => {\n          const isExpanded = expandedSession === session.id;\n          const rowsPerHour = calculateRowsPerHour(session);\n\n          return (\n            <div\n              key={session.id}\n              className=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\"\n            >\n              {/* Session Header */}\n              <button\n                onClick={() => toggleExpand(session.id)}\n                className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <span className={`text-2xl ${getMoodColor(session.mood)}`}>\n                    {getMoodEmoji(session.mood)}\n                  </span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-gray-900 dark:text-white\">\n                      {format(new Date(session.start_time), 'MMM d, yyyy')}\n                    </div>\n                    <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                      {format(new Date(session.start_time), 'h:mm a')}\n                      {session.end_time &&\n                        ` - ${format(new Date(session.end_time), 'h:mm a')}`}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"text-right\">\n                    <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                      {formatDuration(session.duration_seconds || 0)}\n                    </div>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                      {session.rows_completed} rows\n                    </div>\n                  </div>\n                  <svg\n                    className={`w-5 h-5 text-gray-400 transition-transform ${\n                      isExpanded ? 'transform rotate-180' : ''\n                    }`}\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M19 9l-7 7-7-7\"\n                    />\n                  </svg>\n                </div>\n              </button>\n\n              {/* Expanded Details */}\n              {isExpanded && (\n                <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600\">\n                  {/* Stats */}\n                  <div className=\"grid grid-cols-2 gap-4 mb-3\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <FiTrendingUp className=\"w-4 h-4 text-gray-500\" />\n                      <span className=\"text-gray-600 dark:text-gray-400\">Pace:</span>\n                      <span className=\"font-medium text-gray-900 dark:text-white\">\n                        {rowsPerHour} rows/hour\n                      </span>\n                    </div>\n                    {session.location && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <FiMapPin className=\"w-4 h-4 text-gray-500\" />\n                        <span className=\"text-gray-600 dark:text-gray-400\">Location:</span>\n                        <span className=\"font-medium text-gray-900 dark:text-white\">\n                          {session.location}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Counter Values */}\n                  {session.starting_counter_values &&\n                    session.ending_counter_values &&\n                    Object.keys(session.starting_counter_values).length > 0 && (\n                      <div className=\"mb-3\">\n                        <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400 mb-2\">\n                          Counter Progress\n                        </div>\n                        <div className=\"space-y-1\">\n                          {Object.entries(session.starting_counter_values).map(\n                            ([counterId, startValue]) => {\n                              const endValue =\n                                session.ending_counter_values?.[counterId] || startValue;\n                              const diff = endValue - startValue;\n                              return (\n                                <div\n                                  key={counterId}\n                                  className=\"flex justify-between text-sm\"\n                                >\n                                  <span className=\"text-gray-600 dark:text-gray-400\">\n                                    Counter {counterId.slice(0, 8)}\n                                  </span>\n                                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                                    {startValue}  {endValue}\n                                    {diff > 0 && (\n                                      <span className=\"text-green-600 dark:text-green-400 ml-1\">\n                                        (+{diff})\n                                      </span>\n                                    )}\n                                  </span>\n                                </div>\n                              );\n                            }\n                          )}\n                        </div>\n                      </div>\n                    )}\n\n                  {/* Notes */}\n                  {session.notes && (\n                    <div className=\"mb-3\">\n                      <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\n                        Notes\n                      </div>\n                      <div className=\"text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded\">\n                        {session.notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Delete Button */}\n                  {onDeleteSession && (\n                    <button\n                      onClick={() => onDeleteSession(session.id)}\n                      className=\"text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium\"\n                    >\n                      Delete Session\n                    </button>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiClock, FiPlus, FiTrash2, FiCheckCircle, FiCircle } from 'react-icons/fi';\nimport { ProjectMilestone } from '../../types/counter.types';\nimport { formatDuration as _formatDuration } from 'date-fns';\n\ninterface ProjectTimerProps {\n  projectId: string;\n  milestones: ProjectMilestone[];\n  totalTimeSeconds: number;\n  totalRows: number;\n  completedRows: number;\n  onAddMilestone: (milestone: Omit<ProjectMilestone, 'id' | 'created_at'>) => Promise<void>;\n  onUpdateMilestone: (milestoneId: string, updates: Partial<ProjectMilestone>) => Promise<void>;\n  onDeleteMilestone: (milestoneId: string) => Promise<void>;\n}\n\nexport const ProjectTimer: React.FC<ProjectTimerProps> = ({\n  projectId,\n  milestones,\n  totalTimeSeconds,\n  totalRows,\n  completedRows,\n  onAddMilestone,\n  onUpdateMilestone,\n  onDeleteMilestone,\n}) => {\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [_editingMilestone, _setEditingMilestone] = useState<ProjectMilestone | null>(null);\n  const [newMilestone, setNewMilestone] = useState({\n    name: '',\n    target_rows: 0,\n  });\n\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n\n    if (hours === 0) return `${minutes}m`;\n    if (hours < 10) return `${hours}h ${minutes}m`;\n    return `${hours}h`;\n  };\n\n  const calculateRowsPerHour = (): number => {\n    if (totalTimeSeconds === 0) return 0;\n    const hours = totalTimeSeconds / 3600;\n    return Math.round(completedRows / hours);\n  };\n\n  const calculateEstimatedCompletion = (): string => {\n    const rowsPerHour = calculateRowsPerHour();\n    if (rowsPerHour === 0) return 'Not enough data';\n\n    const remainingRows = totalRows - completedRows;\n    const estimatedHours = remainingRows / rowsPerHour;\n\n    if (estimatedHours < 1) {\n      return `~${Math.round(estimatedHours * 60)} minutes`;\n    }\n    if (estimatedHours < 24) {\n      return `~${Math.round(estimatedHours)} hours`;\n    }\n    const days = Math.round(estimatedHours / 24);\n    return `~${days} day${days !== 1 ? 's' : ''}`;\n  };\n\n  const handleAddMilestone = async () => {\n    if (!newMilestone.name.trim()) return;\n\n    try {\n      await onAddMilestone({\n        project_id: projectId,\n        name: newMilestone.name,\n        target_rows: newMilestone.target_rows || undefined,\n        actual_rows: 0,\n        time_spent_seconds: 0,\n        sort_order: milestones.length,\n      });\n\n      setNewMilestone({ name: '', target_rows: 0 });\n      setShowAddModal(false);\n    } catch (error) {\n      console.error('Failed to add milestone:', error);\n    }\n  };\n\n  const handleCompleteMilestone = async (milestone: ProjectMilestone) => {\n    try {\n      await onUpdateMilestone(milestone.id, {\n        completed_at: milestone.completed_at ? undefined : new Date().toISOString(),\n        actual_rows: milestone.actual_rows || completedRows,\n      });\n    } catch (error) {\n      console.error('Failed to complete milestone:', error);\n    }\n  };\n\n  const progressPercentage = totalRows > 0 ? (completedRows / totalRows) * 100 : 0;\n  const rowsPerHour = calculateRowsPerHour();\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n          <FiClock className=\"w-5 h-5\" />\n          Project Progress\n        </h3>\n        <button\n          onClick={() => setShowAddModal(true)}\n          className=\"flex items-center gap-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors\"\n        >\n          <FiPlus className=\"w-4 h-4\" />\n          Add Milestone\n        </button>\n      </div>\n\n      {/* Overall Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Total Time</div>\n          <div className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {formatTime(totalTimeSeconds)}\n          </div>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Rows Complete</div>\n          <div className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {completedRows}\n            {totalRows > 0 && (\n              <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                /{totalRows}\n              </span>\n            )}\n          </div>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Average Pace</div>\n          <div className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {rowsPerHour}\n          </div>\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">rows/hour</div>\n        </div>\n        <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n          <div className=\"text-xs text-gray-600 dark:text-gray-400 mb-1\">Time Remaining</div>\n          <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n            {calculateEstimatedCompletion()}\n          </div>\n        </div>\n      </div>\n\n      {/* Progress Bar */}\n      {totalRows > 0 && (\n        <div className=\"mb-6\">\n          <div className=\"flex justify-between text-sm mb-2\">\n            <span className=\"text-gray-600 dark:text-gray-400\">Overall Progress</span>\n            <span className=\"font-medium text-gray-900 dark:text-white\">\n              {progressPercentage.toFixed(1)}%\n            </span>\n          </div>\n          <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3\">\n            <div\n              className=\"bg-blue-600 h-3 rounded-full transition-all duration-300\"\n              style={{ width: `${Math.min(progressPercentage, 100)}%` }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Milestones */}\n      <div>\n        <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\n          Milestones\n        </h4>\n\n        {milestones.length === 0 ? (\n          <div className=\"text-center py-6 text-gray-500 dark:text-gray-400\">\n            <FiCircle className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n            <p className=\"text-sm\">No milestones yet</p>\n            <p className=\"text-xs mt-1\">Break down your project into manageable sections</p>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            {milestones\n              .sort((a, b) => a.sort_order - b.sort_order)\n              .map((milestone) => {\n                const isCompleted = !!milestone.completed_at;\n                const milestoneProgress = milestone.target_rows\n                  ? Math.min(\n                      ((milestone.actual_rows || 0) / milestone.target_rows) * 100,\n                      100\n                    )\n                  : 0;\n\n                return (\n                  <div\n                    key={milestone.id}\n                    className={`p-3 rounded-lg border-2 transition-all ${\n                      isCompleted\n                        ? 'border-green-500 bg-green-50 dark:bg-green-900/20'\n                        : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700'\n                    }`}\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div className=\"flex items-start gap-2 flex-1\">\n                        <button\n                          onClick={() => handleCompleteMilestone(milestone)}\n                          className=\"mt-0.5\"\n                        >\n                          {isCompleted ? (\n                            <FiCheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n                          ) : (\n                            <FiCircle className=\"w-5 h-5 text-gray-400\" />\n                          )}\n                        </button>\n                        <div className=\"flex-1\">\n                          <div\n                            className={`font-medium ${\n                              isCompleted\n                                ? 'text-green-900 dark:text-green-300 line-through'\n                                : 'text-gray-900 dark:text-white'\n                            }`}\n                          >\n                            {milestone.name}\n                          </div>\n                          <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 space-x-3\">\n                            {milestone.target_rows && (\n                              <span>\n                                Target: {milestone.target_rows} rows\n                              </span>\n                            )}\n                            {milestone.time_spent_seconds > 0 && (\n                              <span>\n                                Time: {formatTime(milestone.time_spent_seconds)}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => onDeleteMilestone(milestone.id)}\n                        className=\"text-red-600 hover:text-red-700 dark:text-red-400 p-1\"\n                      >\n                        <FiTrash2 className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n\n                    {/* Milestone Progress Bar */}\n                    {milestone.target_rows && !isCompleted && (\n                      <div className=\"mt-2\">\n                        <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5\">\n                          <div\n                            className=\"bg-blue-600 h-1.5 rounded-full transition-all duration-300\"\n                            style={{ width: `${milestoneProgress}%` }}\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n          </div>\n        )}\n      </div>\n\n      {/* Add Milestone Modal */}\n      {showAddModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6\">\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\n              Add Milestone\n            </h3>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Milestone Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={newMilestone.name}\n                  onChange={(e) =>\n                    setNewMilestone({ ...newMilestone, name: e.target.value })\n                  }\n                  placeholder=\"e.g., Ribbing, Body, Sleeves\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Target Rows (optional)\n                </label>\n                <input\n                  type=\"number\"\n                  value={newMilestone.target_rows || ''}\n                  onChange={(e) =>\n                    setNewMilestone({\n                      ...newMilestone,\n                      target_rows: parseInt(e.target.value) || 0,\n                    })\n                  }\n                  placeholder=\"Number of rows for this section\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => setShowAddModal(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleAddMilestone}\n                disabled={!newMilestone.name.trim()}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors\"\n              >\n                Add Milestone\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import React, { useState, useEffect } from 'react';\nimport { SessionTimer } from './SessionTimer';\nimport { SessionHistory } from './SessionHistory';\nimport { ProjectTimer } from './ProjectTimer';\nimport { KnittingSession, ProjectMilestone } from '../../types/counter.types';\nimport axios from 'axios';\n\ninterface SessionManagerProps {\n  projectId: string;\n  totalRows?: number;\n  getCurrentCounterValues: () => Record<string, number>;\n}\n\nexport const SessionManager: React.FC<SessionManagerProps> = ({\n  projectId,\n  totalRows = 0,\n  getCurrentCounterValues,\n}) => {\n  const [currentSession, setCurrentSession] = useState<KnittingSession | null>(null);\n  const [sessions, setSessions] = useState<KnittingSession[]>([]);\n  const [milestones, setMilestones] = useState<ProjectMilestone[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState<'timer' | 'history' | 'progress'>('timer');\n\n  // Fetch sessions and milestones\n  useEffect(() => {\n    fetchSessions();\n    fetchMilestones();\n    checkActiveSession();\n  }, [projectId]);\n\n  const checkActiveSession = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${projectId}/sessions/active`);\n      if (response.data.success && response.data.data) {\n        setCurrentSession(response.data.data);\n      }\n    } catch (error) {\n      // No active session\n      console.log('No active session');\n    }\n  };\n\n  const fetchSessions = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/projects/${projectId}/sessions`);\n      setSessions(response.data.success ? response.data.data.sessions || [] : []);\n    } catch (error) {\n      console.error('Failed to fetch sessions:', error);\n      setSessions([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMilestones = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${projectId}/milestones`);\n      setMilestones(response.data.success ? response.data.data.milestones || [] : []);\n    } catch (error) {\n      console.error('Failed to fetch milestones:', error);\n      setMilestones([]);\n    }\n  };\n\n  const handleStartSession = async (): Promise<KnittingSession> => {\n    try {\n      const response = await axios.post(`/api/projects/${projectId}/sessions/start`, {\n        mood: undefined,\n        location: undefined,\n        notes: undefined,\n      });\n\n      const newSession = response.data.success ? response.data.data.session : response.data;\n      setCurrentSession(newSession);\n      return newSession;\n    } catch (error) {\n      console.error('Failed to start session:', error);\n      throw error;\n    }\n  };\n\n  const handleEndSession = async (notes?: string, mood?: string) => {\n    if (!currentSession) return;\n\n    try {\n      await axios.post(`/api/projects/${projectId}/sessions/${currentSession.id}/end`, {\n        notes,\n        mood,\n      });\n\n      setCurrentSession(null);\n      fetchSessions(); // Refresh session list\n    } catch (error) {\n      console.error('Failed to end session:', error);\n      throw error;\n    }\n  };\n\n  const handleDeleteSession = async (sessionId: string) => {\n    try {\n      await axios.delete(`/api/projects/${projectId}/sessions/${sessionId}`);\n      setSessions(sessions.filter((s) => s.id !== sessionId));\n    } catch (error) {\n      console.error('Failed to delete session:', error);\n    }\n  };\n\n  const handleAddMilestone = async (\n    milestone: Omit<ProjectMilestone, 'id' | 'created_at'>\n  ) => {\n    try {\n      const response = await axios.post(`/api/projects/${projectId}/milestones`, {\n        name: milestone.name,\n        targetRows: milestone.target_rows,\n      });\n      const newMilestone = response.data.success ? response.data.data.milestone : response.data;\n      setMilestones([...milestones, newMilestone]);\n    } catch (error) {\n      console.error('Failed to add milestone:', error);\n      throw error;\n    }\n  };\n\n  const handleUpdateMilestone = async (\n    milestoneId: string,\n    updates: Partial<ProjectMilestone>\n  ) => {\n    try {\n      const response = await axios.put(\n        `/api/projects/${projectId}/milestones/${milestoneId}`,\n        {\n          name: updates.name,\n          targetRows: updates.target_rows,\n          actualRows: updates.actual_rows,\n          timeSpentSeconds: updates.time_spent_seconds,\n          completedAt: updates.completed_at,\n        }\n      );\n      const updatedMilestone = response.data.success ? response.data.data.milestone : response.data;\n      setMilestones(\n        milestones.map((m) => (m.id === milestoneId ? updatedMilestone : m))\n      );\n    } catch (error) {\n      console.error('Failed to update milestone:', error);\n      throw error;\n    }\n  };\n\n  const handleDeleteMilestone = async (milestoneId: string) => {\n    try {\n      await axios.delete(`/api/projects/${projectId}/milestones/${milestoneId}`);\n      setMilestones(milestones.filter((m) => m.id !== milestoneId));\n    } catch (error) {\n      console.error('Failed to delete milestone:', error);\n      throw error;\n    }\n  };\n\n  // Calculate totals\n  const totalTimeSeconds = sessions.reduce(\n    (sum, session) => sum + (session.duration_seconds || 0),\n    0\n  );\n  const completedRows = sessions.reduce(\n    (sum, session) => sum + session.rows_completed,\n    0\n  );\n\n  if (loading) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n        <div className=\"text-center text-gray-500 dark:text-gray-400\">\n          Loading sessions...\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Tab Navigation */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden\">\n        <div className=\"flex border-b border-gray-200 dark:border-gray-700\">\n          <button\n            onClick={() => setActiveTab('timer')}\n            className={`flex-1 px-4 py-3 font-medium transition-colors ${\n              activeTab === 'timer'\n                ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\n            }`}\n          >\n            Session Timer\n          </button>\n          <button\n            onClick={() => setActiveTab('progress')}\n            className={`flex-1 px-4 py-3 font-medium transition-colors ${\n              activeTab === 'progress'\n                ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\n            }`}\n          >\n            Progress\n          </button>\n          <button\n            onClick={() => setActiveTab('history')}\n            className={`flex-1 px-4 py-3 font-medium transition-colors ${\n              activeTab === 'history'\n                ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'\n            }`}\n          >\n            History ({sessions.length})\n          </button>\n        </div>\n\n        <div className=\"p-6\">\n          {/* Session Timer Tab */}\n          {activeTab === 'timer' && (\n            <SessionTimer\n              projectId={projectId}\n              currentSession={currentSession}\n              onStartSession={handleStartSession}\n              onEndSession={handleEndSession}\n              getCurrentCounterValues={getCurrentCounterValues}\n            />\n          )}\n\n          {/* Progress Tab */}\n          {activeTab === 'progress' && (\n            <ProjectTimer\n              projectId={projectId}\n              milestones={milestones}\n              totalTimeSeconds={totalTimeSeconds}\n              totalRows={totalRows}\n              completedRows={completedRows}\n              onAddMilestone={handleAddMilestone}\n              onUpdateMilestone={handleUpdateMilestone}\n              onDeleteMilestone={handleDeleteMilestone}\n            />\n          )}\n\n          {/* History Tab */}\n          {activeTab === 'history' && (\n            <SessionHistory sessions={sessions} onDeleteSession={handleDeleteSession} />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { FiMic, FiSquare, FiPlay, FiPause, FiTrash2, FiDownload, FiEdit2, FiCheck, FiX } from 'react-icons/fi';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface AudioNote {\n  id: string;\n  project_id: string;\n  pattern_id?: string;\n  audio_url: string;\n  transcription?: string;\n  duration_seconds: number;\n  counter_values?: Record<string, number>;\n  created_at: string;\n}\n\ninterface AudioNotesProps {\n  projectId: string;\n  patternId?: string;\n  notes: AudioNote[];\n  getCurrentCounterValues?: () => Record<string, number>;\n  onSaveNote: (audioBlob: Blob, durationSeconds: number, transcription?: string) => Promise<void>;\n  onDeleteNote: (noteId: string) => Promise<void>;\n  onUpdateTranscription?: (noteId: string, transcription: string) => Promise<void>;\n}\n\nexport const AudioNotes: React.FC<AudioNotesProps> = ({\n  projectId: _projectId,\n  patternId: _patternId,\n  notes,\n  getCurrentCounterValues: _getCurrentCounterValues,\n  onSaveNote,\n  onDeleteNote,\n  onUpdateTranscription,\n}) => {\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [playingNoteId, setPlayingNoteId] = useState<string | null>(null);\n  const [editingNoteId, setEditingNoteId] = useState<string | null>(null);\n  const [editTranscription, setEditTranscription] = useState('');\n\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const recordingIntervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const recordingTimeRef = useRef<number>(0);\n  const audioElementsRef = useRef<Map<string, HTMLAudioElement>>(new Map());\n  const recordingMimeTypeRef = useRef<string>('audio/webm');\n\n  // Cleanup audio elements on unmount\n  useEffect(() => {\n    return () => {\n      audioElementsRef.current.forEach((audio) => {\n        audio.pause();\n        audio.src = '';\n      });\n      audioElementsRef.current.clear();\n    };\n  }, []);\n\n  // Get the best supported audio mime type for recording\n  const getSupportedMimeType = (): string => {\n    const types = [\n      'audio/webm;codecs=opus',\n      'audio/webm',\n      'audio/ogg;codecs=opus',\n      'audio/mp4',\n      'audio/mpeg',\n      'audio/wav',\n    ];\n\n    for (const type of types) {\n      if (MediaRecorder.isTypeSupported(type)) {\n        console.log(` Using audio mime type: ${type}`);\n        return type;\n      }\n    }\n\n    console.warn(' No preferred mime type supported, using browser default');\n    return '';\n  };\n\n  const startRecording = async () => {\n    try {\n      // Check if MediaRecorder API is supported\n      if (!window.MediaRecorder) {\n        alert(' Audio recording is not supported in this browser. Please use Chrome, Firefox, Edge, or Safari.');\n        return;\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n      // Detect supported mime type\n      const mimeType = getSupportedMimeType();\n      recordingMimeTypeRef.current = mimeType;\n\n      // Create MediaRecorder with supported mime type\n      const options = mimeType ? { mimeType } : {};\n      const mediaRecorder = new MediaRecorder(stream, options);\n\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          console.log(` Audio chunk received: ${event.data.size} bytes`);\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      mediaRecorder.onstop = async () => {\n        console.log(` Recording stopped. Total chunks: ${audioChunksRef.current.length}`);\n\n        // Use the actual mime type from the MediaRecorder\n        const actualMimeType = mediaRecorder.mimeType || recordingMimeTypeRef.current;\n        const audioBlob = new Blob(audioChunksRef.current, { type: actualMimeType });\n\n        console.log(` Audio blob created: ${audioBlob.size} bytes, type: ${actualMimeType}`);\n\n        // Stop all tracks\n        stream.getTracks().forEach((track) => track.stop());\n\n        // Validate blob before saving\n        if (audioBlob.size === 0) {\n          console.error(' Audio blob is empty - no data was recorded');\n          alert('Recording failed: No audio data was captured. Please try again.');\n          return;\n        }\n\n        // Save the note with duration (transcription can be added manually later)\n        // Use ref value instead of state to get the current recording time\n        const duration = recordingTimeRef.current;\n        console.log(`  Recording duration: ${duration} seconds`);\n        try {\n          await onSaveNote(audioBlob, duration, undefined);\n          console.log(' Audio note saved successfully');\n        } catch (error) {\n          console.error('Failed to save audio note:', error);\n          alert('Failed to save audio note');\n        }\n      };\n\n      // Add error handler for MediaRecorder\n      mediaRecorder.onerror = (event: any) => {\n        console.error(' MediaRecorder error:', event.error);\n        alert(`Recording error: ${event.error?.message || 'Unknown error occurred'}`);\n      };\n\n      mediaRecorder.start(1000); // Request data every 1000ms for reliability\n      setIsRecording(true);\n      setRecordingTime(0);\n      recordingTimeRef.current = 0;\n\n      // Start recording timer\n      recordingIntervalRef.current = setInterval(() => {\n        recordingTimeRef.current += 1;\n        setRecordingTime(recordingTimeRef.current);\n      }, 1000);\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n\n      // Provide specific error messages based on error type\n      if (error instanceof DOMException) {\n        switch (error.name) {\n          case 'NotAllowedError':\n            alert(' Microphone access denied. Please allow microphone permissions in your browser settings and try again.');\n            break;\n          case 'NotFoundError':\n            alert(' No microphone found. Please connect a microphone and try again.');\n            break;\n          case 'NotReadableError':\n            alert(' Microphone is already in use by another application. Please close other apps using the microphone and try again.');\n            break;\n          default:\n            alert(` Failed to access microphone: ${error.message}`);\n        }\n      } else {\n        alert('Failed to access microphone. Please grant microphone permissions.');\n      }\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n\n      if (recordingIntervalRef.current) {\n        clearInterval(recordingIntervalRef.current);\n        recordingIntervalRef.current = null;\n      }\n    }\n  };\n\n  const playAudio = (note: AudioNote) => {\n    // Pause any currently playing audio\n    if (playingNoteId) {\n      const currentAudio = audioElementsRef.current.get(playingNoteId);\n      if (currentAudio) {\n        currentAudio.pause();\n        currentAudio.currentTime = 0;\n      }\n    }\n\n    // Get or create audio element for this note\n    let audio = audioElementsRef.current.get(note.id);\n    if (!audio) {\n      audio = new Audio(note.audio_url);\n      audio.onended = () => setPlayingNoteId(null);\n      audioElementsRef.current.set(note.id, audio);\n    }\n\n    if (playingNoteId === note.id) {\n      audio.pause();\n      setPlayingNoteId(null);\n    } else {\n      audio.play();\n      setPlayingNoteId(note.id);\n    }\n  };\n\n  const handleDeleteNote = async (noteId: string) => {\n    if (!confirm('Are you sure you want to delete this audio note?')) return;\n\n    try {\n      // Stop and cleanup audio if playing\n      const audio = audioElementsRef.current.get(noteId);\n      if (audio) {\n        audio.pause();\n        audio.src = '';\n        audioElementsRef.current.delete(noteId);\n      }\n\n      await onDeleteNote(noteId);\n    } catch (error) {\n      console.error('Failed to delete note:', error);\n      alert('Failed to delete note');\n    }\n  };\n\n  const startEditTranscription = (note: AudioNote) => {\n    setEditingNoteId(note.id);\n    setEditTranscription(note.transcription || '');\n  };\n\n  const saveTranscription = async (noteId: string) => {\n    if (!onUpdateTranscription) return;\n\n    try {\n      await onUpdateTranscription(noteId, editTranscription);\n      setEditingNoteId(null);\n      setEditTranscription('');\n    } catch (error) {\n      console.error('Failed to update transcription:', error);\n      alert('Failed to update transcription');\n    }\n  };\n\n  const cancelEditTranscription = () => {\n    setEditingNoteId(null);\n    setEditTranscription('');\n  };\n\n  const formatDuration = (seconds: number): string => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n        Audio Notes\n      </h3>\n\n      {/* Recording Controls */}\n      <div className=\"mb-6\">\n        {!isRecording ? (\n          <button\n            onClick={startRecording}\n            className=\"w-full flex items-center justify-center gap-3 px-6 py-4 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n          >\n            <FiMic className=\"w-6 h-6\" />\n            Start Recording\n          </button>\n        ) : (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-center gap-3 py-4\">\n              <div className=\"w-4 h-4 bg-red-600 rounded-full animate-pulse\" />\n              <span className=\"text-2xl font-bold text-gray-900 dark:text-white tabular-nums\">\n                {formatDuration(recordingTime)}\n              </span>\n            </div>\n            <button\n              onClick={stopRecording}\n              className=\"w-full flex items-center justify-center gap-3 px-6 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-lg font-medium transition-colors min-h-[60px]\"\n            >\n              <FiSquare className=\"w-6 h-6\" />\n              Stop Recording\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Audio Notes List */}\n      <div className=\"space-y-3\">\n        {notes.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n            <FiMic className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>No audio notes yet</p>\n            <p className=\"text-sm mt-1\">Record your first voice note</p>\n          </div>\n        ) : (\n          notes.map((note) => (\n            <div\n              key={note.id}\n              className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n            >\n              {/* Note Header */}\n              <div className=\"flex items-center justify-between mb-3\">\n                <div>\n                  <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                    {formatDistanceToNow(new Date(note.created_at), { addSuffix: true })}\n                  </div>\n                  <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    Duration: {formatDuration(note.duration_seconds)}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    onClick={() => playAudio(note)}\n                    className={`p-2 rounded-lg transition-colors ${\n                      playingNoteId === note.id\n                        ? 'bg-blue-600 text-white'\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n                    }`}\n                    title={playingNoteId === note.id ? 'Pause' : 'Play'}\n                  >\n                    {playingNoteId === note.id ? (\n                      <FiPause className=\"w-5 h-5\" />\n                    ) : (\n                      <FiPlay className=\"w-5 h-5\" />\n                    )}\n                  </button>\n                  <a\n                    href={note.audio_url}\n                    download={`audio-note-${note.id}.webm`}\n                    className=\"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600\"\n                    title=\"Download\"\n                  >\n                    <FiDownload className=\"w-5 h-5\" />\n                  </a>\n                  <button\n                    onClick={() => handleDeleteNote(note.id)}\n                    className=\"p-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30\"\n                    title=\"Delete\"\n                  >\n                    <FiTrash2 className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </div>\n\n              {/* Transcription */}\n              {editingNoteId === note.id ? (\n                <div className=\"space-y-2\">\n                  <textarea\n                    value={editTranscription}\n                    onChange={(e) => setEditTranscription(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm\"\n                    rows={3}\n                    placeholder=\"Add transcription or notes...\"\n                  />\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => saveTranscription(note.id)}\n                      className=\"flex items-center gap-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm\"\n                    >\n                      <FiCheck className=\"w-4 h-4\" />\n                      Save\n                    </button>\n                    <button\n                      onClick={cancelEditTranscription}\n                      className=\"flex items-center gap-1 px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm\"\n                    >\n                      <FiX className=\"w-4 h-4\" />\n                      Cancel\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"bg-gray-50 dark:bg-gray-700 rounded p-3\">\n                  <div className=\"flex items-start justify-between mb-1\">\n                    <div className=\"text-xs font-medium text-gray-600 dark:text-gray-400\">\n                      Transcription\n                    </div>\n                    {onUpdateTranscription && (\n                      <button\n                        onClick={() => startEditTranscription(note)}\n                        className=\"text-blue-600 dark:text-blue-400 hover:text-blue-700\"\n                      >\n                        <FiEdit2 className=\"w-3 h-3\" />\n                      </button>\n                    )}\n                  </div>\n                  <div className=\"text-sm text-gray-700 dark:text-gray-300\">\n                    {note.transcription || (\n                      <span className=\"italic text-gray-500 dark:text-gray-400\">\n                        No transcription available. Click edit to add notes.\n                      </span>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Counter Values */}\n              {note.counter_values && Object.keys(note.counter_values).length > 0 && (\n                <div className=\"mt-3 text-xs text-gray-500 dark:text-gray-400\">\n                  <span className=\"font-medium\">At: </span>\n                  {Object.entries(note.counter_values)\n                    .map(([key, value]) => `${key}: ${value}`)\n                    .join(', ')}\n                </div>\n              )}\n            </div>\n          ))\n        )}\n      </div>\n\n      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-4\">\n         Tip: Click the microphone icon to record voice notes hands-free while knitting\n      </p>\n    </div>\n  );\n};\n","import React, { useRef, useState, useEffect } from 'react';\nimport { FiEdit3, FiTrash, FiDownload, FiTrash2, FiRotateCcw, FiRotateCw, FiDroplet } from 'react-icons/fi';\n\ninterface HandwrittenNotesProps {\n  patternId?: string;\n  projectId: string;\n  pageNumber?: number;\n  onSave?: (imageData: string) => Promise<void>;\n  initialData?: string; // Base64 image data\n}\n\ninterface DrawingPoint {\n  x: number;\n  y: number;\n}\n\ninterface DrawingPath {\n  points: DrawingPoint[];\n  color: string;\n  width: number;\n  tool: 'pen' | 'eraser';\n}\n\nconst COLORS = [\n  { name: 'Black', value: '#000000' },\n  { name: 'Blue', value: '#3B82F6' },\n  { name: 'Red', value: '#EF4444' },\n  { name: 'Green', value: '#10B981' },\n  { name: 'Purple', value: '#8B5CF6' },\n  { name: 'Orange', value: '#F97316' },\n  { name: 'Pink', value: '#EC4899' },\n  { name: 'Yellow', value: '#FBBF24' },\n];\n\nconst LINE_WIDTHS = [2, 4, 6, 8, 12];\n\nexport const HandwrittenNotes: React.FC<HandwrittenNotesProps> = ({\n  patternId: _patternId,\n  projectId: _projectId,\n  pageNumber: _pageNumber,\n  onSave,\n  initialData,\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [currentPath, setCurrentPath] = useState<DrawingPoint[]>([]);\n  const [paths, setPaths] = useState<DrawingPath[]>([]);\n  const [undoStack, setUndoStack] = useState<DrawingPath[][]>([]);\n  const [redoStack, setRedoStack] = useState<DrawingPath[][]>([]);\n\n  const [tool, setTool] = useState<'pen' | 'eraser'>('pen');\n  const [color, setColor] = useState('#000000');\n  const [lineWidth, setLineWidth] = useState(4);\n  const [showColorPicker, setShowColorPicker] = useState(false);\n  const [showWidthPicker, setShowWidthPicker] = useState(false);\n\n  // Initialize canvas\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const container = containerRef.current;\n    if (!canvas || !container) return;\n\n    // Set canvas size to match container\n    const rect = container.getBoundingClientRect();\n    canvas.width = rect.width;\n    canvas.height = Math.max(rect.height, 400);\n\n    // Set white background\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      ctx.fillStyle = '#FFFFFF';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      // Load initial data if provided\n      if (initialData) {\n        const img = new Image();\n        img.onload = () => {\n          ctx.drawImage(img, 0, 0);\n        };\n        img.src = initialData;\n      }\n    }\n  }, [initialData]);\n\n  // Redraw canvas when paths change\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Clear canvas\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Draw all paths\n    paths.forEach((path) => {\n      if (path.points.length < 2) return;\n\n      ctx.beginPath();\n      ctx.strokeStyle = path.tool === 'eraser' ? '#FFFFFF' : path.color;\n      ctx.lineWidth = path.tool === 'eraser' ? path.width * 2 : path.width;\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n\n      ctx.moveTo(path.points[0].x, path.points[0].y);\n      for (let i = 1; i < path.points.length; i++) {\n        ctx.lineTo(path.points[i].x, path.points[i].y);\n      }\n      ctx.stroke();\n    });\n  }, [paths]);\n\n  const getCanvasPoint = (e: React.MouseEvent | React.TouchEvent): DrawingPoint => {\n    const canvas = canvasRef.current;\n    if (!canvas) return { x: 0, y: 0 };\n\n    const rect = canvas.getBoundingClientRect();\n    let clientX: number, clientY: number;\n\n    if ('touches' in e) {\n      clientX = e.touches[0].clientX;\n      clientY = e.touches[0].clientY;\n    } else {\n      clientX = e.clientX;\n      clientY = e.clientY;\n    }\n\n    return {\n      x: clientX - rect.left,\n      y: clientY - rect.top,\n    };\n  };\n\n  const startDrawing = (e: React.MouseEvent | React.TouchEvent) => {\n    e.preventDefault();\n    setIsDrawing(true);\n    const point = getCanvasPoint(e);\n    setCurrentPath([point]);\n  };\n\n  const draw = (e: React.MouseEvent | React.TouchEvent) => {\n    if (!isDrawing) return;\n    e.preventDefault();\n\n    const point = getCanvasPoint(e);\n    setCurrentPath((prev) => [...prev, point]);\n\n    // Draw current stroke immediately\n    const canvas = canvasRef.current;\n    const ctx = canvas?.getContext('2d');\n    if (!ctx || currentPath.length === 0) return;\n\n    ctx.beginPath();\n    ctx.strokeStyle = tool === 'eraser' ? '#FFFFFF' : color;\n    ctx.lineWidth = tool === 'eraser' ? lineWidth * 2 : lineWidth;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    const lastPoint = currentPath[currentPath.length - 1];\n    ctx.moveTo(lastPoint.x, lastPoint.y);\n    ctx.lineTo(point.x, point.y);\n    ctx.stroke();\n  };\n\n  const endDrawing = () => {\n    if (!isDrawing) return;\n    setIsDrawing(false);\n\n    if (currentPath.length > 1) {\n      const newPath: DrawingPath = {\n        points: currentPath,\n        color,\n        width: lineWidth,\n        tool,\n      };\n\n      // Save state for undo\n      setUndoStack((prev) => [...prev, paths]);\n      setRedoStack([]); // Clear redo stack on new action\n\n      setPaths((prev) => [...prev, newPath]);\n    }\n\n    setCurrentPath([]);\n  };\n\n  const handleUndo = () => {\n    if (undoStack.length === 0) return;\n\n    const previousState = undoStack[undoStack.length - 1];\n    setRedoStack((prev) => [...prev, paths]);\n    setPaths(previousState);\n    setUndoStack((prev) => prev.slice(0, -1));\n  };\n\n  const handleRedo = () => {\n    if (redoStack.length === 0) return;\n\n    const nextState = redoStack[redoStack.length - 1];\n    setUndoStack((prev) => [...prev, paths]);\n    setPaths(nextState);\n    setRedoStack((prev) => prev.slice(0, -1));\n  };\n\n  const handleClear = () => {\n    if (paths.length === 0) return;\n\n    setUndoStack((prev) => [...prev, paths]);\n    setRedoStack([]);\n    setPaths([]);\n  };\n\n  const handleExport = async () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const imageData = canvas.toDataURL('image/png');\n\n    if (onSave) {\n      try {\n        await onSave(imageData);\n        alert('Notes saved successfully!');\n      } catch (error) {\n        console.error('Failed to save notes:', error);\n        alert('Failed to save notes');\n      }\n    } else {\n      // Download as file\n      const link = document.createElement('a');\n      link.download = `notes-${Date.now()}.png`;\n      link.href = imageData;\n      link.click();\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n          Handwritten Notes\n        </h3>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleUndo}\n            disabled={undoStack.length === 0}\n            className=\"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed\"\n            title=\"Undo\"\n          >\n            <FiRotateCcw className=\"w-5 h-5\" />\n          </button>\n          <button\n            onClick={handleRedo}\n            disabled={redoStack.length === 0}\n            className=\"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed\"\n            title=\"Redo\"\n          >\n            <FiRotateCw className=\"w-5 h-5\" />\n          </button>\n          <button\n            onClick={handleClear}\n            className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded\"\n            title=\"Clear all\"\n          >\n            <FiTrash2 className=\"w-5 h-5\" />\n          </button>\n          <button\n            onClick={handleExport}\n            className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded\"\n            title=\"Save/Export\"\n          >\n            <FiDownload className=\"w-5 h-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Drawing Tools */}\n      <div className=\"flex items-center gap-3 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex-wrap\">\n        {/* Tool Selection */}\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => setTool('pen')}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${\n              tool === 'pen'\n                ? 'bg-blue-600 text-white'\n                : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500'\n            }`}\n          >\n            <FiEdit3 className=\"w-4 h-4\" />\n            Pen\n          </button>\n          <button\n            onClick={() => setTool('eraser')}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${\n              tool === 'eraser'\n                ? 'bg-blue-600 text-white'\n                : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500'\n            }`}\n          >\n            <FiTrash className=\"w-4 h-4\" />\n            Eraser\n          </button>\n        </div>\n\n        {/* Color Picker */}\n        {tool === 'pen' && (\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowColorPicker(!showColorPicker)}\n              className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg\"\n            >\n              <FiDroplet className=\"w-4 h-4\" />\n              <div\n                className=\"w-6 h-6 rounded border-2 border-gray-300\"\n                style={{ backgroundColor: color }}\n              />\n            </button>\n            {showColorPicker && (\n              <div className=\"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10\">\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {COLORS.map((c) => (\n                    <button\n                      key={c.value}\n                      onClick={() => {\n                        setColor(c.value);\n                        setShowColorPicker(false);\n                      }}\n                      className={`w-8 h-8 rounded border-2 transition-transform hover:scale-110 ${\n                        color === c.value\n                          ? 'border-blue-600 ring-2 ring-blue-300'\n                          : 'border-gray-300'\n                      }`}\n                      style={{ backgroundColor: c.value }}\n                      title={c.name}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Line Width */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowWidthPicker(!showWidthPicker)}\n            className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg\"\n          >\n            <div\n              className=\"rounded-full bg-gray-900 dark:bg-white\"\n              style={{ width: lineWidth * 2, height: lineWidth * 2 }}\n            />\n            {lineWidth}px\n          </button>\n          {showWidthPicker && (\n            <div className=\"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10\">\n              <div className=\"flex flex-col gap-2\">\n                {LINE_WIDTHS.map((width) => (\n                  <button\n                    key={width}\n                    onClick={() => {\n                      setLineWidth(width);\n                      setShowWidthPicker(false);\n                    }}\n                    className={`flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${\n                      lineWidth === width ? 'bg-blue-50 dark:bg-blue-900/20' : ''\n                    }`}\n                  >\n                    <div\n                      className=\"rounded-full bg-gray-900 dark:bg-white\"\n                      style={{ width: width * 2, height: width * 2 }}\n                    />\n                    <span className=\"text-sm\">{width}px</span>\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Drawing Canvas */}\n      <div\n        ref={containerRef}\n        className=\"border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white\"\n        style={{ touchAction: 'none' }}\n      >\n        <canvas\n          ref={canvasRef}\n          onMouseDown={startDrawing}\n          onMouseMove={draw}\n          onMouseUp={endDrawing}\n          onMouseLeave={endDrawing}\n          onTouchStart={startDrawing}\n          onTouchMove={draw}\n          onTouchEnd={endDrawing}\n          className=\"cursor-crosshair\"\n        />\n      </div>\n\n      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n        Draw on the canvas with your mouse, trackpad, or touch screen. Use the eraser to remove\n        strokes.\n      </p>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { FiFileText, FiTrash2, FiDownload } from 'react-icons/fi';\nimport { formatDistanceToNow } from 'date-fns';\n\ntype TemplateType = 'gauge_swatch' | 'fit_adjustment' | 'yarn_substitution' | 'finishing_techniques';\n\ninterface GaugeSwatchData {\n  needle_size: string;\n  stitches_per_inch: number;\n  rows_per_inch: number;\n  swatch_width: number;\n  swatch_height: number;\n  notes?: string;\n}\n\ninterface FitAdjustmentData {\n  measurement_name: string;\n  original_value: number;\n  adjusted_value: number;\n  reason: string;\n  notes?: string;\n}\n\ninterface YarnSubstitutionData {\n  original_yarn_name: string;\n  original_yarn_weight: string;\n  original_yardage: number;\n  replacement_yarn_name: string;\n  replacement_yarn_weight: string;\n  replacement_yardage: number;\n  gauge_comparison: string;\n  notes?: string;\n}\n\ninterface FinishingTechniquesData {\n  bind_off_method: string;\n  seaming_technique: string;\n  blocking_instructions: string;\n  notes?: string;\n}\n\ntype MemoData = GaugeSwatchData | FitAdjustmentData | YarnSubstitutionData | FinishingTechniquesData;\n\ninterface StructuredMemo {\n  id: string;\n  project_id: string;\n  template_type: TemplateType;\n  data: MemoData;\n  created_at: string;\n}\n\ninterface StructuredMemoTemplatesProps {\n  projectId: string;\n  memos: StructuredMemo[];\n  onSaveMemo: (templateType: TemplateType, data: MemoData) => Promise<void>;\n  onDeleteMemo: (memoId: string) => Promise<void>;\n}\n\nconst TEMPLATE_INFO = {\n  gauge_swatch: {\n    name: 'Gauge Swatch',\n    icon: '',\n    description: 'Record gauge measurements for accurate sizing',\n  },\n  fit_adjustment: {\n    name: 'Fit Adjustment',\n    icon: '',\n    description: 'Track modifications to pattern measurements',\n  },\n  yarn_substitution: {\n    name: 'Yarn Substitution',\n    icon: '',\n    description: 'Document yarn changes and gauge comparison',\n  },\n  finishing_techniques: {\n    name: 'Finishing Techniques',\n    icon: '',\n    description: 'Notes on bind-off, seaming, and blocking',\n  },\n};\n\nexport const StructuredMemoTemplates: React.FC<StructuredMemoTemplatesProps> = ({\n  projectId: _projectId,\n  memos,\n  onSaveMemo,\n  onDeleteMemo,\n}) => {\n  const [showNewMemoModal, setShowNewMemoModal] = useState(false);\n  const [selectedTemplate, setSelectedTemplate] = useState<TemplateType>('gauge_swatch');\n  const [formData, setFormData] = useState<any>({});\n\n  const handleOpenNewMemo = (templateType: TemplateType) => {\n    setSelectedTemplate(templateType);\n    setFormData({});\n    setShowNewMemoModal(true);\n  };\n\n  const handleSaveMemo = async () => {\n    try {\n      await onSaveMemo(selectedTemplate, formData);\n      setShowNewMemoModal(false);\n      setFormData({});\n    } catch (error) {\n      console.error('Failed to save memo:', error);\n      alert('Failed to save memo');\n    }\n  };\n\n  const handleDeleteMemo = async (memoId: string) => {\n    if (!confirm('Are you sure you want to delete this memo?')) return;\n\n    try {\n      await onDeleteMemo(memoId);\n    } catch (error) {\n      console.error('Failed to delete memo:', error);\n      alert('Failed to delete memo');\n    }\n  };\n\n  const exportMemo = (memo: StructuredMemo) => {\n    const text = renderMemoAsText(memo);\n    const blob = new Blob([text], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${TEMPLATE_INFO[memo.template_type].name.replace(/\\s/g, '_')}_${memo.id}.txt`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const renderMemoAsText = (memo: StructuredMemo): string => {\n    const title = TEMPLATE_INFO[memo.template_type].name;\n    const date = new Date(memo.created_at).toLocaleDateString();\n\n    let content = `${title}\\n`;\n    content += `Date: ${date}\\n`;\n    content += `${'='.repeat(50)}\\n\\n`;\n\n    switch (memo.template_type) {\n      case 'gauge_swatch':\n        const gauge = memo.data as GaugeSwatchData;\n        content += `Needle Size: ${gauge.needle_size}\\n`;\n        content += `Stitches per Inch: ${gauge.stitches_per_inch}\\n`;\n        content += `Rows per Inch: ${gauge.rows_per_inch}\\n`;\n        content += `Swatch Dimensions: ${gauge.swatch_width}\"  ${gauge.swatch_height}\"\\n`;\n        if (gauge.notes) content += `\\nNotes: ${gauge.notes}\\n`;\n        break;\n\n      case 'fit_adjustment':\n        const fit = memo.data as FitAdjustmentData;\n        content += `Measurement: ${fit.measurement_name}\\n`;\n        content += `Original: ${fit.original_value}\\n`;\n        content += `Adjusted: ${fit.adjusted_value}\\n`;\n        content += `Reason: ${fit.reason}\\n`;\n        if (fit.notes) content += `\\nNotes: ${fit.notes}\\n`;\n        break;\n\n      case 'yarn_substitution':\n        const yarn = memo.data as YarnSubstitutionData;\n        content += `Original Yarn: ${yarn.original_yarn_name} (${yarn.original_yarn_weight})\\n`;\n        content += `Original Yardage: ${yarn.original_yardage} yards\\n`;\n        content += `Replacement Yarn: ${yarn.replacement_yarn_name} (${yarn.replacement_yarn_weight})\\n`;\n        content += `Replacement Yardage: ${yarn.replacement_yardage} yards\\n`;\n        content += `Gauge Comparison: ${yarn.gauge_comparison}\\n`;\n        if (yarn.notes) content += `\\nNotes: ${yarn.notes}\\n`;\n        break;\n\n      case 'finishing_techniques':\n        const finish = memo.data as FinishingTechniquesData;\n        content += `Bind-Off Method: ${finish.bind_off_method}\\n`;\n        content += `Seaming Technique: ${finish.seaming_technique}\\n`;\n        content += `Blocking Instructions: ${finish.blocking_instructions}\\n`;\n        if (finish.notes) content += `\\nNotes: ${finish.notes}\\n`;\n        break;\n    }\n\n    return content;\n  };\n\n  const renderTemplateForm = () => {\n    switch (selectedTemplate) {\n      case 'gauge_swatch':\n        return (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Needle Size\n              </label>\n              <input\n                type=\"text\"\n                value={formData.needle_size || ''}\n                onChange={(e) => setFormData({ ...formData, needle_size: e.target.value })}\n                placeholder=\"e.g., US 7 / 4.5mm\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Stitches per Inch\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  value={formData.stitches_per_inch || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, stitches_per_inch: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"4.5\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Rows per Inch\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  value={formData.rows_per_inch || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, rows_per_inch: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"6.0\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Swatch Width (inches)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.swatch_width || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, swatch_width: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"4\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Swatch Height (inches)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.swatch_height || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, swatch_height: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"4\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Any additional observations...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={3}\n              />\n            </div>\n          </div>\n        );\n\n      case 'fit_adjustment':\n        return (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Measurement Name\n              </label>\n              <input\n                type=\"text\"\n                value={formData.measurement_name || ''}\n                onChange={(e) => setFormData({ ...formData, measurement_name: e.target.value })}\n                placeholder=\"e.g., Sleeve length, Bust circumference\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Original Value\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.original_value || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, original_value: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"36\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Adjusted Value\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={formData.adjusted_value || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, adjusted_value: parseFloat(e.target.value) })\n                  }\n                  placeholder=\"38\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Reason for Change\n              </label>\n              <input\n                type=\"text\"\n                value={formData.reason || ''}\n                onChange={(e) => setFormData({ ...formData, reason: e.target.value })}\n                placeholder=\"e.g., Prefer looser fit, Accommodate larger bust\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Additional details...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={2}\n              />\n            </div>\n          </div>\n        );\n\n      case 'yarn_substitution':\n        return (\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Original Yarn Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.original_yarn_name || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, original_yarn_name: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Original Weight\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.original_yarn_weight || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, original_yarn_weight: e.target.value })\n                  }\n                  placeholder=\"DK, Worsted, etc.\"\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Original Yardage\n              </label>\n              <input\n                type=\"number\"\n                value={formData.original_yardage || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, original_yardage: parseInt(e.target.value) })\n                }\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Replacement Yarn Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.replacement_yarn_name || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, replacement_yarn_name: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Replacement Weight\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.replacement_yarn_weight || ''}\n                  onChange={(e) =>\n                    setFormData({ ...formData, replacement_yarn_weight: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Replacement Yardage\n              </label>\n              <input\n                type=\"number\"\n                value={formData.replacement_yardage || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, replacement_yardage: parseInt(e.target.value) })\n                }\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Gauge Comparison\n              </label>\n              <input\n                type=\"text\"\n                value={formData.gauge_comparison || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, gauge_comparison: e.target.value })\n                }\n                placeholder=\"e.g., Same gauge, Slightly looser\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Differences in texture, drape, etc.\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={2}\n              />\n            </div>\n          </div>\n        );\n\n      case 'finishing_techniques':\n        return (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Bind-Off Method\n              </label>\n              <input\n                type=\"text\"\n                value={formData.bind_off_method || ''}\n                onChange={(e) => setFormData({ ...formData, bind_off_method: e.target.value })}\n                placeholder=\"e.g., Standard, Sewn, I-cord\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Seaming Technique\n              </label>\n              <input\n                type=\"text\"\n                value={formData.seaming_technique || ''}\n                onChange={(e) => setFormData({ ...formData, seaming_technique: e.target.value })}\n                placeholder=\"e.g., Mattress stitch, Kitchener stitch\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Blocking Instructions\n              </label>\n              <textarea\n                value={formData.blocking_instructions || ''}\n                onChange={(e) =>\n                  setFormData({ ...formData, blocking_instructions: e.target.value })\n                }\n                placeholder=\"Wet blocking, steam blocking, measurements, etc.\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={3}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Additional Notes (optional)\n              </label>\n              <textarea\n                value={formData.notes || ''}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                placeholder=\"Any other finishing details...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                rows={2}\n              />\n            </div>\n          </div>\n        );\n    }\n  };\n\n  const renderMemoCard = (memo: StructuredMemo) => {\n    const info = TEMPLATE_INFO[memo.template_type];\n\n    return (\n      <div\n        key={memo.id}\n        className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\"\n      >\n        <div className=\"flex items-start justify-between mb-3\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-2xl\">{info.icon}</span>\n              <h4 className=\"font-medium text-gray-900 dark:text-white\">{info.name}</h4>\n            </div>\n            <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n              {formatDistanceToNow(new Date(memo.created_at), { addSuffix: true })}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => exportMemo(memo)}\n              className=\"p-1 text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n              title=\"Export\"\n            >\n              <FiDownload className=\"w-4 h-4\" />\n            </button>\n            <button\n              onClick={() => handleDeleteMemo(memo.id)}\n              className=\"p-1 text-red-600 hover:text-red-700 dark:text-red-400\"\n              title=\"Delete\"\n            >\n              <FiTrash2 className=\"w-4 h-4\" />\n            </button>\n          </div>\n        </div>\n        <div className=\"text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-3 rounded\">\n          <pre className=\"whitespace-pre-wrap font-sans\">{renderMemoAsText(memo)}</pre>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n          <FiFileText className=\"w-5 h-5\" />\n          Structured Memos\n        </h3>\n      </div>\n\n      {/* Template Selection */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 mb-6\">\n        {(Object.entries(TEMPLATE_INFO) as [TemplateType, typeof TEMPLATE_INFO[TemplateType]][]).map(\n          ([type, info]) => (\n            <button\n              key={type}\n              onClick={() => handleOpenNewMemo(type)}\n              className=\"flex items-start gap-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 dark:hover:border-blue-500 transition-colors text-left\"\n            >\n              <span className=\"text-3xl\">{info.icon}</span>\n              <div>\n                <div className=\"font-medium text-gray-900 dark:text-white\">{info.name}</div>\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                  {info.description}\n                </div>\n              </div>\n            </button>\n          )\n        )}\n      </div>\n\n      {/* Saved Memos */}\n      <div className=\"space-y-3\">\n        {memos.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n            <FiFileText className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>No memos yet</p>\n            <p className=\"text-sm mt-1\">Click a template above to create your first memo</p>\n          </div>\n        ) : (\n          memos.map(renderMemoCard)\n        )}\n      </div>\n\n      {/* New Memo Modal */}\n      {showNewMemoModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <span className=\"text-2xl\">{TEMPLATE_INFO[selectedTemplate].icon}</span>\n              <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                {TEMPLATE_INFO[selectedTemplate].name}\n              </h3>\n            </div>\n\n            {renderTemplateForm()}\n\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={() => setShowNewMemoModal(false)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSaveMemo}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                Save Memo\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import { useState, useEffect } from 'react';\nimport { FiAlertCircle, FiPlus,  FiTrash2, FiToggleLeft, FiToggleRight } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface MagicMarker {\n  id: string;\n  project_id: string;\n  counter_id: string | null;\n  name: string;\n  trigger_type: string;\n  trigger_condition: any;\n  alert_message: string;\n  alert_type: string;\n  is_active: boolean;\n  created_at: string;\n}\n\ninterface Counter {\n  id: string;\n  name: string;\n  current_value: number;\n  target_value: number | null;\n}\n\ninterface MagicMarkerManagerProps {\n  projectId: string;\n  counters: Counter[];\n}\n\nconst TRIGGER_TYPES = [\n  { value: 'counter_value', label: 'Counter reaches value' },\n  { value: 'row_interval', label: 'Every N rows' },\n  { value: 'stitch_count', label: 'Stitch count milestone' },\n  { value: 'time_based', label: 'Time-based reminder' },\n];\n\nconst ALERT_TYPES = [\n  { value: 'notification', label: ' Notification' },\n  { value: 'sound', label: ' Sound' },\n  { value: 'vibration', label: ' Vibration' },\n  { value: 'visual', label: ' Visual' },\n];\n\nexport default function MagicMarkerManager({ projectId, counters }: MagicMarkerManagerProps) {\n  const [markers, setMarkers] = useState<MagicMarker[]>([]);\n  const [showModal, setShowModal] = useState(false);\n  const [_editingMarker, _setEditingMarker] = useState<MagicMarker | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    counterId: '',\n    triggerType: 'counter_value',\n    operator: 'equals',\n    triggerValue: '',\n    interval: '',\n    alertMessage: '',\n    alertType: 'notification',\n  });\n\n  useEffect(() => {\n    fetchMarkers();\n  }, [projectId]);\n\n  const fetchMarkers = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${projectId}/magic-markers`);\n      setMarkers(response.data.data.magicMarkers || []);\n    } catch (error) {\n      console.error('Error fetching magic markers:', error);\n    }\n  };\n\n  const handleCreate = async () => {\n    if (!formData.name.trim()) {\n      toast.error('Please enter a marker name');\n      return;\n    }\n\n    if (!formData.alertMessage.trim()) {\n      toast.error('Please enter an alert message');\n      return;\n    }\n\n    let triggerCondition: any = {};\n\n    switch (formData.triggerType) {\n      case 'counter_value':\n        if (!formData.triggerValue || formData.triggerValue.trim() === '') {\n          toast.error('Please enter trigger value');\n          return;\n        }\n        const counterValue = parseInt(formData.triggerValue);\n        if (isNaN(counterValue)) {\n          toast.error('Trigger value must be a valid number');\n          return;\n        }\n        triggerCondition = {\n          operator: formData.operator,\n          value: counterValue,\n        };\n        break;\n      case 'row_interval':\n        if (!formData.interval || formData.interval.trim() === '') {\n          toast.error('Please enter interval');\n          return;\n        }\n        const rowInterval = parseInt(formData.interval);\n        if (isNaN(rowInterval) || rowInterval <= 0) {\n          toast.error('Interval must be a positive number');\n          return;\n        }\n        triggerCondition = {\n          interval: rowInterval,\n        };\n        break;\n      case 'stitch_count':\n        if (!formData.triggerValue || formData.triggerValue.trim() === '') {\n          toast.error('Please enter stitch count');\n          return;\n        }\n        const stitchCount = parseInt(formData.triggerValue);\n        if (isNaN(stitchCount) || stitchCount <= 0) {\n          toast.error('Stitch count must be a positive number');\n          return;\n        }\n        triggerCondition = {\n          count: stitchCount,\n        };\n        break;\n      case 'time_based':\n        if (!formData.interval || formData.interval.trim() === '') {\n          toast.error('Please enter time interval (minutes)');\n          return;\n        }\n        const timeInterval = parseInt(formData.interval);\n        if (isNaN(timeInterval) || timeInterval <= 0) {\n          toast.error('Time interval must be a positive number');\n          return;\n        }\n        triggerCondition = {\n          minutes: timeInterval,\n        };\n        break;\n    }\n\n    try {\n      await axios.post(`/api/projects/${projectId}/magic-markers`, {\n        name: formData.name,\n        counterId: formData.counterId || null,\n        triggerType: formData.triggerType,\n        triggerCondition,\n        alertMessage: formData.alertMessage,\n        alertType: formData.alertType,\n        isActive: true,\n      });\n\n      toast.success('Magic marker created!');\n      setShowModal(false);\n      resetForm();\n      fetchMarkers();\n    } catch (error: any) {\n      console.error('Error creating marker:', error);\n      toast.error(error.response?.data?.message || 'Failed to create marker');\n    }\n  };\n\n  const handleToggle = async (markerId: string) => {\n    try {\n      await axios.patch(`/api/projects/${projectId}/magic-markers/${markerId}/toggle`);\n      fetchMarkers();\n    } catch (error) {\n      console.error('Error toggling marker:', error);\n      toast.error('Failed to toggle marker');\n    }\n  };\n\n  const handleDelete = async (markerId: string, name: string) => {\n    if (!confirm(`Delete magic marker \"${name}\"?`)) return;\n\n    try {\n      await axios.delete(`/api/projects/${projectId}/magic-markers/${markerId}`);\n      toast.success('Marker deleted');\n      fetchMarkers();\n    } catch (error) {\n      console.error('Error deleting marker:', error);\n      toast.error('Failed to delete marker');\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      counterId: '',\n      triggerType: 'counter_value',\n      operator: 'equals',\n      triggerValue: '',\n      interval: '',\n      alertMessage: '',\n      alertType: 'notification',\n    });\n  };\n\n  const getTriggerDescription = (marker: MagicMarker) => {\n    const condition = marker.trigger_condition;\n    switch (marker.trigger_type) {\n      case 'counter_value':\n        const operatorMap: Record<string, string> = {\n          equals: '=',\n          greater_than: '>',\n          less_than: '<',\n          multiple_of: 'is multiple of',\n        };\n        const operatorText = operatorMap[condition.operator as string] || condition.operator;\n        return `When counter ${operatorText} ${condition.value}`;\n      case 'row_interval':\n        return `Every ${condition.interval} rows`;\n      case 'stitch_count':\n        return `At ${condition.count} stitches`;\n      case 'time_based':\n        return `Every ${condition.minutes} minutes`;\n      default:\n        return marker.trigger_type;\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <FiAlertCircle className=\"h-5 w-5 text-purple-600\" />\n          <h2 className=\"text-lg font-semibold text-gray-900\">Magic Markers</h2>\n          <span className=\"text-sm text-gray-500\">({markers.length})</span>\n        </div>\n\n        <button\n          onClick={() => setShowModal(true)}\n          className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition\"\n        >\n          <FiPlus className=\"h-4 w-4\" />\n          New Marker\n        </button>\n      </div>\n\n      {/* Markers List */}\n      {markers.length === 0 ? (\n        <div className=\"text-center py-8 text-gray-500\">\n          <FiAlertCircle className=\"h-12 w-12 mx-auto mb-3 text-gray-300\" />\n          <p>No magic markers yet</p>\n          <p className=\"text-sm mt-1\">Create markers to get alerts at important milestones</p>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {markers.map((marker) => (\n            <div\n              key={marker.id}\n              className={`border rounded-lg p-4 ${\n                marker.is_active\n                  ? 'border-purple-200 bg-purple-50'\n                  : 'border-gray-200 bg-gray-50'\n              }`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <h3 className=\"font-semibold text-gray-900\">{marker.name}</h3>\n                    {marker.is_active ? (\n                      <span className=\"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full\">\n                        Active\n                      </span>\n                    ) : (\n                      <span className=\"px-2 py-0.5 bg-gray-200 text-gray-600 text-xs rounded-full\">\n                        Inactive\n                      </span>\n                    )}\n                  </div>\n\n                  <p className=\"text-sm text-gray-600 mb-2\">\n                    {getTriggerDescription(marker)}\n                  </p>\n\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xs text-gray-500\">Alert:</span>\n                    <span className=\"text-sm font-medium text-gray-700\">\n                      {marker.alert_message}\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-2 ml-4\">\n                  <button\n                    onClick={() => handleToggle(marker.id)}\n                    className=\"p-2 hover:bg-white rounded transition\"\n                    title={marker.is_active ? 'Disable' : 'Enable'}\n                  >\n                    {marker.is_active ? (\n                      <FiToggleRight className=\"h-5 w-5 text-green-600\" />\n                    ) : (\n                      <FiToggleLeft className=\"h-5 w-5 text-gray-400\" />\n                    )}\n                  </button>\n\n                  <button\n                    onClick={() => handleDelete(marker.id, marker.name)}\n                    className=\"p-2 hover:bg-white rounded transition text-red-600\"\n                    title=\"Delete\"\n                  >\n                    <FiTrash2 className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Modal */}\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-4 border-b border-gray-200 flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">New Magic Marker</h3>\n              <button\n                onClick={() => {\n                  setShowModal(false);\n                  resetForm();\n                }}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                \n              </button>\n            </div>\n\n            <div className=\"p-4 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Marker Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"e.g., Decrease reminder\"\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  autoFocus\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Counter (optional)\n                </label>\n                <select\n                  value={formData.counterId}\n                  onChange={(e) => setFormData({ ...formData, counterId: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                >\n                  <option value=\"\">All counters</option>\n                  {counters.map((counter) => (\n                    <option key={counter.id} value={counter.id}>\n                      {counter.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Trigger Type\n                </label>\n                <select\n                  value={formData.triggerType}\n                  onChange={(e) => setFormData({ ...formData, triggerType: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                >\n                  {TRIGGER_TYPES.map((type) => (\n                    <option key={type.value} value={type.value}>\n                      {type.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {(formData.triggerType === 'counter_value' || formData.triggerType === 'stitch_count') && (\n                <>\n                  {formData.triggerType === 'counter_value' && (\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Comparison Operator\n                      </label>\n                      <select\n                        value={formData.operator}\n                        onChange={(e) => setFormData({ ...formData, operator: e.target.value })}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                      >\n                        <option value=\"equals\">Equals (=)</option>\n                        <option value=\"greater_than\">Greater than (&gt;)</option>\n                        <option value=\"less_than\">Less than (&lt;)</option>\n                        <option value=\"multiple_of\">Is multiple of</option>\n                      </select>\n                    </div>\n                  )}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Trigger Value\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.triggerValue}\n                      onChange={(e) => setFormData({ ...formData, triggerValue: e.target.value })}\n                      placeholder=\"e.g., 100\"\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                    />\n                  </div>\n                </>\n              )}\n\n              {(formData.triggerType === 'row_interval' || formData.triggerType === 'time_based') && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    {formData.triggerType === 'time_based' ? 'Interval (minutes)' : 'Every N Rows'}\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.interval}\n                    onChange={(e) => setFormData({ ...formData, interval: e.target.value })}\n                    placeholder={formData.triggerType === 'time_based' ? 'e.g., 30' : 'e.g., 10'}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                  />\n                </div>\n              )}\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Alert Message *\n                </label>\n                <textarea\n                  value={formData.alertMessage}\n                  onChange={(e) => setFormData({ ...formData, alertMessage: e.target.value })}\n                  placeholder=\"e.g., Time to start decreases for the sleeve!\"\n                  rows={2}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Alert Type\n                </label>\n                <select\n                  value={formData.alertType}\n                  onChange={(e) => setFormData({ ...formData, alertType: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500\"\n                >\n                  {ALERT_TYPES.map((type) => (\n                    <option key={type.value} value={type.value}>\n                      {type.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"flex gap-3 pt-2\">\n                <button\n                  onClick={() => {\n                    setShowModal(false);\n                    resetForm();\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleCreate}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                >\n                  Create\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { FiLoader } from 'react-icons/fi';\n\ninterface LoadingSpinnerProps {\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  text?: string;\n  fullScreen?: boolean;\n  className?: string;\n}\n\nexport default function LoadingSpinner({\n  size = 'md',\n  text,\n  fullScreen = false,\n  className = ''\n}: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: 'w-4 h-4',\n    md: 'w-8 h-8',\n    lg: 'w-12 h-12',\n    xl: 'w-16 h-16'\n  };\n\n  const textSizeClasses = {\n    sm: 'text-sm',\n    md: 'text-base',\n    lg: 'text-lg',\n    xl: 'text-xl'\n  };\n\n  const spinner = (\n    <div className={`flex flex-col items-center justify-center gap-3 ${className}`}>\n      <FiLoader\n        className={`${sizeClasses[size]} text-purple-600 dark:text-purple-400 animate-spin`}\n        aria-label=\"Loading\"\n        role=\"status\"\n      />\n      {text && (\n        <p className={`${textSizeClasses[size]} text-gray-600 dark:text-gray-400 font-medium`}>\n          {text}\n        </p>\n      )}\n    </div>\n  );\n\n  if (fullScreen) {\n    return (\n      <div className=\"fixed inset-0 bg-gray-50 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 flex items-center justify-center z-50\">\n        {spinner}\n      </div>\n    );\n  }\n\n  return spinner;\n}\n\n/**\n * Inline loading spinner for buttons\n */\nexport function ButtonSpinner({ className = '' }: { className?: string }) {\n  return (\n    <FiLoader\n      className={`w-4 h-4 animate-spin ${className}`}\n      aria-label=\"Loading\"\n      role=\"status\"\n    />\n  );\n}\n\n/**\n * Card/Section loading skeleton\n */\nexport function LoadingSkeleton({\n  lines = 3,\n  className = ''\n}: {\n  lines?: number;\n  className?: string;\n}) {\n  return (\n    <div className={`animate-pulse space-y-3 ${className}`} role=\"status\" aria-label=\"Loading content\">\n      {Array.from({ length: lines }).map((_, i) => (\n        <div\n          key={i}\n          className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded\"\n          style={{ width: `${100 - (i * 10)}%` }}\n        />\n      ))}\n    </div>\n  );\n}\n\n/**\n * Card loading state\n */\nexport function LoadingCard({ className = '' }: { className?: string }) {\n  return (\n    <div className={`bg-white dark:bg-gray-800 rounded-lg p-6 ${className}`}>\n      <div className=\"animate-pulse\">\n        <div className=\"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4\" />\n        <div className=\"space-y-3\">\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded\" />\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6\" />\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/6\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FiExternalLink } from 'react-icons/fi';\nimport axios from 'axios';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\nimport 'react-pdf/dist/Page/TextLayer.css';\n\n// Configure PDF.js worker - use local file for production reliability\npdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.min.js';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  designer?: string;\n  description?: string;\n}\n\ninterface PatternFile {\n  id: string;\n  filename: string;\n  original_filename: string;\n  file_path: string;\n  file_type: 'pdf' | 'image' | 'document' | 'other';\n  mime_type: string;\n}\n\ninterface PatternPreviewProps {\n  patterns: Pattern[];\n  mode?: 'normal' | 'knitting';\n}\n\nexport default function PatternPreview({ patterns, mode = 'normal' }: PatternPreviewProps) {\n  const [selectedPattern, setSelectedPattern] = useState<Pattern | null>(null);\n  const [patternFiles, setPatternFiles] = useState<PatternFile[]>([]);\n  const [selectedFile, setSelectedFile] = useState<PatternFile | null>(null);\n  const [numPages, setNumPages] = useState<number | null>(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [scale, setScale] = useState(1.0);\n  const [loading, setLoading] = useState(false);\n\n  // Auto-select first pattern on mount if available\n  useEffect(() => {\n    if (patterns.length > 0 && !selectedPattern) {\n      setSelectedPattern(patterns[0]);\n    }\n  }, [patterns]);\n\n  // Fetch pattern files when pattern is selected\n  useEffect(() => {\n    if (selectedPattern) {\n      fetchPatternFiles(selectedPattern.id);\n    }\n  }, [selectedPattern]);\n\n  // Auto-select first PDF file when files are loaded\n  useEffect(() => {\n    if (patternFiles.length > 0 && !selectedFile) {\n      const firstPdf = patternFiles.find(f => f.file_type === 'pdf');\n      if (firstPdf) {\n        setSelectedFile(firstPdf);\n      }\n    }\n  }, [patternFiles]);\n\n  const fetchPatternFiles = async (patternId: string) => {\n    try {\n      setLoading(true);\n      const response = await axios.get(`/api/uploads/patterns/${patternId}/files`);\n      const files = response.data.data.files || [];\n      setPatternFiles(files);\n    } catch (error) {\n      console.error('Error fetching pattern files:', error);\n      setPatternFiles([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePatternChange = (patternId: string) => {\n    const pattern = patterns.find(p => p.id === patternId);\n    if (pattern) {\n      setSelectedPattern(pattern);\n      setSelectedFile(null);\n      setPageNumber(1);\n    }\n  };\n\n  const handleFileChange = (fileId: string) => {\n    const file = patternFiles.find(f => f.id === fileId);\n    if (file) {\n      setSelectedFile(file);\n      setPageNumber(1);\n    }\n  };\n\n  const onDocumentLoadSuccess = ({ numPages }: { numPages: number }) => {\n    setNumPages(numPages);\n  };\n\n  const previousPage = () => {\n    setPageNumber(prev => Math.max(prev - 1, 1));\n  };\n\n  const nextPage = () => {\n    setPageNumber(prev => Math.min(prev + 1, numPages || prev));\n  };\n\n  const zoomIn = () => {\n    setScale(prev => Math.min(prev + 0.2, 2.0));\n  };\n\n  const zoomOut = () => {\n    setScale(prev => Math.max(prev - 0.2, 0.5));\n  };\n\n  const pdfFiles = patternFiles.filter(f => f.file_type === 'pdf');\n\n  if (patterns.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\n        <h3 className={`font-semibold text-gray-900 mb-4 ${mode === 'knitting' ? 'text-xl' : 'text-lg'}`}>\n          Pattern Preview\n        </h3>\n        <div className=\"text-center py-8 text-gray-500\">\n          <p>No patterns linked to this project yet.</p>\n          <p className=\"text-sm mt-2\">Add a pattern to see it here.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n      <div className=\"mb-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h3 className={`font-semibold text-gray-900 ${mode === 'knitting' ? 'text-xl' : 'text-lg'}`}>\n            Pattern Preview\n          </h3>\n          {selectedPattern && (\n            <Link\n              to={`/patterns/${selectedPattern.id}`}\n              className=\"text-purple-600 hover:text-purple-700 flex items-center gap-1 text-sm\"\n            >\n              Open Full View <FiExternalLink className=\"h-4 w-4\" />\n            </Link>\n          )}\n        </div>\n\n        {/* Pattern Selector */}\n        <div className=\"space-y-3\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Select Pattern\n            </label>\n            <select\n              value={selectedPattern?.id || ''}\n              onChange={(e) => handlePatternChange(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent\"\n            >\n              {patterns.map((pattern) => (\n                <option key={pattern.id} value={pattern.id}>\n                  {pattern.name} {pattern.designer ? `by ${pattern.designer}` : ''}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* File Selector - Only show if there are PDF files */}\n          {pdfFiles.length > 0 && (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Select PDF File\n              </label>\n              <select\n                value={selectedFile?.id || ''}\n                onChange={(e) => handleFileChange(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent\"\n              >\n                {pdfFiles.map((file) => (\n                  <option key={file.id} value={file.id}>\n                    {file.original_filename}\n                  </option>\n                ))}\n              </select>\n            </div>\n          )}\n        </div>\n\n        {/* Pattern Description */}\n        {selectedPattern?.description && (\n          <div className=\"mt-3 p-3 bg-purple-50 rounded-lg\">\n            <p className=\"text-sm text-gray-700\">{selectedPattern.description}</p>\n          </div>\n        )}\n      </div>\n\n      {/* PDF Viewer */}\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12 bg-gray-50 rounded-lg\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n        </div>\n      ) : selectedFile && selectedFile.file_type === 'pdf' ? (\n        <div className=\"border border-gray-200 rounded-lg overflow-hidden\">\n          {/* PDF Controls */}\n          <div className=\"bg-gray-100 px-4 py-2 flex items-center justify-between border-b border-gray-200\">\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={previousPage}\n                disabled={pageNumber <= 1}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                Previous\n              </button>\n              <span className=\"text-sm text-gray-700\">\n                Page {pageNumber} of {numPages || '?'}\n              </span>\n              <button\n                onClick={nextPage}\n                disabled={pageNumber >= (numPages || 0)}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                Next\n              </button>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={zoomOut}\n                disabled={scale <= 0.5}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                -\n              </button>\n              <span className=\"text-sm text-gray-700\">{Math.round(scale * 100)}%</span>\n              <button\n                onClick={zoomIn}\n                disabled={scale >= 2.0}\n                className=\"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n              >\n                +\n              </button>\n            </div>\n          </div>\n\n          {/* PDF Display */}\n          <div className=\"overflow-auto bg-gray-50\" style={{ maxHeight: mode === 'knitting' ? '600px' : '500px' }}>\n            <Document\n              file={`/api/uploads/patterns/${selectedPattern?.id}/files/${selectedFile.id}/download`}\n              onLoadSuccess={onDocumentLoadSuccess}\n              loading={\n                <div className=\"flex items-center justify-center py-12\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\n                </div>\n              }\n              error={\n                <div className=\"flex items-center justify-center py-12 text-red-600\">\n                  <p>Failed to load PDF. Please try again.</p>\n                </div>\n              }\n            >\n              <Page\n                pageNumber={pageNumber}\n                scale={scale}\n                renderTextLayer={true}\n                renderAnnotationLayer={true}\n              />\n            </Document>\n          </div>\n        </div>\n      ) : pdfFiles.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n          <p className=\"text-gray-500\">No PDF files found for this pattern.</p>\n          {selectedPattern && (\n            <Link\n              to={`/patterns/${selectedPattern.id}`}\n              className=\"inline-block mt-2 text-purple-600 hover:text-purple-700 text-sm\"\n            >\n              Upload a PDF file \n            </Link>\n          )}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport {\n  FiArrowLeft, FiEdit2, FiTrash2, FiCalendar, FiClock, FiCheck, FiImage,\n  FiPlus, FiX, FiUser, FiAlertCircle, FiMic, FiEye, FiEyeOff\n} from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport PhotoGallery from '../components/PhotoGallery';\nimport FileUpload from '../components/FileUpload';\nimport CounterManager from '../components/counters/CounterManager';\nimport { SessionManager, SessionTimer, SessionHistory } from '../components/sessions';\nimport { useWebSocket } from '../contexts/WebSocketContext';\nimport { AudioNotes } from '../components/notes/AudioNotes';\nimport { HandwrittenNotes } from '../components/notes/HandwrittenNotes';\nimport { StructuredMemoTemplates } from '../components/notes/StructuredMemoTemplates';\nimport MagicMarkerManager from '../components/magic-markers/MagicMarkerManager';\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport PatternPreview from '../components/PatternPreview';\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string;\n  project_type: string;\n  status: string;\n  start_date: string;\n  target_completion_date: string;\n  completion_date: string;\n  notes: string;\n  recipient_id?: string;\n  photos: any[];\n  counters: any[];\n  patterns: any[];\n  yarn: any[];\n  tools: any[];\n}\n\nexport default function ProjectDetail() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { joinProject, leaveProject } = useWebSocket();\n\n  const [project, setProject] = useState<Project | null>(null);\n  const [photos, setPhotos] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showEditModal, setShowEditModal] = useState(false);\n\n  // Knitting Mode state\n  const [knittingMode, setKnittingMode] = useState(false);\n  const [showKnittingVoiceNotes, setShowKnittingVoiceNotes] = useState(false);\n  const [showKnittingHistory, setShowKnittingHistory] = useState(false);\n\n  // Notes state\n  const [audioNotes, setAudioNotes] = useState<any[]>([]);\n  const [structuredMemos, setStructuredMemos] = useState<any[]>([]);\n  const [notesTab, setNotesTab] = useState<'audio' | 'handwritten' | 'memos'>('audio');\n  const [editingNotes, setEditingNotes] = useState(false);\n  const [notesText, setNotesText] = useState('');\n\n  // Modal states for adding items\n  const [showAddPatternModal, setShowAddPatternModal] = useState(false);\n  const [showUploadPatternModal, setShowUploadPatternModal] = useState(false);\n  const [showAddYarnModal, setShowAddYarnModal] = useState(false);\n  const [showAddToolModal, setShowAddToolModal] = useState(false);\n\n  // Available items to add\n  const [availablePatterns, setAvailablePatterns] = useState<any[]>([]);\n  const [availableYarn, setAvailableYarn] = useState<any[]>([]);\n  const [availableTools, setAvailableTools] = useState<any[]>([]);\n  const [availableRecipients, setAvailableRecipients] = useState<any[]>([]);\n\n  // Selected items for adding\n  const [selectedPatternId, setSelectedPatternId] = useState('');\n  const [selectedYarnId, setSelectedYarnId] = useState('');\n  const [yarnQuantity, setYarnQuantity] = useState({ skeins: '', yards: '' });\n  const [selectedToolId, setSelectedToolId] = useState('');\n\n  // Pattern upload form\n  const [uploadingPattern, setUploadingPattern] = useState(false);\n  const [newPatternData, setNewPatternData] = useState({\n    name: '',\n    description: '',\n    designer: '',\n    difficulty: 'intermediate',\n  });\n  const [patternFile, setPatternFile] = useState<File | null>(null);\n\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    status: 'active',\n    notes: '',\n    recipientId: '',\n  });\n\n  // Reference for tracking if component is mounted (prevents state updates on unmounted component)\n  const isMountedRef = useRef(true);\n\n  // Reference for tracking if a fetch is in progress (prevents duplicate requests)\n  const isFetchingRef = useRef(false);\n\n  useEffect(() => {\n    isMountedRef.current = true;\n\n    const loadInitialData = async () => {\n      if (isFetchingRef.current) return;\n      isFetchingRef.current = true;\n\n      try {\n        // Load all data in parallel\n        await Promise.all([\n          fetchProject(),\n          fetchPhotos(),\n          fetchAvailableItems(),\n          fetchAudioNotes(),\n          fetchStructuredMemos(),\n        ]);\n      } catch (error) {\n        if (isMountedRef.current) {\n          console.error('Error loading project data:', error);\n        }\n      } finally {\n        isFetchingRef.current = false;\n      }\n    };\n\n    loadInitialData();\n\n    if (id) {\n      joinProject(id);\n    }\n\n    return () => {\n      isMountedRef.current = false;\n      if (id) {\n        leaveProject(id);\n      }\n    };\n  }, [id]);\n\n  // Session and counter state for knitting mode integration\n  const [currentSession, setCurrentSession] = useState<any>(null);\n  const [sessions, setSessions] = useState<any[]>([]);\n\n  useEffect(() => {\n    if (knittingMode) {\n      fetchSessions();\n      checkActiveSession();\n    }\n  }, [knittingMode]);\n\n  const checkActiveSession = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/sessions/active`);\n      if (response.data.success && response.data.data) {\n        setCurrentSession(response.data.data);\n      }\n    } catch (error) {\n      // No active session\n      setCurrentSession(null);\n    }\n  };\n\n  const fetchSessions = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/sessions`);\n      setSessions(response.data.success ? response.data.data.sessions || [] : []);\n    } catch (error) {\n      console.error('Failed to fetch sessions:', error);\n      setSessions([]);\n    }\n  };\n\n  const fetchProject = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}`);\n      const projectData = response.data.data.project;\n      setProject(projectData);\n      setFormData({\n        name: projectData.name,\n        description: projectData.description || '',\n        status: projectData.status || 'active',\n        notes: projectData.notes || '',\n        recipientId: projectData.recipient_id || '',\n      });\n    } catch (error: any) {\n      console.error('Error fetching project:', error);\n      toast.error('Failed to load project');\n      navigate('/projects');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchAvailableItems = async () => {\n    try {\n      const [patternsRes, yarnRes, toolsRes, recipientsRes] = await Promise.all([\n        axios.get('/api/patterns'),\n        axios.get('/api/yarn'),\n        axios.get('/api/tools'),\n        axios.get('/api/recipients'),\n      ]);\n      setAvailablePatterns(patternsRes.data.data.patterns || []);\n      setAvailableYarn(yarnRes.data.data.yarn || []);\n      setAvailableTools(toolsRes.data.data.tools || []);\n      setAvailableRecipients(recipientsRes.data.data.recipients || []);\n    } catch (error) {\n      console.error('Error fetching available items:', error);\n    }\n  };\n\n  const handleUpdate = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    try {\n      await axios.put(`/api/projects/${id}`, formData);\n      toast.success('Project updated successfully!');\n      setShowEditModal(false);\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error updating project:', error);\n      toast.error('Failed to update project');\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!confirm(`Are you sure you want to delete \"${project?.name}\"?`)) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/projects/${id}`);\n      toast.success('Project deleted successfully');\n      navigate('/projects');\n    } catch (error: any) {\n      console.error('Error deleting project:', error);\n      toast.error('Failed to delete project');\n    }\n  };\n\n  const handleEditNotes = () => {\n    setNotesText(project?.notes || '');\n    setEditingNotes(true);\n  };\n\n  const handleSaveNotes = async () => {\n    try {\n      await axios.put(`/api/projects/${id}`, {\n        name: project?.name,\n        description: project?.description,\n        status: project?.status,\n        notes: notesText,\n      });\n      toast.success('Notes saved successfully!');\n      setEditingNotes(false);\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error saving notes:', error);\n      toast.error('Failed to save notes');\n    }\n  };\n\n  const handleCancelNotes = () => {\n    setNotesText('');\n    setEditingNotes(false);\n  };\n\n  // Pattern management\n  const handleAddPattern = async () => {\n    if (!selectedPatternId) {\n      toast.error('Please select a pattern');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/patterns`, {\n        patternId: selectedPatternId,\n      });\n      toast.success('Pattern added to project!');\n      setShowAddPatternModal(false);\n      setSelectedPatternId('');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error adding pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to add pattern');\n    }\n  };\n\n  const handleRemovePattern = async (patternId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/patterns/${patternId}`);\n      toast.success('Pattern removed from project');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error removing pattern:', error);\n      toast.error('Failed to remove pattern');\n    }\n  };\n\n  // Upload new pattern directly from project\n  const handleUploadPattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!patternFile) {\n      toast.error('Please select a pattern file to upload');\n      return;\n    }\n\n    if (!newPatternData.name.trim()) {\n      toast.error('Please enter a pattern name');\n      return;\n    }\n\n    setUploadingPattern(true);\n\n    try {\n      // Step 1: Create the pattern\n      const createResponse = await axios.post('/api/patterns', newPatternData);\n      const newPattern = createResponse.data.data.pattern;\n      toast.success('Pattern created!');\n\n      // Step 2: Upload the file to the pattern\n      const fileFormData = new FormData();\n      fileFormData.append('file', patternFile);\n      fileFormData.append('description', 'Pattern file');\n\n      await axios.post(`/api/uploads/patterns/${newPattern.id}/files`, fileFormData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('File uploaded!');\n\n      // Step 3: Link the pattern to the project\n      await axios.post(`/api/projects/${id}/patterns`, {\n        patternId: newPattern.id,\n      });\n      toast.success('Pattern added to project!');\n\n      // Reset form and close modal\n      setShowUploadPatternModal(false);\n      setNewPatternData({\n        name: '',\n        description: '',\n        designer: '',\n        difficulty: 'intermediate',\n      });\n      setPatternFile(null);\n      fetchProject();\n      fetchAvailableItems();\n    } catch (error: any) {\n      console.error('Error uploading pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to upload pattern');\n    } finally {\n      setUploadingPattern(false);\n    }\n  };\n\n  // Yarn management\n  const handleAddYarn = async () => {\n    if (!selectedYarnId) {\n      toast.error('Please select yarn');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/yarn`, {\n        yarnId: selectedYarnId,\n        skeinsUsed: yarnQuantity.skeins ? parseFloat(yarnQuantity.skeins) : undefined,\n        yardsUsed: yarnQuantity.yards ? parseFloat(yarnQuantity.yards) : undefined,\n      });\n      toast.success('Yarn added to project! Stash has been updated.');\n      setShowAddYarnModal(false);\n      setSelectedYarnId('');\n      setYarnQuantity({ skeins: '', yards: '' });\n      fetchProject();\n      fetchAvailableItems(); // Refresh to show updated yarn quantities\n    } catch (error: any) {\n      console.error('Error adding yarn:', error);\n      toast.error(error.response?.data?.message || 'Failed to add yarn');\n    }\n  };\n\n  const handleRemoveYarn = async (yarnId: string) => {\n    if (!confirm('Remove this yarn? The used amount will be restored to your stash.')) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/projects/${id}/yarn/${yarnId}`);\n      toast.success('Yarn removed and restored to stash');\n      fetchProject();\n      fetchAvailableItems(); // Refresh to show updated yarn quantities\n    } catch (error: any) {\n      console.error('Error removing yarn:', error);\n      toast.error('Failed to remove yarn');\n    }\n  };\n\n  // Tool management\n  const handleAddTool = async () => {\n    if (!selectedToolId) {\n      toast.error('Please select a tool');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/tools`, {\n        toolId: selectedToolId,\n      });\n      toast.success('Tool added to project!');\n      setShowAddToolModal(false);\n      setSelectedToolId('');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error adding tool:', error);\n      toast.error(error.response?.data?.message || 'Failed to add tool');\n    }\n  };\n\n  const handleRemoveTool = async (toolId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/tools/${toolId}`);\n      toast.success('Tool removed from project');\n      fetchProject();\n    } catch (error: any) {\n      console.error('Error removing tool:', error);\n      toast.error('Failed to remove tool');\n    }\n  };\n\n  const fetchPhotos = async () => {\n    try {\n      const response = await axios.get(`/api/uploads/projects/${id}/photos`);\n      setPhotos(response.data.data.photos);\n    } catch (error: any) {\n      console.error('Error fetching photos:', error);\n    }\n  };\n\n  const fetchAudioNotes = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/audio-notes`);\n      setAudioNotes(response.data.data.audioNotes || []);\n    } catch (error: any) {\n      console.error('Error fetching audio notes:', error);\n    }\n  };\n\n  const fetchStructuredMemos = async () => {\n    try {\n      const response = await axios.get(`/api/projects/${id}/structured-memos`);\n      setStructuredMemos(response.data.data.memos || []);\n    } catch (error: any) {\n      console.error('Error fetching structured memos:', error);\n    }\n  };\n\n  const handleSaveAudioNote = async (audioBlob: Blob, durationSeconds: number, transcription?: string) => {\n    const formData = new FormData();\n    formData.append('audio', audioBlob, 'audio-note.webm');\n    formData.append('durationSeconds', durationSeconds.toString());\n    if (transcription) {\n      formData.append('transcription', transcription);\n    }\n\n    try {\n      await axios.post(`/api/projects/${id}/audio-notes`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('Audio note saved!');\n      fetchAudioNotes();\n    } catch (error: any) {\n      console.error('Error saving audio note:', error);\n      toast.error('Failed to save audio note');\n      throw error;\n    }\n  };\n\n  const handleDeleteAudioNote = async (noteId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/audio-notes/${noteId}`);\n      toast.success('Audio note deleted');\n      fetchAudioNotes();\n    } catch (error: any) {\n      console.error('Error deleting audio note:', error);\n      toast.error('Failed to delete audio note');\n      throw error;\n    }\n  };\n\n  const handleUpdateAudioTranscription = async (noteId: string, transcription: string) => {\n    try {\n      await axios.put(`/api/projects/${id}/audio-notes/${noteId}`, { transcription });\n      toast.success('Transcription updated');\n      fetchAudioNotes();\n    } catch (error: any) {\n      console.error('Error updating transcription:', error);\n      toast.error('Failed to update transcription');\n      throw error;\n    }\n  };\n\n  const handleSaveStructuredMemo = async (templateType: string, data: any) => {\n    try {\n      await axios.post(`/api/projects/${id}/structured-memos`, {\n        templateType,\n        data,\n      });\n      toast.success('Memo saved!');\n      fetchStructuredMemos();\n    } catch (error: any) {\n      console.error('Error saving memo:', error);\n      toast.error('Failed to save memo');\n      throw error;\n    }\n  };\n\n  const handleDeleteStructuredMemo = async (memoId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/structured-memos/${memoId}`);\n      toast.success('Memo deleted');\n      fetchStructuredMemos();\n    } catch (error: any) {\n      console.error('Error deleting memo:', error);\n      toast.error('Failed to delete memo');\n      throw error;\n    }\n  };\n\n  const handleToggleKnittingMode = () => {\n    setKnittingMode(!knittingMode);\n    if (!knittingMode) {\n      toast.success('Knitting Mode activated! ');\n    } else {\n      toast.info('Knitting Mode deactivated');\n    }\n  };\n\n  // Get current counter values for session tracking\n  const getCurrentCounterValues = () => {\n    const counterValues: Record<string, number> = {};\n    if (project?.counters) {\n      project.counters.forEach((counter: any) => {\n        counterValues[counter.id] = counter.current_count || 0;\n      });\n    }\n    return counterValues;\n  };\n\n  const handleStartSession = async (): Promise<any> => {\n    try {\n      const response = await axios.post(`/api/projects/${id}/sessions/start`, {\n        mood: undefined,\n        location: undefined,\n        notes: 'Knitting session',\n      });\n      const newSession = response.data.success ? response.data.data.session : response.data;\n      setCurrentSession(newSession);\n      await fetchSessions();\n      toast.success('Knitting session started! ');\n      return newSession;\n    } catch (error) {\n      console.error('Failed to start session:', error);\n      toast.error('Failed to start session');\n      throw error;\n    }\n  };\n\n  const handleEndSession = async (notes?: string, mood?: string) => {\n    if (!currentSession) return;\n\n    try {\n      await axios.post(`/api/projects/${id}/sessions/${currentSession.id}/end`, {\n        notes,\n        mood,\n      });\n      setCurrentSession(null);\n      await fetchSessions();\n      toast.success('Session ended and saved!');\n    } catch (error) {\n      console.error('Failed to end session:', error);\n      toast.error('Failed to end session');\n      throw error;\n    }\n  };\n\n  const handleDeleteSession = async (sessionId: string) => {\n    try {\n      await axios.delete(`/api/projects/${id}/sessions/${sessionId}`);\n      await fetchSessions();\n      toast.success('Session deleted');\n    } catch (error) {\n      console.error('Failed to delete session:', error);\n      toast.error('Failed to delete session');\n    }\n  };\n\n  const handlePhotoUpload = async (file: File) => {\n    const formData = new FormData();\n    formData.append('photo', file);\n\n    try {\n      await axios.post(`/api/uploads/projects/${id}/photos`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('Photo uploaded successfully!');\n      fetchPhotos();\n    } catch (error: any) {\n      console.error('Error uploading photo:', error);\n      toast.error('Failed to upload photo');\n      throw error;\n    }\n  };\n\n  const handlePhotoDelete = async (photoId: string) => {\n    try {\n      await axios.delete(`/api/uploads/projects/${id}/photos/${photoId}`);\n      toast.success('Photo deleted successfully');\n      fetchPhotos();\n    } catch (error: any) {\n      console.error('Error deleting photo:', error);\n      toast.error('Failed to delete photo');\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    if (!dateString) return 'Not set';\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active':\n        return 'bg-green-100 text-green-800';\n      case 'completed':\n        return 'bg-blue-100 text-blue-800';\n      case 'paused':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'planned':\n        return 'bg-gray-100 text-gray-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getYarnPercentage = (y: any) => {\n    const remaining = y.yarn_remaining || 0;\n    const total = y.yarn_total || 1;\n    return Math.max(0, Math.min(100, (remaining / total) * 100));\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <LoadingSpinner size=\"lg\" text=\"Loading project...\" />\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-gray-500\">Project not found</p>\n        <Link to=\"/projects\" className=\"text-purple-600 hover:text-purple-700 mt-4 inline-block\">\n          Back to Projects\n        </Link>\n      </div>\n    );\n  }\n\n  const selectedRecipient = availableRecipients.find(r => r.id === formData.recipientId);\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"mb-6\">\n        <Link\n          to=\"/projects\"\n          className=\"inline-flex items-center text-purple-600 hover:text-purple-700 mb-4\"\n        >\n          <FiArrowLeft className=\"mr-2\" />\n          Back to Projects\n        </Link>\n\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-3 mb-2\">\n              <h1 className=\"text-3xl font-bold text-gray-900\">{project.name}</h1>\n              <span\n                className={`px-3 py-1 text-sm font-medium rounded-full ${getStatusColor(\n                  project.status\n                )}`}\n              >\n                {project.status}\n              </span>\n            </div>\n            {project.project_type && (\n              <p className=\"text-gray-600\">Type: {project.project_type}</p>\n            )}\n            {selectedRecipient && (\n              <p className=\"text-gray-600 flex items-center mt-1\">\n                <FiUser className=\"mr-2 h-4 w-4\" />\n                Gift for: {selectedRecipient.first_name} {selectedRecipient.last_name}\n              </p>\n            )}\n          </div>\n\n          <div className=\"flex gap-2 flex-wrap\">\n            <button\n              onClick={handleToggleKnittingMode}\n              className={`px-4 py-3 md:py-2 rounded-lg transition flex items-center min-h-[48px] md:min-h-0 ${\n                knittingMode\n                  ? 'bg-green-600 text-white hover:bg-green-700'\n                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n              }`}\n            >\n              {knittingMode ? <FiEyeOff className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" /> : <FiEye className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />}\n              <span className=\"text-base md:text-sm\">{knittingMode ? 'Exit Knitting Mode' : 'Knitting Mode'}</span>\n            </button>\n            <button\n              onClick={() => setShowEditModal(true)}\n              className=\"px-4 py-3 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center min-h-[48px] md:min-h-0\"\n            >\n              <FiEdit2 className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Edit</span>\n            </button>\n            <button\n              onClick={handleDelete}\n              className=\"px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition flex items-center min-h-[48px] md:min-h-0\"\n            >\n              <FiTrash2 className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Delete</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Knitting Mode - Full Featured UI */}\n      {knittingMode ? (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n          {/* Main Content - Left Column */}\n          <div className=\"lg:col-span-2 space-y-4 md:space-y-6\">\n            {/* Pattern Preview - Knitting Mode */}\n            {project.patterns && project.patterns.length > 0 && (\n              <PatternPreview\n                patterns={project.patterns}\n                mode=\"knitting\"\n              />\n            )}\n\n            {/* Counters - Large Display */}\n            <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n              <h2 className=\"text-xl md:text-2xl font-bold text-gray-900 mb-4 md:mb-6\">Active Counters</h2>\n              <CounterManager projectId={id!} />\n            </div>\n          </div>\n\n          {/* Sidebar - Right Column */}\n          <div className=\"space-y-4 md:space-y-6\">\n            {/* Session Timer with Row Tracking */}\n            <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-lg md:text-xl font-bold text-gray-900\">Session Timer</h2>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setShowKnittingVoiceNotes(!showKnittingVoiceNotes)}\n                    className={`p-2 rounded-lg transition ${\n                      showKnittingVoiceNotes\n                        ? 'bg-purple-600 text-white'\n                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                    }`}\n                    title=\"Voice Notes\"\n                  >\n                    <FiMic className=\"h-4 w-4\" />\n                  </button>\n                  <button\n                    onClick={() => setShowKnittingHistory(!showKnittingHistory)}\n                    className={`p-2 rounded-lg transition ${\n                      showKnittingHistory\n                        ? 'bg-purple-600 text-white'\n                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                    }`}\n                    title=\"History\"\n                  >\n                    <FiClock className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              </div>\n              <SessionTimer\n                projectId={id!}\n                currentSession={currentSession}\n                onStartSession={handleStartSession}\n                onEndSession={handleEndSession}\n                getCurrentCounterValues={getCurrentCounterValues}\n              />\n            </div>\n\n            {/* Voice Notes - Embedded in Knitting Mode */}\n            {showKnittingVoiceNotes && (\n              <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n                <h2 className=\"text-lg md:text-xl font-bold text-gray-900 mb-4\">Voice Notes</h2>\n                <AudioNotes\n                  projectId={id!}\n                  notes={audioNotes}\n                  onSaveNote={handleSaveAudioNote}\n                  onDeleteNote={handleDeleteAudioNote}\n                  onUpdateTranscription={handleUpdateAudioTranscription}\n                />\n              </div>\n            )}\n\n            {/* Session History - Embedded in Knitting Mode */}\n            {showKnittingHistory && sessions.length > 0 && (\n              <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6\">\n                <h2 className=\"text-lg md:text-xl font-bold text-gray-900 mb-4\">Session History</h2>\n                <SessionHistory sessions={sessions} onDeleteSession={handleDeleteSession} />\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        <>\n          {/* Normal Mode - Project Details Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n        {/* Main Content - Left Column */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Description */}\n          {project.description && (\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-3\">Description</h2>\n              <p className=\"text-gray-700 whitespace-pre-wrap\">{project.description}</p>\n            </div>\n          )}\n\n          {/* Pattern Preview Section - Normal Mode */}\n          {project.patterns && project.patterns.length > 0 && (\n            <PatternPreview\n              patterns={project.patterns}\n              mode=\"normal\"\n            />\n          )}\n\n          {/* Photos */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center mb-4\">\n              <FiImage className=\"h-5 w-5 text-purple-600 mr-2\" />\n              <h2 className=\"text-lg font-semibold text-gray-900\">Project Photos</h2>\n              <span className=\"ml-2 text-sm text-gray-500\">({photos.length})</span>\n            </div>\n\n            <div className=\"mb-6\">\n              <FileUpload onUpload={handlePhotoUpload} />\n            </div>\n\n            <PhotoGallery photos={photos} onDelete={handlePhotoDelete} />\n          </div>\n\n          {/* Counters */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Counters</h2>\n            <CounterManager projectId={id!} />\n          </div>\n\n          {/* Magic Markers */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <MagicMarkerManager\n              projectId={id!}\n              counters={project?.counters || []}\n            />\n          </div>\n\n          {/* Session Management */}\n          <SessionManager\n            projectId={id!}\n            totalRows={0} // TODO: Get from project or pattern\n            getCurrentCounterValues={() => {\n              // Get counter values from CounterManager\n              // This is a placeholder - you may need to lift state up or use context\n              return {};\n            }}\n          />\n\n          {/* Notes Section with Tabs */}\n          <div id=\"notes-section\" className=\"bg-white rounded-lg shadow\">\n            <div className=\"border-b border-gray-200 px-6 pt-6\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Notes</h2>\n              <nav className=\"flex -mb-px gap-6\">\n                <button\n                  onClick={() => setNotesTab('audio')}\n                  className={`pb-3 text-sm font-medium border-b-2 ${\n                    notesTab === 'audio'\n                      ? 'border-purple-600 text-purple-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Audio Notes\n                </button>\n                <button\n                  onClick={() => setNotesTab('handwritten')}\n                  className={`pb-3 text-sm font-medium border-b-2 ${\n                    notesTab === 'handwritten'\n                      ? 'border-purple-600 text-purple-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Handwritten\n                </button>\n                <button\n                  onClick={() => setNotesTab('memos')}\n                  className={`pb-3 text-sm font-medium border-b-2 ${\n                    notesTab === 'memos'\n                      ? 'border-purple-600 text-purple-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Structured Memos\n                </button>\n              </nav>\n            </div>\n\n            <div className=\"p-6\">\n              {notesTab === 'audio' && (\n                <AudioNotes\n                  projectId={id!}\n                  notes={audioNotes}\n                  onSaveNote={handleSaveAudioNote}\n                  onDeleteNote={handleDeleteAudioNote}\n                  onUpdateTranscription={handleUpdateAudioTranscription}\n                />\n              )}\n\n              {notesTab === 'handwritten' && (\n                <HandwrittenNotes\n                  projectId={id!}\n                  onSave={async (imageData) => {\n                    try {\n                      // Convert base64 to blob\n                      const response = await fetch(imageData);\n                      const blob = await response.blob();\n\n                      const formData = new FormData();\n                      formData.append('image', blob, 'handwritten-note.png');\n\n                      await axios.post(`/api/projects/${id}/handwritten-notes`, formData, {\n                        headers: {\n                          'Content-Type': 'multipart/form-data',\n                        },\n                      });\n                      toast.success('Handwritten note saved!');\n                    } catch (error) {\n                      console.error('Error saving handwritten note:', error);\n                      throw error;\n                    }\n                  }}\n                />\n              )}\n\n              {notesTab === 'memos' && (\n                <StructuredMemoTemplates\n                  projectId={id!}\n                  memos={structuredMemos}\n                  onSaveMemo={handleSaveStructuredMemo}\n                  onDeleteMemo={handleDeleteStructuredMemo}\n                />\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Sidebar - Right Column */}\n        <div className=\"space-y-6\">\n          {/* Timeline */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Timeline</h2>\n            <div className=\"space-y-3\">\n              {project.start_date && (\n                <div className=\"flex items-start\">\n                  <FiCalendar className=\"mt-1 mr-3 h-5 w-5 text-gray-400\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Started</p>\n                    <p className=\"text-sm text-gray-600\">{formatDate(project.start_date)}</p>\n                  </div>\n                </div>\n              )}\n              {project.target_completion_date && (\n                <div className=\"flex items-start\">\n                  <FiClock className=\"mt-1 mr-3 h-5 w-5 text-gray-400\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Target Completion</p>\n                    <p className=\"text-sm text-gray-600\">\n                      {formatDate(project.target_completion_date)}\n                    </p>\n                  </div>\n                </div>\n              )}\n              {project.completion_date && (\n                <div className=\"flex items-start\">\n                  <FiCheck className=\"mt-1 mr-3 h-5 w-5 text-green-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Completed</p>\n                    <p className=\"text-sm text-gray-600\">{formatDate(project.completion_date)}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Notes */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Notes</h2>\n              {!editingNotes && (\n                <button\n                  onClick={handleEditNotes}\n                  className=\"text-purple-600 hover:text-purple-700\"\n                  title=\"Edit notes\"\n                >\n                  <FiEdit2 className=\"h-4 w-4\" />\n                </button>\n              )}\n            </div>\n\n            {editingNotes ? (\n              <div className=\"space-y-3\">\n                <textarea\n                  value={notesText}\n                  onChange={(e) => setNotesText(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm\"\n                  rows={6}\n                  placeholder=\"Add notes about your project...\"\n                />\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={handleSaveNotes}\n                    className=\"flex-1 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm flex items-center justify-center gap-2\"\n                  >\n                    <FiCheck className=\"h-4 w-4\" />\n                    Save\n                  </button>\n                  <button\n                    onClick={handleCancelNotes}\n                    className=\"flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm flex items-center justify-center gap-2\"\n                  >\n                    <FiX className=\"h-4 w-4\" />\n                    Cancel\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div>\n                {project.notes ? (\n                  <p className=\"text-sm text-gray-700 whitespace-pre-wrap\">{project.notes}</p>\n                ) : (\n                  <p className=\"text-sm text-gray-500 italic\">No notes added yet</p>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Patterns */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Patterns</h2>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => setShowAddPatternModal(true)}\n                  className=\"text-purple-600 hover:text-purple-700 text-xs flex items-center gap-1\"\n                  title=\"Select existing pattern\"\n                >\n                  <FiPlus className=\"h-4 w-4\" />\n                  Select\n                </button>\n                <button\n                  onClick={() => setShowUploadPatternModal(true)}\n                  className=\"px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 flex items-center gap-1\"\n                  title=\"Upload new pattern\"\n                >\n                  <FiPlus className=\"h-3 w-3\" />\n                  Upload\n                </button>\n              </div>\n            </div>\n\n            {project.patterns && project.patterns.length > 0 ? (\n              <ul className=\"space-y-2\">\n                {project.patterns.map((pattern: any) => (\n                  <li key={pattern.id} className=\"flex items-center justify-between text-sm\">\n                    <Link\n                      to={`/patterns/${pattern.id}`}\n                      className=\"text-purple-600 hover:text-purple-700 flex-1\"\n                    >\n                      {pattern.name}\n                    </Link>\n                    <button\n                      onClick={() => handleRemovePattern(pattern.id)}\n                      className=\"text-red-600 hover:text-red-700 ml-2\"\n                      title=\"Remove pattern\"\n                    >\n                      <FiX className=\"h-4 w-4\" />\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <p className=\"text-sm text-gray-500\">No patterns added</p>\n            )}\n          </div>\n\n          {/* Tools */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">Tools</h2>\n              <button\n                onClick={() => setShowAddToolModal(true)}\n                className=\"text-purple-600 hover:text-purple-700\"\n                title=\"Add tool\"\n              >\n                <FiPlus className=\"h-5 w-5\" />\n              </button>\n            </div>\n\n            {project.tools && project.tools.length > 0 ? (\n              <ul className=\"space-y-2\">\n                {project.tools.map((tool: any) => (\n                  <li key={tool.id} className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-gray-700 flex-1\">\n                      {tool.name}\n                      {tool.size && <span className=\"text-gray-500\"> ({tool.size})</span>}\n                    </span>\n                    <button\n                      onClick={() => handleRemoveTool(tool.id)}\n                      className=\"text-red-600 hover:text-red-700 ml-2\"\n                      title=\"Remove tool\"\n                    >\n                      <FiX className=\"h-4 w-4\" />\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <p className=\"text-sm text-gray-500\">No tools added</p>\n            )}\n          </div>\n\n          {/* Yarn Usage */}\n          {project.yarn && project.yarn.length > 0 ? (\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Yarn Usage</h2>\n                <button\n                  onClick={() => setShowAddYarnModal(true)}\n                  className=\"text-purple-600 hover:text-purple-700\"\n                  title=\"Add yarn\"\n                >\n                  <FiPlus className=\"h-5 w-5\" />\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                {project.yarn.map((y: any) => {\n                  const percentage = getYarnPercentage(y);\n                  const isLowStock = y.low_stock_alert && y.yards_remaining <= (y.low_stock_threshold || 0);\n\n                  return (\n                    <div key={y.id} className=\"border border-gray-200 rounded-lg p-3\">\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div className=\"flex-1\">\n                          <h3 className=\"text-sm font-medium text-gray-900\">\n                            {y.brand} {y.name}\n                            {y.color && <span className=\"text-gray-600\"> - {y.color}</span>}\n                          </h3>\n                          <p className=\"text-xs text-gray-500\">{y.weight}</p>\n                        </div>\n                        <button\n                          onClick={() => handleRemoveYarn(y.id)}\n                          className=\"text-red-600 hover:text-red-700 p-1\"\n                          title=\"Remove yarn\"\n                        >\n                          <FiX className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n\n                      {/* Usage Stats */}\n                      <div className=\"space-y-2 mb-3\">\n                        <div>\n                          <p className=\"text-xs text-gray-500\">Used in Project</p>\n                          <p className=\"text-xs font-medium text-gray-900\">\n                            {y.skeins_used || 0} skeins, {y.yards_used || 0} yds\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-xs text-gray-500\">Remaining in Stash</p>\n                          <p className=\"text-xs font-medium text-gray-900\">\n                            {y.skeins_remaining || 0} skeins, {y.yards_remaining || 0} yds\n                          </p>\n                        </div>\n                      </div>\n\n                      {/* Progress Bar */}\n                      <div className=\"mb-2\">\n                        <div className=\"flex items-center justify-between text-xs text-gray-600 mb-1\">\n                          <span>Stash Level</span>\n                          <span>{percentage.toFixed(0)}%</span>\n                        </div>\n                        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                          <div\n                            className={`h-2 rounded-full transition-all ${\n                              percentage < 20 ? 'bg-red-500' : percentage < 50 ? 'bg-yellow-500' : 'bg-green-500'\n                            }`}\n                            style={{ width: `${percentage}%` }}\n                          />\n                        </div>\n                      </div>\n\n                      {/* Low Stock Warning */}\n                      {isLowStock && (\n                        <div className=\"flex items-center text-orange-600 text-xs mt-2\">\n                          <FiAlertCircle className=\"mr-1 h-3 w-3\" />\n                          Low stock! Only {y.yards_remaining} yards remaining\n                        </div>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          ) : (\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Yarn Usage</h2>\n                <button\n                  onClick={() => setShowAddYarnModal(true)}\n                  className=\"text-purple-600 hover:text-purple-700\"\n                  title=\"Add yarn\"\n                >\n                  <FiPlus className=\"h-5 w-5\" />\n                </button>\n              </div>\n              <p className=\"text-sm text-gray-500\">No yarn added</p>\n            </div>\n          )}\n        </div>\n      </div>\n        </>\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Project</h2>\n            </div>\n\n            <form onSubmit={handleUpdate} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Project Name\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Status</label>\n                  <select\n                    value={formData.status}\n                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"planned\">Planned</option>\n                    <option value=\"active\">Active</option>\n                    <option value=\"paused\">Paused</option>\n                    <option value=\"completed\">Completed</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Gift Recipient (Optional)\n                  </label>\n                  <select\n                    value={formData.recipientId}\n                    onChange={(e) => setFormData({ ...formData, recipientId: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"\">None</option>\n                    {availableRecipients.map((r) => (\n                      <option key={r.id} value={r.id}>\n                        {r.first_name} {r.last_name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={5}\n                  placeholder=\"Add notes about your project...\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowEditModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Save Changes\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Add Pattern Modal */}\n      {showAddPatternModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Add Pattern to Project</h2>\n            </div>\n\n            <div className=\"p-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Select Pattern\n              </label>\n              <select\n                value={selectedPatternId}\n                onChange={(e) => setSelectedPatternId(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4\"\n              >\n                <option value=\"\">Choose a pattern...</option>\n                {availablePatterns\n                  .filter(p => !project?.patterns?.some((pp: any) => pp.id === p.id))\n                  .map((pattern) => (\n                    <option key={pattern.id} value={pattern.id}>\n                      {pattern.name}\n                      {pattern.designer && ` by ${pattern.designer}`}\n                    </option>\n                  ))}\n              </select>\n\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => {\n                    setShowAddPatternModal(false);\n                    setSelectedPatternId('');\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleAddPattern}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Pattern\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Upload New Pattern Modal */}\n      {showUploadPatternModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Upload New Pattern</h2>\n              <p className=\"text-sm text-gray-600 mt-1\">Upload a PDF pattern and add it to this project</p>\n            </div>\n\n            <form onSubmit={handleUploadPattern} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={newPatternData.name}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Cable Knit Sweater\"\n                  required\n                  disabled={uploadingPattern}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Designer\n                </label>\n                <input\n                  type=\"text\"\n                  value={newPatternData.designer}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, designer: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Jane Doe\"\n                  disabled={uploadingPattern}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Difficulty\n                </label>\n                <select\n                  value={newPatternData.difficulty}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, difficulty: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  disabled={uploadingPattern}\n                >\n                  <option value=\"beginner\">Beginner</option>\n                  <option value=\"intermediate\">Intermediate</option>\n                  <option value=\"advanced\">Advanced</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={newPatternData.description}\n                  onChange={(e) => setNewPatternData({ ...newPatternData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Brief description of the pattern...\"\n                  disabled={uploadingPattern}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern File (PDF) *\n                </label>\n                <input\n                  type=\"file\"\n                  accept=\".pdf,application/pdf\"\n                  onChange={(e) => setPatternFile(e.target.files?.[0] || null)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100\"\n                  required\n                  disabled={uploadingPattern}\n                />\n                {patternFile && (\n                  <p className=\"text-sm text-gray-600 mt-2\">\n                    Selected: {patternFile.name} ({(patternFile.size / 1024 / 1024).toFixed(2)} MB)\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowUploadPatternModal(false);\n                    setNewPatternData({\n                      name: '',\n                      description: '',\n                      designer: '',\n                      difficulty: 'intermediate',\n                    });\n                    setPatternFile(null);\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                  disabled={uploadingPattern}\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed\"\n                  disabled={uploadingPattern}\n                >\n                  {uploadingPattern ? 'Uploading...' : 'Upload & Add to Project'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Add Yarn Modal */}\n      {showAddYarnModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Add Yarn to Project</h2>\n            </div>\n\n            <div className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Select Yarn\n                </label>\n                <select\n                  value={selectedYarnId}\n                  onChange={(e) => setSelectedYarnId(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                >\n                  <option value=\"\">Choose yarn...</option>\n                  {availableYarn\n                    .filter(y => y.skeins_remaining > 0)\n                    .map((yarn) => (\n                      <option key={yarn.id} value={yarn.id}>\n                        {yarn.brand} {yarn.name} - {yarn.color}\n                        ({yarn.skeins_remaining} skeins, {yarn.yards_remaining} yds available)\n                      </option>\n                    ))}\n                </select>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Skeins to Use\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={yarnQuantity.skeins}\n                    onChange={(e) => setYarnQuantity({ ...yarnQuantity, skeins: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"0\"\n                    min=\"0\"\n                    step=\"0.1\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yards to Use\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={yarnQuantity.yards}\n                    onChange={(e) => setYarnQuantity({ ...yarnQuantity, yards: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"0\"\n                    min=\"0\"\n                    step=\"1\"\n                  />\n                </div>\n              </div>\n\n              <p className=\"text-sm text-gray-500\">\n                The specified amount will be deducted from your stash automatically.\n              </p>\n\n              <div className=\"flex gap-3 pt-2\">\n                <button\n                  onClick={() => {\n                    setShowAddYarnModal(false);\n                    setSelectedYarnId('');\n                    setYarnQuantity({ skeins: '', yards: '' });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleAddYarn}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Yarn\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Add Tool Modal */}\n      {showAddToolModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-xl font-bold text-gray-900\">Add Tool to Project</h2>\n            </div>\n\n            <div className=\"p-6\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Select Tool\n              </label>\n              <select\n                value={selectedToolId}\n                onChange={(e) => setSelectedToolId(e.target.value)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4\"\n              >\n                <option value=\"\">Choose a tool...</option>\n                {availableTools\n                  .filter(t => !project?.tools?.some((pt: any) => pt.id === t.id))\n                  .map((tool) => (\n                    <option key={tool.id} value={tool.id}>\n                      {tool.name}\n                      {tool.size && ` (${tool.size})`}\n                      {tool.type && ` - ${tool.type}`}\n                    </option>\n                  ))}\n              </select>\n\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => {\n                    setShowAddToolModal(false);\n                    setSelectedToolId('');\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleAddTool}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Tool\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiBookmark, FiPlus, FiX, FiEdit2, FiTrash2, FiChevronRight } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Bookmark {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  name: string;\n  page_number: number;\n  y_position: number | null;\n  zoom_level: number;\n  notes: string | null;\n  color: string;\n  sort_order: number;\n  created_at: string;\n}\n\ninterface BookmarkManagerProps {\n  patternId: string;\n  projectId?: string;\n  currentPage?: number;\n  currentZoom?: number;\n  onJumpToBookmark: (bookmark: Bookmark) => void;\n}\n\nconst BOOKMARK_COLORS = [\n  { name: 'Yellow', value: '#FBBF24' },\n  { name: 'Red', value: '#EF4444' },\n  { name: 'Blue', value: '#3B82F6' },\n  { name: 'Green', value: '#10B981' },\n  { name: 'Purple', value: '#8B5CF6' },\n  { name: 'Pink', value: '#EC4899' },\n];\n\nexport default function BookmarkManager({\n  patternId,\n  projectId,\n  currentPage = 1,\n  currentZoom = 1.0,\n  onJumpToBookmark,\n}: BookmarkManagerProps) {\n  const [bookmarks, setBookmarks] = useState<Bookmark[]>([]);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [editingBookmark, setEditingBookmark] = useState<Bookmark | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    pageNumber: currentPage,\n    notes: '',\n    color: '#FBBF24',\n  });\n\n  useEffect(() => {\n    fetchBookmarks();\n  }, [patternId, projectId]);\n\n  const fetchBookmarks = async () => {\n    try {\n      const params = projectId ? { projectId } : {};\n      const response = await axios.get(`/api/patterns/${patternId}/bookmarks`, { params });\n      setBookmarks(response.data.data.bookmarks);\n    } catch (error) {\n      console.error('Error fetching bookmarks:', error);\n    }\n  };\n\n  const handleCreateBookmark = async () => {\n    if (!formData.name.trim()) {\n      toast.error('Please enter a bookmark name');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/patterns/${patternId}/bookmarks`, {\n        name: formData.name,\n        pageNumber: formData.pageNumber,\n        zoomLevel: currentZoom,\n        notes: formData.notes || null,\n        color: formData.color,\n        projectId: projectId || null,\n      });\n\n      toast.success('Bookmark created!');\n      setShowCreateModal(false);\n      resetForm();\n      fetchBookmarks();\n    } catch (error: any) {\n      console.error('Error creating bookmark:', error);\n      toast.error(error.response?.data?.message || 'Failed to create bookmark');\n    }\n  };\n\n  const handleUpdateBookmark = async () => {\n    if (!editingBookmark) return;\n\n    try {\n      await axios.put(`/api/patterns/${patternId}/bookmarks/${editingBookmark.id}`, {\n        name: formData.name,\n        pageNumber: formData.pageNumber,\n        notes: formData.notes || null,\n        color: formData.color,\n      });\n\n      toast.success('Bookmark updated!');\n      setEditingBookmark(null);\n      resetForm();\n      fetchBookmarks();\n    } catch (error: any) {\n      console.error('Error updating bookmark:', error);\n      toast.error(error.response?.data?.message || 'Failed to update bookmark');\n    }\n  };\n\n  const handleDeleteBookmark = async (bookmarkId: string) => {\n    if (!confirm('Delete this bookmark?')) return;\n\n    try {\n      await axios.delete(`/api/patterns/${patternId}/bookmarks/${bookmarkId}`);\n      toast.success('Bookmark deleted');\n      fetchBookmarks();\n    } catch (error) {\n      console.error('Error deleting bookmark:', error);\n      toast.error('Failed to delete bookmark');\n    }\n  };\n\n  const handleQuickBookmark = async () => {\n    try {\n      await axios.post(`/api/patterns/${patternId}/bookmarks`, {\n        name: `Page ${currentPage}`,\n        pageNumber: currentPage,\n        zoomLevel: currentZoom,\n        color: '#FBBF24',\n        projectId: projectId || null,\n      });\n\n      toast.success(`Bookmark added for page ${currentPage}!`);\n      fetchBookmarks();\n    } catch (error) {\n      console.error('Error creating quick bookmark:', error);\n      toast.error('Failed to create bookmark');\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      pageNumber: currentPage,\n      notes: '',\n      color: '#FBBF24',\n    });\n  };\n\n  const openCreateModal = () => {\n    resetForm();\n    setShowCreateModal(true);\n  };\n\n  const openEditModal = (bookmark: Bookmark) => {\n    setFormData({\n      name: bookmark.name,\n      pageNumber: bookmark.page_number,\n      notes: bookmark.notes || '',\n      color: bookmark.color,\n    });\n    setEditingBookmark(bookmark);\n  };\n\n  return (\n    <div className=\"bg-gray-700 rounded-lg p-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <FiBookmark className=\"h-5 w-5 text-yellow-400\" />\n          <h3 className=\"text-white font-semibold\">Bookmarks</h3>\n          <span className=\"text-gray-400 text-sm\">({bookmarks.length})</span>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleQuickBookmark}\n            className=\"p-2 bg-gray-600 hover:bg-gray-500 rounded text-white text-sm\"\n            title=\"Quick bookmark current page\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n          </button>\n          <button\n            onClick={openCreateModal}\n            className=\"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded text-white text-sm flex items-center gap-2\"\n          >\n            <FiPlus className=\"h-4 w-4\" />\n            New\n          </button>\n        </div>\n      </div>\n\n      {/* Bookmarks List */}\n      <div className=\"space-y-2 max-h-80 overflow-y-auto\">\n        {bookmarks.length === 0 ? (\n          <p className=\"text-gray-400 text-sm text-center py-4\">No bookmarks yet</p>\n        ) : (\n          bookmarks.map((bookmark) => (\n            <div\n              key={bookmark.id}\n              className=\"flex items-center gap-3 p-3 bg-gray-800 rounded-lg hover:bg-gray-750 cursor-pointer group\"\n            >\n              {/* Color indicator */}\n              <div\n                className=\"w-1 h-12 rounded-full flex-shrink-0\"\n                style={{ backgroundColor: bookmark.color }}\n              />\n\n              {/* Bookmark info */}\n              <div\n                className=\"flex-1 min-w-0\"\n                onClick={() => onJumpToBookmark(bookmark)}\n              >\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <h4 className=\"text-white font-medium truncate\">{bookmark.name}</h4>\n                  <FiChevronRight className=\"h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                </div>\n                <div className=\"flex items-center gap-3 text-xs text-gray-400\">\n                  <span>Page {bookmark.page_number}</span>\n                  {bookmark.notes && (\n                    <span className=\"truncate max-w-xs\">{bookmark.notes}</span>\n                  )}\n                </div>\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    openEditModal(bookmark);\n                  }}\n                  className=\"p-1.5 hover:bg-gray-600 rounded text-blue-400\"\n                  title=\"Edit bookmark\"\n                >\n                  <FiEdit2 className=\"h-4 w-4\" />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleDeleteBookmark(bookmark.id);\n                  }}\n                  className=\"p-1.5 hover:bg-gray-600 rounded text-red-400\"\n                  title=\"Delete bookmark\"\n                >\n                  <FiTrash2 className=\"h-4 w-4\" />\n                </button>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      {/* Create/Edit Modal */}\n      {(showCreateModal || editingBookmark) && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"p-4 border-b border-gray-700 flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-white\">\n                {editingBookmark ? 'Edit Bookmark' : 'New Bookmark'}\n              </h3>\n              <button\n                onClick={() => {\n                  setShowCreateModal(false);\n                  setEditingBookmark(null);\n                  resetForm();\n                }}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                <FiX className=\"h-5 w-5\" />\n              </button>\n            </div>\n\n            <div className=\"p-4 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Bookmark Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"e.g., Current row, Sleeve decreases\"\n                  className=\"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500\"\n                  autoFocus\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Page Number\n                </label>\n                <input\n                  type=\"number\"\n                  value={formData.pageNumber}\n                  onChange={(e) => setFormData({ ...formData, pageNumber: parseInt(e.target.value) })}\n                  min={1}\n                  className=\"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Color\n                </label>\n                <div className=\"grid grid-cols-6 gap-2\">\n                  {BOOKMARK_COLORS.map((color) => (\n                    <button\n                      key={color.value}\n                      onClick={() => setFormData({ ...formData, color: color.value })}\n                      className={`w-full h-10 rounded border-2 ${\n                        formData.color === color.value\n                          ? 'border-white'\n                          : 'border-gray-600 hover:border-gray-400'\n                      }`}\n                      style={{ backgroundColor: color.value }}\n                      title={color.name}\n                    />\n                  ))}\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Notes (optional)\n                </label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  placeholder=\"Additional notes or instructions\"\n                  rows={3}\n                  className=\"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-2\">\n                <button\n                  onClick={() => {\n                    setShowCreateModal(false);\n                    setEditingBookmark(null);\n                    resetForm();\n                  }}\n                  className=\"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={editingBookmark ? handleUpdateBookmark : handleCreateBookmark}\n                  className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                >\n                  {editingBookmark ? 'Update' : 'Create'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useRef, useEffect } from 'react';\nimport {  FiTrash2, FiEye, FiEyeOff } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Highlight {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  page_number: number;\n  coordinates: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  };\n  color: string;\n  opacity: number;\n  layer: number;\n}\n\ninterface PatternHighlighterProps {\n  patternId: string;\n  projectId?: string;\n  pageNumber: number;\n  isActive: boolean;\n}\n\nconst HIGHLIGHT_COLORS = [\n  { name: 'Yellow', value: '#FBBF24' },\n  { name: 'Red', value: '#EF4444' },\n  { name: 'Blue', value: '#3B82F6' },\n  { name: 'Green', value: '#10B981' },\n  { name: 'Purple', value: '#8B5CF6' },\n  { name: 'Pink', value: '#EC4899' },\n];\n\nexport default function PatternHighlighter({\n  patternId,\n  projectId,\n  pageNumber,\n  isActive,\n}: PatternHighlighterProps) {\n  const [highlights, setHighlights] = useState<Highlight[]>([]);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [startPos, setStartPos] = useState<{ x: number; y: number } | null>(null);\n  const [currentRect, setCurrentRect] = useState<any>(null);\n  const [selectedColor, setSelectedColor] = useState(HIGHLIGHT_COLORS[0].value);\n  const [opacity, setOpacity] = useState(0.3);\n  const [showControls, setShowControls] = useState(true);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isActive) {\n      fetchHighlights();\n    }\n  }, [patternId, projectId, pageNumber, isActive]);\n\n  useEffect(() => {\n    if (isActive) {\n      drawHighlights();\n    }\n  }, [highlights, isActive]);\n\n  const fetchHighlights = async () => {\n    try {\n      const params: any = { pageNumber };\n      if (projectId) params.projectId = projectId;\n\n      const response = await axios.get(`/api/patterns/${patternId}/highlights`, { params });\n      setHighlights(response.data.data.highlights || []);\n    } catch (error) {\n      console.error('Error fetching highlights:', error);\n    }\n  };\n\n  const drawHighlights = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Draw all highlights\n    highlights.forEach((highlight) => {\n      ctx.fillStyle = highlight.color;\n      ctx.globalAlpha = highlight.opacity;\n      ctx.fillRect(\n        highlight.coordinates.x,\n        highlight.coordinates.y,\n        highlight.coordinates.width,\n        highlight.coordinates.height\n      );\n    });\n\n    // Draw current rectangle being drawn\n    if (currentRect) {\n      ctx.fillStyle = selectedColor;\n      ctx.globalAlpha = opacity;\n      ctx.fillRect(currentRect.x, currentRect.y, currentRect.width, currentRect.height);\n    }\n\n    ctx.globalAlpha = 1;\n  };\n\n  const getMousePos = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return { x: 0, y: 0 };\n\n    const rect = canvas.getBoundingClientRect();\n    return {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top,\n    };\n  };\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isActive) return;\n\n    const pos = getMousePos(e);\n    setStartPos(pos);\n    setIsDrawing(true);\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isDrawing || !startPos) return;\n\n    const pos = getMousePos(e);\n    const width = pos.x - startPos.x;\n    const height = pos.y - startPos.y;\n\n    setCurrentRect({\n      x: width < 0 ? pos.x : startPos.x,\n      y: height < 0 ? pos.y : startPos.y,\n      width: Math.abs(width),\n      height: Math.abs(height),\n    });\n\n    drawHighlights();\n  };\n\n  const handleMouseUp = async () => {\n    if (!isDrawing || !currentRect) {\n      setIsDrawing(false);\n      return;\n    }\n\n    // Only save if rectangle is large enough\n    if (currentRect.width > 5 && currentRect.height > 5) {\n      await saveHighlight(currentRect);\n    }\n\n    setIsDrawing(false);\n    setStartPos(null);\n    setCurrentRect(null);\n  };\n\n  const saveHighlight = async (coordinates: any) => {\n    try {\n      await axios.post(`/api/patterns/${patternId}/highlights`, {\n        pageNumber,\n        coordinates,\n        color: selectedColor,\n        opacity,\n        projectId: projectId || null,\n      });\n\n      toast.success('Highlight saved!');\n      fetchHighlights();\n    } catch (error) {\n      console.error('Error saving highlight:', error);\n      toast.error('Failed to save highlight');\n    }\n  };\n\n  const handleClearAll = async () => {\n    if (!confirm('Clear all highlights on this page?')) return;\n\n    try {\n      // Delete all highlights for this page\n      await Promise.all(\n        highlights.map((h) =>\n          axios.delete(`/api/patterns/${patternId}/highlights/${h.id}`)\n        )\n      );\n\n      toast.success('All highlights cleared');\n      setHighlights([]);\n    } catch (error) {\n      console.error('Error clearing highlights:', error);\n      toast.error('Failed to clear highlights');\n    }\n  };\n\n  if (!isActive) return null;\n\n  return (\n    <>\n      {/* Canvas overlay */}\n      <canvas\n        ref={canvasRef}\n        className=\"absolute inset-0 w-full h-full z-30 pointer-events-auto\"\n        style={{ cursor: isDrawing ? 'crosshair' : 'default' }}\n        width={containerRef.current?.clientWidth || 800}\n        height={containerRef.current?.clientHeight || 1000}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n      />\n\n      {/* Control Panel */}\n      <div className=\"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64\">\n        <div className=\"flex items-center justify-between\">\n          <h4 className=\"text-white font-semibold text-sm\">Highlighter</h4>\n          <button\n            onClick={() => setShowControls(!showControls)}\n            className=\"p-1 hover:bg-gray-700 rounded text-gray-400\"\n          >\n            {showControls ? <FiEyeOff className=\"h-4 w-4\" /> : <FiEye className=\"h-4 w-4\" />}\n          </button>\n        </div>\n\n        {showControls && (\n          <>\n            {/* Instructions */}\n            <div className=\"text-xs text-gray-300 bg-gray-700 rounded p-2\">\n              <p>Click and drag to highlight</p>\n            </div>\n\n            {/* Color Selection */}\n            <div>\n              <label className=\"block text-xs font-medium text-gray-300 mb-2\">Color</label>\n              <div className=\"grid grid-cols-3 gap-2\">\n                {HIGHLIGHT_COLORS.map((c) => (\n                  <button\n                    key={c.value}\n                    onClick={() => setSelectedColor(c.value)}\n                    className={`h-10 rounded border-2 ${\n                      selectedColor === c.value ? 'border-white' : 'border-gray-600'\n                    }`}\n                    style={{ backgroundColor: c.value }}\n                    title={c.name}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Opacity Slider */}\n            <div>\n              <label className=\"block text-xs font-medium text-gray-300 mb-2\">\n                Opacity: {Math.round(opacity * 100)}%\n              </label>\n              <input\n                type=\"range\"\n                min=\"0.1\"\n                max=\"0.6\"\n                step=\"0.1\"\n                value={opacity}\n                onChange={(e) => setOpacity(parseFloat(e.target.value))}\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* Highlight Count */}\n            <div className=\"text-xs text-gray-400 pt-2 border-t border-gray-700\">\n              {highlights.length} highlight{highlights.length !== 1 ? 's' : ''} on this page\n            </div>\n\n            {/* Clear All Button */}\n            {highlights.length > 0 && (\n              <button\n                onClick={handleClearAll}\n                className=\"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-medium flex items-center justify-center gap-2\"\n              >\n                <FiTrash2 className=\"h-4 w-4\" />\n                Clear All\n              </button>\n            )}\n          </>\n        )}\n      </div>\n    </>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport { FiMove, FiX, FiEye, FiEyeOff } from 'react-icons/fi';\n\ninterface RowMarkerProps {\n  pageNumber: number;\n  onPositionChange?: (position: { x: number; y: number }) => void;\n}\n\nconst MARKER_COLORS = [\n  { name: 'Yellow', value: '#FBBF24', opacity: 0.3 },\n  { name: 'Red', value: '#EF4444', opacity: 0.3 },\n  { name: 'Blue', value: '#3B82F6', opacity: 0.3 },\n  { name: 'Green', value: '#10B981', opacity: 0.3 },\n  { name: 'Purple', value: '#8B5CF6', opacity: 0.3 },\n];\n\nexport default function RowMarker({ pageNumber: _pageNumber, onPositionChange }: RowMarkerProps) {\n  const [position, setPosition] = useState({ x: 50, y: 50 }); // Percentage based\n  const [height, setHeight] = useState(3); // Percentage of viewport\n  const [isDragging, setIsDragging] = useState(false);\n  const [isResizing, setIsResizing] = useState(false);\n  const [color, setColor] = useState(MARKER_COLORS[0].value);\n  const [opacity, setOpacity] = useState(0.3);\n  const [isLocked, setIsLocked] = useState(false);\n  const [isVisible, setIsVisible] = useState(true);\n  const [showControls, setShowControls] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n\n  // Handle dragging\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    if (isLocked) return;\n\n    e.preventDefault();\n    setIsDragging(true);\n    setDragStart({\n      x: e.clientX - (position.x * window.innerWidth) / 100,\n      y: e.clientY - (position.y * window.innerHeight) / 100,\n    });\n  }, [isLocked, position]);\n\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    if (!isDragging || isLocked) return;\n\n    const newX = ((e.clientX - dragStart.x) / window.innerWidth) * 100;\n    const newY = ((e.clientY - dragStart.y) / window.innerHeight) * 100;\n\n    setPosition({\n      x: Math.max(0, Math.min(100, newX)),\n      y: Math.max(0, Math.min(100 - height, newY)),\n    });\n  }, [isDragging, isLocked, dragStart, height]);\n\n  const handleMouseUp = useCallback(() => {\n    if (isDragging) {\n      setIsDragging(false);\n      onPositionChange?.(position);\n    }\n    setIsResizing(false);\n  }, [isDragging, position, onPositionChange]);\n\n  // Handle resize\n  const handleResizeStart = useCallback((e: React.MouseEvent) => {\n    if (isLocked) return;\n    e.stopPropagation();\n    setIsResizing(true);\n  }, [isLocked]);\n\n  const handleResize = useCallback((e: MouseEvent) => {\n    if (!isResizing || isLocked) return;\n\n    const newHeight = (e.clientY / window.innerHeight) * 100 - position.y;\n    setHeight(Math.max(1, Math.min(20, newHeight)));\n  }, [isResizing, isLocked, position.y]);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isVisible) return;\n\n      switch (e.key) {\n        case 'ArrowUp':\n          if (!isLocked) {\n            e.preventDefault();\n            setPosition(prev => ({ ...prev, y: Math.max(0, prev.y - 1) }));\n          }\n          break;\n        case 'ArrowDown':\n          if (!isLocked) {\n            e.preventDefault();\n            setPosition(prev => ({ ...prev, y: Math.min(100 - height, prev.y + 1) }));\n          }\n          break;\n        case 'l':\n        case 'L':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            setIsLocked(!isLocked);\n          }\n          break;\n        case 'h':\n        case 'H':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            setIsVisible(!isVisible);\n          }\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isVisible, isLocked, height]);\n\n  // Mouse event listeners\n  useEffect(() => {\n    if (isDragging) {\n      window.addEventListener('mousemove', handleMouseMove);\n      window.addEventListener('mouseup', handleMouseUp);\n      return () => {\n        window.removeEventListener('mousemove', handleMouseMove);\n        window.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDragging, handleMouseMove, handleMouseUp]);\n\n  useEffect(() => {\n    if (isResizing) {\n      window.addEventListener('mousemove', handleResize);\n      window.addEventListener('mouseup', handleMouseUp);\n      return () => {\n        window.removeEventListener('mousemove', handleResize);\n        window.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isResizing, handleResize, handleMouseUp]);\n\n  if (!isVisible) {\n    return (\n      <button\n        onClick={() => setIsVisible(true)}\n        className=\"fixed top-20 right-4 z-50 px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg shadow-lg flex items-center gap-2\"\n        title=\"Show row marker (Ctrl+H)\"\n      >\n        <FiEye className=\"h-4 w-4\" />\n        Show Marker\n      </button>\n    );\n  }\n\n  return (\n    <>\n      {/* Row Marker */}\n      <div\n        className={`fixed z-40 transition-opacity ${isDragging ? 'cursor-move' : ''} ${\n          isLocked ? 'pointer-events-none' : 'cursor-move'\n        }`}\n        style={{\n          left: `${position.x}%`,\n          top: `${position.y}%`,\n          width: '90%',\n          height: `${height}%`,\n          backgroundColor: color,\n          opacity: opacity,\n          transform: 'translate(-50%, 0)',\n        }}\n        onMouseDown={handleMouseDown}\n        onMouseEnter={() => !isLocked && setShowControls(true)}\n        onMouseLeave={() => setShowControls(false)}\n      >\n        {/* Controls */}\n        {showControls && !isLocked && (\n          <div className=\"absolute top-0 right-0 flex items-center gap-1 bg-gray-900 bg-opacity-90 rounded-bl-lg p-1\">\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsVisible(false);\n              }}\n              className=\"p-1 hover:bg-gray-700 rounded text-white\"\n              title=\"Hide marker\"\n            >\n              <FiEyeOff className=\"h-3 w-3\" />\n            </button>\n            <FiMove className=\"h-3 w-3 text-white\" title=\"Drag to move\" />\n          </div>\n        )}\n\n        {/* Resize Handle */}\n        {!isLocked && (\n          <div\n            className=\"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize bg-gray-900 bg-opacity-50 hover:bg-opacity-75\"\n            onMouseDown={handleResizeStart}\n            title=\"Drag to resize\"\n          />\n        )}\n      </div>\n\n      {/* Control Panel */}\n      <div className=\"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64\">\n        <div className=\"flex items-center justify-between\">\n          <h4 className=\"text-white font-semibold text-sm\">Row Marker</h4>\n          <button\n            onClick={() => setIsVisible(false)}\n            className=\"p-1 hover:bg-gray-700 rounded text-gray-400\"\n            title=\"Hide marker (Ctrl+H)\"\n          >\n            <FiX className=\"h-4 w-4\" />\n          </button>\n        </div>\n\n        {/* Color Selection */}\n        <div>\n          <label className=\"block text-xs font-medium text-gray-300 mb-2\">Color</label>\n          <div className=\"flex gap-2\">\n            {MARKER_COLORS.map((c) => (\n              <button\n                key={c.value}\n                onClick={() => setColor(c.value)}\n                className={`w-8 h-8 rounded border-2 ${\n                  color === c.value ? 'border-white' : 'border-gray-600'\n                }`}\n                style={{ backgroundColor: c.value }}\n                title={c.name}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Opacity Slider */}\n        <div>\n          <label className=\"block text-xs font-medium text-gray-300 mb-2\">\n            Opacity: {Math.round(opacity * 100)}%\n          </label>\n          <input\n            type=\"range\"\n            min=\"0.1\"\n            max=\"0.8\"\n            step=\"0.1\"\n            value={opacity}\n            onChange={(e) => setOpacity(parseFloat(e.target.value))}\n            className=\"w-full\"\n          />\n        </div>\n\n        {/* Height Slider */}\n        <div>\n          <label className=\"block text-xs font-medium text-gray-300 mb-2\">\n            Height: {height.toFixed(1)}%\n          </label>\n          <input\n            type=\"range\"\n            min=\"1\"\n            max=\"20\"\n            step=\"0.5\"\n            value={height}\n            onChange={(e) => setHeight(parseFloat(e.target.value))}\n            className=\"w-full\"\n          />\n        </div>\n\n        {/* Lock Toggle */}\n        <button\n          onClick={() => setIsLocked(!isLocked)}\n          className={`w-full px-3 py-2 rounded text-sm font-medium ${\n            isLocked\n              ? 'bg-red-600 hover:bg-red-700 text-white'\n              : 'bg-gray-700 hover:bg-gray-600 text-white'\n          }`}\n        >\n          {isLocked ? ' Locked' : ' Unlocked'} (Ctrl+L)\n        </button>\n\n        {/* Instructions */}\n        <div className=\"text-xs text-gray-400 space-y-1 pt-2 border-t border-gray-700\">\n          <p> Drag marker to move</p>\n          <p> Drag bottom edge to resize</p>\n          <p> Arrow keys to fine-tune</p>\n          <p> Ctrl+L to lock/unlock</p>\n          <p> Ctrl+H to hide/show</p>\n        </div>\n      </div>\n    </>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport {\n  FiZoomIn,\n  FiZoomOut,\n  FiRotateCw,\n  FiChevronLeft,\n  FiChevronRight,\n  FiSearch,\n  FiX,\n  FiMaximize,\n  \n  FiBookmark,\n  FiMove,\n  FiEdit3\n} from 'react-icons/fi';\nimport { toast } from 'react-toastify';\nimport BookmarkManager from './BookmarkManager';\nimport RowMarker from './RowMarker';\nimport PatternHighlighter from './PatternHighlighter';\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\nimport 'react-pdf/dist/Page/TextLayer.css';\n\n// Configure PDF.js worker - use local file for production reliability\npdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.min.js';\n\ninterface PatternViewerProps {\n  fileUrl: string;\n  filename: string;\n  patternId?: string;\n  projectId?: string;\n  onClose?: () => void;\n  fullscreen?: boolean;\n  initialPage?: number;\n  initialZoom?: number;\n}\n\nconst ZOOM_LEVELS = [0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];\n\nexport default function PatternViewer({ fileUrl, filename, patternId, projectId, onClose, fullscreen = true, initialPage, initialZoom }: PatternViewerProps) {\n  const [numPages, setNumPages] = useState<number>(0);\n  const [currentPage, setCurrentPage] = useState<number>(initialPage || 1);\n  const [zoomIndex, setZoomIndex] = useState<number>(() => {\n    // Find closest zoom level if initialZoom is provided\n    if (initialZoom) {\n      const closestIndex = ZOOM_LEVELS.reduce((prev, curr, idx) =>\n        Math.abs(curr - initialZoom) < Math.abs(ZOOM_LEVELS[prev] - initialZoom) ? idx : prev,\n        2\n      );\n      return closestIndex;\n    }\n    return 2; // Default to 1.0\n  });\n  const [rotation, setRotation] = useState<number>(0);\n  const [searchText, setSearchText] = useState<string>('');\n  const [showSearch, setShowSearch] = useState<boolean>(false);\n  const [_isFullscreen, setIsFullscreen] = useState<boolean>(false);\n  const [showBookmarks, setShowBookmarks] = useState<boolean>(Boolean(patternId));\n  const [showRowMarker, setShowRowMarker] = useState<boolean>(false);\n  const [showHighlighter, setShowHighlighter] = useState<boolean>(false);\n\n  const zoomLevel = ZOOM_LEVELS[zoomIndex];\n\n  // Navigate to page when initialPage changes (for bookmark jumping)\n  useEffect(() => {\n    if (initialPage && initialPage >= 1 && initialPage <= numPages) {\n      setCurrentPage(initialPage);\n    }\n  }, [initialPage, numPages]);\n\n  // Update zoom when initialZoom changes\n  useEffect(() => {\n    if (initialZoom) {\n      const closestIndex = ZOOM_LEVELS.reduce((prev, curr, idx) =>\n        Math.abs(curr - initialZoom) < Math.abs(ZOOM_LEVELS[prev] - initialZoom) ? idx : prev,\n        2\n      );\n      setZoomIndex(closestIndex);\n    }\n  }, [initialZoom]);\n\n  function onDocumentLoadSuccess({ numPages }: { numPages: number }) {\n    setNumPages(numPages);\n    setCurrentPage(1);\n    toast.success(`PDF loaded: ${numPages} pages`);\n  }\n\n  function onDocumentLoadError(error: Error) {\n    console.error('Error loading PDF:', error);\n    toast.error('Failed to load PDF file');\n  }\n\n  const handleZoomIn = useCallback(() => {\n    if (zoomIndex < ZOOM_LEVELS.length - 1) {\n      setZoomIndex(prev => prev + 1);\n    }\n  }, [zoomIndex]);\n\n  const handleZoomOut = useCallback(() => {\n    if (zoomIndex > 0) {\n      setZoomIndex(prev => prev - 1);\n    }\n  }, [zoomIndex]);\n\n  const handleRotate = useCallback(() => {\n    setRotation(prev => (prev + 90) % 360);\n  }, []);\n\n  const handleNextPage = useCallback(() => {\n    if (currentPage < numPages) {\n      setCurrentPage(prev => prev + 1);\n    }\n  }, [currentPage, numPages]);\n\n  const handlePrevPage = useCallback(() => {\n    if (currentPage > 1) {\n      setCurrentPage(prev => prev - 1);\n    }\n  }, [currentPage]);\n\n  const handlePageJump = useCallback((page: number) => {\n    if (page >= 1 && page <= numPages) {\n      setCurrentPage(page);\n    }\n  }, [numPages]);\n\n  const toggleFullscreen = useCallback(() => {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n      setIsFullscreen(true);\n    } else {\n      document.exitFullscreen();\n      setIsFullscreen(false);\n    }\n  }, []);\n\n  const handleJumpToBookmark = useCallback((bookmark: any) => {\n    setCurrentPage(bookmark.page_number);\n    if (bookmark.zoom_level) {\n      const zoomIdx = ZOOM_LEVELS.findIndex(z => Math.abs(z - bookmark.zoom_level) < 0.01);\n      if (zoomIdx !== -1) {\n        setZoomIndex(zoomIdx);\n      }\n    }\n    toast.success(`Jumped to: ${bookmark.name}`);\n  }, []);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      switch (e.key) {\n        case 'ArrowRight':\n        case 'PageDown':\n          handleNextPage();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          handlePrevPage();\n          break;\n        case 'Home':\n          setCurrentPage(1);\n          break;\n        case 'End':\n          setCurrentPage(numPages);\n          break;\n        case '+':\n        case '=':\n          handleZoomIn();\n          break;\n        case '-':\n          handleZoomOut();\n          break;\n        case 'f':\n        case 'F':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            setShowSearch(true);\n          }\n          break;\n        case 'Escape':\n          setShowSearch(false);\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [currentPage, numPages, handleNextPage, handlePrevPage, handleZoomIn, handleZoomOut]);\n\n  // Handle fullscreen change\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);\n  }, []);\n\n  return (\n    <div className={fullscreen ? \"fixed inset-0 bg-gray-900 z-50 flex flex-col\" : \"bg-gray-900 flex flex-col h-full\"}>\n      {/* Toolbar */}\n      <div className=\"bg-gray-800 text-white p-3 flex items-center justify-between shadow-lg\">\n        <div className=\"flex items-center gap-4\">\n          <h3 className=\"font-semibold text-lg truncate max-w-md\">{filename}</h3>\n          <span className=\"text-sm text-gray-400\">\n            {numPages > 0 && `${numPages} pages`}\n          </span>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* Page Navigation */}\n          <div className=\"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2\">\n            <button\n              onClick={handlePrevPage}\n              disabled={currentPage <= 1}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Previous page ()\"\n            >\n              <FiChevronLeft className=\"h-5 w-5\" />\n            </button>\n\n            <div className=\"flex items-center gap-2\">\n              <input\n                type=\"number\"\n                value={currentPage}\n                onChange={(e) => handlePageJump(parseInt(e.target.value))}\n                className=\"w-14 px-2 py-1 bg-gray-600 text-white text-center rounded border-none focus:ring-2 focus:ring-purple-500\"\n                min={1}\n                max={numPages}\n              />\n              <span className=\"text-gray-400\">/ {numPages}</span>\n            </div>\n\n            <button\n              onClick={handleNextPage}\n              disabled={currentPage >= numPages}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Next page ()\"\n            >\n              <FiChevronRight className=\"h-5 w-5\" />\n            </button>\n          </div>\n\n          {/* Zoom Controls */}\n          <div className=\"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2\">\n            <button\n              onClick={handleZoomOut}\n              disabled={zoomIndex <= 0}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Zoom out (-)\"\n            >\n              <FiZoomOut className=\"h-5 w-5\" />\n            </button>\n\n            <span className=\"text-sm font-medium w-12 text-center\">\n              {Math.round(zoomLevel * 100)}%\n            </span>\n\n            <button\n              onClick={handleZoomIn}\n              disabled={zoomIndex >= ZOOM_LEVELS.length - 1}\n              className=\"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              title=\"Zoom in (+)\"\n            >\n              <FiZoomIn className=\"h-5 w-5\" />\n            </button>\n          </div>\n\n          {/* Additional Controls */}\n          <button\n            onClick={handleRotate}\n            className=\"p-2 hover:bg-gray-700 rounded-lg\"\n            title=\"Rotate clockwise\"\n          >\n            <FiRotateCw className=\"h-5 w-5\" />\n          </button>\n\n          <button\n            onClick={() => setShowSearch(!showSearch)}\n            className={`p-2 hover:bg-gray-700 rounded-lg ${showSearch ? 'bg-gray-700' : ''}`}\n            title=\"Search (Ctrl+F)\"\n          >\n            <FiSearch className=\"h-5 w-5\" />\n          </button>\n\n          {patternId && (\n            <button\n              onClick={() => setShowBookmarks(!showBookmarks)}\n              className={`p-2 hover:bg-gray-700 rounded-lg ${showBookmarks ? 'bg-gray-700' : ''}`}\n              title=\"Bookmarks\"\n            >\n              <FiBookmark className=\"h-5 w-5\" />\n            </button>\n          )}\n\n          <button\n            onClick={() => setShowRowMarker(!showRowMarker)}\n            className={`p-2 hover:bg-gray-700 rounded-lg ${showRowMarker ? 'bg-gray-700' : ''}`}\n            title=\"Row marker\"\n          >\n            <FiMove className=\"h-5 w-5\" />\n          </button>\n\n          {patternId && (\n            <button\n              onClick={() => setShowHighlighter(!showHighlighter)}\n              className={`p-2 hover:bg-gray-700 rounded-lg ${showHighlighter ? 'bg-gray-700' : ''}`}\n              title=\"Highlighter\"\n            >\n              <FiEdit3 className=\"h-5 w-5\" />\n            </button>\n          )}\n\n          <button\n            onClick={toggleFullscreen}\n            className=\"p-2 hover:bg-gray-700 rounded-lg\"\n            title=\"Toggle fullscreen\"\n          >\n            <FiMaximize className=\"h-5 w-5\" />\n          </button>\n\n          {onClose && (\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-700 rounded-lg ml-2\"\n              title=\"Close viewer (Esc)\"\n            >\n              <FiX className=\"h-5 w-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Search Bar */}\n      {showSearch && (\n        <div className=\"bg-gray-800 border-t border-gray-700 px-4 py-3\">\n          <div className=\"flex items-center gap-3 max-w-md\">\n            <div className=\"flex-1 relative\">\n              <input\n                type=\"text\"\n                value={searchText}\n                onChange={(e) => setSearchText(e.target.value)}\n                placeholder=\"Search in document...\"\n                className=\"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border-none focus:ring-2 focus:ring-purple-500\"\n                autoFocus\n              />\n            </div>\n            <button\n              onClick={() => setShowSearch(false)}\n              className=\"p-2 hover:bg-gray-700 rounded-lg text-white\"\n            >\n              <FiX className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Bookmark Sidebar */}\n        {showBookmarks && patternId && (\n          <div className=\"w-80 flex-shrink-0 border-r border-gray-700 overflow-y-auto\">\n            <BookmarkManager\n              patternId={patternId}\n              projectId={projectId}\n              currentPage={currentPage}\n              currentZoom={zoomLevel}\n              onJumpToBookmark={handleJumpToBookmark}\n            />\n          </div>\n        )}\n\n        {/* PDF Viewer */}\n        <div className=\"flex-1 overflow-auto bg-gray-800 p-4\">\n          <div className=\"flex justify-center min-h-full\">\n            <Document\n              file={fileUrl}\n              onLoadSuccess={onDocumentLoadSuccess}\n              onLoadError={onDocumentLoadError}\n              loading={\n                <div className=\"flex items-center justify-center h-screen\">\n                  <div className=\"text-white text-lg\">Loading PDF...</div>\n                </div>\n              }\n              error={\n                <div className=\"flex items-center justify-center h-screen\">\n                  <div className=\"text-red-500 text-lg\">Failed to load PDF</div>\n                </div>\n              }\n            >\n              <Page\n                pageNumber={currentPage}\n                scale={zoomLevel}\n                rotate={rotation}\n                renderTextLayer={true}\n                renderAnnotationLayer={true}\n                className=\"shadow-2xl\"\n                loading={\n                  <div className=\"flex items-center justify-center min-h-screen\">\n                    <div className=\"text-white\">Loading page...</div>\n                  </div>\n                }\n              />\n            </Document>\n          </div>\n        </div>\n      </div>\n\n      {/* Page Indicator (Mobile) */}\n      <div className=\"md:hidden bg-gray-800 text-white text-center py-2 border-t border-gray-700\">\n        Page {currentPage} of {numPages}\n      </div>\n\n      {/* Row Marker Overlay */}\n      {showRowMarker && <RowMarker pageNumber={currentPage} />}\n\n      {/* Pattern Highlighter */}\n      {showHighlighter && patternId && (\n        <PatternHighlighter\n          patternId={patternId}\n          projectId={projectId}\n          pageNumber={currentPage}\n          isActive={showHighlighter}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  designer?: string;\n  category?: string;\n}\n\ninterface CollationResult {\n  id: string;\n  fileUrl: string;\n  pageCount: number;\n  fileSize: number;\n  patternCount: number;\n}\n\nexport const PDFCollation: React.FC = () => {\n  const [patterns, setPatterns] = useState<Pattern[]>([]);\n  const [selectedPatterns, setSelectedPatterns] = useState<string[]>([]);\n  const [addDividers, setAddDividers] = useState(false);\n  const [dividerText, setDividerText] = useState('Pattern');\n  const [loading, setLoading] = useState(false);\n  const [collationResult, setCollationResult] = useState<CollationResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchPatterns();\n  }, []);\n\n  const fetchPatterns = async () => {\n    try {\n      const response = await axios.get('/api/patterns');\n      if (response.data.success) {\n        setPatterns(response.data.data.patterns);\n      }\n    } catch (err) {\n      console.error('Failed to fetch patterns:', err);\n      setError('Failed to load patterns');\n    }\n  };\n\n  const handlePatternToggle = (patternId: string) => {\n    setSelectedPatterns((prev) =>\n      prev.includes(patternId)\n        ? prev.filter((id) => id !== patternId)\n        : [...prev, patternId]\n    );\n  };\n\n  const handleMoveUp = (index: number) => {\n    if (index === 0) return;\n    const newOrder = [...selectedPatterns];\n    [newOrder[index - 1], newOrder[index]] = [newOrder[index], newOrder[index - 1]];\n    setSelectedPatterns(newOrder);\n  };\n\n  const handleMoveDown = (index: number) => {\n    if (index === selectedPatterns.length - 1) return;\n    const newOrder = [...selectedPatterns];\n    [newOrder[index], newOrder[index + 1]] = [newOrder[index + 1], newOrder[index]];\n    setSelectedPatterns(newOrder);\n  };\n\n  const handleCollate = async () => {\n    if (selectedPatterns.length === 0) {\n      setError('Please select at least one pattern');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    setCollationResult(null);\n\n    try {\n      const response = await axios.post('/api/patterns/collate', {\n        patternIds: selectedPatterns,\n        addDividers,\n        dividerText,\n      });\n\n      if (response.data.success) {\n        setCollationResult(response.data.data.collation);\n      }\n    } catch (err: any) {\n      console.error('Failed to collate patterns:', err);\n      setError(err.response?.data?.message || 'Failed to merge PDFs');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getPatternName = (patternId: string) => {\n    const pattern = patterns.find((p) => p.id === patternId);\n    return pattern?.name || 'Unknown Pattern';\n  };\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';\n  };\n\n  return (\n    <div className=\"pdf-collation\">\n      <div className=\"collation-header\">\n        <h2>Merge Pattern PDFs</h2>\n        <p className=\"description\">\n          Select multiple patterns to merge into a single PDF file\n        </p>\n      </div>\n\n      {error && (\n        <div className=\"error-message\" role=\"alert\">\n          {error}\n        </div>\n      )}\n\n      <div className=\"collation-content\">\n        {/* Pattern Selection */}\n        <div className=\"pattern-selection\">\n          <h3>Available Patterns</h3>\n          <div className=\"pattern-list\">\n            {patterns.map((pattern) => (\n              <div\n                key={pattern.id}\n                className={`pattern-item ${selectedPatterns.includes(pattern.id) ? 'selected' : ''}`}\n                onClick={() => handlePatternToggle(pattern.id)}\n              >\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPatterns.includes(pattern.id)}\n                  onChange={() => handlePatternToggle(pattern.id)}\n                  onClick={(e) => e.stopPropagation()}\n                />\n                <div className=\"pattern-info\">\n                  <div className=\"pattern-name\">{pattern.name}</div>\n                  {pattern.designer && (\n                    <div className=\"pattern-designer\">by {pattern.designer}</div>\n                  )}\n                  {pattern.category && (\n                    <span className=\"pattern-category\">{pattern.category}</span>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Selected Patterns Order */}\n        {selectedPatterns.length > 0 && (\n          <div className=\"selected-patterns\">\n            <h3>Merge Order ({selectedPatterns.length} patterns)</h3>\n            <div className=\"pattern-order-list\">\n              {selectedPatterns.map((patternId, index) => (\n                <div key={patternId} className=\"pattern-order-item\">\n                  <span className=\"order-number\">{index + 1}.</span>\n                  <span className=\"pattern-name\">{getPatternName(patternId)}</span>\n                  <div className=\"order-controls\">\n                    <button\n                      onClick={() => handleMoveUp(index)}\n                      disabled={index === 0}\n                      className=\"btn-icon\"\n                      aria-label=\"Move up\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => handleMoveDown(index)}\n                      disabled={index === selectedPatterns.length - 1}\n                      className=\"btn-icon\"\n                      aria-label=\"Move down\"\n                    >\n                      \n                    </button>\n                    <button\n                      onClick={() => handlePatternToggle(patternId)}\n                      className=\"btn-icon btn-remove\"\n                      aria-label=\"Remove\"\n                    >\n                      \n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Options */}\n        <div className=\"collation-options\">\n          <h3>Options</h3>\n          <div className=\"option\">\n            <label>\n              <input\n                type=\"checkbox\"\n                checked={addDividers}\n                onChange={(e) => setAddDividers(e.target.checked)}\n              />\n              Add divider pages between patterns\n            </label>\n          </div>\n          {addDividers && (\n            <div className=\"option\">\n              <label>\n                Divider text:\n                <input\n                  type=\"text\"\n                  value={dividerText}\n                  onChange={(e) => setDividerText(e.target.value)}\n                  placeholder=\"Pattern\"\n                  maxLength={255}\n                />\n              </label>\n            </div>\n          )}\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"collation-actions\">\n          <button\n            onClick={handleCollate}\n            disabled={loading || selectedPatterns.length === 0}\n            className=\"btn-primary\"\n          >\n            {loading ? 'Merging PDFs...' : 'Merge PDFs'}\n          </button>\n          {selectedPatterns.length > 0 && (\n            <button\n              onClick={() => setSelectedPatterns([])}\n              className=\"btn-secondary\"\n              disabled={loading}\n            >\n              Clear Selection\n            </button>\n          )}\n        </div>\n\n        {/* Result */}\n        {collationResult && (\n          <div className=\"collation-result\">\n            <h3> PDF Merged Successfully!</h3>\n            <div className=\"result-info\">\n              <p>\n                <strong>Patterns merged:</strong> {collationResult.patternCount}\n              </p>\n              <p>\n                <strong>Total pages:</strong> {collationResult.pageCount}\n              </p>\n              <p>\n                <strong>File size:</strong> {formatFileSize(collationResult.fileSize)}\n              </p>\n            </div>\n            <div className=\"result-actions\">\n              <a\n                href={collationResult.fileUrl}\n                download\n                className=\"btn-primary\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                Download Merged PDF\n              </a>\n              <button\n                onClick={() => {\n                  setCollationResult(null);\n                  setSelectedPatterns([]);\n                }}\n                className=\"btn-secondary\"\n              >\n                Merge More Patterns\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <style>{`\n        .pdf-collation {\n          max-width: 1200px;\n          margin: 0 auto;\n          padding: 20px;\n        }\n\n        .collation-header {\n          margin-bottom: 30px;\n        }\n\n        .collation-header h2 {\n          font-size: 24px;\n          font-weight: 600;\n          margin-bottom: 8px;\n        }\n\n        .description {\n          color: #6b7280;\n          font-size: 14px;\n        }\n\n        .error-message {\n          background-color: #fef2f2;\n          border: 1px solid #fecaca;\n          color: #991b1b;\n          padding: 12px 16px;\n          border-radius: 6px;\n          margin-bottom: 20px;\n        }\n\n        .collation-content {\n          display: grid;\n          gap: 30px;\n        }\n\n        .pattern-selection h3,\n        .selected-patterns h3,\n        .collation-options h3 {\n          font-size: 18px;\n          font-weight: 600;\n          margin-bottom: 16px;\n        }\n\n        .pattern-list {\n          display: grid;\n          gap: 12px;\n          max-height: 400px;\n          overflow-y: auto;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 16px;\n        }\n\n        .pattern-item {\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n          padding: 12px;\n          border: 2px solid #e5e7eb;\n          border-radius: 6px;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n\n        .pattern-item:hover {\n          border-color: #3b82f6;\n          background-color: #eff6ff;\n        }\n\n        .pattern-item.selected {\n          border-color: #3b82f6;\n          background-color: #dbeafe;\n        }\n\n        .pattern-item input[type='checkbox'] {\n          margin-top: 2px;\n          width: 18px;\n          height: 18px;\n          cursor: pointer;\n        }\n\n        .pattern-info {\n          flex: 1;\n        }\n\n        .pattern-name {\n          font-weight: 500;\n          margin-bottom: 4px;\n        }\n\n        .pattern-designer {\n          font-size: 14px;\n          color: #6b7280;\n          margin-bottom: 4px;\n        }\n\n        .pattern-category {\n          display: inline-block;\n          font-size: 12px;\n          padding: 2px 8px;\n          background-color: #f3f4f6;\n          border-radius: 4px;\n          color: #4b5563;\n        }\n\n        .pattern-order-list {\n          display: grid;\n          gap: 8px;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 16px;\n        }\n\n        .pattern-order-item {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 10px 12px;\n          background-color: #f9fafb;\n          border-radius: 6px;\n        }\n\n        .order-number {\n          font-weight: 600;\n          color: #6b7280;\n          min-width: 30px;\n        }\n\n        .pattern-order-item .pattern-name {\n          flex: 1;\n        }\n\n        .order-controls {\n          display: flex;\n          gap: 4px;\n        }\n\n        .btn-icon {\n          width: 32px;\n          height: 32px;\n          border: 1px solid #d1d5db;\n          background-color: white;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 16px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: all 0.2s;\n        }\n\n        .btn-icon:hover:not(:disabled) {\n          background-color: #f3f4f6;\n          border-color: #9ca3af;\n        }\n\n        .btn-icon:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .btn-icon.btn-remove {\n          color: #dc2626;\n          font-size: 24px;\n        }\n\n        .btn-icon.btn-remove:hover:not(:disabled) {\n          background-color: #fef2f2;\n          border-color: #fca5a5;\n        }\n\n        .collation-options {\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 20px;\n        }\n\n        .option {\n          margin-bottom: 16px;\n        }\n\n        .option:last-child {\n          margin-bottom: 0;\n        }\n\n        .option label {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          font-size: 14px;\n        }\n\n        .option input[type='checkbox'] {\n          width: 18px;\n          height: 18px;\n          cursor: pointer;\n        }\n\n        .option input[type='text'] {\n          margin-left: 8px;\n          padding: 6px 12px;\n          border: 1px solid #d1d5db;\n          border-radius: 4px;\n          font-size: 14px;\n        }\n\n        .collation-actions {\n          display: flex;\n          gap: 12px;\n        }\n\n        .btn-primary,\n        .btn-secondary {\n          padding: 12px 24px;\n          border-radius: 6px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s;\n          border: none;\n          font-size: 14px;\n        }\n\n        .btn-primary {\n          background-color: #3b82f6;\n          color: white;\n        }\n\n        .btn-primary:hover:not(:disabled) {\n          background-color: #2563eb;\n        }\n\n        .btn-primary:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n\n        .btn-secondary {\n          background-color: white;\n          color: #374151;\n          border: 1px solid #d1d5db;\n        }\n\n        .btn-secondary:hover:not(:disabled) {\n          background-color: #f9fafb;\n        }\n\n        .collation-result {\n          background-color: #f0fdf4;\n          border: 2px solid #86efac;\n          border-radius: 8px;\n          padding: 24px;\n        }\n\n        .collation-result h3 {\n          color: #166534;\n          font-size: 20px;\n          margin-bottom: 16px;\n        }\n\n        .result-info {\n          margin-bottom: 20px;\n        }\n\n        .result-info p {\n          margin-bottom: 8px;\n          font-size: 14px;\n          color: #166534;\n        }\n\n        .result-actions {\n          display: flex;\n          gap: 12px;\n        }\n\n        .result-actions a {\n          text-decoration: none;\n        }\n\n        @media (max-width: 768px) {\n          .pdf-collation {\n            padding: 16px;\n          }\n\n          .collation-header h2 {\n            font-size: 20px;\n          }\n\n          .collation-actions {\n            flex-direction: column;\n          }\n\n          .result-actions {\n            flex-direction: column;\n          }\n\n          .btn-primary,\n          .btn-secondary {\n            width: 100%;\n          }\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default PDFCollation;\n","import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport {\n  FiZoomIn,\n  FiZoomOut,\n  FiRotateCw,\n  FiInfo,\n  FiDownload,\n  FiPrinter,\n  FiCheck,\n  FiChevronLeft,\n  FiChevronRight,\n} from 'react-icons/fi';\n\ninterface ChartSymbol {\n  id: string;\n  symbol: string;\n  name: string;\n  description: string;\n  color?: string;\n}\n\ninterface ChartCell {\n  row: number;\n  col: number;\n  symbol: string;\n}\n\ninterface ChartViewerProps {\n  chartData: ChartCell[];\n  symbols: ChartSymbol[];\n  rows: number;\n  cols: number;\n  title?: string;\n  isInTheRound?: boolean;\n}\n\ninterface ViewState {\n  zoom: number;\n  rotation: number;\n  pan: { x: number; y: number };\n}\n\nexport const ChartViewer: React.FC<ChartViewerProps> = ({\n  chartData,\n  symbols,\n  rows,\n  cols,\n  title,\n  isInTheRound = false,\n}) => {\n  const [zoom, setZoom] = useState(1);\n  const [rotation, setRotation] = useState(0);\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [showLegend, setShowLegend] = useState(true);\n  const [highlightedRow, setHighlightedRow] = useState<number | null>(null);\n  const [highlightedCell, setHighlightedCell] = useState<{ row: number; col: number } | null>(null);\n  const [currentRow, setCurrentRow] = useState<number | null>(null);\n  const [canvasSize, setCanvasSize] = useState({ width: 800, height: 600 });\n\n  // Touch support state\n  const [touchStart, setTouchStart] = useState<{ x: number; y: number; dist: number } | null>(null);\n\n  // Undo/redo state\n  const [history, setHistory] = useState<ViewState[]>([{ zoom: 1, rotation: 0, pan: { x: 0, y: 0 } }]);\n  const [historyIndex, setHistoryIndex] = useState(0);\n\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const CELL_SIZE = 40;\n  const PADDING = 60;\n\n  // Responsive canvas sizing\n  useEffect(() => {\n    const updateSize = () => {\n      if (containerRef.current) {\n        const rect = containerRef.current.getBoundingClientRect();\n        setCanvasSize({\n          width: Math.max(600, rect.width),\n          height: Math.max(400, rect.height - 80), // Account for header\n        });\n      }\n    };\n\n    updateSize();\n    const resizeObserver = new ResizeObserver(updateSize);\n    if (containerRef.current) {\n      resizeObserver.observe(containerRef.current);\n    }\n\n    return () => resizeObserver.disconnect();\n  }, []);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      switch (e.key) {\n        case 'ArrowUp':\n          e.preventDefault();\n          if (highlightedCell) {\n            const newRow = Math.min(rows, highlightedCell.row + 1);\n            setHighlightedCell({ ...highlightedCell, row: newRow });\n            setHighlightedRow(newRow);\n          }\n          break;\n        case 'ArrowDown':\n          e.preventDefault();\n          if (highlightedCell) {\n            const newRow = Math.max(1, highlightedCell.row - 1);\n            setHighlightedCell({ ...highlightedCell, row: newRow });\n            setHighlightedRow(newRow);\n          }\n          break;\n        case 'ArrowLeft':\n          e.preventDefault();\n          if (highlightedCell) {\n            const newCol = Math.max(0, highlightedCell.col - 1);\n            setHighlightedCell({ ...highlightedCell, col: newCol });\n          }\n          break;\n        case 'ArrowRight':\n          e.preventDefault();\n          if (highlightedCell) {\n            const newCol = Math.min(cols - 1, highlightedCell.col + 1);\n            setHighlightedCell({ ...highlightedCell, col: newCol });\n          }\n          break;\n        case '+':\n        case '=':\n          e.preventDefault();\n          handleZoomIn();\n          break;\n        case '-':\n        case '_':\n          e.preventDefault();\n          handleZoomOut();\n          break;\n        case 'Home':\n          e.preventDefault();\n          if (highlightedCell) {\n            setHighlightedCell({ row: rows, col: 0 });\n            setHighlightedRow(rows);\n          }\n          break;\n        case 'End':\n          e.preventDefault();\n          if (highlightedCell) {\n            setHighlightedCell({ row: 1, col: cols - 1 });\n            setHighlightedRow(1);\n          }\n          break;\n        case 'Escape':\n          e.preventDefault();\n          setHighlightedCell(null);\n          setHighlightedRow(null);\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [highlightedCell, rows, cols]);\n\n  const saveToHistory = useCallback(() => {\n    const newState: ViewState = { zoom, rotation, pan };\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(newState);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  }, [zoom, rotation, pan, history, historyIndex]);\n\n  const undo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const state = history[newIndex];\n      setZoom(state.zoom);\n      setRotation(state.rotation);\n      setPan(state.pan);\n      setHistoryIndex(newIndex);\n    }\n  };\n\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const state = history[newIndex];\n      setZoom(state.zoom);\n      setRotation(state.rotation);\n      setPan(state.pan);\n      setHistoryIndex(newIndex);\n    }\n  };\n\n  useEffect(() => {\n    renderChart();\n  }, [chartData, zoom, rotation, pan, highlightedRow, highlightedCell, currentRow, canvasSize]);\n\n  const renderChart = (canvas?: HTMLCanvasElement, forPrint: boolean = false) => {\n    const targetCanvas = canvas || canvasRef.current;\n    if (!targetCanvas) return;\n\n    const ctx = targetCanvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = forPrint ? cols * CELL_SIZE + PADDING * 2 : targetCanvas.width;\n    const height = forPrint ? rows * CELL_SIZE + PADDING * 2 : targetCanvas.height;\n\n    if (forPrint) {\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n    }\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.save();\n\n    if (!forPrint) {\n      ctx.translate(width / 2 + pan.x, height / 2 + pan.y);\n      ctx.scale(zoom, zoom);\n      ctx.rotate((rotation * Math.PI) / 180);\n      ctx.translate(-width / 2, -height / 2);\n    }\n\n    const chartWidth = cols * CELL_SIZE;\n    const chartHeight = rows * CELL_SIZE;\n    const startX = (width - chartWidth) / 2;\n    const startY = (height - chartHeight) / 2;\n\n    // Draw grid\n    ctx.strokeStyle = '#e5e7eb';\n    ctx.lineWidth = 1;\n\n    for (let row = 0; row <= rows; row++) {\n      ctx.beginPath();\n      ctx.moveTo(startX, startY + row * CELL_SIZE);\n      ctx.lineTo(startX + chartWidth, startY + row * CELL_SIZE);\n      ctx.stroke();\n    }\n\n    for (let col = 0; col <= cols; col++) {\n      ctx.beginPath();\n      ctx.moveTo(startX + col * CELL_SIZE, startY);\n      ctx.lineTo(startX + col * CELL_SIZE, startY + chartHeight);\n      ctx.stroke();\n    }\n\n    // Draw row numbers\n    ctx.fillStyle = '#6b7280';\n    ctx.font = 'bold 12px Arial';\n    ctx.textAlign = 'right';\n    ctx.textBaseline = 'middle';\n\n    for (let row = 0; row < rows; row++) {\n      const displayRow = rows - row;\n      const y = startY + row * CELL_SIZE + CELL_SIZE / 2;\n\n      if (isInTheRound && displayRow % 2 === 0) {\n        ctx.fillStyle = '#3b82f6';\n      } else {\n        ctx.fillStyle = '#6b7280';\n      }\n\n      ctx.fillText(displayRow.toString(), startX - 10, y);\n    }\n\n    // Draw column numbers\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillStyle = '#6b7280';\n\n    for (let col = 0; col < cols; col++) {\n      const x = startX + col * CELL_SIZE + CELL_SIZE / 2;\n      ctx.fillText((col + 1).toString(), x, startY - 20);\n    }\n\n    // Highlight current row (row tracking)\n    if (currentRow !== null && !forPrint) {\n      ctx.fillStyle = 'rgba(34, 197, 94, 0.15)';\n      const rowIndex = rows - currentRow;\n      ctx.fillRect(startX, startY + rowIndex * CELL_SIZE, chartWidth, CELL_SIZE);\n\n      // Draw current row indicator\n      ctx.fillStyle = '#22c55e';\n      ctx.beginPath();\n      ctx.moveTo(startX - 5, startY + rowIndex * CELL_SIZE + CELL_SIZE / 2 - 6);\n      ctx.lineTo(startX - 5, startY + rowIndex * CELL_SIZE + CELL_SIZE / 2 + 6);\n      ctx.lineTo(startX - 15, startY + rowIndex * CELL_SIZE + CELL_SIZE / 2);\n      ctx.fill();\n    }\n\n    // Highlight row if selected\n    if (highlightedRow !== null && !forPrint) {\n      ctx.fillStyle = 'rgba(59, 130, 246, 0.2)';\n      const rowIndex = rows - highlightedRow;\n      ctx.fillRect(startX, startY + rowIndex * CELL_SIZE, chartWidth, CELL_SIZE);\n    }\n\n    // Highlight cell if selected\n    if (highlightedCell && !forPrint) {\n      ctx.strokeStyle = '#22c55e';\n      ctx.lineWidth = 3;\n      const rowIndex = rows - highlightedCell.row;\n      ctx.strokeRect(\n        startX + highlightedCell.col * CELL_SIZE,\n        startY + rowIndex * CELL_SIZE,\n        CELL_SIZE,\n        CELL_SIZE\n      );\n    }\n\n    // Draw symbols\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.font = '20px Arial';\n\n    chartData.forEach((cell) => {\n      const symbol = symbols.find((s) => s.id === cell.symbol);\n      const rowIndex = rows - cell.row;\n      const x = startX + cell.col * CELL_SIZE + CELL_SIZE / 2;\n      const y = startY + rowIndex * CELL_SIZE + CELL_SIZE / 2;\n\n      if (symbol) {\n        ctx.fillStyle = symbol.color || '#000000';\n        ctx.fillText(symbol.symbol, x, y);\n      }\n    });\n\n    ctx.restore();\n  };\n\n  const handleWheel = (e: React.WheelEvent) => {\n    e.preventDefault();\n    const delta = e.deltaY > 0 ? -0.1 : 0.1;\n    const newZoom = Math.max(0.5, Math.min(3, zoom + delta));\n    setZoom(newZoom);\n  };\n\n  // Touch event handlers\n  const getTouchDistance = (touches: React.TouchList) => {\n    if (touches.length < 2) return 0;\n    const dx = touches[0].clientX - touches[1].clientX;\n    const dy = touches[0].clientY - touches[1].clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if (e.touches.length === 1) {\n      setIsDragging(true);\n      setDragStart({ x: e.touches[0].clientX - pan.x, y: e.touches[0].clientY - pan.y });\n    } else if (e.touches.length === 2) {\n      const dist = getTouchDistance(e.touches);\n      const midX = (e.touches[0].clientX + e.touches[1].clientX) / 2;\n      const midY = (e.touches[0].clientY + e.touches[1].clientY) / 2;\n      setTouchStart({ x: midX, y: midY, dist });\n    }\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    e.preventDefault();\n\n    if (e.touches.length === 1 && isDragging) {\n      setPan({\n        x: e.touches[0].clientX - dragStart.x,\n        y: e.touches[0].clientY - dragStart.y,\n      });\n    } else if (e.touches.length === 2 && touchStart) {\n      const newDist = getTouchDistance(e.touches);\n      const scale = newDist / touchStart.dist;\n      const newZoom = Math.max(0.5, Math.min(3, zoom * scale));\n      setZoom(newZoom);\n      setTouchStart({ ...touchStart, dist: newDist });\n    }\n  };\n\n  const handleTouchEnd = () => {\n    setIsDragging(false);\n    setTouchStart(null);\n    saveToHistory();\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    setIsDragging(true);\n    setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (isDragging) {\n      setPan({\n        x: e.clientX - dragStart.x,\n        y: e.clientY - dragStart.y,\n      });\n    }\n  };\n\n  const handleMouseUp = () => {\n    if (isDragging) {\n      saveToHistory();\n    }\n    setIsDragging(false);\n  };\n\n  const handleCanvasClick = (e: React.MouseEvent) => {\n    if (isDragging) return;\n\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    const chartWidth = cols * CELL_SIZE;\n    const chartHeight = rows * CELL_SIZE;\n    const startX = (canvas.width - chartWidth) / 2;\n    const startY = (canvas.height - chartHeight) / 2;\n\n    const adjustedX = (x - pan.x - canvas.width / 2) / zoom + canvas.width / 2;\n    const adjustedY = (y - pan.y - canvas.height / 2) / zoom + canvas.height / 2;\n\n    const col = Math.floor((adjustedX - startX) / CELL_SIZE);\n    const rowIndex = Math.floor((adjustedY - startY) / CELL_SIZE);\n    const row = rows - rowIndex;\n\n    if (col >= 0 && col < cols && row > 0 && row <= rows) {\n      setHighlightedCell({ row, col });\n      setHighlightedRow(row);\n    } else {\n      setHighlightedCell(null);\n      setHighlightedRow(null);\n    }\n  };\n\n  const handleZoomIn = () => {\n    const newZoom = Math.min(3, zoom + 0.2);\n    setZoom(newZoom);\n    saveToHistory();\n  };\n\n  const handleZoomOut = () => {\n    const newZoom = Math.max(0.5, zoom - 0.2);\n    setZoom(newZoom);\n    saveToHistory();\n  };\n\n  const handleRotate = () => {\n    const newRotation = (rotation + 90) % 360;\n    setRotation(newRotation);\n    saveToHistory();\n  };\n\n  const resetView = () => {\n    setZoom(1);\n    setPan({ x: 0, y: 0 });\n    setRotation(0);\n    setHighlightedRow(null);\n    setHighlightedCell(null);\n    saveToHistory();\n  };\n\n  // Export to PNG\n  const exportToPNG = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const link = document.createElement('a');\n    link.download = `${title || 'chart'}.png`;\n    link.href = canvas.toDataURL('image/png');\n    link.click();\n  };\n\n  // Print support\n  const handlePrint = () => {\n    const printCanvas = document.createElement('canvas');\n    renderChart(printCanvas, true);\n\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) return;\n\n    printWindow.document.write(`\n      <html>\n        <head>\n          <title>${title || 'Knitting Chart'}</title>\n          <style>\n            body { margin: 0; padding: 20px; }\n            img { max-width: 100%; height: auto; }\n            h1 { font-family: Arial, sans-serif; margin-bottom: 20px; }\n            @media print {\n              body { padding: 0; }\n              h1 { page-break-after: avoid; }\n            }\n          </style>\n        </head>\n        <body>\n          <h1>${title || 'Knitting Chart'}</h1>\n          <img src=\"${printCanvas.toDataURL()}\" />\n        </body>\n      </html>\n    `);\n\n    printWindow.document.close();\n    setTimeout(() => {\n      printWindow.print();\n    }, 250);\n  };\n\n  const moveToNextRow = () => {\n    if (currentRow === null) {\n      setCurrentRow(1);\n    } else if (currentRow < rows) {\n      setCurrentRow(currentRow + 1);\n    }\n  };\n\n  const moveToPrevRow = () => {\n    if (currentRow !== null && currentRow > 1) {\n      setCurrentRow(currentRow - 1);\n    }\n  };\n\n  return (\n    <div className=\"chart-viewer\" ref={containerRef}>\n      <div className=\"chart-header\">\n        <div className=\"chart-title-section\">\n          {title && <h2 className=\"chart-title\">{title}</h2>}\n          {currentRow && (\n            <div className=\"current-row-indicator\">\n              <span className=\"current-row-label\">Current Row:</span>\n              <span className=\"current-row-number\">{currentRow}</span>\n            </div>\n          )}\n        </div>\n\n        <div className=\"chart-controls\">\n          <div className=\"control-group\">\n            <button\n              onClick={handleZoomOut}\n              className=\"control-btn\"\n              title=\"Zoom Out (-)\"\n              aria-label=\"Zoom out\"\n            >\n              <FiZoomOut />\n            </button>\n            <span className=\"zoom-level\">{Math.round(zoom * 100)}%</span>\n            <button\n              onClick={handleZoomIn}\n              className=\"control-btn\"\n              title=\"Zoom In (+)\"\n              aria-label=\"Zoom in\"\n            >\n              <FiZoomIn />\n            </button>\n          </div>\n\n          {isInTheRound && (\n            <button\n              onClick={handleRotate}\n              className=\"control-btn\"\n              title=\"Rotate Chart\"\n              aria-label=\"Rotate chart\"\n            >\n              <FiRotateCw />\n            </button>\n          )}\n\n          <div className=\"control-group\">\n            <button\n              onClick={moveToPrevRow}\n              className=\"control-btn\"\n              title=\"Previous Row\"\n              disabled={currentRow === null || currentRow === 1}\n              aria-label=\"Previous row\"\n            >\n              <FiChevronLeft />\n            </button>\n            <button\n              onClick={moveToNextRow}\n              className=\"control-btn\"\n              title=\"Next Row\"\n              disabled={currentRow === rows}\n              aria-label=\"Next row\"\n            >\n              <FiChevronRight />\n            </button>\n            {currentRow && (\n              <button\n                onClick={() => setCurrentRow(null)}\n                className=\"control-btn active\"\n                title=\"Clear Current Row\"\n                aria-label=\"Clear current row\"\n              >\n                <FiCheck />\n              </button>\n            )}\n          </div>\n\n          <button\n            onClick={() => setShowLegend(!showLegend)}\n            className={`control-btn ${showLegend ? 'active' : ''}`}\n            title=\"Toggle Legend\"\n            aria-label=\"Toggle legend\"\n          >\n            <FiInfo />\n          </button>\n\n          <button\n            onClick={exportToPNG}\n            className=\"control-btn\"\n            title=\"Export to PNG\"\n            aria-label=\"Export to PNG\"\n          >\n            <FiDownload />\n          </button>\n\n          <button\n            onClick={handlePrint}\n            className=\"control-btn\"\n            title=\"Print Chart\"\n            aria-label=\"Print chart\"\n          >\n            <FiPrinter />\n          </button>\n\n          <div className=\"control-group\">\n            <button\n              onClick={undo}\n              className=\"control-btn-text\"\n              disabled={historyIndex === 0}\n              title=\"Undo (Ctrl+Z)\"\n            >\n              Undo\n            </button>\n            <button\n              onClick={redo}\n              className=\"control-btn-text\"\n              disabled={historyIndex === history.length - 1}\n              title=\"Redo (Ctrl+Y)\"\n            >\n              Redo\n            </button>\n          </div>\n\n          <button onClick={resetView} className=\"control-btn-text\">\n            Reset View\n          </button>\n        </div>\n      </div>\n\n      <div className=\"chart-container\">\n        <canvas\n          ref={canvasRef}\n          width={canvasSize.width}\n          height={canvasSize.height}\n          onWheel={handleWheel}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          onClick={handleCanvasClick}\n          onTouchStart={handleTouchStart}\n          onTouchMove={handleTouchMove}\n          onTouchEnd={handleTouchEnd}\n          style={{ cursor: isDragging ? 'grabbing' : 'grab', touchAction: 'none' }}\n          tabIndex={0}\n          role=\"img\"\n          aria-label=\"Interactive knitting chart\"\n        />\n\n        {showLegend && (\n          <div className=\"symbol-legend\" role=\"complementary\" aria-label=\"Symbol legend\">\n            <h3 className=\"legend-title\">Symbol Legend</h3>\n            <div className=\"legend-items\">\n              {symbols.map((symbol) => (\n                <div key={symbol.id} className=\"legend-item\">\n                  <span\n                    className=\"legend-symbol\"\n                    style={{ color: symbol.color || '#000000' }}\n                    aria-hidden=\"true\"\n                  >\n                    {symbol.symbol}\n                  </span>\n                  <div className=\"legend-info\">\n                    <div className=\"legend-name\">{symbol.name}</div>\n                    <div className=\"legend-description\">{symbol.description}</div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {highlightedCell && (\n          <div className=\"chart-info\" role=\"status\" aria-live=\"polite\">\n            <strong>Selected:</strong> Row {highlightedCell.row}, Stitch {highlightedCell.col + 1}\n          </div>\n        )}\n\n        <div className=\"keyboard-hint\" role=\"note\">\n          <small>\n            Keyboard: Arrow keys to navigate  +/- to zoom  Esc to deselect\n          </small>\n        </div>\n      </div>\n\n      <style>{`\n        .chart-viewer {\n          width: 100%;\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n          min-height: 500px;\n        }\n\n        .chart-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 16px;\n          background-color: #f9fafb;\n          border-bottom: 1px solid #e5e7eb;\n          flex-wrap: wrap;\n          gap: 12px;\n        }\n\n        .chart-title-section {\n          display: flex;\n          align-items: center;\n          gap: 16px;\n        }\n\n        .chart-title {\n          font-size: 20px;\n          font-weight: 600;\n          color: #111827;\n          margin: 0;\n        }\n\n        .current-row-indicator {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 6px 12px;\n          background-color: #22c55e;\n          color: white;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: 500;\n        }\n\n        .current-row-label {\n          opacity: 0.9;\n        }\n\n        .current-row-number {\n          font-size: 18px;\n          font-weight: 700;\n        }\n\n        .chart-controls {\n          display: flex;\n          gap: 8px;\n          align-items: center;\n          flex-wrap: wrap;\n        }\n\n        .control-group {\n          display: flex;\n          gap: 4px;\n          align-items: center;\n          padding: 0 4px;\n          border-left: 1px solid #d1d5db;\n        }\n\n        .control-group:first-child {\n          border-left: none;\n          padding-left: 0;\n        }\n\n        .control-btn {\n          width: 36px;\n          height: 36px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border: 1px solid #d1d5db;\n          background-color: white;\n          border-radius: 6px;\n          cursor: pointer;\n          transition: all 0.2s;\n          color: #374151;\n        }\n\n        .control-btn:hover:not(:disabled) {\n          background-color: #f3f4f6;\n          border-color: #9ca3af;\n        }\n\n        .control-btn:disabled {\n          opacity: 0.4;\n          cursor: not-allowed;\n        }\n\n        .control-btn.active {\n          background-color: #3b82f6;\n          color: white;\n          border-color: #3b82f6;\n        }\n\n        .control-btn-text {\n          padding: 8px 12px;\n          border: 1px solid #d1d5db;\n          background-color: white;\n          border-radius: 6px;\n          cursor: pointer;\n          font-size: 13px;\n          font-weight: 500;\n          transition: all 0.2s;\n          color: #374151;\n        }\n\n        .control-btn-text:hover:not(:disabled) {\n          background-color: #f3f4f6;\n          border-color: #9ca3af;\n        }\n\n        .control-btn-text:disabled {\n          opacity: 0.4;\n          cursor: not-allowed;\n        }\n\n        .zoom-level {\n          font-size: 13px;\n          font-weight: 500;\n          color: #4b5563;\n          min-width: 45px;\n          text-align: center;\n        }\n\n        .chart-container {\n          position: relative;\n          flex: 1;\n          background-color: #ffffff;\n          overflow: hidden;\n        }\n\n        canvas {\n          display: block;\n          width: 100%;\n          height: 100%;\n        }\n\n        canvas:focus {\n          outline: 2px solid #3b82f6;\n          outline-offset: -2px;\n        }\n\n        .symbol-legend {\n          position: absolute;\n          top: 16px;\n          right: 16px;\n          background-color: white;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 16px;\n          max-width: 300px;\n          max-height: calc(100% - 80px);\n          overflow-y: auto;\n          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n\n        .legend-title {\n          font-size: 16px;\n          font-weight: 600;\n          margin: 0 0 12px 0;\n          color: #111827;\n        }\n\n        .legend-items {\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n        }\n\n        .legend-item {\n          display: flex;\n          gap: 12px;\n          align-items: flex-start;\n        }\n\n        .legend-symbol {\n          font-size: 24px;\n          font-weight: bold;\n          min-width: 32px;\n          text-align: center;\n        }\n\n        .legend-info {\n          flex: 1;\n        }\n\n        .legend-name {\n          font-weight: 500;\n          font-size: 14px;\n          color: #111827;\n          margin-bottom: 2px;\n        }\n\n        .legend-description {\n          font-size: 12px;\n          color: #6b7280;\n        }\n\n        .chart-info {\n          position: absolute;\n          bottom: 50px;\n          left: 50%;\n          transform: translateX(-50%);\n          background-color: rgba(17, 24, 39, 0.9);\n          color: white;\n          padding: 8px 16px;\n          border-radius: 6px;\n          font-size: 14px;\n          pointer-events: none;\n          white-space: nowrap;\n        }\n\n        .keyboard-hint {\n          position: absolute;\n          bottom: 16px;\n          left: 50%;\n          transform: translateX(-50%);\n          background-color: rgba(249, 250, 251, 0.95);\n          color: #6b7280;\n          padding: 6px 12px;\n          border-radius: 6px;\n          font-size: 12px;\n          pointer-events: none;\n          border: 1px solid #e5e7eb;\n        }\n\n        @media print {\n          .chart-header,\n          .chart-controls,\n          .symbol-legend,\n          .chart-info,\n          .keyboard-hint {\n            display: none !important;\n          }\n\n          .chart-viewer {\n            height: auto;\n          }\n\n          canvas {\n            width: 100% !important;\n            height: auto !important;\n          }\n        }\n\n        @media (max-width: 768px) {\n          .chart-header {\n            flex-direction: column;\n            align-items: stretch;\n          }\n\n          .chart-title-section {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 8px;\n          }\n\n          .chart-controls {\n            justify-content: center;\n            flex-wrap: wrap;\n          }\n\n          .control-group {\n            border-left: none;\n            padding: 0;\n          }\n\n          .symbol-legend {\n            position: static;\n            max-width: 100%;\n            margin: 16px;\n            max-height: 300px;\n          }\n\n          .keyboard-hint {\n            display: none;\n          }\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ChartViewer;\n","import { useState, useEffect, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { FiPlus, FiTrash2, FiBook, FiSearch, FiX, FiSettings, FiGrid } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { PDFCollation } from '../components/patterns';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  description: string;\n  designer: string;\n  difficulty: string;\n  category: string;\n  created_at: string;\n}\n\nexport default function Patterns() {\n  const navigate = useNavigate();\n  const [patterns, setPatterns] = useState<Pattern[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showCollationModal, setShowCollationModal] = useState(false);\n  const [editingPattern, setEditingPattern] = useState<Pattern | null>(null);\n  const [patternFiles, setPatternFiles] = useState<File[]>([]);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n\n  // Search and filter state\n  const [searchQuery, setSearchQuery] = useState('');\n  const [difficultyFilter, setDifficultyFilter] = useState<string>('all');\n  const [categoryFilter, setCategoryFilter] = useState<string>('all');\n\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    designer: '',\n    difficulty: 'intermediate',\n    category: 'sweater',\n  });\n\n  useEffect(() => {\n    fetchPatterns();\n  }, []);\n\n  const fetchPatterns = async () => {\n    try {\n      const response = await axios.get('/api/patterns');\n      setPatterns(response.data.data.patterns);\n    } catch (error: any) {\n      console.error('Error fetching patterns:', error);\n      toast.error('Failed to load patterns');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreatePattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    setUploadingFiles(true);\n\n    try {\n      // Step 1: Create the pattern\n      const createResponse = await axios.post('/api/patterns', formData);\n      const newPattern = createResponse.data.data.pattern;\n      toast.success('Pattern created!');\n\n      // Step 2: Upload PDF files if any\n      if (patternFiles.length > 0) {\n        let uploadedCount = 0;\n        for (const file of patternFiles) {\n          try {\n            const fileFormData = new FormData();\n            fileFormData.append('file', file);\n\n            await axios.post(`/api/uploads/patterns/${newPattern.id}/files`, fileFormData, {\n              headers: {\n                'Content-Type': 'multipart/form-data',\n              },\n            });\n            uploadedCount++;\n          } catch (error) {\n            console.error(`Failed to upload ${file.name}:`, error);\n          }\n        }\n\n        if (uploadedCount === patternFiles.length) {\n          toast.success(`Pattern created with ${uploadedCount} PDF${uploadedCount > 1 ? 's' : ''}!`);\n        } else {\n          toast.warning(`Pattern created but only ${uploadedCount}/${patternFiles.length} files uploaded`);\n        }\n      }\n\n      // Reset and close\n      setShowCreateModal(false);\n      setFormData({\n        name: '',\n        description: '',\n        designer: '',\n        difficulty: 'intermediate',\n        category: 'sweater',\n      });\n      setPatternFiles([]);\n      fetchPatterns();\n    } catch (error: any) {\n      console.error('Error creating pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to create pattern');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n\n  const handleEditClick = (pattern: Pattern) => {\n    setEditingPattern(pattern);\n    setFormData({\n      name: pattern.name || '',\n      description: pattern.description || '',\n      designer: pattern.designer || '',\n      difficulty: pattern.difficulty || 'intermediate',\n      category: pattern.category || 'sweater',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdatePattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingPattern) return;\n\n    try {\n      await axios.put(`/api/patterns/${editingPattern.id}`, formData);\n      toast.success('Pattern updated successfully!');\n      setShowEditModal(false);\n      setEditingPattern(null);\n      setFormData({\n        name: '',\n        description: '',\n        designer: '',\n        difficulty: 'intermediate',\n        category: 'sweater',\n      });\n      fetchPatterns();\n    } catch (error: any) {\n      console.error('Error updating pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to update pattern');\n    }\n  };\n\n  const handleDeletePattern = async (id: string, name: string) => {\n    if (deletingId) return;\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    setDeletingId(id);\n    try {\n      await axios.delete(`/api/patterns/${id}`);\n      toast.success('Pattern deleted successfully');\n      fetchPatterns();\n    } catch (error) {\n      console.error('Error deleting pattern:', error);\n      toast.error('Failed to delete pattern');\n    } finally {\n      setDeletingId(null);\n    }\n  };\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'beginner':\n        return 'bg-green-100 text-green-800';\n      case 'intermediate':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'advanced':\n        return 'bg-orange-100 text-orange-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  // Filter and search patterns\n  const filteredPatterns = useMemo(() => {\n    return patterns.filter((pattern) => {\n      // Search filter\n      const searchLower = searchQuery.toLowerCase();\n      const matchesSearch =\n        !searchQuery ||\n        pattern.name.toLowerCase().includes(searchLower) ||\n        pattern.description?.toLowerCase().includes(searchLower) ||\n        pattern.designer?.toLowerCase().includes(searchLower) ||\n        pattern.category?.toLowerCase().includes(searchLower);\n\n      // Difficulty filter\n      const matchesDifficulty =\n        difficultyFilter === 'all' || pattern.difficulty === difficultyFilter;\n\n      // Category filter\n      const matchesCategory =\n        categoryFilter === 'all' || pattern.category === categoryFilter;\n\n      return matchesSearch && matchesDifficulty && matchesCategory;\n    });\n  }, [patterns, searchQuery, difficultyFilter, categoryFilter]);\n\n  // Get unique categories for filter dropdown\n  const categories = useMemo(() => {\n    const cats = new Set(patterns.map((p) => p.category).filter(Boolean));\n    return Array.from(cats).sort();\n  }, [patterns]);\n\n  const clearFilters = () => {\n    setSearchQuery('');\n    setDifficultyFilter('all');\n    setCategoryFilter('all');\n  };\n\n  const hasActiveFilters = searchQuery || difficultyFilter !== 'all' || categoryFilter !== 'all';\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading patterns...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Patterns</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your knitting pattern library</p>\n        </div>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={() => setShowCollationModal(true)}\n            className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n            disabled={patterns.length === 0}\n          >\n            <FiBook className=\"mr-2\" />\n            Merge PDFs\n          </button>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            New Pattern\n          </button>\n        </div>\n      </div>\n\n      {/* Search and Filter Bar */}\n      {patterns.length > 0 && (\n        <div className=\"bg-white rounded-lg shadow p-4 mb-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            {/* Search Input */}\n            <div className=\"flex-1 relative\">\n              <FiSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search patterns, designers...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              />\n            </div>\n\n            {/* Difficulty Filter */}\n            <select\n              value={difficultyFilter}\n              onChange={(e) => setDifficultyFilter(e.target.value)}\n              className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            >\n              <option value=\"all\">All Difficulties</option>\n              <option value=\"beginner\">Beginner</option>\n              <option value=\"intermediate\">Intermediate</option>\n              <option value=\"advanced\">Advanced</option>\n              <option value=\"expert\">Expert</option>\n            </select>\n\n            {/* Category Filter */}\n            <select\n              value={categoryFilter}\n              onChange={(e) => setCategoryFilter(e.target.value)}\n              className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            >\n              <option value=\"all\">All Categories</option>\n              {categories.map((cat) => (\n                <option key={cat} value={cat}>\n                  {cat.charAt(0).toUpperCase() + cat.slice(1)}\n                </option>\n              ))}\n            </select>\n\n            {/* Clear Filters */}\n            {hasActiveFilters && (\n              <button\n                onClick={clearFilters}\n                className=\"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 transition\"\n              >\n                <FiX className=\"mr-2\" />\n                Clear\n              </button>\n            )}\n          </div>\n\n          {/* Results count */}\n          {hasActiveFilters && (\n            <div className=\"mt-3 text-sm text-gray-600\">\n              Showing {filteredPatterns.length} of {patterns.length} patterns\n            </div>\n          )}\n        </div>\n      )}\n\n      {patterns.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiBook className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No patterns yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start building your pattern library</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Pattern\n          </button>\n        </div>\n      ) : filteredPatterns.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiSearch className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No matching patterns</h3>\n          <p className=\"text-gray-500 mb-4\">Try adjusting your search or filters</p>\n          <button\n            onClick={clearFilters}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiX className=\"mr-2\" />\n            Clear Filters\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {filteredPatterns.map((pattern) => (\n            <div\n              key={pattern.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition\"\n            >\n              {/* Clickable card area */}\n              <div\n                onClick={() => navigate(`/patterns/${pattern.id}`)}\n                className=\"cursor-pointer p-6 pb-4\"\n              >\n                <div className=\"flex items-start justify-between mb-3\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 flex-1 hover:text-purple-600 transition\">\n                    {pattern.name}\n                  </h3>\n                  {pattern.difficulty && (\n                    <span\n                      className={`px-2 py-1 text-xs font-medium rounded-full ${getDifficultyColor(\n                        pattern.difficulty\n                      )}`}\n                    >\n                      {pattern.difficulty}\n                    </span>\n                  )}\n                </div>\n\n                {pattern.designer && (\n                  <p className=\"text-sm text-gray-600 mb-2\">by {pattern.designer}</p>\n                )}\n\n                {pattern.description && (\n                  <p className=\"text-gray-600 text-sm mb-4 line-clamp-2\">\n                    {pattern.description}\n                  </p>\n                )}\n\n                {pattern.category && (\n                  <div className=\"text-sm text-gray-500 mb-2\">\n                    Category: {pattern.category}\n                  </div>\n                )}\n              </div>\n\n              {/* Action buttons */}\n              <div className=\"px-6 pb-6\">\n                <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      navigate(`/patterns/${pattern.id}/builder`);\n                    }}\n                    className=\"flex-1 px-3 py-2 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition flex items-center justify-center text-sm\"\n                  >\n                    <FiGrid className=\"mr-2 h-4 w-4\" />\n                    Edit Pattern\n                  </button>\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleEditClick(pattern);\n                    }}\n                    className=\"px-3 py-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 transition flex items-center justify-center text-sm\"\n                    title=\"Edit pattern details\"\n                  >\n                    <FiSettings className=\"h-4 w-4\" />\n                  </button>\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleDeletePattern(pattern.id, pattern.name);\n                    }}\n                    disabled={deletingId === pattern.id}\n                    className=\"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\n                    title=\"Delete pattern\"\n                  >\n                    {deletingId === pattern.id ? (\n                      <span className=\"h-4 w-4 animate-spin rounded-full border-2 border-red-600 border-t-transparent inline-block\" />\n                    ) : (\n                      <FiTrash2 className=\"h-4 w-4\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Pattern Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add New Pattern</h2>\n            </div>\n\n            <form onSubmit={handleCreatePattern} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Classic Raglan Sweater\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Designer\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.designer}\n                  onChange={(e) => setFormData({ ...formData, designer: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"Pattern designer name\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Difficulty\n                  </label>\n                  <select\n                    value={formData.difficulty}\n                    onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"beginner\">Beginner</option>\n                    <option value=\"intermediate\">Intermediate</option>\n                    <option value=\"advanced\">Advanced</option>\n                    <option value=\"expert\">Expert</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Category\n                  </label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"sweater\">Sweater</option>\n                    <option value=\"scarf\">Scarf</option>\n                    <option value=\"hat\">Hat</option>\n                    <option value=\"blanket\">Blanket</option>\n                    <option value=\"socks\">Socks</option>\n                    <option value=\"shawl\">Shawl</option>\n                    <option value=\"toy\">Toy/Amigurumi</option>\n                    <option value=\"other\">Other</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Pattern details, notes, etc.\"\n                />\n              </div>\n\n              {/* PDF Upload */}\n              <div className=\"border-t border-gray-200 pt-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern PDF Files (Optional)\n                </label>\n                <p className=\"text-sm text-gray-500 mb-2\">\n                  Upload one or more PDF files for this pattern\n                </p>\n                <input\n                  type=\"file\"\n                  accept=\".pdf,application/pdf\"\n                  multiple\n                  onChange={(e) => {\n                    if (e.target.files) {\n                      setPatternFiles(Array.from(e.target.files));\n                    }\n                  }}\n                  disabled={uploadingFiles}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed\"\n                />\n                {patternFiles.length > 0 && (\n                  <div className=\"mt-3 space-y-1\">\n                    <p className=\"text-sm font-medium text-gray-700\">\n                      Selected files ({patternFiles.length}):\n                    </p>\n                    {patternFiles.map((file, index) => (\n                      <div key={index} className=\"text-sm text-gray-600 flex items-center justify-between bg-gray-50 px-3 py-2 rounded\">\n                        <span>{file.name}</span>\n                        <span className=\"text-gray-500\">({(file.size / 1024 / 1024).toFixed(2)} MB)</span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateModal(false);\n                    setPatternFiles([]);\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                  disabled={uploadingFiles}\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed\"\n                  disabled={uploadingFiles}\n                >\n                  {uploadingFiles ? 'Creating & Uploading...' : 'Add Pattern'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Pattern Modal */}\n      {showEditModal && editingPattern && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Pattern</h2>\n            </div>\n\n            <form onSubmit={handleUpdatePattern} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Pattern Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., Classic Raglan Sweater\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Designer\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.designer}\n                  onChange={(e) => setFormData({ ...formData, designer: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"Pattern designer name\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Difficulty\n                  </label>\n                  <select\n                    value={formData.difficulty}\n                    onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"beginner\">Beginner</option>\n                    <option value=\"intermediate\">Intermediate</option>\n                    <option value=\"advanced\">Advanced</option>\n                    <option value=\"expert\">Expert</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Category\n                  </label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"sweater\">Sweater</option>\n                    <option value=\"scarf\">Scarf</option>\n                    <option value=\"hat\">Hat</option>\n                    <option value=\"blanket\">Blanket</option>\n                    <option value=\"socks\">Socks</option>\n                    <option value=\"shawl\">Shawl</option>\n                    <option value=\"toy\">Toy/Amigurumi</option>\n                    <option value=\"other\">Other</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Pattern details, notes, etc.\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingPattern(null);\n                    setFormData({\n                      name: '',\n                      description: '',\n                      designer: '',\n                      difficulty: 'intermediate',\n                      category: 'sweater',\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Pattern\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* PDF Collation Modal */}\n      {showCollationModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Merge Pattern PDFs</h2>\n              <button\n                onClick={() => setShowCollationModal(false)}\n                className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n              >\n                \n              </button>\n            </div>\n            <div className=\"p-6\">\n              <PDFCollation />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useRef } from 'react';\nimport { FiUpload, FiX, FiFile, FiImage, FiFileText, FiDownload, FiTrash2, FiEye } from 'react-icons/fi';\nimport PatternViewer from './patterns/PatternViewer';\n\ninterface PatternFile {\n  id: string;\n  filename: string;\n  original_filename: string;\n  file_path: string;\n  mime_type: string;\n  size: number;\n  file_type: 'pdf' | 'image' | 'document' | 'other';\n  description?: string;\n  created_at: string;\n}\n\ninterface PatternFileUploadProps {\n  files: PatternFile[];\n  onUpload: (file: File, description?: string) => Promise<void>;\n  onDelete: (fileId: string) => Promise<void>;\n  onDownload: (fileId: string, filename: string) => Promise<void>;\n  patternId?: string;\n}\n\nexport default function PatternFileUpload({\n  files,\n  onUpload,\n  onDelete,\n  onDownload,\n  patternId,\n}: PatternFileUploadProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [description, setDescription] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const [viewingFile, setViewingFile] = useState<PatternFile | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const acceptedTypes = [\n    'application/pdf',\n    'application/x-pdf',\n    'application/acrobat',\n    'applications/vnd.pdf',\n    'text/pdf',\n    'text/x-pdf',\n    '.pdf',\n    'image/jpeg',\n    'image/jpg',\n    'image/png',\n    'image/webp',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'text/plain',\n  ].join(',');\n\n  const handleFileSelect = (file: File) => {\n    // Validate file extension as primary check\n    const fileName = file.name.toLowerCase();\n    const validExtensions = ['.pdf', '.jpg', '.jpeg', '.png', '.webp', '.doc', '.docx', '.txt'];\n    const hasValidExtension = validExtensions.some(ext => fileName.endsWith(ext));\n\n    // Validate file type (MIME type)\n    const validTypes = acceptedTypes.split(',').map(t => t.trim());\n    const hasValidMimeType = validTypes.includes(file.type);\n\n    // Accept file if either extension or MIME type is valid (handles browser inconsistencies)\n    if (!hasValidExtension && !hasValidMimeType) {\n      alert(`Invalid file type: ${file.type || 'unknown'}\\n\\nAccepted file types:\\n- PDF documents (.pdf)\\n- Images (.jpg, .png, .webp)\\n- Word documents (.doc, .docx)\\n- Text files (.txt)\\n\\nPlease make sure your file has the correct extension.`);\n      return;\n    }\n\n    // Validate file size (25MB max)\n    const fileSizeMB = file.size / (1024 * 1024);\n    if (fileSizeMB > 25) {\n      alert(`File size (${fileSizeMB.toFixed(1)}MB) exceeds the 25MB limit.\\n\\nPlease choose a smaller file or compress your PDF.`);\n      return;\n    }\n\n    setSelectedFile(file);\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      handleFileSelect(file);\n    }\n  };\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true);\n    } else if (e.type === 'dragleave') {\n      setDragActive(false);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    try {\n      await onUpload(selectedFile, description);\n      // Reset after successful upload\n      setSelectedFile(null);\n      setDescription('');\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } catch (error) {\n      console.error('Upload error:', error);\n      alert('Failed to upload file. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setSelectedFile(null);\n    setDescription('');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const getFileIcon = (fileType: string) => {\n    switch (fileType) {\n      case 'pdf':\n        return <FiFile className=\"w-6 h-6 text-red-500\" />;\n      case 'image':\n        return <FiImage className=\"w-6 h-6 text-blue-500\" />;\n      case 'document':\n        return <FiFileText className=\"w-6 h-6 text-blue-600\" />;\n      default:\n        return <FiFile className=\"w-6 h-6 text-gray-500\" />;\n    }\n  };\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Upload Section */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm\">\n        <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n          Upload Pattern Files\n        </h3>\n\n        {/* Drag and drop area */}\n        <div\n          className={`\n            border-2 border-dashed rounded-lg p-8 text-center transition-colors\n            ${dragActive\n              ? 'border-pink-500 bg-pink-50 dark:bg-pink-900/10'\n              : 'border-gray-300 dark:border-gray-600 hover:border-pink-400 dark:hover:border-pink-500'\n            }\n          `}\n          onDragEnter={handleDrag}\n          onDragLeave={handleDrag}\n          onDragOver={handleDrag}\n          onDrop={handleDrop}\n        >\n          <FiUpload className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n          <p className=\"mb-2 text-sm text-gray-600 dark:text-gray-400\">\n            <span className=\"font-semibold\">Click to upload</span> or drag and drop\n          </p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n            PDF, Images, Word documents, or text files (MAX. 25MB)\n          </p>\n\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            className=\"hidden\"\n            accept={acceptedTypes}\n            onChange={handleInputChange}\n          />\n\n          <button\n            type=\"button\"\n            onClick={() => fileInputRef.current?.click()}\n            className=\"mt-4 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors\"\n          >\n            Select File\n          </button>\n        </div>\n\n        {/* Selected file preview */}\n        {selectedFile && (\n          <div className=\"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                <FiFile className=\"w-6 h-6 text-gray-500\" />\n                <div>\n                  <p className=\"font-medium text-gray-900 dark:text-white\">\n                    {selectedFile.name}\n                  </p>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    {formatFileSize(selectedFile.size)}\n                  </p>\n                </div>\n              </div>\n              <button\n                onClick={handleCancel}\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n              >\n                <FiX className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            {/* Description input */}\n            <div className=\"mb-3\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Description (optional)\n              </label>\n              <input\n                type=\"text\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"E.g., Main pattern, Size chart, Assembly instructions...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\n              />\n            </div>\n\n            <button\n              onClick={handleUpload}\n              disabled={uploading}\n              className=\"w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {uploading ? 'Uploading...' : 'Upload File'}\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Files List */}\n      {files.length > 0 && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm\">\n          <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n            Pattern Files ({files.length})\n          </h3>\n\n          <div className=\"space-y-3\">\n            {files.map((file) => (\n              <div\n                key={file.id}\n                className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-650 transition-colors\"\n              >\n                <div className=\"flex items-center space-x-3 flex-1\">\n                  {getFileIcon(file.file_type)}\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-gray-900 dark:text-white truncate\">\n                      {file.original_filename}\n                    </p>\n                    {file.description && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                        {file.description}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n                      {formatFileSize(file.size)}  {new Date(file.created_at).toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center space-x-2 ml-4\">\n                  {file.file_type === 'pdf' && patternId && (\n                    <button\n                      onClick={() => setViewingFile(file)}\n                      className=\"p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors\"\n                      title=\"View PDF\"\n                    >\n                      <FiEye className=\"w-5 h-5\" />\n                    </button>\n                  )}\n                  <button\n                    onClick={() => onDownload(file.id, file.original_filename)}\n                    className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\n                    title=\"Download\"\n                  >\n                    <FiDownload className=\"w-5 h-5\" />\n                  </button>\n                  <button\n                    onClick={() => {\n                      if (window.confirm('Are you sure you want to delete this file?')) {\n                        onDelete(file.id);\n                      }\n                    }}\n                    className=\"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\n                    title=\"Delete\"\n                  >\n                    <FiTrash2 className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* PDF Viewer Modal */}\n      {viewingFile && viewingFile.file_type === 'pdf' && patternId && (\n        <PatternViewer\n          fileUrl={`/api/uploads/patterns/${patternId}/files/${viewingFile.id}/download`}\n          filename={viewingFile.original_filename}\n          patternId={patternId}\n          onClose={() => setViewingFile(null)}\n        />\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { FiSave, FiX, FiPlus, FiMinus, FiGrid, FiEdit3, FiTrash2, FiRotateCcw, FiRotateCw } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface ChartSymbol {\n  id: string;\n  symbol: string;\n  name: string;\n  description: string;\n  color?: string;\n  category: string;\n}\n\ninterface ChartCell {\n  row: number;\n  col: number;\n  symbol: string;\n}\n\ninterface ChartData {\n  id?: string;\n  title: string;\n  rows: number;\n  cols: number;\n  isInTheRound: boolean;\n  notes?: string;\n  chartData: ChartCell[];\n  symbols: ChartSymbol[];\n}\n\ninterface ChartEditorProps {\n  patternId: string;\n  chartData?: ChartData;\n  onSave?: () => void;\n  onCancel?: () => void;\n}\n\ntype Tool = 'pencil' | 'eraser' | 'fill';\n\nexport function ChartEditor({ patternId, chartData, onSave, onCancel }: ChartEditorProps) {\n  const [title, setTitle] = useState(chartData?.title || '');\n  const [rows, setRows] = useState(chartData?.rows || 20);\n  const [cols, setCols] = useState(chartData?.cols || 20);\n  const [isInTheRound, setIsInTheRound] = useState(chartData?.isInTheRound || false);\n  const [notes, setNotes] = useState(chartData?.notes || '');\n  const [cells, setCells] = useState<ChartCell[]>(chartData?.chartData || []);\n  const [availableSymbols, setAvailableSymbols] = useState<ChartSymbol[]>([]);\n  const [selectedSymbol, setSelectedSymbol] = useState<ChartSymbol | null>(null);\n  const [activeTool, setActiveTool] = useState<Tool>('pencil');\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [history, setHistory] = useState<ChartCell[][]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [saving, setSaving] = useState(false);\n  const [zoom, setZoom] = useState(1);\n  const canvasRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    fetchSymbols();\n  }, []);\n\n  useEffect(() => {\n    // Initialize history\n    if (history.length === 0) {\n      setHistory([cells]);\n      setHistoryIndex(0);\n    }\n  }, []);\n\n  const fetchSymbols = async () => {\n    try {\n      const response = await axios.get('/api/chart-symbols');\n      const symbols = response.data.data.symbols;\n      setAvailableSymbols(symbols);\n      if (symbols.length > 0 && !selectedSymbol) {\n        setSelectedSymbol(symbols[0]);\n      }\n    } catch (error) {\n      console.error('Error fetching symbols:', error);\n      toast.error('Failed to load chart symbols');\n    }\n  };\n\n  const addToHistory = (newCells: ChartCell[]) => {\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(newCells);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  };\n\n  const undo = () => {\n    if (historyIndex > 0) {\n      setHistoryIndex(historyIndex - 1);\n      setCells(history[historyIndex - 1]);\n    }\n  };\n\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      setHistoryIndex(historyIndex + 1);\n      setCells(history[historyIndex + 1]);\n    }\n  };\n\n  const getCellSymbol = (row: number, col: number): string | null => {\n    const cell = cells.find(c => c.row === row && c.col === col);\n    return cell?.symbol || null;\n  };\n\n  const handleCellClick = (row: number, col: number) => {\n    if (activeTool === 'pencil' && selectedSymbol) {\n      const newCells = cells.filter(c => !(c.row === row && c.col === col));\n      newCells.push({ row, col, symbol: selectedSymbol.id });\n      setCells(newCells);\n      addToHistory(newCells);\n    } else if (activeTool === 'eraser') {\n      const newCells = cells.filter(c => !(c.row === row && c.col === col));\n      setCells(newCells);\n      addToHistory(newCells);\n    } else if (activeTool === 'fill' && selectedSymbol) {\n      // Fill all empty cells with selected symbol\n      const newCells = [...cells];\n      for (let r = 0; r < rows; r++) {\n        for (let c = 0; c < cols; c++) {\n          if (!getCellSymbol(r, c)) {\n            newCells.push({ row: r, col: c, symbol: selectedSymbol.id });\n          }\n        }\n      }\n      setCells(newCells);\n      addToHistory(newCells);\n    }\n  };\n\n  const handleMouseDown = (row: number, col: number) => {\n    setIsDrawing(true);\n    handleCellClick(row, col);\n  };\n\n  const handleMouseEnter = (row: number, col: number) => {\n    if (isDrawing) {\n      handleCellClick(row, col);\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDrawing(false);\n  };\n\n  const handleSave = async () => {\n    if (!title.trim()) {\n      toast.error('Chart title is required');\n      return;\n    }\n\n    if (rows < 1 || rows > 1000) {\n      toast.error('Rows must be between 1 and 1000');\n      return;\n    }\n\n    if (cols < 1 || cols > 1000) {\n      toast.error('Columns must be between 1 and 1000');\n      return;\n    }\n\n    setSaving(true);\n\n    try {\n      const usedSymbolIds = [...new Set(cells.map(c => c.symbol))];\n      const payload = {\n        title,\n        rows,\n        cols,\n        isInTheRound,\n        notes,\n        chartData: cells,\n        symbolIds: usedSymbolIds,\n      };\n\n      if (chartData?.id) {\n        // Update existing chart\n        await axios.put(`/api/patterns/${patternId}/charts/${chartData.id}`, payload);\n        toast.success('Chart updated successfully');\n      } else {\n        // Create new chart\n        await axios.post(`/api/patterns/${patternId}/charts`, payload);\n        toast.success('Chart created successfully');\n      }\n\n      onSave?.();\n    } catch (error: any) {\n      console.error('Error saving chart:', error);\n      toast.error(error.response?.data?.message || 'Failed to save chart');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleGridResize = (newRows: number, newCols: number) => {\n    if (newRows < 1 || newRows > 1000 || newCols < 1 || newCols > 1000) {\n      toast.error('Grid size must be between 1 and 1000');\n      return;\n    }\n\n    // Filter out cells that are outside new grid bounds\n    const newCells = cells.filter(c => c.row < newRows && c.col < newCols);\n    setCells(newCells);\n    addToHistory(newCells);\n    setRows(newRows);\n    setCols(newCols);\n  };\n\n  const clearChart = () => {\n    if (window.confirm('Are you sure you want to clear the entire chart?')) {\n      setCells([]);\n      addToHistory([]);\n    }\n  };\n\n  const renderGrid = () => {\n    const grid = [];\n    for (let r = 0; r < rows; r++) {\n      for (let c = 0; c < cols; c++) {\n        const cellSymbolId = getCellSymbol(r, c);\n        const symbol = cellSymbolId\n          ? availableSymbols.find(s => s.id === cellSymbolId)\n          : null;\n\n        grid.push(\n          <div\n            key={`${r}-${c}`}\n            className=\"chart-cell\"\n            style={{\n              backgroundColor: symbol?.color || '#fff',\n              border: '1px solid #ddd',\n              cursor: 'pointer',\n              fontSize: `${12 * zoom}px`,\n              width: `${20 * zoom}px`,\n              height: `${20 * zoom}px`,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              userSelect: 'none',\n            }}\n            onMouseDown={() => handleMouseDown(r, c)}\n            onMouseEnter={() => handleMouseEnter(r, c)}\n            onMouseUp={handleMouseUp}\n          >\n            {symbol?.symbol}\n          </div>\n        );\n      }\n    }\n    return grid;\n  };\n\n  const renderSymbolPalette = () => {\n    const categories = [...new Set(availableSymbols.map(s => s.category))];\n\n    return categories.map(category => (\n      <div key={category} className=\"mb-4\">\n        <h4 className=\"text-sm font-semibold text-gray-700 mb-2 capitalize\">{category}</h4>\n        <div className=\"grid grid-cols-4 gap-2\">\n          {availableSymbols\n            .filter(s => s.category === category)\n            .map(symbol => (\n              <button\n                key={symbol.id}\n                onClick={() => setSelectedSymbol(symbol)}\n                className={`p-2 border rounded hover:bg-gray-100 transition ${\n                  selectedSymbol?.id === symbol.id ? 'border-blue-500 bg-blue-50' : 'border-gray-300'\n                }`}\n                style={{ backgroundColor: symbol.color || '#fff' }}\n                title={`${symbol.name} - ${symbol.description}`}\n              >\n                <div className=\"text-xl\">{symbol.symbol}</div>\n                <div className=\"text-xs mt-1 text-gray-600\">{symbol.name}</div>\n              </button>\n            ))}\n        </div>\n      </div>\n    ));\n  };\n\n  return (\n    <div className=\"chart-editor bg-white rounded-lg shadow-lg p-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-2xl font-bold text-gray-800\">\n          {chartData?.id ? 'Edit Chart' : 'Create New Chart'}\n        </h2>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={handleSave}\n            disabled={saving}\n            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n          >\n            <FiSave />\n            {saving ? 'Saving...' : 'Save'}\n          </button>\n          <button\n            onClick={onCancel}\n            className=\"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600\"\n          >\n            <FiX />\n            Cancel\n          </button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left Panel - Chart Settings */}\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Chart Title</label>\n            <input\n              type=\"text\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"e.g., Main Cable Pattern\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Rows</label>\n              <input\n                type=\"number\"\n                value={rows}\n                onChange={(e) => handleGridResize(parseInt(e.target.value) || 1, cols)}\n                min=\"1\"\n                max=\"1000\"\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Columns</label>\n              <input\n                type=\"number\"\n                value={cols}\n                onChange={(e) => handleGridResize(rows, parseInt(e.target.value) || 1)}\n                min=\"1\"\n                max=\"1000\"\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <label className=\"flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                checked={isInTheRound}\n                onChange={(e) => setIsInTheRound(e.target.checked)}\n                className=\"rounded border-gray-300\"\n              />\n              <span className=\"text-sm font-medium text-gray-700\">Knit in the round</span>\n            </label>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n            <textarea\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              rows={3}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"Add notes about this chart...\"\n            />\n          </div>\n\n          {/* Tools */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tools</label>\n            <div className=\"grid grid-cols-3 gap-2\">\n              <button\n                onClick={() => setActiveTool('pencil')}\n                className={`p-2 border rounded-lg flex flex-col items-center gap-1 ${\n                  activeTool === 'pencil' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'\n                }`}\n              >\n                <FiEdit3 />\n                <span className=\"text-xs\">Pencil</span>\n              </button>\n              <button\n                onClick={() => setActiveTool('eraser')}\n                className={`p-2 border rounded-lg flex flex-col items-center gap-1 ${\n                  activeTool === 'eraser' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'\n                }`}\n              >\n                <FiTrash2 />\n                <span className=\"text-xs\">Eraser</span>\n              </button>\n              <button\n                onClick={() => setActiveTool('fill')}\n                className={`p-2 border rounded-lg flex flex-col items-center gap-1 ${\n                  activeTool === 'fill' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'\n                }`}\n              >\n                <FiGrid />\n                <span className=\"text-xs\">Fill</span>\n              </button>\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-2\">\n            <button\n              onClick={undo}\n              disabled={historyIndex <= 0}\n              className=\"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 flex items-center justify-center gap-1\"\n              title=\"Undo\"\n            >\n              <FiRotateCcw />\n              Undo\n            </button>\n            <button\n              onClick={redo}\n              disabled={historyIndex >= history.length - 1}\n              className=\"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 flex items-center justify-center gap-1\"\n              title=\"Redo\"\n            >\n              <FiRotateCw />\n              Redo\n            </button>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => setZoom(Math.max(0.5, zoom - 0.25))}\n              className=\"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 flex items-center justify-center gap-1\"\n            >\n              <FiMinus />\n              Zoom Out\n            </button>\n            <button\n              onClick={() => setZoom(Math.min(2, zoom + 0.25))}\n              className=\"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 flex items-center justify-center gap-1\"\n            >\n              <FiPlus />\n              Zoom In\n            </button>\n          </div>\n\n          <button\n            onClick={clearChart}\n            className=\"w-full p-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 flex items-center justify-center gap-1\"\n          >\n            <FiTrash2 />\n            Clear Chart\n          </button>\n\n          {/* Symbol Palette */}\n          <div className=\"mt-6\">\n            <h3 className=\"text-lg font-semibold text-gray-800 mb-4\">Symbol Palette</h3>\n            <div className=\"max-h-96 overflow-y-auto\">\n              {renderSymbolPalette()}\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel - Chart Grid */}\n        <div className=\"lg:col-span-2\">\n          <div className=\"border border-gray-300 rounded-lg p-4 bg-gray-50\">\n            <div className=\"mb-4 flex justify-between items-center\">\n              <h3 className=\"text-lg font-semibold text-gray-800\">Chart Grid</h3>\n              <div className=\"text-sm text-gray-600\">\n                {rows}  {cols} ({cells.length} cells filled)\n              </div>\n            </div>\n\n            <div\n              ref={canvasRef}\n              className=\"overflow-auto max-h-[600px] bg-white border border-gray-200 rounded\"\n              onMouseLeave={handleMouseUp}\n            >\n              <div\n                style={{\n                  display: 'grid',\n                  gridTemplateColumns: `repeat(${cols}, ${20 * zoom}px)`,\n                  gap: 0,\n                  width: 'fit-content',\n                }}\n              >\n                {renderGrid()}\n              </div>\n            </div>\n\n            {selectedSymbol && activeTool === 'pencil' && (\n              <div className=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"text-2xl\" style={{ backgroundColor: selectedSymbol.color }}>\n                    {selectedSymbol.symbol}\n                  </div>\n                  <div>\n                    <div className=\"font-semibold text-gray-800\">{selectedSymbol.name}</div>\n                    <div className=\"text-sm text-gray-600\">{selectedSymbol.description}</div>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useRef } from 'react';\nimport { FiUpload, FiX, FiFile, FiCheckCircle } from 'react-icons/fi';\nimport { toast } from 'react-toastify';\n\ninterface ChartCell {\n  row: number;\n  col: number;\n  symbol: string;\n}\n\ninterface ChartData {\n  title: string;\n  rows: number;\n  cols: number;\n  isInTheRound?: boolean;\n  notes?: string;\n  chartData: ChartCell[];\n  symbolIds?: string[];\n}\n\ninterface ChartUploadProps {\n  onUpload: (chartData: ChartData) => void;\n  onCancel: () => void;\n}\n\nexport function ChartUpload({ onUpload, onCancel }: ChartUploadProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [preview, setPreview] = useState<ChartData | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = event.target.files?.[0];\n    if (!selectedFile) return;\n\n    // Validate file type\n    const allowedTypes = ['application/json', 'text/csv', 'text/plain'];\n    if (!allowedTypes.includes(selectedFile.type) && !selectedFile.name.match(/\\.(json|csv|txt)$/i)) {\n      toast.error('Please upload a JSON, CSV, or TXT file');\n      return;\n    }\n\n    setFile(selectedFile);\n    parseFile(selectedFile);\n  };\n\n  const parseFile = async (file: File) => {\n    try {\n      const content = await file.text();\n      let chartData: ChartData | null = null;\n\n      if (file.name.endsWith('.json')) {\n        // Parse JSON format\n        const data = JSON.parse(content);\n        chartData = parseJsonFormat(data);\n      } else if (file.name.endsWith('.csv')) {\n        // Parse CSV format\n        chartData = parseCsvFormat(content);\n      } else if (file.name.endsWith('.txt')) {\n        // Parse text format (grid-based)\n        chartData = parseTextFormat(content);\n      }\n\n      if (chartData) {\n        // Validate chart data\n        if (!chartData.title || !chartData.rows || !chartData.cols) {\n          throw new Error('Invalid chart data: missing required fields (title, rows, cols)');\n        }\n\n        if (chartData.rows < 1 || chartData.rows > 1000 || chartData.cols < 1 || chartData.cols > 1000) {\n          throw new Error('Invalid chart dimensions: rows and cols must be between 1 and 1000');\n        }\n\n        setPreview(chartData);\n        toast.success('Chart data parsed successfully');\n      } else {\n        throw new Error('Unable to parse file');\n      }\n    } catch (error: any) {\n      console.error('Error parsing file:', error);\n      toast.error(error.message || 'Failed to parse chart file');\n      setFile(null);\n      setPreview(null);\n    }\n  };\n\n  const parseJsonFormat = (data: any): ChartData => {\n    // Expected JSON format:\n    // {\n    //   \"title\": \"Chart Title\",\n    //   \"rows\": 20,\n    //   \"cols\": 20,\n    //   \"isInTheRound\": false,\n    //   \"notes\": \"Optional notes\",\n    //   \"chartData\": [{\"row\": 0, \"col\": 0, \"symbol\": \"symbol-id\"}, ...],\n    //   \"symbolIds\": [\"symbol-id-1\", \"symbol-id-2\", ...]\n    // }\n\n    return {\n      title: data.title || 'Imported Chart',\n      rows: parseInt(data.rows) || 20,\n      cols: parseInt(data.cols) || 20,\n      isInTheRound: data.isInTheRound || false,\n      notes: data.notes || '',\n      chartData: Array.isArray(data.chartData) ? data.chartData : [],\n      symbolIds: Array.isArray(data.symbolIds) ? data.symbolIds : [],\n    };\n  };\n\n  const parseCsvFormat = (content: string): ChartData => {\n    // Expected CSV format:\n    // row,col,symbol\n    // 0,0,symbol-id\n    // 0,1,symbol-id\n    // ...\n\n    const lines = content.trim().split('\\n');\n    const chartData: ChartCell[] = [];\n    let maxRow = 0;\n    let maxCol = 0;\n    const symbolSet = new Set<string>();\n\n    // Skip header if present\n    const startIndex = lines[0].toLowerCase().includes('row') ? 1 : 0;\n\n    for (let i = startIndex; i < lines.length; i++) {\n      const parts = lines[i].split(',').map(p => p.trim());\n      if (parts.length >= 3) {\n        const row = parseInt(parts[0]);\n        const col = parseInt(parts[1]);\n        const symbol = parts[2];\n\n        if (!isNaN(row) && !isNaN(col) && symbol) {\n          chartData.push({ row, col, symbol });\n          maxRow = Math.max(maxRow, row);\n          maxCol = Math.max(maxCol, col);\n          symbolSet.add(symbol);\n        }\n      }\n    }\n\n    return {\n      title: 'Imported Chart from CSV',\n      rows: maxRow + 1,\n      cols: maxCol + 1,\n      isInTheRound: false,\n      notes: '',\n      chartData,\n      symbolIds: Array.from(symbolSet),\n    };\n  };\n\n  const parseTextFormat = (content: string): ChartData => {\n    // Expected text format (grid-based):\n    // Title: Chart Title\n    // Rows: 20\n    // Cols: 20\n    // InTheRound: false\n    // Grid:\n    // .-.-.\n    // -----\n    // .-.-.\n    //\n    // Where each character represents a symbol\n\n    const lines = content.trim().split('\\n');\n    let title = 'Imported Chart from Text';\n    let rows = 0;\n    let cols = 0;\n    let isInTheRound = false;\n    const gridLines: string[] = [];\n    let inGrid = false;\n\n    for (const line of lines) {\n      if (line.toLowerCase().startsWith('title:')) {\n        title = line.substring(6).trim();\n      } else if (line.toLowerCase().startsWith('rows:')) {\n        rows = parseInt(line.substring(5).trim()) || 0;\n      } else if (line.toLowerCase().startsWith('cols:')) {\n        cols = parseInt(line.substring(5).trim()) || 0;\n      } else if (line.toLowerCase().startsWith('intheround:')) {\n        isInTheRound = line.substring(11).trim().toLowerCase() === 'true';\n      } else if (line.toLowerCase().startsWith('grid:')) {\n        inGrid = true;\n      } else if (inGrid && line.trim()) {\n        gridLines.push(line);\n      }\n    }\n\n    // If rows/cols not specified, infer from grid\n    if (!rows || !cols) {\n      rows = gridLines.length;\n      cols = Math.max(...gridLines.map(l => l.length));\n    }\n\n    // Parse grid into cells (this is a simplified version)\n    const chartData: ChartCell[] = [];\n    const symbolMap: { [key: string]: string } = {};\n    let symbolCounter = 0;\n\n    for (let r = 0; r < gridLines.length; r++) {\n      for (let c = 0; c < gridLines[r].length; c++) {\n        const char = gridLines[r][c];\n        if (char && char !== ' ') {\n          // Map character to symbol ID\n          if (!symbolMap[char]) {\n            symbolMap[char] = `symbol-${symbolCounter++}`;\n          }\n          chartData.push({\n            row: r,\n            col: c,\n            symbol: symbolMap[char],\n          });\n        }\n      }\n    }\n\n    return {\n      title,\n      rows,\n      cols,\n      isInTheRound,\n      notes: 'Imported from text file',\n      chartData,\n      symbolIds: Object.values(symbolMap),\n    };\n  };\n\n  const handleUpload = () => {\n    if (!preview) {\n      toast.error('No chart data to upload');\n      return;\n    }\n\n    setUploading(true);\n\n    // Simulate upload delay\n    setTimeout(() => {\n      onUpload(preview);\n      setUploading(false);\n    }, 500);\n  };\n\n  const handleDrop = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault();\n    const droppedFile = event.dataTransfer.files[0];\n    if (droppedFile && fileInputRef.current) {\n      const dataTransfer = new DataTransfer();\n      dataTransfer.items.add(droppedFile);\n      fileInputRef.current.files = dataTransfer.files;\n      handleFileSelect({ target: fileInputRef.current } as any);\n    }\n  };\n\n  const handleDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault();\n  };\n\n  return (\n    <div className=\"chart-upload bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-2xl font-bold text-gray-800\">Import Chart</h2>\n        <button\n          onClick={onCancel}\n          className=\"text-gray-500 hover:text-gray-700\"\n        >\n          <FiX size={24} />\n        </button>\n      </div>\n\n      {!preview ? (\n        <div>\n          <div\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            className=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition cursor-pointer\"\n            onClick={() => fileInputRef.current?.click()}\n          >\n            <FiUpload size={48} className=\"mx-auto text-gray-400 mb-4\" />\n            <p className=\"text-lg text-gray-700 mb-2\">\n              Drop your chart file here or click to browse\n            </p>\n            <p className=\"text-sm text-gray-500 mb-4\">\n              Supported formats: JSON, CSV, TXT\n            </p>\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\".json,.csv,.txt\"\n              onChange={handleFileSelect}\n              className=\"hidden\"\n            />\n          </div>\n\n          <div className=\"mt-6\">\n            <h3 className=\"text-lg font-semibold text-gray-800 mb-3\">File Format Examples</h3>\n\n            <div className=\"space-y-4\">\n              <div>\n                <h4 className=\"font-medium text-gray-700 mb-2\">JSON Format:</h4>\n                <pre className=\"bg-gray-100 p-3 rounded text-sm overflow-x-auto\">\n{`{\n  \"title\": \"My Chart\",\n  \"rows\": 20,\n  \"cols\": 20,\n  \"isInTheRound\": false,\n  \"notes\": \"Optional notes\",\n  \"chartData\": [\n    {\"row\": 0, \"col\": 0, \"symbol\": \"symbol-id\"},\n    {\"row\": 0, \"col\": 1, \"symbol\": \"symbol-id\"}\n  ],\n  \"symbolIds\": [\"symbol-id-1\", \"symbol-id-2\"]\n}`}\n                </pre>\n              </div>\n\n              <div>\n                <h4 className=\"font-medium text-gray-700 mb-2\">CSV Format:</h4>\n                <pre className=\"bg-gray-100 p-3 rounded text-sm overflow-x-auto\">\n{`row,col,symbol\n0,0,symbol-id-1\n0,1,symbol-id-2\n1,0,symbol-id-1`}\n                </pre>\n              </div>\n\n              <div>\n                <h4 className=\"font-medium text-gray-700 mb-2\">Text Format:</h4>\n                <pre className=\"bg-gray-100 p-3 rounded text-sm overflow-x-auto\">\n{`Title: My Chart\nRows: 10\nCols: 10\nInTheRound: false\nGrid:\n.-.-.-.-\n--------\n.-.-.-.-`}\n                </pre>\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div>\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mb-6 flex items-start gap-3\">\n            <FiCheckCircle className=\"text-green-600 mt-1\" size={24} />\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-green-800 mb-1\">Chart Parsed Successfully</h3>\n              <p className=\"text-sm text-green-700\">\n                Review the chart details below and click \"Import Chart\" to continue.\n              </p>\n            </div>\n          </div>\n\n          <div className=\"space-y-4 mb-6\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Title</label>\n                <div className=\"px-3 py-2 bg-gray-50 border border-gray-300 rounded\">\n                  {preview.title}\n                </div>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Dimensions</label>\n                <div className=\"px-3 py-2 bg-gray-50 border border-gray-300 rounded\">\n                  {preview.rows}  {preview.cols}\n                </div>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">In the Round</label>\n              <div className=\"px-3 py-2 bg-gray-50 border border-gray-300 rounded\">\n                {preview.isInTheRound ? 'Yes' : 'No'}\n              </div>\n            </div>\n\n            {preview.notes && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Notes</label>\n                <div className=\"px-3 py-2 bg-gray-50 border border-gray-300 rounded\">\n                  {preview.notes}\n                </div>\n              </div>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Chart Data</label>\n              <div className=\"px-3 py-2 bg-gray-50 border border-gray-300 rounded\">\n                {preview.chartData.length} cells, {preview.symbolIds?.length || 0} unique symbols\n              </div>\n            </div>\n          </div>\n\n          {file && (\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center gap-3\">\n              <FiFile className=\"text-blue-600\" size={20} />\n              <div className=\"flex-1\">\n                <div className=\"text-sm font-medium text-blue-800\">{file.name}</div>\n                <div className=\"text-xs text-blue-600\">\n                  {(file.size / 1024).toFixed(2)} KB\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex gap-3\">\n            <button\n              onClick={handleUpload}\n              disabled={uploading}\n              className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 font-medium\"\n            >\n              <FiUpload />\n              {uploading ? 'Importing...' : 'Import Chart'}\n            </button>\n            <button\n              onClick={() => {\n                setFile(null);\n                setPreview(null);\n              }}\n              className=\"px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 font-medium\"\n            >\n              Choose Different File\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiEdit2, FiTrash2, FiMove } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface PatternSection {\n  id: string;\n  pattern_id: string;\n  name: string;\n  page_number: number | null;\n  y_position: number | null;\n  sort_order: number;\n  parent_section_id: string | null;\n  created_at: string;\n}\n\ninterface PatternSectionsManagerProps {\n  patternId: string;\n  onClose: () => void;\n}\n\nexport default function PatternSectionsManager({ patternId, onClose }: PatternSectionsManagerProps) {\n  const [sections, setSections] = useState<PatternSection[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showForm, setShowForm] = useState(false);\n  const [editingSection, setEditingSection] = useState<PatternSection | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    pageNumber: '',\n    sortOrder: '',\n  });\n\n  useEffect(() => {\n    fetchSections();\n  }, [patternId]);\n\n  const fetchSections = async () => {\n    try {\n      const response = await axios.get(`/api/patterns/${patternId}/sections`);\n      setSections(response.data.data.sections || []);\n    } catch (error) {\n      console.error('Error fetching sections:', error);\n      toast.error('Failed to load sections');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreate = async () => {\n    if (!formData.name.trim()) {\n      toast.error('Section name is required');\n      return;\n    }\n\n    try {\n      const payload: any = {\n        name: formData.name,\n        sortOrder: sections.length,\n      };\n\n      if (formData.pageNumber) {\n        payload.pageNumber = parseInt(formData.pageNumber);\n      }\n\n      await axios.post(`/api/patterns/${patternId}/sections`, payload);\n      toast.success('Section created!');\n      setShowForm(false);\n      resetForm();\n      fetchSections();\n    } catch (error: any) {\n      console.error('Error creating section:', error);\n      toast.error(error.response?.data?.message || 'Failed to create section');\n    }\n  };\n\n  const handleUpdate = async () => {\n    if (!editingSection) return;\n\n    if (!formData.name.trim()) {\n      toast.error('Section name is required');\n      return;\n    }\n\n    try {\n      const payload: any = {\n        name: formData.name,\n      };\n\n      if (formData.pageNumber) {\n        payload.pageNumber = parseInt(formData.pageNumber);\n      }\n\n      if (formData.sortOrder) {\n        payload.sortOrder = parseInt(formData.sortOrder);\n      }\n\n      await axios.put(`/api/patterns/${patternId}/sections/${editingSection.id}`, payload);\n      toast.success('Section updated!');\n      setEditingSection(null);\n      resetForm();\n      fetchSections();\n    } catch (error: any) {\n      console.error('Error updating section:', error);\n      toast.error(error.response?.data?.message || 'Failed to update section');\n    }\n  };\n\n  const handleDelete = async (sectionId: string, name: string) => {\n    if (!confirm(`Delete section \"${name}\"?`)) return;\n\n    try {\n      await axios.delete(`/api/patterns/${patternId}/sections/${sectionId}`);\n      toast.success('Section deleted');\n      fetchSections();\n    } catch (error) {\n      console.error('Error deleting section:', error);\n      toast.error('Failed to delete section');\n    }\n  };\n\n  const handleEdit = (section: PatternSection) => {\n    setEditingSection(section);\n    setFormData({\n      name: section.name,\n      pageNumber: section.page_number?.toString() || '',\n      sortOrder: section.sort_order.toString(),\n    });\n  };\n\n  const handleMoveUp = async (section: PatternSection, index: number) => {\n    if (index === 0) return;\n\n    try {\n      await axios.put(`/api/patterns/${patternId}/sections/${section.id}`, {\n        sortOrder: index - 1,\n      });\n      fetchSections();\n    } catch (error) {\n      toast.error('Failed to reorder section');\n    }\n  };\n\n  const handleMoveDown = async (section: PatternSection, index: number) => {\n    if (index === sections.length - 1) return;\n\n    try {\n      await axios.put(`/api/patterns/${patternId}/sections/${section.id}`, {\n        sortOrder: index + 1,\n      });\n      fetchSections();\n    } catch (error) {\n      toast.error('Failed to reorder section');\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      pageNumber: '',\n      sortOrder: '',\n    });\n    setShowForm(false);\n    setEditingSection(null);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\n          <h2 className=\"text-2xl font-bold text-gray-900\">Pattern Sections</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n          >\n            \n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto\"></div>\n              <p className=\"mt-4 text-gray-500\">Loading sections...</p>\n            </div>\n          ) : (\n            <>\n              {/* Sections List */}\n              {sections.length === 0 && !showForm && !editingSection ? (\n                <div className=\"text-center py-12\">\n                  <FiMove className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No sections yet</h3>\n                  <p className=\"text-gray-500 mb-6\">\n                    Organize your pattern into sections like \"Body\", \"Sleeves\", \"Finishing\", etc.\n                  </p>\n                  <button\n                    onClick={() => setShowForm(true)}\n                    className=\"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2\"\n                  >\n                    <FiPlus className=\"h-5 w-5\" />\n                    Create First Section\n                  </button>\n                </div>\n              ) : (\n                <>\n                  {!showForm && !editingSection && (\n                    <div className=\"mb-4\">\n                      <button\n                        onClick={() => setShowForm(true)}\n                        className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2\"\n                      >\n                        <FiPlus className=\"h-4 w-4\" />\n                        New Section\n                      </button>\n                    </div>\n                  )}\n\n                  {/* Section Form */}\n                  {(showForm || editingSection) && (\n                    <div className=\"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50\">\n                      <h3 className=\"font-semibold text-gray-900 mb-4\">\n                        {editingSection ? 'Edit Section' : 'New Section'}\n                      </h3>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Section Name *\n                          </label>\n                          <input\n                            type=\"text\"\n                            value={formData.name}\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                            placeholder=\"e.g., Body, Sleeves, Finishing\"\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                            autoFocus\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Page Number (optional)\n                          </label>\n                          <input\n                            type=\"number\"\n                            value={formData.pageNumber}\n                            onChange={(e) => setFormData({ ...formData, pageNumber: e.target.value })}\n                            placeholder=\"e.g., 5\"\n                            min=\"1\"\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                          />\n                          <p className=\"mt-1 text-xs text-gray-500\">\n                            Link this section to a specific page in the pattern\n                          </p>\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                          <button\n                            onClick={resetForm}\n                            className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50\"\n                          >\n                            Cancel\n                          </button>\n                          <button\n                            onClick={editingSection ? handleUpdate : handleCreate}\n                            className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                          >\n                            {editingSection ? 'Update' : 'Create'}\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Sections List */}\n                  {sections.length > 0 && (\n                    <div className=\"space-y-2\">\n                      {sections.map((section, index) => (\n                        <div\n                          key={section.id}\n                          className=\"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition\"\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <h4 className=\"font-semibold text-gray-900\">{section.name}</h4>\n                              {section.page_number && (\n                                <p className=\"text-sm text-gray-500 mt-1\">Page {section.page_number}</p>\n                              )}\n                            </div>\n\n                            <div className=\"flex items-center gap-2 ml-4\">\n                              <button\n                                onClick={() => handleMoveUp(section, index)}\n                                disabled={index === 0}\n                                className=\"p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-30 disabled:cursor-not-allowed\"\n                                title=\"Move up\"\n                              >\n                                \n                              </button>\n                              <button\n                                onClick={() => handleMoveDown(section, index)}\n                                disabled={index === sections.length - 1}\n                                className=\"p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-30 disabled:cursor-not-allowed\"\n                                title=\"Move down\"\n                              >\n                                \n                              </button>\n                              <button\n                                onClick={() => handleEdit(section)}\n                                className=\"p-2 text-blue-600 hover:bg-blue-50 rounded\"\n                                title=\"Edit\"\n                              >\n                                <FiEdit2 className=\"h-4 w-4\" />\n                              </button>\n                              <button\n                                onClick={() => handleDelete(section.id, section.name)}\n                                className=\"p-2 text-red-600 hover:bg-red-50 rounded\"\n                                title=\"Delete\"\n                              >\n                                <FiTrash2 className=\"h-4 w-4\" />\n                              </button>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiBookmark, FiEdit3, FiEdit, FiPlus, FiTrash2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Bookmark {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  name: string;\n  page_number: number;\n  y_position: number | null;\n  zoom_level: number;\n  notes: string | null;\n  color: string;\n  sort_order: number;\n  created_at: string;\n}\n\ninterface Highlight {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  page_number: number;\n  coordinates: { x: number; y: number; width: number; height: number };\n  color: string;\n  opacity: number;\n  layer: number;\n  created_at: string;\n}\n\ninterface Annotation {\n  id: string;\n  pattern_id: string;\n  project_id: string | null;\n  page_number: number;\n  annotation_type: string;\n  data: any;\n  image_url: string | null;\n  created_at: string;\n}\n\ninterface PatternAnnotationsManagerProps {\n  patternId: string;\n  projectId?: string;\n  onClose: () => void;\n}\n\ntype TabType = 'bookmarks' | 'highlights' | 'annotations';\n\nexport default function PatternAnnotationsManager({\n  patternId,\n  projectId,\n  onClose,\n}: PatternAnnotationsManagerProps) {\n  const [activeTab, setActiveTab] = useState<TabType>('bookmarks');\n  const [bookmarks, setBookmarks] = useState<Bookmark[]>([]);\n  const [highlights, setHighlights] = useState<Highlight[]>([]);\n  const [annotations, setAnnotations] = useState<Annotation[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showBookmarkForm, setShowBookmarkForm] = useState(false);\n  const [showAnnotationForm, setShowAnnotationForm] = useState(false);\n  const [bookmarkForm, setBookmarkForm] = useState({\n    name: '',\n    pageNumber: '',\n    notes: '',\n    color: '#FBBF24',\n  });\n  const [annotationForm, setAnnotationForm] = useState({\n    pageNumber: '',\n    annotationType: 'text',\n    text: '',\n  });\n\n  useEffect(() => {\n    fetchData();\n  }, [patternId, activeTab]);\n\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      if (activeTab === 'bookmarks') {\n        const response = await axios.get(\n          `/api/patterns/${patternId}/bookmarks${projectId ? `?projectId=${projectId}` : ''}`\n        );\n        setBookmarks(response.data.data.bookmarks || []);\n      } else if (activeTab === 'highlights') {\n        const response = await axios.get(\n          `/api/patterns/${patternId}/highlights${projectId ? `?projectId=${projectId}` : ''}`\n        );\n        setHighlights(response.data.data.highlights || []);\n      } else if (activeTab === 'annotations') {\n        const response = await axios.get(\n          `/api/patterns/${patternId}/annotations${projectId ? `?projectId=${projectId}` : ''}`\n        );\n        setAnnotations(response.data.data.annotations || []);\n      }\n    } catch (error) {\n      console.error('Error fetching data:', error);\n      toast.error('Failed to load data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateBookmark = async () => {\n    if (!bookmarkForm.name.trim()) {\n      toast.error('Bookmark name is required');\n      return;\n    }\n\n    if (!bookmarkForm.pageNumber) {\n      toast.error('Page number is required');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/patterns/${patternId}/bookmarks`, {\n        name: bookmarkForm.name,\n        pageNumber: parseInt(bookmarkForm.pageNumber),\n        notes: bookmarkForm.notes || null,\n        color: bookmarkForm.color,\n        projectId: projectId || null,\n      });\n\n      toast.success('Bookmark created!');\n      setShowBookmarkForm(false);\n      setBookmarkForm({ name: '', pageNumber: '', notes: '', color: '#FBBF24' });\n      fetchData();\n    } catch (error: any) {\n      console.error('Error creating bookmark:', error);\n      toast.error(error.response?.data?.message || 'Failed to create bookmark');\n    }\n  };\n\n  const handleCreateAnnotation = async () => {\n    if (!annotationForm.pageNumber) {\n      toast.error('Page number is required');\n      return;\n    }\n\n    if (!annotationForm.text.trim()) {\n      toast.error('Annotation text is required');\n      return;\n    }\n\n    try {\n      await axios.post(`/api/patterns/${patternId}/annotations`, {\n        pageNumber: parseInt(annotationForm.pageNumber),\n        annotationType: annotationForm.annotationType,\n        data: { text: annotationForm.text },\n        projectId: projectId || null,\n      });\n\n      toast.success('Annotation created!');\n      setShowAnnotationForm(false);\n      setAnnotationForm({ pageNumber: '', annotationType: 'text', text: '' });\n      fetchData();\n    } catch (error: any) {\n      console.error('Error creating annotation:', error);\n      toast.error(error.response?.data?.message || 'Failed to create annotation');\n    }\n  };\n\n  const handleDeleteBookmark = async (bookmarkId: string, name: string) => {\n    if (!confirm(`Delete bookmark \"${name}\"?`)) return;\n\n    try {\n      await axios.delete(`/api/patterns/${patternId}/bookmarks/${bookmarkId}`);\n      toast.success('Bookmark deleted');\n      fetchData();\n    } catch (error) {\n      console.error('Error deleting bookmark:', error);\n      toast.error('Failed to delete bookmark');\n    }\n  };\n\n  const handleDeleteHighlight = async (highlightId: string) => {\n    if (!confirm('Delete this highlight?')) return;\n\n    try {\n      await axios.delete(`/api/patterns/${patternId}/highlights/${highlightId}`);\n      toast.success('Highlight deleted');\n      fetchData();\n    } catch (error) {\n      console.error('Error deleting highlight:', error);\n      toast.error('Failed to delete highlight');\n    }\n  };\n\n  const handleDeleteAnnotation = async (annotationId: string) => {\n    if (!confirm('Delete this annotation?')) return;\n\n    try {\n      await axios.delete(`/api/patterns/${patternId}/annotations/${annotationId}`);\n      toast.success('Annotation deleted');\n      fetchData();\n    } catch (error) {\n      console.error('Error deleting annotation:', error);\n      toast.error('Failed to delete annotation');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\n          <h2 className=\"text-2xl font-bold text-gray-900\">Pattern Annotations</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n          >\n            \n          </button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"border-b border-gray-200\">\n          <div className=\"flex px-6\">\n            <button\n              onClick={() => setActiveTab('bookmarks')}\n              className={`px-4 py-3 font-medium border-b-2 transition ${\n                activeTab === 'bookmarks'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiBookmark className=\"h-4 w-4\" />\n                Bookmarks ({bookmarks.length})\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('highlights')}\n              className={`px-4 py-3 font-medium border-b-2 transition ${\n                activeTab === 'highlights'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiEdit className=\"h-4 w-4\" />\n                Highlights ({highlights.length})\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('annotations')}\n              className={`px-4 py-3 font-medium border-b-2 transition ${\n                activeTab === 'annotations'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiEdit3 className=\"h-4 w-4\" />\n                Notes ({annotations.length})\n              </div>\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto\"></div>\n              <p className=\"mt-4 text-gray-500\">Loading...</p>\n            </div>\n          ) : (\n            <>\n              {/* Bookmarks Tab */}\n              {activeTab === 'bookmarks' && (\n                <>\n                  {!showBookmarkForm && (\n                    <div className=\"mb-4\">\n                      <button\n                        onClick={() => setShowBookmarkForm(true)}\n                        className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2\"\n                      >\n                        <FiPlus className=\"h-4 w-4\" />\n                        New Bookmark\n                      </button>\n                    </div>\n                  )}\n\n                  {showBookmarkForm && (\n                    <div className=\"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50\">\n                      <h3 className=\"font-semibold text-gray-900 mb-4\">New Bookmark</h3>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Bookmark Name *\n                          </label>\n                          <input\n                            type=\"text\"\n                            value={bookmarkForm.name}\n                            onChange={(e) =>\n                              setBookmarkForm({ ...bookmarkForm, name: e.target.value })\n                            }\n                            placeholder=\"e.g., Current row, Sleeve decreases\"\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                            autoFocus\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Page Number *\n                          </label>\n                          <input\n                            type=\"number\"\n                            value={bookmarkForm.pageNumber}\n                            onChange={(e) =>\n                              setBookmarkForm({ ...bookmarkForm, pageNumber: e.target.value })\n                            }\n                            placeholder=\"e.g., 5\"\n                            min=\"1\"\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Notes (optional)\n                          </label>\n                          <textarea\n                            value={bookmarkForm.notes}\n                            onChange={(e) =>\n                              setBookmarkForm({ ...bookmarkForm, notes: e.target.value })\n                            }\n                            placeholder=\"Add notes about this bookmark\"\n                            rows={2}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Color\n                          </label>\n                          <input\n                            type=\"color\"\n                            value={bookmarkForm.color}\n                            onChange={(e) =>\n                              setBookmarkForm({ ...bookmarkForm, color: e.target.value })\n                            }\n                            className=\"h-10 w-20 border border-gray-300 rounded cursor-pointer\"\n                          />\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                          <button\n                            onClick={() => {\n                              setShowBookmarkForm(false);\n                              setBookmarkForm({\n                                name: '',\n                                pageNumber: '',\n                                notes: '',\n                                color: '#FBBF24',\n                              });\n                            }}\n                            className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50\"\n                          >\n                            Cancel\n                          </button>\n                          <button\n                            onClick={handleCreateBookmark}\n                            className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                          >\n                            Create\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {bookmarks.length === 0 && !showBookmarkForm ? (\n                    <div className=\"text-center py-12\">\n                      <FiBookmark className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No bookmarks yet</h3>\n                      <p className=\"text-gray-500 mb-6\">\n                        Save your place in the pattern with bookmarks\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {bookmarks.map((bookmark) => (\n                        <div\n                          key={bookmark.id}\n                          className=\"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition\"\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-start gap-3 flex-1\">\n                              <div\n                                className=\"w-3 h-3 rounded-full mt-1\"\n                                style={{ backgroundColor: bookmark.color }}\n                              />\n                              <div className=\"flex-1\">\n                                <h4 className=\"font-semibold text-gray-900\">{bookmark.name}</h4>\n                                <p className=\"text-sm text-gray-500 mt-1\">Page {bookmark.page_number}</p>\n                                {bookmark.notes && (\n                                  <p className=\"text-sm text-gray-600 mt-2\">{bookmark.notes}</p>\n                                )}\n                              </div>\n                            </div>\n                            <button\n                              onClick={() => handleDeleteBookmark(bookmark.id, bookmark.name)}\n                              className=\"p-2 text-red-600 hover:bg-red-50 rounded\"\n                              title=\"Delete\"\n                            >\n                              <FiTrash2 className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </>\n              )}\n\n              {/* Highlights Tab */}\n              {activeTab === 'highlights' && (\n                <div>\n                  {highlights.length === 0 ? (\n                    <div className=\"text-center py-12\">\n                      <FiEdit className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No highlights yet</h3>\n                      <p className=\"text-gray-500 mb-6\">\n                        Highlights must be created directly on the PDF viewer\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {highlights.map((highlight) => (\n                        <div\n                          key={highlight.id}\n                          className=\"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition\"\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-start gap-3 flex-1\">\n                              <div\n                                className=\"w-3 h-3 rounded mt-1\"\n                                style={{ backgroundColor: highlight.color, opacity: highlight.opacity }}\n                              />\n                              <div className=\"flex-1\">\n                                <p className=\"text-sm text-gray-900\">Page {highlight.page_number}</p>\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                  Created {new Date(highlight.created_at).toLocaleDateString()}\n                                </p>\n                              </div>\n                            </div>\n                            <button\n                              onClick={() => handleDeleteHighlight(highlight.id)}\n                              className=\"p-2 text-red-600 hover:bg-red-50 rounded\"\n                              title=\"Delete\"\n                            >\n                              <FiTrash2 className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Annotations Tab */}\n              {activeTab === 'annotations' && (\n                <>\n                  {!showAnnotationForm && (\n                    <div className=\"mb-4\">\n                      <button\n                        onClick={() => setShowAnnotationForm(true)}\n                        className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2\"\n                      >\n                        <FiPlus className=\"h-4 w-4\" />\n                        New Note\n                      </button>\n                    </div>\n                  )}\n\n                  {showAnnotationForm && (\n                    <div className=\"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50\">\n                      <h3 className=\"font-semibold text-gray-900 mb-4\">New Note</h3>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Page Number *\n                          </label>\n                          <input\n                            type=\"number\"\n                            value={annotationForm.pageNumber}\n                            onChange={(e) =>\n                              setAnnotationForm({ ...annotationForm, pageNumber: e.target.value })\n                            }\n                            placeholder=\"e.g., 5\"\n                            min=\"1\"\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                            autoFocus\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Note Text *\n                          </label>\n                          <textarea\n                            value={annotationForm.text}\n                            onChange={(e) =>\n                              setAnnotationForm({ ...annotationForm, text: e.target.value })\n                            }\n                            placeholder=\"Add your notes, modifications, or reminders\"\n                            rows={3}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                          />\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                          <button\n                            onClick={() => {\n                              setShowAnnotationForm(false);\n                              setAnnotationForm({\n                                pageNumber: '',\n                                annotationType: 'text',\n                                text: '',\n                              });\n                            }}\n                            className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50\"\n                          >\n                            Cancel\n                          </button>\n                          <button\n                            onClick={handleCreateAnnotation}\n                            className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded\"\n                          >\n                            Create\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {annotations.length === 0 && !showAnnotationForm ? (\n                    <div className=\"text-center py-12\">\n                      <FiEdit3 className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No notes yet</h3>\n                      <p className=\"text-gray-500 mb-6\">\n                        Add personal notes, modifications, and annotations to your pattern\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {annotations.map((annotation) => (\n                        <div\n                          key={annotation.id}\n                          className=\"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition\"\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm font-medium text-gray-900 mb-1\">\n                                Page {annotation.page_number}\n                              </p>\n                              <p className=\"text-sm text-gray-700 mb-2\">\n                                {annotation.data?.text || '(No text)'}\n                              </p>\n                              <p className=\"text-xs text-gray-500\">\n                                {new Date(annotation.created_at).toLocaleDateString()}\n                              </p>\n                            </div>\n                            <button\n                              onClick={() => handleDeleteAnnotation(annotation.id)}\n                              className=\"p-2 text-red-600 hover:bg-red-50 rounded\"\n                              title=\"Delete\"\n                            >\n                              <FiTrash2 className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { FiArrowLeft, FiEdit2, FiTrash2, FiFileText, FiGrid, FiTool, FiX, FiSettings } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport PatternFileUpload from '../components/PatternFileUpload';\nimport BookmarkManager from '../components/patterns/BookmarkManager';\nimport PatternViewer from '../components/patterns/PatternViewer';\nimport { ChartViewer } from '../components/patterns/ChartViewer';\nimport { ChartEditor } from '../components/patterns/ChartEditor';\nimport { ChartUpload } from '../components/patterns/ChartUpload';\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport PatternSectionsManager from '../components/patterns/PatternSectionsManager';\nimport PatternAnnotationsManager from '../components/patterns/PatternAnnotationsManager';\nimport PDFCollation from '../components/patterns/PDFCollation';\n\ninterface Pattern {\n  id: string;\n  name: string;\n  description: string;\n  designer: string;\n  difficulty: string;\n  category: string;\n  yarn_requirements?: string;\n  needle_size?: string;\n  gauge?: string;\n  sizes_available?: string;\n  notes?: string;\n  tags?: string[];\n  is_favorite?: boolean;\n  times_used?: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface PatternFile {\n  id: string;\n  filename: string;\n  original_filename: string;\n  file_path: string;\n  mime_type: string;\n  size: number;\n  file_type: 'pdf' | 'image' | 'document' | 'other';\n  description?: string;\n  created_at: string;\n}\n\nexport default function PatternDetail() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [pattern, setPattern] = useState<Pattern | null>(null);\n  const [files, setFiles] = useState<PatternFile[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [activeTab, setActiveTab] = useState<'overview' | 'viewer' | 'charts' | 'tools'>('overview');\n  const [selectedPdfFile, setSelectedPdfFile] = useState<PatternFile | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    designer: '',\n    difficulty: 'intermediate',\n    category: 'sweater',\n    yarnRequirements: '',\n    needleSize: '',\n    gauge: '',\n    sizesAvailable: '',\n    notes: '',\n  });\n  const [showSectionsModal, setShowSectionsModal] = useState(false);\n  const [showAnnotationsModal, setShowAnnotationsModal] = useState(false);\n  const [showCollationModal, setShowCollationModal] = useState(false);\n  const [charts, setCharts] = useState<any[]>([]);\n  const [selectedChart, setSelectedChart] = useState<any | null>(null);\n  const [showChartEditor, setShowChartEditor] = useState(false);\n  const [showChartUpload, setShowChartUpload] = useState(false);\n  const [showChartViewer, setShowChartViewer] = useState(false);\n  const [editingChart, setEditingChart] = useState<any | null>(null);\n\n  // Bookmark jump state\n  const [targetPage, setTargetPage] = useState<number | undefined>(undefined);\n  const [targetZoom, setTargetZoom] = useState<number | undefined>(undefined);\n\n  useEffect(() => {\n    if (id) {\n      fetchPattern();\n      fetchPatternFiles();\n      fetchCharts();\n    }\n  }, [id]);\n\n  useEffect(() => {\n    // Auto-select first PDF file for viewer\n    if (files.length > 0 && !selectedPdfFile) {\n      const pdfFile = files.find(f => f.file_type === 'pdf');\n      if (pdfFile) {\n        setSelectedPdfFile(pdfFile);\n      }\n    }\n  }, [files, selectedPdfFile]);\n\n  const fetchPattern = async () => {\n    try {\n      const response = await axios.get(`/api/patterns/${id}`);\n      setPattern(response.data.data.pattern);\n    } catch (error: any) {\n      console.error('Error fetching pattern:', error);\n      toast.error('Failed to load pattern');\n      navigate('/patterns');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchPatternFiles = async () => {\n    try {\n      const response = await axios.get(`/api/uploads/patterns/${id}/files`);\n      setFiles(response.data.data.files || []);\n    } catch (error: any) {\n      console.error('Error fetching pattern files:', error);\n      // Don't show error toast for files - it's okay if there are no files yet\n    }\n  };\n\n  const handleEditClick = () => {\n    if (!pattern) return;\n    setFormData({\n      name: pattern.name || '',\n      description: pattern.description || '',\n      designer: pattern.designer || '',\n      difficulty: pattern.difficulty || 'intermediate',\n      category: pattern.category || 'sweater',\n      yarnRequirements: pattern.yarn_requirements || '',\n      needleSize: pattern.needle_size || '',\n      gauge: pattern.gauge || '',\n      sizesAvailable: pattern.sizes_available || '',\n      notes: pattern.notes || '',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdatePattern = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!pattern) return;\n\n    try {\n      await axios.put(`/api/patterns/${pattern.id}`, formData);\n      toast.success('Pattern updated successfully!');\n      setShowEditModal(false);\n      fetchPattern();\n    } catch (error: any) {\n      console.error('Error updating pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to update pattern');\n    }\n  };\n\n  const handleDeletePattern = async () => {\n    if (!pattern) return;\n    if (!confirm(`Are you sure you want to delete \"${pattern.name}\"? This will also delete all associated files.`)) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/patterns/${pattern.id}`);\n      toast.success('Pattern deleted successfully');\n      navigate('/patterns');\n    } catch (error: any) {\n      console.error('Error deleting pattern:', error);\n      toast.error('Failed to delete pattern');\n    }\n  };\n\n  const handleFileUpload = async (file: File, description?: string) => {\n    const formData = new FormData();\n    formData.append('file', file);\n    if (description) {\n      formData.append('description', description);\n    }\n\n    try {\n      await axios.post(`/api/uploads/patterns/${id}/files`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      toast.success('File uploaded successfully!');\n      fetchPatternFiles();\n    } catch (error: any) {\n      console.error('Error uploading file:', error);\n      toast.error(error.response?.data?.message || 'Failed to upload file');\n      throw error;\n    }\n  };\n\n  const handleFileDownload = async (fileId: string, filename: string) => {\n    try {\n      const response = await axios.get(`/api/uploads/patterns/${id}/files/${fileId}/download`, {\n        responseType: 'blob',\n      });\n\n      // Create download link\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', filename);\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      window.URL.revokeObjectURL(url);\n    } catch (error: any) {\n      console.error('Error downloading file:', error);\n      toast.error('Failed to download file');\n    }\n  };\n\n  const handleFileDelete = async (fileId: string) => {\n    try {\n      await axios.delete(`/api/uploads/patterns/${id}/files/${fileId}`);\n      toast.success('File deleted successfully');\n      fetchPatternFiles();\n    } catch (error: any) {\n      console.error('Error deleting file:', error);\n      toast.error('Failed to delete file');\n    }\n  };\n\n  const fetchCharts = async () => {\n    try {\n      const response = await axios.get(`/api/patterns/${id}/charts`);\n      setCharts(response.data.data.charts || []);\n    } catch (error: any) {\n      console.error('Error fetching charts:', error);\n      // Don't show error toast - it's okay if there are no charts yet\n    }\n  };\n\n  const fetchChartDetail = async (chartId: string) => {\n    try {\n      const response = await axios.get(`/api/patterns/${id}/charts/${chartId}`);\n      return response.data.data.chart;\n    } catch (error: any) {\n      console.error('Error fetching chart:', error);\n      toast.error('Failed to load chart');\n      return null;\n    }\n  };\n\n  const handleChartSaved = () => {\n    setShowChartEditor(false);\n    setShowChartUpload(false);\n    setEditingChart(null);\n    fetchCharts();\n  };\n\n  const handleChartEdit = async (chart: any) => {\n    const chartDetail = await fetchChartDetail(chart.id);\n    if (chartDetail) {\n      setEditingChart(chartDetail);\n      setShowChartEditor(true);\n    }\n  };\n\n  const handleChartView = async (chart: any) => {\n    const chartDetail = await fetchChartDetail(chart.id);\n    if (chartDetail) {\n      setSelectedChart(chartDetail);\n      setShowChartViewer(true);\n    }\n  };\n\n  const handleChartDelete = async (chartId: string, chartTitle: string) => {\n    if (!confirm(`Are you sure you want to delete \"${chartTitle}\"?`)) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/api/patterns/${id}/charts/${chartId}`);\n      toast.success('Chart deleted successfully');\n      fetchCharts();\n    } catch (error: any) {\n      console.error('Error deleting chart:', error);\n      toast.error('Failed to delete chart');\n    }\n  };\n\n  const handleChartUpload = (chartData: any) => {\n    setEditingChart(chartData);\n    setShowChartUpload(false);\n    setShowChartEditor(true);\n  };\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'beginner':\n        return 'bg-green-100 text-green-800';\n      case 'intermediate':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'advanced':\n        return 'bg-orange-100 text-orange-800';\n      case 'expert':\n        return 'bg-red-100 text-red-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <LoadingSpinner size=\"lg\" text=\"Loading pattern...\" />\n      </div>\n    );\n  }\n\n  if (!pattern) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Pattern not found</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"mb-4 md:mb-6\">\n        <button\n          onClick={() => navigate('/patterns')}\n          className=\"flex items-center text-purple-600 hover:text-purple-700 mb-3 md:mb-4 min-h-[48px]\"\n        >\n          <FiArrowLeft className=\"mr-2 h-5 w-5\" />\n          <span className=\"text-base md:text-sm\">Back to Patterns</span>\n        </button>\n\n        <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\n          <div className=\"flex-1\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2\">\n              <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">{pattern.name}</h1>\n              {pattern.difficulty && (\n                <span className={`px-3 py-1 text-sm font-medium rounded-full self-start ${getDifficultyColor(pattern.difficulty)}`}>\n                  {pattern.difficulty}\n                </span>\n              )}\n            </div>\n            {pattern.designer && (\n              <p className=\"text-base md:text-sm text-gray-600\">by {pattern.designer}</p>\n            )}\n          </div>\n\n          <div className=\"flex gap-2 flex-wrap\">\n            <button\n              onClick={() => navigate(`/patterns/${id}/builder`)}\n              className=\"flex items-center justify-center px-4 py-3 md:py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition min-h-[48px] md:min-h-0 flex-1 sm:flex-none\"\n            >\n              <FiGrid className=\"mr-2 h-5 w-5 md:h-4 md:w-4\" />\n              <span className=\"text-base md:text-sm\">Edit Pattern</span>\n            </button>\n            <button\n              onClick={handleEditClick}\n              className=\"flex items-center justify-center px-4 py-3 md:py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition min-h-[48px] md:min-h-0\"\n              title=\"Edit pattern details\"\n            >\n              <FiSettings className=\"h-5 w-5 md:h-4 md:w-4\" />\n            </button>\n            <button\n              onClick={handleDeletePattern}\n              className=\"flex items-center justify-center px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition min-h-[48px] md:min-h-0\"\n              title=\"Delete pattern\"\n            >\n              <FiTrash2 className=\"h-5 w-5 md:h-4 md:w-4\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Tabs - Scrollable on mobile */}\n      <div className=\"bg-white rounded-lg shadow mb-4 md:mb-6\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"flex -mb-px overflow-x-auto scrollbar-hide\">\n            <button\n              onClick={() => setActiveTab('overview')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'overview'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiFileText className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">Overview</span>\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('viewer')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'viewer'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              } ${!selectedPdfFile ? 'opacity-50 cursor-not-allowed' : ''}`}\n              disabled={!selectedPdfFile}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiFileText className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">PDF Viewer</span>\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('charts')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'charts'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiGrid className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">Charts</span>\n              </div>\n            </button>\n            <button\n              onClick={() => setActiveTab('tools')}\n              className={`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${\n                activeTab === 'tools'\n                  ? 'border-purple-600 text-purple-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FiTool className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"hidden sm:inline\">Tools</span>\n              </div>\n            </button>\n          </nav>\n        </div>\n      </div>\n\n      {/* Tab Content */}\n      {activeTab === 'overview' && (\n        <>\n          {/* Pattern Details */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n        {/* Main Info */}\n        <div className=\"lg:col-span-2 bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Pattern Information</h2>\n\n          {pattern.description && (\n            <div className=\"mb-4\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Description</h3>\n              <p className=\"text-gray-600\">{pattern.description}</p>\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {pattern.category && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Category</h3>\n                <p className=\"text-gray-900\">{pattern.category}</p>\n              </div>\n            )}\n\n            {pattern.needle_size && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Needle Size</h3>\n                <p className=\"text-gray-900\">{pattern.needle_size}</p>\n              </div>\n            )}\n\n            {pattern.gauge && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Gauge</h3>\n                <p className=\"text-gray-900\">{pattern.gauge}</p>\n              </div>\n            )}\n\n            {pattern.sizes_available && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Sizes Available</h3>\n                <p className=\"text-gray-900\">{pattern.sizes_available}</p>\n              </div>\n            )}\n          </div>\n\n          {pattern.yarn_requirements && (\n            <div className=\"mt-4\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Yarn Requirements</h3>\n              <p className=\"text-gray-600\">{pattern.yarn_requirements}</p>\n            </div>\n          )}\n\n          {pattern.notes && (\n            <div className=\"mt-4\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Notes</h3>\n              <p className=\"text-gray-600 whitespace-pre-wrap\">{pattern.notes}</p>\n            </div>\n          )}\n        </div>\n\n        {/* Stats */}\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Statistics</h2>\n\n          <div className=\"space-y-3\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-700\">Times Used</h3>\n              <p className=\"text-2xl font-bold text-purple-600\">{pattern.times_used || 0}</p>\n            </div>\n\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-700\">Files Attached</h3>\n              <p className=\"text-2xl font-bold text-purple-600\">{files.length}</p>\n            </div>\n\n            <div className=\"pt-3 border-t border-gray-200\">\n              <h3 className=\"text-sm font-medium text-gray-700\">Created</h3>\n              <p className=\"text-gray-600\">{new Date(pattern.created_at).toLocaleDateString()}</p>\n            </div>\n\n            {pattern.updated_at && pattern.updated_at !== pattern.created_at && (\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-700\">Last Updated</h3>\n                <p className=\"text-gray-600\">{new Date(pattern.updated_at).toLocaleDateString()}</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Pattern Files */}\n      <PatternFileUpload\n        files={files}\n        onUpload={handleFileUpload}\n        onDelete={handleFileDelete}\n        onDownload={handleFileDownload}\n        patternId={id}\n      />\n\n          {/* Bookmarks */}\n          <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n            <BookmarkManager\n              patternId={id!}\n              onJumpToBookmark={(bookmark) => {\n                // Set the target page and zoom for the viewer\n                setTargetPage(bookmark.page_number);\n                if (bookmark.zoom_level) {\n                  setTargetZoom(bookmark.zoom_level);\n                }\n                toast.info(`Jumping to page ${bookmark.page_number}`);\n                setActiveTab('viewer');\n              }}\n            />\n          </div>\n        </>\n      )}\n\n      {/* PDF Viewer Tab */}\n      {activeTab === 'viewer' && selectedPdfFile && (\n        <div className=\"bg-white rounded-lg shadow overflow-hidden\" style={{ height: '800px' }}>\n          <PatternViewer\n            fileUrl={`/api/uploads/patterns/${id}/files/${selectedPdfFile.id}/download`}\n            filename={selectedPdfFile.original_filename}\n            patternId={id}\n            fullscreen={false}\n            initialPage={targetPage}\n            initialZoom={targetZoom}\n          />\n        </div>\n      )}\n\n      {/* Charts Tab */}\n      {activeTab === 'charts' && !showChartEditor && !showChartUpload && !showChartViewer && (\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <div className=\"flex justify-between items-center mb-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900\">Pattern Charts</h2>\n            <div className=\"flex gap-2 flex-wrap\">\n              <button\n                onClick={() => navigate(`/patterns/${id}/builder`)}\n                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2\"\n              >\n                <FiGrid />\n                Pattern Builder\n              </button>\n              <button\n                onClick={() => setShowChartUpload(true)}\n                className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2\"\n              >\n                <FiGrid />\n                Import Chart\n              </button>\n              <button\n                onClick={() => {\n                  setEditingChart(null);\n                  setShowChartEditor(true);\n                }}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2\"\n              >\n                <FiGrid />\n                Create Chart\n              </button>\n            </div>\n          </div>\n\n          {charts.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <FiGrid className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Charts Yet</h3>\n              <p className=\"text-gray-500 mb-4\">\n                Create or import knitting charts to visualize your pattern\n              </p>\n              <div className=\"flex gap-3 justify-center flex-wrap\">\n                <button\n                  onClick={() => navigate(`/patterns/${id}/builder`)}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\n                >\n                  Pattern Builder\n                </button>\n                <button\n                  onClick={() => setShowChartUpload(true)}\n                  className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700\"\n                >\n                  Import Chart\n                </button>\n                <button\n                  onClick={() => {\n                    setEditingChart(null);\n                    setShowChartEditor(true);\n                  }}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\n                >\n                  Create New Chart\n                </button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {charts.map((chart) => (\n                <div\n                  key={chart.id}\n                  className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition\"\n                >\n                  <div className=\"flex justify-between items-start mb-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chart.title}</h3>\n                    <div className=\"flex gap-1\">\n                      <button\n                        onClick={() => handleChartEdit(chart)}\n                        className=\"p-1 text-blue-600 hover:bg-blue-50 rounded\"\n                        title=\"Edit Chart\"\n                      >\n                        <FiEdit2 size={16} />\n                      </button>\n                      <button\n                        onClick={() => handleChartDelete(chart.id, chart.title)}\n                        className=\"p-1 text-red-600 hover:bg-red-50 rounded\"\n                        title=\"Delete Chart\"\n                      >\n                        <FiTrash2 size={16} />\n                      </button>\n                    </div>\n                  </div>\n                  <div className=\"text-sm text-gray-600 space-y-1 mb-3\">\n                    <div>Size: {chart.rows}  {chart.cols}</div>\n                    <div>Type: {chart.is_in_the_round ? 'In the Round' : 'Flat'}</div>\n                    {chart.notes && (\n                      <div className=\"text-xs text-gray-500 line-clamp-2\">{chart.notes}</div>\n                    )}\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => handleChartView(chart)}\n                      className=\"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm font-medium\"\n                    >\n                      View Chart\n                    </button>\n                    <button\n                      onClick={() => navigate(`/patterns/${id}/builder?chart=${chart.id}`)}\n                      className=\"flex-1 px-3 py-2 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm font-medium\"\n                    >\n                      Edit in Builder\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Chart Editor Modal */}\n      {activeTab === 'charts' && showChartEditor && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg max-w-7xl w-full max-h-[90vh] overflow-y-auto\">\n            <ChartEditor\n              patternId={id!}\n              chartData={editingChart}\n              onSave={handleChartSaved}\n              onCancel={() => {\n                setShowChartEditor(false);\n                setEditingChart(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Chart Upload Modal */}\n      {activeTab === 'charts' && showChartUpload && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <ChartUpload\n            onUpload={handleChartUpload}\n            onCancel={() => setShowChartUpload(false)}\n          />\n        </div>\n      )}\n\n      {/* Chart Viewer Modal */}\n      {activeTab === 'charts' && showChartViewer && selectedChart && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto p-6\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-2xl font-bold text-gray-800\">{selectedChart.title}</h2>\n              <button\n                onClick={() => {\n                  setShowChartViewer(false);\n                  setSelectedChart(null);\n                }}\n                className=\"text-gray-500 hover:text-gray-700\"\n              >\n                <FiX size={24} />\n              </button>\n            </div>\n            <ChartViewer\n              chartData={selectedChart.chartData}\n              symbols={selectedChart.symbols}\n              rows={selectedChart.rows}\n              cols={selectedChart.cols}\n              title={selectedChart.title}\n              isInTheRound={selectedChart.is_in_the_round}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Tools Tab */}\n      {activeTab === 'tools' && (\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Pattern Tools</h2>\n          <div className=\"space-y-4\">\n            <div className=\"border border-gray-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-gray-900 mb-2\">Pattern Sections</h3>\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Organize your pattern into sections for easier navigation\n              </p>\n              <button\n                onClick={() => setShowSectionsModal(true)}\n                className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n              >\n                Manage Sections\n              </button>\n            </div>\n            <div className=\"border border-gray-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-gray-900 mb-2\">Pattern Annotations</h3>\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Add notes and annotations directly to your pattern\n              </p>\n              <button\n                onClick={() => setShowAnnotationsModal(true)}\n                className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n              >\n                Add Annotations\n              </button>\n            </div>\n            <div className=\"border border-gray-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-gray-900 mb-2\">Pattern Collation</h3>\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Combine multiple PDFs into a single pattern document\n              </p>\n              <button\n                onClick={() => setShowCollationModal(true)}\n                className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n              >\n                Collate PDFs\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Pattern Sections Modal */}\n      {showSectionsModal && pattern && (\n        <PatternSectionsManager\n          patternId={pattern.id}\n          onClose={() => setShowSectionsModal(false)}\n        />\n      )}\n\n      {/* Pattern Annotations Modal */}\n      {showAnnotationsModal && pattern && (\n        <PatternAnnotationsManager\n          patternId={pattern.id}\n          onClose={() => setShowAnnotationsModal(false)}\n        />\n      )}\n\n      {/* Pattern Collation Modal */}\n      {showCollationModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full my-8\">\n            <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Collate Pattern PDFs</h2>\n              <button\n                onClick={() => setShowCollationModal(false)}\n                className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n              >\n                \n              </button>\n            </div>\n            <div className=\"p-6\">\n              <PDFCollation />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Pattern</h2>\n            </div>\n\n            <form onSubmit={handleUpdatePattern} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Pattern Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Designer</label>\n                  <input\n                    type=\"text\"\n                    value={formData.designer}\n                    onChange={(e) => setFormData({ ...formData, designer: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Difficulty</label>\n                  <select\n                    value={formData.difficulty}\n                    onChange={(e) => setFormData({ ...formData, difficulty: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"beginner\">Beginner</option>\n                    <option value=\"intermediate\">Intermediate</option>\n                    <option value=\"advanced\">Advanced</option>\n                    <option value=\"expert\">Expert</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Category</label>\n                  <select\n                    value={formData.category}\n                    onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"sweater\">Sweater</option>\n                    <option value=\"scarf\">Scarf</option>\n                    <option value=\"hat\">Hat</option>\n                    <option value=\"blanket\">Blanket</option>\n                    <option value=\"socks\">Socks</option>\n                    <option value=\"shawl\">Shawl</option>\n                    <option value=\"toy\">Toy/Amigurumi</option>\n                    <option value=\"other\">Other</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Needle Size</label>\n                  <input\n                    type=\"text\"\n                    value={formData.needleSize}\n                    onChange={(e) => setFormData({ ...formData, needleSize: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., US 7, 4.5mm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Gauge</label>\n                  <input\n                    type=\"text\"\n                    value={formData.gauge}\n                    onChange={(e) => setFormData({ ...formData, gauge: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., 20 sts x 28 rows = 4 inches\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Sizes Available</label>\n                  <input\n                    type=\"text\"\n                    value={formData.sizesAvailable}\n                    onChange={(e) => setFormData({ ...formData, sizesAvailable: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., XS, S, M, L, XL\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n                  <textarea\n                    value={formData.description}\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    rows={3}\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Yarn Requirements</label>\n                  <textarea\n                    value={formData.yarnRequirements}\n                    onChange={(e) => setFormData({ ...formData, yarnRequirements: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    rows={2}\n                    placeholder=\"e.g., 800 yards worsted weight yarn\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                  <textarea\n                    value={formData.notes}\n                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    rows={3}\n                    placeholder=\"Additional notes, modifications, tips, etc.\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowEditModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Pattern\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import axios, { AxiosError, AxiosRequestConfig } from 'axios';\n\n/**\n * Global Axios Configuration\n * - CSRF token handling\n * - Request/response interceptors\n * - Retry logic with exponential backoff\n * - Comprehensive error handling\n * - Development logging\n *\n * This configures the DEFAULT axios instance so all imports get this configuration\n */\n\n// Configure axios defaults globally\naxios.defaults.baseURL = import.meta.env.VITE_API_URL || 'http://localhost:5000';\naxios.defaults.timeout = 30000; // 30 seconds\naxios.defaults.withCredentials = true; // Enable cookies for session/CSRF\naxios.defaults.headers.common['Content-Type'] = 'application/json';\n\n// CSRF token cache\nlet csrfToken: string | null = null;\n\n/**\n * Fetch CSRF token from backend\n */\nasync function fetchCsrfToken(): Promise<string> {\n  try {\n    const response = await axios.get('/api/csrf-token');\n    csrfToken = response.data.csrfToken;\n    return csrfToken || '';\n  } catch (error) {\n    console.error('Failed to fetch CSRF token:', error);\n    // Don't throw - allow app to continue without CSRF token\n    return '';\n  }\n}\n\n/**\n * Get cached CSRF token or fetch new one\n */\nasync function getCsrfToken(): Promise<string> {\n  if (csrfToken) {\n    return csrfToken;\n  }\n  return fetchCsrfToken();\n}\n\n/**\n * Request Interceptor\n * - Add CSRF token to unsafe methods (POST, PUT, DELETE, PATCH)\n * - Log requests in development\n */\naxios.interceptors.request.use(\n  async (config) => {\n    // Add CSRF token for unsafe methods\n    const unsafeMethods = ['POST', 'PUT', 'DELETE', 'PATCH'];\n    if (config.method && unsafeMethods.includes(config.method.toUpperCase())) {\n      try {\n        const token = await getCsrfToken();\n        if (token) {\n          config.headers['x-csrf-token'] = token;\n        }\n      } catch (error) {\n        console.error('Failed to attach CSRF token:', error);\n        // Don't block request if CSRF fails\n      }\n    }\n\n    // Log requests in development\n    if (import.meta.env.DEV) {\n      console.log(`[API Request] ${config.method?.toUpperCase()} ${config.url}`, {\n        params: config.params,\n        data: config.data,\n      });\n    }\n\n    return config;\n  },\n  (error) => {\n    if (import.meta.env.DEV) {\n      console.error('[API Request Error]', error);\n    }\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Refresh access token using refresh token\n */\nlet isRefreshing = false;\nlet failedQueue: Array<{ resolve: (value?: unknown) => void; reject: (reason?: unknown) => void }> = [];\n\nconst processQueue = (error: unknown, token: string | null = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\nasync function refreshAccessToken(): Promise<string | null> {\n  try {\n    const response = await axios.post('/api/auth/refresh');\n    if (response.data.success && response.data.data?.accessToken) {\n      return response.data.data.accessToken;\n    }\n    return null;\n  } catch (error) {\n    console.error('Failed to refresh access token:', error);\n    return null;\n  }\n}\n\n/**\n * Response Interceptor\n * - Handle common HTTP errors\n * - Token refresh on 401 errors\n * - Rate limit handling with exponential backoff (429)\n * - Retry failed requests\n * - Log responses in development\n * - Handle CSRF token expiration\n */\naxios.interceptors.response.use(\n  (response) => {\n    // Log successful responses in development\n    if (import.meta.env.DEV) {\n      console.log(`[API Response] ${response.config.method?.toUpperCase()} ${response.config.url}`, {\n        status: response.status,\n        data: response.data,\n      });\n    }\n    return response;\n  },\n  async (error: AxiosError) => {\n    const originalRequest = error.config as AxiosRequestConfig & {\n      _retry?: boolean;\n      _retryCount?: number;\n      _rateLimitRetry?: boolean;\n      _rateLimitRetryCount?: number;\n    };\n\n    // Log errors in development\n    if (import.meta.env.DEV) {\n      console.error('[API Error]', {\n        url: originalRequest?.url,\n        method: originalRequest?.method,\n        status: error.response?.status,\n        message: error.message,\n        data: error.response?.data,\n      });\n    }\n\n    // Handle 401 Unauthorized - try to refresh token\n    if (error.response?.status === 401 && originalRequest) {\n      // Don't retry refresh endpoint itself\n      if (originalRequest.url?.includes('/auth/refresh') || originalRequest.url?.includes('/auth/login')) {\n        // Clear CSRF token\n        csrfToken = null;\n\n        // Redirect to login if not already on auth pages\n        const currentPath = window.location.pathname;\n        const authPaths = ['/login', '/register', '/forgot-password', '/reset-password', '/verify-email'];\n        if (!authPaths.some(path => currentPath.includes(path))) {\n          window.location.href = '/login';\n        }\n        return Promise.reject(error);\n      }\n\n      // If already retrying, don't retry again\n      if (originalRequest._retry) {\n        csrfToken = null;\n        const currentPath = window.location.pathname;\n        const authPaths = ['/login', '/register', '/forgot-password', '/reset-password', '/verify-email'];\n        if (!authPaths.some(path => currentPath.includes(path))) {\n          window.location.href = '/login';\n        }\n        return Promise.reject(error);\n      }\n\n      if (isRefreshing) {\n        // Queue this request while token is being refreshed\n        return new Promise((resolve, reject) => {\n          failedQueue.push({ resolve, reject });\n        })\n          .then(() => {\n            return axios(originalRequest);\n          })\n          .catch(err => {\n            return Promise.reject(err);\n          });\n      }\n\n      originalRequest._retry = true;\n      isRefreshing = true;\n\n      try {\n        const newToken = await refreshAccessToken();\n\n        if (newToken) {\n          processQueue(null, newToken);\n\n          // Update axios default header\n          axios.defaults.headers.common['Authorization'] = `Bearer ${newToken}`;\n\n          // Retry the original request\n          return axios(originalRequest);\n        } else {\n          // Token refresh failed\n          processQueue(error, null);\n          csrfToken = null;\n\n          const currentPath = window.location.pathname;\n          const authPaths = ['/login', '/register', '/forgot-password', '/reset-password', '/verify-email'];\n          if (!authPaths.some(path => currentPath.includes(path))) {\n            window.location.href = '/login';\n          }\n          return Promise.reject(error);\n        }\n      } catch (refreshError) {\n        processQueue(refreshError, null);\n        csrfToken = null;\n\n        const currentPath = window.location.pathname;\n        const authPaths = ['/login', '/register', '/forgot-password', '/reset-password', '/verify-email'];\n        if (!authPaths.some(path => currentPath.includes(path))) {\n          window.location.href = '/login';\n        }\n        return Promise.reject(error);\n      } finally {\n        isRefreshing = false;\n      }\n    }\n\n    // Handle 403 Forbidden - might be CSRF token issue\n    if (error.response?.status === 403) {\n      const errorData = error.response.data as { error?: string };\n\n      // If CSRF error, refresh token and retry once\n      if (errorData.error?.includes('CSRF') && originalRequest && !originalRequest._retry) {\n        originalRequest._retry = true;\n\n        try {\n          // Fetch new CSRF token\n          await fetchCsrfToken();\n\n          // Retry original request with new token\n          return axios(originalRequest);\n        } catch (retryError) {\n          console.error('Failed to retry request after CSRF refresh:', retryError);\n          return Promise.reject(error);\n        }\n      }\n    }\n\n    // Handle 429 Too Many Requests - retry with exponential backoff\n    if (error.response?.status === 429 && originalRequest) {\n      const maxRateLimitRetries = 3;\n      const rateLimitRetryCount = originalRequest._rateLimitRetryCount || 0;\n\n      if (rateLimitRetryCount < maxRateLimitRetries && !originalRequest._rateLimitRetry) {\n        originalRequest._rateLimitRetry = true;\n        originalRequest._rateLimitRetryCount = rateLimitRetryCount + 1;\n\n        // Get retry-after from headers (in seconds) or use exponential backoff\n        const retryAfterHeader = error.response.headers['retry-after'];\n        const retryAfterSeconds = retryAfterHeader ? parseInt(retryAfterHeader, 10) : null;\n\n        // Use retry-after if provided, otherwise exponential backoff: 2s, 4s, 8s\n        const delay = retryAfterSeconds\n          ? retryAfterSeconds * 1000\n          : Math.pow(2, rateLimitRetryCount + 1) * 1000;\n\n        if (import.meta.env.DEV) {\n          console.log(`[Rate Limit Retry] Attempt ${rateLimitRetryCount + 1}/${maxRateLimitRetries} after ${delay}ms`);\n        }\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        // Reset retry flag before retrying\n        originalRequest._rateLimitRetry = false;\n\n        return axios(originalRequest);\n      } else {\n        // Max retries reached, dispatch event for UI notification\n        const retryAfter = error.response.headers['retry-after'];\n        const errorData = error.response.data as { message?: string; tier?: string; limit?: number };\n\n        window.dispatchEvent(new CustomEvent('rate-limit-exceeded', {\n          detail: {\n            message: errorData.message || 'Rate limit exceeded',\n            tier: errorData.tier,\n            limit: errorData.limit,\n            retryAfter: retryAfter ? parseInt(retryAfter, 10) : null,\n          }\n        }));\n\n        console.warn('Rate limit exceeded. Max retries reached. Retry after:', retryAfter);\n      }\n    }\n\n    // Handle network errors with retry logic\n    if (!error.response && originalRequest) {\n      const maxRetries = 3;\n      const retryCount = originalRequest._retryCount || 0;\n\n      if (retryCount < maxRetries) {\n        originalRequest._retryCount = retryCount + 1;\n\n        // Exponential backoff: 1s, 2s, 4s\n        const delay = Math.pow(2, retryCount) * 1000;\n\n        if (import.meta.env.DEV) {\n          console.log(`[API Retry] Attempt ${retryCount + 1}/${maxRetries} after ${delay}ms`);\n        }\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n        return axios(originalRequest);\n      }\n    }\n\n    // Handle 404 Not Found\n    if (error.response?.status === 404) {\n      console.warn('Resource not found:', originalRequest?.url);\n      // Dispatch event for UI notification\n      window.dispatchEvent(new CustomEvent('api-error', {\n        detail: { status: 404, message: 'The requested resource was not found' }\n      }));\n    }\n\n    // Handle 500 Internal Server Error\n    if (error.response?.status === 500) {\n      console.error('Server error:', error.response.data);\n      window.dispatchEvent(new CustomEvent('api-error', {\n        detail: { status: 500, message: 'A server error occurred. Please try again later.' }\n      }));\n    }\n\n    // Handle 503 Service Unavailable\n    if (error.response?.status === 503) {\n      console.error('Service unavailable. Server might be down.');\n      window.dispatchEvent(new CustomEvent('api-error', {\n        detail: { status: 503, message: 'Service is temporarily unavailable. Please try again later.' }\n      }));\n    }\n\n    // Handle validation errors (422)\n    if (error.response?.status === 422) {\n      const errorData = error.response.data as { errors?: Array<{ msg: string }> };\n      const message = errorData.errors?.[0]?.msg || 'Validation error';\n      window.dispatchEvent(new CustomEvent('api-error', {\n        detail: { status: 422, message }\n      }));\n    }\n\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Helper function to clear CSRF token\n * Useful when user logs out\n */\nexport function clearCsrfToken(): void {\n  csrfToken = null;\n}\n\n/**\n * Helper function to manually refresh CSRF token\n */\nexport async function refreshCsrfToken(): Promise<string> {\n  return fetchCsrfToken();\n}\n\n// Export the configured axios instance as default\nexport default axios;\n","/**\n * Complete Knitting Stitch Symbol Library\n * Based on Craft Yarn Council Standards + comprehensive knitting resources\n */\n\nexport interface SymbolData {\n  id: string;\n  symbol: string;\n  name: string;\n  abbr: string;\n  description: string;\n  fallback?: string;\n  width?: number; // For multi-stitch symbols like cables\n  category?: string;\n  categoryKey?: string;\n}\n\nexport interface CategoryData {\n  name: string;\n  description?: string;\n  symbols: SymbolData[];\n}\n\nexport interface SymbolLibrary {\n  [key: string]: CategoryData;\n}\n\nexport const KNITTING_SYMBOLS: SymbolLibrary = {\n  // BASIC STITCHES\n  basic: {\n    name: \"Basic Stitches\",\n    symbols: [\n      { id: \"k\", symbol: \"\", name: \"Knit\", abbr: \"k\", description: \"Knit stitch\" },\n      { id: \"p\", symbol: \"\", name: \"Purl\", abbr: \"p\", description: \"Purl stitch\" },\n      { id: \"yo\", symbol: \"\", name: \"Yarn Over\", abbr: \"yo\", description: \"Yarn over\" },\n      { id: \"sl\", symbol: \"v\", name: \"Slip\", abbr: \"sl\", description: \"Slip stitch\" },\n      { id: \"no-stitch\", symbol: \"\", name: \"No Stitch\", abbr: \"\", description: \"No stitch (placeholder)\" },\n      { id: \"k-tbl\", symbol: \"\", name: \"Knit TBL\", abbr: \"k tbl\", description: \"Knit through back loop\" },\n      { id: \"p-tbl\", symbol: \"\", name: \"Purl TBL\", abbr: \"p tbl\", description: \"Purl through back loop\" },\n      { id: \"wrap\", symbol: \"\", name: \"Wrap\", abbr: \"w&t\", description: \"Wrap and turn\" },\n    ]\n  },\n\n  // DECREASES\n  decreases: {\n    name: \"Decreases\",\n    symbols: [\n      { id: \"k2tog\", symbol: \"\", name: \"K2tog\", abbr: \"k2tog\", description: \"Knit 2 together (right lean)\" },\n      { id: \"ssk\", symbol: \"\", name: \"SSK\", abbr: \"ssk\", description: \"Slip, slip, knit (left lean)\" },\n      { id: \"p2tog\", symbol: \"\", name: \"P2tog\", abbr: \"p2tog\", description: \"Purl 2 together\" },\n      { id: \"ssp\", symbol: \"\", name: \"SSP\", abbr: \"ssp\", description: \"Slip, slip, purl\" },\n      { id: \"k3tog\", symbol: \"\", name: \"K3tog\", abbr: \"k3tog\", description: \"Knit 3 together\" },\n      { id: \"sssk\", symbol: \"\", name: \"SSSK\", abbr: \"sssk\", description: \"Slip, slip, slip, knit\" },\n      { id: \"p3tog\", symbol: \"\", name: \"P3tog\", abbr: \"p3tog\", description: \"Purl 3 together\" },\n      { id: \"cdd\", symbol: \"\", name: \"CDD\", abbr: \"cdd\", description: \"Central double decrease\" },\n      { id: \"sk2p\", symbol: \"^\", name: \"SK2P\", abbr: \"sk2p\", description: \"Slip, k2tog, pass slipped st over\" },\n    ]\n  },\n\n  // INCREASES\n  increases: {\n    name: \"Increases\",\n    symbols: [\n      { id: \"kfb\", symbol: \"\", name: \"KFB\", abbr: \"kfb\", description: \"Knit front and back\" },\n      { id: \"pfb\", symbol: \"\", name: \"PFB\", abbr: \"pfb\", description: \"Purl front and back\" },\n      { id: \"m1\", symbol: \"\", name: \"M1\", abbr: \"m1\", description: \"Make 1\" },\n      { id: \"m1l\", symbol: \"\", name: \"M1L\", abbr: \"m1l\", description: \"Make 1 left\" },\n      { id: \"m1r\", symbol: \"\", name: \"M1R\", abbr: \"m1r\", description: \"Make 1 right\" },\n      { id: \"m1p\", symbol: \"\", name: \"M1P\", abbr: \"m1p\", description: \"Make 1 purl\" },\n      { id: \"kll\", symbol: \"\", name: \"KLL\", abbr: \"kll\", description: \"Knit left lifted increase\" },\n      { id: \"krl\", symbol: \"\", name: \"KRL\", abbr: \"krl\", description: \"Knit right lifted increase\" },\n      { id: \"yo-twice\", symbol: \"\", name: \"YO Twice\", abbr: \"yo x2\", description: \"Yarn over twice\" },\n    ]\n  },\n\n  // CABLES - 2 STITCH\n  cables2: {\n    name: \"2-Stitch Cables\",\n    symbols: [\n      { id: \"1-1-rc\", symbol: \"\", name: \"1/1 RC\", abbr: \"1/1 rc\", description: \"1 over 1 right cable\", width: 2 },\n      { id: \"1-1-lc\", symbol: \"\", name: \"1/1 LC\", abbr: \"1/1 lc\", description: \"1 over 1 left cable\", width: 2 },\n      { id: \"1-1-rpc\", symbol: \"\", name: \"1/1 RPC\", abbr: \"1/1 rpc\", description: \"1 over 1 right purl cable\", width: 2 },\n      { id: \"1-1-lpc\", symbol: \"\", name: \"1/1 LPC\", abbr: \"1/1 lpc\", description: \"1 over 1 left purl cable\", width: 2 },\n    ]\n  },\n\n  // CABLES - 3 STITCH\n  cables3: {\n    name: \"3-Stitch Cables\",\n    symbols: [\n      { id: \"2-1-rc\", symbol: \"\", name: \"2/1 RC\", abbr: \"2/1 rc\", description: \"2 over 1 right cable\", width: 3 },\n      { id: \"2-1-lc\", symbol: \"\", name: \"2/1 LC\", abbr: \"2/1 lc\", description: \"2 over 1 left cable\", width: 3 },\n      { id: \"2-1-rpc\", symbol: \"\", name: \"2/1 RPC\", abbr: \"2/1 rpc\", description: \"2 over 1 right purl cable\", width: 3 },\n      { id: \"2-1-lpc\", symbol: \"\", name: \"2/1 LPC\", abbr: \"2/1 lpc\", description: \"2 over 1 left purl cable\", width: 3 },\n    ]\n  },\n\n  // CABLES - 4 STITCH\n  cables4: {\n    name: \"4-Stitch Cables\",\n    symbols: [\n      { id: \"2-2-rc\", symbol: \"\", name: \"2/2 RC\", abbr: \"2/2 rc\", description: \"2 over 2 right cable\", width: 4 },\n      { id: \"2-2-lc\", symbol: \"\", name: \"2/2 LC\", abbr: \"2/2 lc\", description: \"2 over 2 left cable\", width: 4 },\n      { id: \"2-2-rpc\", symbol: \"\", name: \"2/2 RPC\", abbr: \"2/2 rpc\", description: \"2 over 2 right purl cable\", width: 4 },\n      { id: \"2-2-lpc\", symbol: \"\", name: \"2/2 LPC\", abbr: \"2/2 lpc\", description: \"2 over 2 left purl cable\", width: 4 },\n      { id: \"c4f\", symbol: \"\", name: \"C4F\", abbr: \"c4f\", description: \"Cable 4 front\", width: 4 },\n      { id: \"c4b\", symbol: \"\", name: \"C4B\", abbr: \"c4b\", description: \"Cable 4 back\", width: 4 },\n    ]\n  },\n\n  // CABLES - 6 STITCH\n  cables6: {\n    name: \"6-Stitch Cables\",\n    symbols: [\n      { id: \"3-3-rc\", symbol: \"\", name: \"3/3 RC\", abbr: \"3/3 rc\", description: \"3 over 3 right cable\", width: 6 },\n      { id: \"3-3-lc\", symbol: \"\", name: \"3/3 LC\", abbr: \"3/3 lc\", description: \"3 over 3 left cable\", width: 6 },\n      { id: \"c6f\", symbol: \"\", name: \"C6F\", abbr: \"c6f\", description: \"Cable 6 front\", width: 6 },\n      { id: \"c6b\", symbol: \"\", name: \"C6B\", abbr: \"c6b\", description: \"Cable 6 back\", width: 6 },\n    ]\n  },\n\n  // LACE & EYELETS\n  lace: {\n    name: \"Lace & Eyelets\",\n    symbols: [\n      { id: \"lace-yo\", symbol: \"\", name: \"Yarn Over\", abbr: \"yo\", description: \"Yarn over\" },\n      { id: \"lace-yo-twice\", symbol: \"\", name: \"Double YO\", abbr: \"yo x2\", description: \"Yarn over twice\" },\n      { id: \"nupps\", symbol: \"\", name: \"Nupps\", abbr: \"nupps\", description: \"Nupps (bobble)\" },\n      { id: \"k-yo-3\", symbol: \"\", name: \"K YO 3x\", abbr: \"k yo x3\", description: \"Knit wrapping yarn 3 times\" },\n    ]\n  },\n\n  // BOBBLES & SPECIAL\n  special: {\n    name: \"Bobbles & Special\",\n    symbols: [\n      { id: \"bobble\", symbol: \"\", name: \"Bobble\", abbr: \"bobble\", description: \"Make bobble (5 from 1)\" },\n      { id: \"mb5\", symbol: \"\", name: \"MB5\", abbr: \"mb5\", description: \"Make 5-stitch bobble\" },\n      { id: \"cluster\", symbol: \"\", name: \"Cluster\", abbr: \"cluster\", description: \"Cluster stitch\" },\n      { id: \"puff\", symbol: \"\", name: \"Puff\", abbr: \"puff\", description: \"Puff stitch\" },\n      { id: \"popcorn\", symbol: \"\", name: \"Popcorn\", abbr: \"popcorn\", description: \"Popcorn stitch\" },\n    ]\n  },\n\n  // BIND OFF & CAST ON\n  edging: {\n    name: \"Cast On & Bind Off\",\n    symbols: [\n      { id: \"co\", symbol: \"\", name: \"Cast On\", abbr: \"co\", description: \"Cast on stitch\" },\n      { id: \"bo\", symbol: \"\", name: \"Bind Off\", abbr: \"bo\", description: \"Bind off stitch\" },\n      { id: \"bo-rem\", symbol: \"\", name: \"BO Rem\", abbr: \"bo rem\", description: \"Stitch remaining after bind off\" },\n    ]\n  },\n\n  // COLOR WORK\n  colorwork: {\n    name: \"Colorwork\",\n    symbols: [\n      { id: \"mc\", symbol: \"\", name: \"Main Color\", abbr: \"mc\", description: \"Main color stitch\" },\n      { id: \"cc1\", symbol: \"\", name: \"CC1\", abbr: \"cc1\", description: \"Contrast color 1\" },\n      { id: \"cc2\", symbol: \"\", name: \"CC2\", abbr: \"cc2\", description: \"Contrast color 2\" },\n      { id: \"cc3\", symbol: \"\", name: \"CC3\", abbr: \"cc3\", description: \"Contrast color 3\" },\n    ]\n  },\n\n  // SHORT ROWS\n  shortRows: {\n    name: \"Short Rows\",\n    symbols: [\n      { id: \"wt\", symbol: \"\", name: \"W&T\", abbr: \"w&t\", description: \"Wrap and turn\" },\n      { id: \"pickup-wrap\", symbol: \"\", name: \"Pickup Wrap\", abbr: \"pickup\", description: \"Pick up wrap\" },\n    ]\n  },\n\n  // BRIOCHE\n  brioche: {\n    name: \"Brioche\",\n    symbols: [\n      { id: \"brk\", symbol: \"\", name: \"BRK\", abbr: \"brk\", description: \"Brioche knit\" },\n      { id: \"brp\", symbol: \"\", name: \"BRP\", abbr: \"brp\", description: \"Brioche purl\" },\n      { id: \"sl-yo\", symbol: \"\", name: \"Sl+YO\", abbr: \"sl yo\", description: \"Slip with yarn over\" },\n    ]\n  }\n};\n\n// Helper function to get all symbols as flat array\nexport const getAllSymbols = (): SymbolData[] => {\n  const allSymbols: SymbolData[] = [];\n  Object.keys(KNITTING_SYMBOLS).forEach(categoryKey => {\n    const category = KNITTING_SYMBOLS[categoryKey];\n    category.symbols.forEach(symbol => {\n      allSymbols.push({\n        ...symbol,\n        category: category.name,\n        categoryKey\n      });\n    });\n  });\n  return allSymbols;\n};\n\n// Helper function to search symbols\nexport const searchSymbols = (query: string): SymbolData[] => {\n  const allSymbols = getAllSymbols();\n  const lowerQuery = query.toLowerCase();\n  return allSymbols.filter(symbol =>\n    symbol.name.toLowerCase().includes(lowerQuery) ||\n    symbol.abbr.toLowerCase().includes(lowerQuery) ||\n    symbol.description.toLowerCase().includes(lowerQuery)\n  );\n};\n\n// Get categories for tabs\nexport const getCategories = (): { key: string; name: string; count: number; description?: string }[] => {\n  return Object.keys(KNITTING_SYMBOLS).map(key => ({\n    key,\n    name: KNITTING_SYMBOLS[key].name,\n    count: KNITTING_SYMBOLS[key].symbols.length,\n    description: KNITTING_SYMBOLS[key].description\n  }));\n};\n\n// Export total count\nexport const SYMBOL_COUNT = getAllSymbols().length;\nexport const TOTAL_SYMBOL_COUNT = SYMBOL_COUNT;\n\n// Default symbol (knit stitch)\nexport const DEFAULT_SYMBOL: SymbolData = KNITTING_SYMBOLS.basic.symbols[0];\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport { FiArrowLeft, FiDownload, FiFileText, FiSave, FiLoader, FiGrid, FiBook, FiEdit3, FiXCircle } from 'react-icons/fi';\nimport { toast } from 'react-toastify';\nimport axios from '../lib/axios';\n\n// Import comprehensive symbol library\nimport {\n  KNITTING_SYMBOLS,\n  SymbolData,\n  getCategories,\n  searchSymbols,\n  DEFAULT_SYMBOL,\n  TOTAL_SYMBOL_COUNT,\n} from '../data/knitting-symbols-library';\n\ninterface GridCell {\n  symbol: SymbolData;\n  isOccupied?: boolean; // For multi-width cables\n  parentKey?: string;   // Reference to the parent cell for multi-width symbols\n}\n\ninterface GridData {\n  [key: string]: GridCell;\n}\n\nexport default function PatternBuilder() {\n  const { id: patternId } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const chartIdFromUrl = searchParams.get('chart');\n\n  // Get all categories for tabs\n  const categories = getCategories();\n\n  const [selectedSymbol, setSelectedSymbol] = useState<SymbolData>(DEFAULT_SYMBOL);\n  const [selectedCategory, setSelectedCategory] = useState('basic');\n  const [gridData, setGridData] = useState<GridData>({});\n  const [rows, setRows] = useState(12);\n  const [cols, setCols] = useState(16);\n  const [patternName, setPatternName] = useState('Untitled Pattern');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [saving, setSaving] = useState(false);\n  const [chartId, setChartId] = useState<string | null>(null);\n  const [currentPatternId, setCurrentPatternId] = useState<string | null>(patternId || null);\n  const [eraserMode, setEraserMode] = useState(false);\n\n  // Load existing chart data if editing an existing pattern\n  useEffect(() => {\n    if (patternId) {\n      loadExistingChart();\n    }\n  }, [patternId, chartIdFromUrl]);\n\n  // Helper to parse chart data (handles both array and string formats for backwards compatibility)\n  const parseChartData = (chartData: unknown): Array<{ row: number; col: number; symbol: string; name?: string; abbr?: string; width?: number }> => {\n    if (!chartData) return [];\n    if (Array.isArray(chartData)) return chartData;\n    // Handle double-encoded JSON (backwards compatibility)\n    if (typeof chartData === 'string') {\n      try {\n        return JSON.parse(chartData);\n      } catch {\n        return [];\n      }\n    }\n    return [];\n  };\n\n  // Helper to convert chart data to grid data\n  const convertChartDataToGrid = (chartData: unknown) => {\n    const data = parseChartData(chartData);\n    if (data.length === 0) return;\n\n    const newGridData: GridData = {};\n    data.forEach((cell) => {\n      const key = `${cell.row}-${cell.col}`;\n      // Try to find the symbol in our library by symbol character or name\n      let foundSymbol: SymbolData | undefined;\n      for (const category of Object.keys(KNITTING_SYMBOLS)) {\n        foundSymbol = KNITTING_SYMBOLS[category].symbols.find(\n          s => s.symbol === cell.symbol || s.name === cell.name || s.abbr === cell.abbr\n        );\n        if (foundSymbol) break;\n      }\n      if (foundSymbol) {\n        newGridData[key] = { symbol: foundSymbol };\n        // Handle multi-width symbols\n        const width = cell.width || foundSymbol.width || 1;\n        if (width > 1) {\n          for (let i = 1; i < width; i++) {\n            const occupiedKey = `${cell.row}-${cell.col + i}`;\n            newGridData[occupiedKey] = { symbol: foundSymbol, isOccupied: true, parentKey: key };\n          }\n        }\n      }\n    });\n    setGridData(newGridData);\n  };\n\n  const loadExistingChart = async () => {\n    if (!patternId) return;\n\n    try {\n      // First get the pattern to verify it exists\n      const patternResponse = await axios.get(`/api/patterns/${patternId}`);\n      if (patternResponse.data.success) {\n        setPatternName(patternResponse.data.data.pattern.name || 'Untitled Pattern');\n      }\n\n      // If specific chart ID provided, load that chart\n      if (chartIdFromUrl) {\n        const chartResponse = await axios.get(`/api/patterns/${patternId}/charts/${chartIdFromUrl}`);\n        if (chartResponse.data.success && chartResponse.data.data.chart) {\n          const chart = chartResponse.data.data.chart;\n          setChartId(chart.id);\n          setPatternName(chart.title || patternName);\n          setRows(chart.rows || 12);\n          setCols(chart.cols || 16);\n          convertChartDataToGrid(chart.chart_data || chart.chartData);\n        }\n      } else {\n        // Otherwise get all charts and load the first one\n        const chartsResponse = await axios.get(`/api/patterns/${patternId}/charts`);\n        if (chartsResponse.data.success && chartsResponse.data.data.charts?.length > 0) {\n          const chart = chartsResponse.data.data.charts[0];\n          setChartId(chart.id);\n          setPatternName(chart.title || patternName);\n          setRows(chart.rows || 12);\n          setCols(chart.cols || 16);\n          convertChartDataToGrid(chart.chart_data);\n        }\n      }\n    } catch (error) {\n      console.error('Error loading chart:', error);\n      // Don't show error for 404 - pattern might not have charts yet\n    }\n  };\n\n  const placeSymbol = (row: number, col: number, symbolData: SymbolData = selectedSymbol) => {\n    const key = `${row}-${col}`;\n    const symbolWidth = symbolData.width || 1;\n\n    // Check if symbol fits in the row\n    if (col + symbolWidth > cols) {\n      toast.warning(`This ${symbolData.name} symbol needs ${symbolWidth} stitches but only ${cols - col} available`);\n      return;\n    }\n\n    // Check if any cells would be occupied by an existing multi-width symbol\n    const existingCell = gridData[key];\n    if (existingCell?.isOccupied && existingCell.parentKey) {\n      // Clear the parent symbol first\n      const parentKey = existingCell.parentKey;\n      const parentCell = gridData[parentKey];\n      if (parentCell) {\n        const parentWidth = parentCell.symbol.width || 1;\n        setGridData(prev => {\n          const newData = { ...prev };\n          for (let i = 0; i < parentWidth; i++) {\n            const [pRow, pCol] = parentKey.split('-').map(Number);\n            delete newData[`${pRow}-${pCol + i}`];\n          }\n          return newData;\n        });\n      }\n    }\n\n    setGridData(prev => {\n      const newData = { ...prev };\n\n      // Place the main symbol\n      newData[key] = { symbol: symbolData };\n\n      // For multi-width symbols, mark occupied cells\n      if (symbolWidth > 1) {\n        for (let i = 1; i < symbolWidth; i++) {\n          const occupiedKey = `${row}-${col + i}`;\n          newData[occupiedKey] = { symbol: symbolData, isOccupied: true, parentKey: key };\n        }\n      }\n\n      return newData;\n    });\n  };\n\n  const clearGrid = () => {\n    if (window.confirm('Clear entire pattern?')) {\n      setGridData({});\n    }\n  };\n\n  const deleteSymbol = (row: number, col: number) => {\n    const key = `${row}-${col}`;\n    const cellData = gridData[key];\n\n    if (!cellData) return;\n\n    setGridData(prev => {\n      const newData = { ...prev };\n\n      // If this is an occupied cell (part of multi-width symbol), find and delete parent\n      if (cellData.isOccupied && cellData.parentKey) {\n        const parentKey = cellData.parentKey;\n        const parentCell = prev[parentKey];\n        if (parentCell) {\n          const parentWidth = parentCell.symbol.width || 1;\n          const [pRow, pCol] = parentKey.split('-').map(Number);\n          for (let i = 0; i < parentWidth; i++) {\n            delete newData[`${pRow}-${pCol + i}`];\n          }\n        }\n      } else {\n        // Delete the main symbol and any occupied cells it owns\n        const symbolWidth = cellData.symbol.width || 1;\n        for (let i = 0; i < symbolWidth; i++) {\n          delete newData[`${row}-${col + i}`];\n        }\n      }\n\n      return newData;\n    });\n  };\n\n  const handleCellClick = (row: number, col: number) => {\n    if (eraserMode) {\n      deleteSymbol(row, col);\n    } else {\n      placeSymbol(row, col);\n    }\n  };\n\n  const exportPattern = () => {\n    // Convert gridData to export format\n    const exportData = Object.entries(gridData)\n      .filter(([_, cell]) => !cell.isOccupied) // Only export non-occupied cells\n      .map(([key, cell]) => {\n        const [row, col] = key.split('-').map(Number);\n        return {\n          row,\n          col,\n          symbol: cell.symbol.symbol,\n          name: cell.symbol.name,\n          abbr: cell.symbol.abbr,\n          width: cell.symbol.width || 1,\n        };\n      });\n\n    const pattern = {\n      name: patternName,\n      rows,\n      columns: cols,\n      totalSymbols: TOTAL_SYMBOL_COUNT,\n      data: exportData,\n      created: new Date().toISOString()\n    };\n    const json = JSON.stringify(pattern, null, 2);\n    const blob = new Blob([json], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${patternName.replace(/\\s+/g, '-').toLowerCase()}-pattern.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n    toast.success('Pattern exported successfully!');\n  };\n\n  const generateInstructions = () => {\n    let instructions = `Pattern: ${patternName}\\n\\nCast on ${cols} stitches.\\n\\n`;\n    for (let r = 0; r < rows; r++) {\n      instructions += `Row ${r + 1}: `;\n      const rowInstructions: string[] = [];\n      let c = 0;\n      while (c < cols) {\n        const key = `${r}-${c}`;\n        const cell = gridData[key];\n        if (cell && !cell.isOccupied) {\n          if (cell.symbol.abbr) {\n            rowInstructions.push(cell.symbol.abbr);\n          }\n          // Skip over multi-width symbol cells\n          c += cell.symbol.width || 1;\n        } else if (!cell || cell.isOccupied) {\n          c++;\n        }\n      }\n      instructions += rowInstructions.join(', ') || 'Empty row';\n      instructions += '\\n';\n    }\n    // Copy to clipboard and show toast notification\n    navigator.clipboard.writeText(instructions).then(() => {\n      toast.success('Pattern instructions copied to clipboard!');\n    }).catch(() => {\n      // Fallback: show in console and toast\n      console.log(instructions);\n      toast.info('Pattern instructions generated - check browser console');\n    });\n  };\n\n  const savePattern = async () => {\n    if (!patternName.trim()) {\n      toast.error('Please enter a pattern name');\n      return;\n    }\n\n    setSaving(true);\n\n    try {\n      let targetPatternId = currentPatternId;\n\n      // If no pattern exists yet, create one first\n      if (!targetPatternId) {\n        const patternResponse = await axios.post('/api/patterns', {\n          name: patternName,\n          description: 'Created with Pattern Builder',\n          category: 'custom',\n        });\n\n        if (patternResponse.data.success) {\n          targetPatternId = patternResponse.data.data.pattern.id;\n          setCurrentPatternId(targetPatternId);\n        } else {\n          throw new Error('Failed to create pattern');\n        }\n      }\n\n      // Convert gridData to chartData format for backend (exclude occupied cells)\n      const chartData = Object.entries(gridData)\n        .filter(([_, cell]) => !cell.isOccupied)\n        .map(([key, cell]) => {\n          const [row, col] = key.split('-').map(Number);\n          return {\n            row,\n            col,\n            symbol: cell.symbol.symbol,\n            name: cell.symbol.name,\n            abbr: cell.symbol.abbr,\n            width: cell.symbol.width || 1,\n          };\n        });\n\n      // Save or update the chart\n      if (chartId) {\n        // Update existing chart\n        await axios.put(`/api/patterns/${targetPatternId}/charts/${chartId}`, {\n          title: patternName,\n          rows,\n          cols,\n          chartData,\n          notes: `Pattern with ${Object.keys(gridData).length} stitches`,\n        });\n        toast.success('Pattern updated successfully!');\n      } else {\n        // Create new chart\n        const chartResponse = await axios.post(`/api/patterns/${targetPatternId}/charts`, {\n          title: patternName,\n          rows,\n          cols,\n          chartData,\n          notes: `Pattern with ${Object.keys(gridData).length} stitches`,\n        });\n\n        if (chartResponse.data.success) {\n          setChartId(chartResponse.data.data.chart.id);\n        }\n        toast.success('Pattern saved to your library!');\n      }\n\n      // Also save to localStorage as backup\n      const pattern = {\n        name: patternName,\n        rows,\n        columns: cols,\n        data: gridData,\n        patternId: targetPatternId,\n        chartId: chartId,\n        savedAt: new Date().toISOString(),\n      };\n      localStorage.setItem('rowly-pattern-backup', JSON.stringify(pattern));\n    } catch (error: any) {\n      console.error('Error saving pattern:', error);\n      toast.error(error.response?.data?.message || 'Failed to save pattern. Please try again.');\n\n      // Fall back to localStorage on error\n      const pattern = {\n        name: patternName,\n        rows,\n        columns: cols,\n        data: gridData\n      };\n      const patterns = JSON.parse(localStorage.getItem('rowly-patterns') || '[]');\n      patterns.push(pattern);\n      localStorage.setItem('rowly-patterns', JSON.stringify(patterns));\n      toast.info('Pattern saved locally as backup.');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Get symbols for the current category or search results\n  const getDisplaySymbols = (): SymbolData[] => {\n    if (searchQuery.trim()) {\n      return searchSymbols(searchQuery);\n    }\n    return KNITTING_SYMBOLS[selectedCategory]?.symbols || [];\n  };\n\n  // Handle category change\n  const handleCategoryChange = (categoryKey: string) => {\n    setSelectedCategory(categoryKey);\n    setSearchQuery('');\n  };\n\n  // Render a stitch symbol with fallback support\n  const renderSymbol = (symbolData: SymbolData, size: 'lg' | 'xl' | '2xl' = '2xl') => {\n    const sizeClass = size === 'lg' ? 'stitch-symbol-lg' : size === 'xl' ? 'stitch-symbol-xl' : 'stitch-symbol-2xl';\n    const widthBadge = symbolData.width && symbolData.width > 1 ? (\n      <span className=\"absolute -top-1 -right-1 bg-purple-600 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center\">\n        {symbolData.width}\n      </span>\n    ) : null;\n\n    return (\n      <div className=\"relative inline-flex items-center justify-center\">\n        <span\n          className={`stitch-symbol ${sizeClass} select-none text-gray-900 dark:text-gray-100`}\n          data-fallback={symbolData.fallback}\n          title={`${symbolData.name}${symbolData.abbr ? ` (${symbolData.abbr})` : ''}${symbolData.width ? ` - ${symbolData.width} sts wide` : ''}`}\n        >\n          {symbolData.symbol}\n        </span>\n        {widthBadge}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"max-w-[1400px] mx-auto p-4 md:p-6\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-4\">\n            {currentPatternId && (\n              <button\n                onClick={() => navigate(`/patterns/${currentPatternId}`)}\n                className=\"flex items-center text-purple-600 hover:text-purple-700 min-h-[48px]\"\n              >\n                <FiArrowLeft className=\"mr-2 h-5 w-5\" />\n                <span className=\"text-base\">Back to Pattern</span>\n              </button>\n            )}\n          </div>\n          <button\n            onClick={() => navigate('/patterns')}\n            className=\"flex items-center gap-2 px-4 py-2 bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-lg transition min-h-[48px]\"\n          >\n            <FiBook className=\"h-5 w-5\" />\n            <span className=\"text-base font-medium\">Pattern Library</span>\n          </button>\n        </div>\n\n        <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2\">Knitting Pattern Builder</h1>\n        <p className=\"text-gray-600 dark:text-gray-400\">Create and design custom knitting patterns with standard stitch symbols</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-[280px_1fr_300px] gap-4\">\n        {/* Symbol Palette */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center justify-between gap-2 mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <FiGrid className=\"text-purple-600 w-5 h-5\" />\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100\">Symbol Palette</h2>\n            </div>\n            <span className=\"text-xs text-gray-500 dark:text-gray-400\">{TOTAL_SYMBOL_COUNT} symbols</span>\n          </div>\n\n          {/* Search */}\n          <input\n            type=\"text\"\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-3\"\n            placeholder=\"Search all symbols...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n\n          {/* Category Tabs */}\n          <div className=\"mb-3 -mx-1\">\n            <div className=\"flex flex-wrap gap-1 max-h-24 overflow-y-auto p-1\">\n              {categories.map(cat => (\n                <button\n                  key={cat.key}\n                  onClick={() => handleCategoryChange(cat.key)}\n                  className={`px-2 py-1 rounded text-xs font-medium whitespace-nowrap transition-colors ${\n                    selectedCategory === cat.key && !searchQuery\n                      ? 'bg-purple-600 text-white'\n                      : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-purple-50 dark:hover:bg-gray-600'\n                  }`}\n                  title={cat.description}\n                >\n                  {cat.name} ({cat.count})\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Symbols Grid */}\n          <div className=\"max-h-[400px] overflow-y-auto pr-1\">\n            {searchQuery ? (\n              // Search results mode\n              <div>\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">\n                  {getDisplaySymbols().length} results for \"{searchQuery}\"\n                </div>\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {getDisplaySymbols().map((symbolData) => (\n                    <div\n                      key={symbolData.id}\n                      className={`aspect-square border rounded-lg flex items-center justify-center cursor-pointer transition-all hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-purple-500 hover:scale-105 ${\n                        selectedSymbol.id === symbolData.id ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/30' : 'border-gray-200 dark:border-gray-600'\n                      }`}\n                      onClick={() => setSelectedSymbol(symbolData)}\n                      draggable\n                      onDragStart={(e) => e.dataTransfer.setData('symbol', JSON.stringify(symbolData))}\n                      title={`${symbolData.name}${symbolData.abbr ? ` (${symbolData.abbr})` : ''}: ${symbolData.description}`}\n                    >\n                      {renderSymbol(symbolData, 'xl')}\n                    </div>\n                  ))}\n                </div>\n                {getDisplaySymbols().length === 0 && (\n                  <div className=\"text-center py-4 text-gray-500 dark:text-gray-400\">\n                    No symbols found for \"{searchQuery}\"\n                  </div>\n                )}\n              </div>\n            ) : (\n              // Category mode\n              <div>\n                <div className=\"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2\">\n                  {KNITTING_SYMBOLS[selectedCategory]?.name}\n                </div>\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {getDisplaySymbols().map((symbolData) => (\n                    <div\n                      key={symbolData.id}\n                      className={`aspect-square border rounded-lg flex items-center justify-center cursor-pointer transition-all hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-purple-500 hover:scale-105 ${\n                        selectedSymbol.id === symbolData.id ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/30' : 'border-gray-200 dark:border-gray-600'\n                      }`}\n                      onClick={() => setSelectedSymbol(symbolData)}\n                      draggable\n                      onDragStart={(e) => e.dataTransfer.setData('symbol', JSON.stringify(symbolData))}\n                      title={`${symbolData.name}${symbolData.abbr ? ` (${symbolData.abbr})` : ''}: ${symbolData.description}`}\n                    >\n                      {renderSymbol(symbolData, 'xl')}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Pattern Grid */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <span className=\"text-xl\"></span>\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100\">Pattern Chart</h2>\n          </div>\n\n          <div className=\"flex flex-wrap gap-3 mb-4\">\n            <div className=\"flex items-center gap-2\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Rows:</label>\n              <input\n                type=\"number\"\n                value={rows}\n                onChange={(e) => setRows(Math.max(1, parseInt(e.target.value) || 1))}\n                className=\"w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded focus:ring-2 focus:ring-purple-500\"\n                min=\"1\"\n                max=\"100\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Stitches:</label>\n              <input\n                type=\"number\"\n                value={cols}\n                onChange={(e) => setCols(Math.max(1, parseInt(e.target.value) || 1))}\n                className=\"w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded focus:ring-2 focus:ring-purple-500\"\n                min=\"1\"\n                max=\"100\"\n              />\n            </div>\n            <div className=\"flex items-center gap-1 border border-gray-300 dark:border-gray-600 rounded-lg p-1\">\n              <button\n                onClick={() => setEraserMode(false)}\n                className={`px-3 py-1 rounded-lg transition text-sm flex items-center gap-1 ${\n                  !eraserMode\n                    ? 'bg-purple-600 text-white'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600'\n                }`}\n                title=\"Draw mode - click to place symbols\"\n              >\n                <FiEdit3 className=\"w-4 h-4\" />\n                Draw\n              </button>\n              <button\n                onClick={() => setEraserMode(true)}\n                className={`px-3 py-1 rounded-lg transition text-sm flex items-center gap-1 ${\n                  eraserMode\n                    ? 'bg-red-600 text-white'\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600'\n                }`}\n                title=\"Eraser mode - click to delete symbols\"\n              >\n                <FiXCircle className=\"w-4 h-4\" />\n                Erase\n              </button>\n            </div>\n            <button\n              onClick={clearGrid}\n              className=\"px-3 py-1 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition text-sm\"\n            >\n              Clear All\n            </button>\n          </div>\n\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">\n            Tip: Right-click any cell to delete its symbol\n          </p>\n\n          <div className=\"overflow-auto max-h-[600px] border-2 border-gray-300 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-900\">\n            <div\n              className=\"inline-grid gap-px bg-gray-300 dark:bg-gray-600 border border-gray-300 dark:border-gray-600\"\n              style={{\n                gridTemplateColumns: `repeat(${cols}, 40px)`,\n                gridTemplateRows: `repeat(${rows}, 40px)`\n              }}\n            >\n              {Array.from({ length: rows * cols }).map((_, index) => {\n                const r = Math.floor(index / cols);\n                const c = index % cols;\n                const key = `${r}-${c}`;\n                const cellData = gridData[key];\n                const isOccupied = cellData?.isOccupied;\n                const symbolData = cellData?.symbol;\n\n                return (\n                  <div\n                    key={key}\n                    className={`w-10 h-10 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 flex items-center justify-center cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-700 ${\n                      cellData && !isOccupied ? 'bg-purple-50 dark:bg-purple-900/30' : ''\n                    } ${isOccupied ? 'bg-purple-100 dark:bg-purple-800/40 opacity-60' : ''}`}\n                    onClick={() => handleCellClick(r, c)}\n                    onContextMenu={(e) => { e.preventDefault(); deleteSymbol(r, c); }}\n                    onDragOver={(e) => e.preventDefault()}\n                    onDrop={(e) => {\n                      e.preventDefault();\n                      const droppedSymbol = JSON.parse(e.dataTransfer.getData('symbol'));\n                      placeSymbol(r, c, droppedSymbol);\n                    }}\n                    title={isOccupied ? 'Part of multi-stitch symbol' : (symbolData ? `${symbolData.name}${symbolData.abbr ? ` (${symbolData.abbr})` : ''}` : 'Empty cell')}\n                  >\n                    {cellData && !isOccupied && symbolData && (\n                      <span\n                        className=\"stitch-symbol stitch-symbol-xl pointer-events-none text-gray-900 dark:text-gray-100\"\n                        data-fallback={symbolData.fallback}\n                      >\n                        {symbolData.symbol}\n                      </span>\n                    )}\n                    {isOccupied && (\n                      <span className=\"text-purple-400 dark:text-purple-500 text-xs\">...</span>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n\n        {/* Properties Panel */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <span className=\"text-xl\"></span>\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100\">Pattern Info</h2>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2\">\n                Pattern Name\n              </label>\n              <input\n                type=\"text\"\n                className=\"w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500\"\n                placeholder=\"My Pattern\"\n                value={patternName}\n                onChange={(e) => setPatternName(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2\">\n                Selected Symbol\n              </label>\n              <div className=\"px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg\">\n                <div className=\"flex items-center gap-3\">\n                  {renderSymbol(selectedSymbol, '2xl')}\n                  <div className=\"flex-1\">\n                    <div className=\"font-semibold text-sm text-gray-900 dark:text-gray-100\">\n                      {selectedSymbol.name}\n                      {selectedSymbol.abbr && (\n                        <span className=\"ml-1 text-xs font-normal text-purple-600 dark:text-purple-400\">({selectedSymbol.abbr})</span>\n                      )}\n                    </div>\n                    <div className=\"text-xs text-gray-600 dark:text-gray-400\">{selectedSymbol.description}</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2\">\n                Stitch Count\n              </label>\n              <div className=\"px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Total Stitches:</span>\n                <span className=\"text-lg font-bold text-purple-600 dark:text-purple-400\">\n                  {Object.keys(gridData).filter(key => !gridData[key].isOccupied && gridData[key].symbol.symbol !== '').length}\n                </span>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2\">\n                Pattern Stats\n              </label>\n              <div className=\"text-sm space-y-2\">\n                <div className=\"flex justify-between py-1\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Rows:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-gray-100\">{rows}</span>\n                </div>\n                <div className=\"flex justify-between py-1\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Stitches per row:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-gray-100\">{cols}</span>\n                </div>\n                <div className=\"flex justify-between py-1\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Total cells:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-gray-100\">{rows * cols}</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 pt-4\">\n              <button\n                onClick={exportPattern}\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n              >\n                <FiDownload />\n                Export Pattern\n              </button>\n              <button\n                onClick={generateInstructions}\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition\"\n              >\n                <FiFileText />\n                Generate Instructions\n              </button>\n              <button\n                onClick={savePattern}\n                disabled={saving}\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {saving ? <FiLoader className=\"animate-spin\" /> : <FiSave />}\n                {saving ? 'Saving...' : 'Save to Library'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiTrash2, FiPackage, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Yarn {\n  id: string;\n  brand: string;\n  name: string;\n  color: string;\n  weight: string;\n  yards_remaining: number;\n  skeins_remaining: number;\n  fiber_content: string;\n  yards_total?: number;\n  skeins_total?: number;\n  low_stock_threshold?: number;\n  low_stock_alert?: boolean;\n  photos?: YarnPhoto[];\n}\n\ninterface YarnPhoto {\n  id: string;\n  yarn_id: string;\n  file_path: string;\n  thumbnail_path: string;\n  original_filename: string;\n}\n\nexport default function YarnStash() {\n  const [yarn, setYarn] = useState<Yarn[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingYarn, setEditingYarn] = useState<Yarn | null>(null);\n  const [yarnPhotos, setYarnPhotos] = useState<YarnPhoto[]>([]);\n  const [uploadingPhoto, setUploadingPhoto] = useState(false);\n  const [formData, setFormData] = useState({\n    brand: '',\n    name: '',\n    color: '',\n    weight: 'worsted',\n    fiberContent: '',\n    yardsTotal: '',\n    skeinsTotal: '1',\n    lowStockThreshold: '',\n    lowStockAlert: false,\n  });\n\n  useEffect(() => {\n    fetchYarn();\n  }, []);\n\n  const fetchYarn = async () => {\n    try {\n      const response = await axios.get('/api/yarn');\n      setYarn(response.data.data.yarn);\n    } catch (error: any) {\n      console.error('Error fetching yarn:', error);\n      toast.error('Failed to load yarn');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateYarn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await axios.post('/api/yarn', formData);\n      toast.success('Yarn added successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        brand: '',\n        name: '',\n        color: '',\n        weight: 'worsted',\n        fiberContent: '',\n        yardsTotal: '',\n        skeinsTotal: '1',\n        lowStockThreshold: '',\n        lowStockAlert: false,\n      });\n      fetchYarn();\n    } catch (error: any) {\n      console.error('Error creating yarn:', error);\n      toast.error(error.response?.data?.message || 'Failed to add yarn');\n    }\n  };\n\n  const handleEditClick = async (y: Yarn) => {\n    setEditingYarn(y);\n    setFormData({\n      brand: y.brand || '',\n      name: y.name || '',\n      color: y.color || '',\n      weight: y.weight || 'worsted',\n      fiberContent: y.fiber_content || '',\n      yardsTotal: y.yards_total?.toString() || '',\n      skeinsTotal: y.skeins_total?.toString() || '1',\n      lowStockThreshold: y.low_stock_threshold?.toString() || '',\n      lowStockAlert: y.low_stock_alert || false,\n    });\n\n    // Fetch photos for this yarn\n    try {\n      const response = await axios.get(`/api/uploads/yarn/${y.id}/photos`);\n      setYarnPhotos(response.data.data.photos || []);\n    } catch (error) {\n      console.error('Error fetching yarn photos:', error);\n      setYarnPhotos([]);\n    }\n\n    setShowEditModal(true);\n  };\n\n  const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!editingYarn || !e.target.files || e.target.files.length === 0) return;\n\n    const file = e.target.files[0];\n    setUploadingPhoto(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('photo', file);\n\n      const response = await axios.post(`/api/uploads/yarn/${editingYarn.id}/photos`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n\n      toast.success('Photo uploaded successfully!');\n      setYarnPhotos([...yarnPhotos, response.data.data.photo]);\n\n      // Reset file input\n      e.target.value = '';\n    } catch (error: any) {\n      console.error('Error uploading photo:', error);\n      toast.error(error.response?.data?.message || 'Failed to upload photo');\n    } finally {\n      setUploadingPhoto(false);\n    }\n  };\n\n  const handlePhotoDelete = async (photoId: string) => {\n    if (!editingYarn) return;\n    if (!confirm('Are you sure you want to delete this photo?')) return;\n\n    try {\n      await axios.delete(`/api/uploads/yarn/${editingYarn.id}/photos/${photoId}`);\n      toast.success('Photo deleted successfully');\n      setYarnPhotos(yarnPhotos.filter(p => p.id !== photoId));\n    } catch (error: any) {\n      console.error('Error deleting photo:', error);\n      toast.error('Failed to delete photo');\n    }\n  };\n\n  const handleUpdateYarn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingYarn) return;\n\n    try {\n      await axios.put(`/api/yarn/${editingYarn.id}`, formData);\n      toast.success('Yarn updated successfully!');\n      setShowEditModal(false);\n      setEditingYarn(null);\n      setFormData({\n        brand: '',\n        name: '',\n        color: '',\n        weight: 'worsted',\n        fiberContent: '',\n        yardsTotal: '',\n        skeinsTotal: '1',\n        lowStockThreshold: '',\n        lowStockAlert: false,\n      });\n      fetchYarn();\n    } catch (error: any) {\n      console.error('Error updating yarn:', error);\n      toast.error(error.response?.data?.message || 'Failed to update yarn');\n    }\n  };\n\n  const handleDeleteYarn = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/yarn/${id}`);\n      toast.success('Yarn deleted successfully');\n      fetchYarn();\n    } catch (error: any) {\n      console.error('Error deleting yarn:', error);\n      toast.error('Failed to delete yarn');\n    }\n  };\n\n  const getWeightColor = (weight: string) => {\n    const colors: { [key: string]: string } = {\n      lace: 'bg-purple-100 text-purple-800',\n      fingering: 'bg-blue-100 text-blue-800',\n      sport: 'bg-green-100 text-green-800',\n      dk: 'bg-yellow-100 text-yellow-800',\n      worsted: 'bg-orange-100 text-orange-800',\n      bulky: 'bg-red-100 text-red-800',\n    };\n    return colors[weight?.toLowerCase()] || 'bg-gray-100 text-gray-800';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading yarn stash...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Yarn Stash</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your yarn inventory</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          Add Yarn\n        </button>\n      </div>\n\n      {yarn.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiPackage className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No yarn in stash</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking your yarn collection</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Yarn\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {yarn.map((y) => (\n            <div\n              key={y.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex-1\">\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\n                    {y.brand && `${y.brand} `}{y.name}\n                  </h3>\n                  {y.color && (\n                    <p className=\"text-sm text-gray-600 mt-1\">{y.color}</p>\n                  )}\n                </div>\n                {y.weight && (\n                  <span\n                    className={`px-2 py-1 text-xs font-medium rounded-full ${getWeightColor(\n                      y.weight\n                    )}`}\n                  >\n                    {y.weight}\n                  </span>\n                )}\n              </div>\n\n              {y.fiber_content && (\n                <p className=\"text-sm text-gray-500 mb-3\">{y.fiber_content}</p>\n              )}\n\n              <div className=\"space-y-2 mb-4\">\n                {y.skeins_remaining !== undefined && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Skeins:</span>\n                    <span className=\"font-medium text-gray-900\">{y.skeins_remaining}</span>\n                  </div>\n                )}\n                {y.yards_remaining !== undefined && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Yards:</span>\n                    <span className=\"font-medium text-gray-900\">{y.yards_remaining}</span>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                <button\n                  onClick={() => handleEditClick(y)}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                  Edit\n                </button>\n                <button\n                  onClick={() => handleDeleteYarn(y.id, y.name)}\n                  className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Yarn Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add Yarn to Stash</h2>\n            </div>\n\n            <form onSubmit={handleCreateYarn} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Brand\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Lion Brand\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yarn Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Wool-Ease\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Color\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.color}\n                    onChange={(e) => setFormData({ ...formData, color: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Navy Blue\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Weight\n                  </label>\n                  <select\n                    value={formData.weight}\n                    onChange={(e) => setFormData({ ...formData, weight: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"lace\">Lace</option>\n                    <option value=\"fingering\">Fingering</option>\n                    <option value=\"sport\">Sport</option>\n                    <option value=\"dk\">DK</option>\n                    <option value=\"worsted\">Worsted</option>\n                    <option value=\"bulky\">Bulky</option>\n                    <option value=\"super-bulky\">Super Bulky</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Fiber Content\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.fiberContent}\n                  onChange={(e) => setFormData({ ...formData, fiberContent: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., 100% Wool, 80% Acrylic 20% Wool\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Number of Skeins\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.skeinsTotal}\n                    onChange={(e) => setFormData({ ...formData, skeinsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    min=\"1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yards per Skein\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.yardsTotal}\n                    onChange={(e) => setFormData({ ...formData, yardsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., 364\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add to Stash\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Yarn Modal */}\n      {showEditModal && editingYarn && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Yarn</h2>\n            </div>\n\n            <form onSubmit={handleUpdateYarn} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Brand\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Lion Brand\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yarn Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Wool-Ease\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Color\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.color}\n                    onChange={(e) => setFormData({ ...formData, color: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Navy Blue\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Weight\n                  </label>\n                  <select\n                    value={formData.weight}\n                    onChange={(e) => setFormData({ ...formData, weight: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  >\n                    <option value=\"lace\">Lace</option>\n                    <option value=\"fingering\">Fingering</option>\n                    <option value=\"sport\">Sport</option>\n                    <option value=\"dk\">DK</option>\n                    <option value=\"worsted\">Worsted</option>\n                    <option value=\"bulky\">Bulky</option>\n                    <option value=\"super-bulky\">Super Bulky</option>\n                  </select>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Fiber Content\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.fiberContent}\n                  onChange={(e) => setFormData({ ...formData, fiberContent: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., 100% Wool, 80% Acrylic 20% Wool\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Number of Skeins\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.skeinsTotal}\n                    onChange={(e) => setFormData({ ...formData, skeinsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    min=\"1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Yards per Skein\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={formData.yardsTotal}\n                    onChange={(e) => setFormData({ ...formData, yardsTotal: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., 364\"\n                  />\n                </div>\n              </div>\n\n              {/* Photo Gallery Section */}\n              <div className=\"border-t border-gray-200 pt-4\">\n                <h3 className=\"text-sm font-medium text-gray-900 mb-3\">Photos</h3>\n\n                {/* Photo Upload */}\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm text-gray-600 mb-2\">\n                    Add photo to visualize your yarn\n                  </label>\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handlePhotoUpload}\n                    disabled={uploadingPhoto}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  />\n                  {uploadingPhoto && (\n                    <p className=\"text-sm text-gray-500 mt-2\">Uploading...</p>\n                  )}\n                </div>\n\n                {/* Photo Grid */}\n                {yarnPhotos.length > 0 && (\n                  <div className=\"grid grid-cols-3 gap-2\">\n                    {yarnPhotos.map((photo) => (\n                      <div key={photo.id} className=\"relative group\">\n                        <img\n                          src={photo.thumbnail_path}\n                          alt={photo.original_filename}\n                          className=\"w-full h-24 object-cover rounded-lg border border-gray-200\"\n                        />\n                        <button\n                          type=\"button\"\n                          onClick={() => handlePhotoDelete(photo.id)}\n                          className=\"absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n                          title=\"Delete photo\"\n                        >\n                          <FiTrash2 className=\"h-3 w-3\" />\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                {yarnPhotos.length === 0 && (\n                  <p className=\"text-sm text-gray-500 text-center py-4 bg-gray-50 rounded-lg\">\n                    No photos yet. Upload a photo to see what your yarn looks like!\n                  </p>\n                )}\n              </div>\n\n              <div className=\"border-t border-gray-200 pt-4\">\n                <h3 className=\"text-sm font-medium text-gray-900 mb-3\">Low Stock Alerts</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Low Stock Threshold (yards)\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.lowStockThreshold}\n                      onChange={(e) => setFormData({ ...formData, lowStockThreshold: e.target.value })}\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                      placeholder=\"e.g., 100\"\n                      min=\"0\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">Get notified when yards drop below this amount</p>\n                  </div>\n\n                  <div className=\"flex items-center\">\n                    <label className=\"flex items-center cursor-pointer\">\n                      <input\n                        type=\"checkbox\"\n                        checked={formData.lowStockAlert}\n                        onChange={(e) => setFormData({ ...formData, lowStockAlert: e.target.checked })}\n                        className=\"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500\"\n                      />\n                      <span className=\"ml-2 text-sm text-gray-700\">Enable low stock alerts</span>\n                    </label>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingYarn(null);\n                    setYarnPhotos([]);\n                    setFormData({\n                      brand: '',\n                      name: '',\n                      color: '',\n                      weight: 'worsted',\n                      fiberContent: '',\n                      yardsTotal: '',\n                      skeinsTotal: '1',\n                      lowStockThreshold: '',\n                      lowStockAlert: false,\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Yarn\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiTrash2, FiTool, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Tool {\n  id: string;\n  name: string;\n  type: string;\n  size: string;\n  material: string;\n  brand: string;\n  quantity: number;\n}\n\nexport default function Tools() {\n  const [tools, setTools] = useState<Tool[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingTool, setEditingTool] = useState<Tool | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    type: 'needle',\n    size: '',\n    material: '',\n    brand: '',\n    quantity: '1',\n  });\n\n  useEffect(() => {\n    fetchTools();\n  }, []);\n\n  const fetchTools = async () => {\n    try {\n      const response = await axios.get('/api/tools');\n      setTools(response.data.data.tools);\n    } catch (error: any) {\n      console.error('Error fetching tools:', error);\n      toast.error('Failed to load tools');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateTool = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await axios.post('/api/tools', formData);\n      toast.success('Tool added successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        name: '',\n        type: 'needle',\n        size: '',\n        material: '',\n        brand: '',\n        quantity: '1',\n      });\n      fetchTools();\n    } catch (error: any) {\n      console.error('Error creating tool:', error);\n      toast.error(error.response?.data?.message || 'Failed to add tool');\n    }\n  };\n\n  const handleEditClick = (tool: Tool) => {\n    setEditingTool(tool);\n    setFormData({\n      name: tool.name || '',\n      type: tool.type || 'needle',\n      size: tool.size || '',\n      material: tool.material || '',\n      brand: tool.brand || '',\n      quantity: tool.quantity?.toString() || '1',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdateTool = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingTool) return;\n\n    try {\n      await axios.put(`/api/tools/${editingTool.id}`, formData);\n      toast.success('Tool updated successfully!');\n      setShowEditModal(false);\n      setEditingTool(null);\n      setFormData({\n        name: '',\n        type: 'needle',\n        size: '',\n        material: '',\n        brand: '',\n        quantity: '1',\n      });\n      fetchTools();\n    } catch (error: any) {\n      console.error('Error updating tool:', error);\n      toast.error(error.response?.data?.message || 'Failed to update tool');\n    }\n  };\n\n  const handleDeleteTool = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/tools/${id}`);\n      toast.success('Tool deleted successfully');\n      fetchTools();\n    } catch (error: any) {\n      console.error('Error deleting tool:', error);\n      toast.error('Failed to delete tool');\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    const colors: { [key: string]: string } = {\n      needle: 'bg-blue-100 text-blue-800',\n      hook: 'bg-purple-100 text-purple-800',\n      circular: 'bg-green-100 text-green-800',\n      dpn: 'bg-yellow-100 text-yellow-800',\n      accessory: 'bg-gray-100 text-gray-800',\n    };\n    return colors[type?.toLowerCase()] || 'bg-gray-100 text-gray-800';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading tools...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Tools</h1>\n          <p className=\"text-gray-600 mt-1\">Manage your knitting tools inventory</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          Add Tool\n        </button>\n      </div>\n\n      {tools.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiTool className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No tools yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking your knitting tools</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Tool\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {tools.map((tool) => (\n            <div\n              key={tool.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex-1\">\n                  <h3 className=\"text-lg font-semibold text-gray-900\">{tool.name}</h3>\n                  {tool.size && <p className=\"text-sm text-gray-600 mt-1\">Size {tool.size}</p>}\n                </div>\n                {tool.type && (\n                  <span\n                    className={`px-2 py-1 text-xs font-medium rounded-full ${getTypeColor(\n                      tool.type\n                    )}`}\n                  >\n                    {tool.type}\n                  </span>\n                )}\n              </div>\n\n              <div className=\"space-y-2 mb-4\">\n                {tool.brand && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Brand:</span> {tool.brand}\n                  </div>\n                )}\n                {tool.material && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Material:</span> {tool.material}\n                  </div>\n                )}\n                {tool.quantity && (\n                  <div className=\"text-sm text-gray-500\">\n                    <span className=\"font-medium\">Quantity:</span> {tool.quantity}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200\">\n                <button\n                  onClick={() => handleEditClick(tool)}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                  Edit\n                </button>\n                <button\n                  onClick={() => handleDeleteTool(tool.id, tool.name)}\n                  className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Tool Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add Tool</h2>\n            </div>\n\n            <form onSubmit={handleCreateTool} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Tool Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., US 7 Circular Needles\"\n                  required\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Type *\n                  </label>\n                  <select\n                    value={formData.type}\n                    onChange={(e) => setFormData({ ...formData, type: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  >\n                    <option value=\"needle\">Straight Needle</option>\n                    <option value=\"circular\">Circular Needle</option>\n                    <option value=\"dpn\">Double-Pointed Needles (DPN)</option>\n                    <option value=\"hook\">Crochet Hook</option>\n                    <option value=\"accessory\">Accessory</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Size</label>\n                  <input\n                    type=\"text\"\n                    value={formData.size}\n                    onChange={(e) => setFormData({ ...formData, size: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., US 7, 4.5mm\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Material\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.material}\n                    onChange={(e) => setFormData({ ...formData, material: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Bamboo, Metal, Wood\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Brand</label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Clover, Addi\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Quantity</label>\n                <input\n                  type=\"number\"\n                  value={formData.quantity}\n                  onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  min=\"1\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Tool\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Tool Modal */}\n      {showEditModal && editingTool && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Tool</h2>\n            </div>\n\n            <form onSubmit={handleUpdateTool} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Tool Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  placeholder=\"e.g., US 7 Circular Needles\"\n                  required\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Type *\n                  </label>\n                  <select\n                    value={formData.type}\n                    onChange={(e) => setFormData({ ...formData, type: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  >\n                    <option value=\"needle\">Straight Needle</option>\n                    <option value=\"circular\">Circular Needle</option>\n                    <option value=\"dpn\">Double-Pointed Needles (DPN)</option>\n                    <option value=\"hook\">Crochet Hook</option>\n                    <option value=\"accessory\">Accessory</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Size</label>\n                  <input\n                    type=\"text\"\n                    value={formData.size}\n                    onChange={(e) => setFormData({ ...formData, size: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., US 7, 4.5mm\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Material\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.material}\n                    onChange={(e) => setFormData({ ...formData, material: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Bamboo, Metal, Wood\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Brand</label>\n                  <input\n                    type=\"text\"\n                    value={formData.brand}\n                    onChange={(e) => setFormData({ ...formData, brand: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Clover, Addi\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Quantity</label>\n                <input\n                  type=\"number\"\n                  value={formData.quantity}\n                  onChange={(e) => setFormData({ ...formData, quantity: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  min=\"1\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingTool(null);\n                    setFormData({\n                      name: '',\n                      type: 'needle',\n                      size: '',\n                      material: '',\n                      brand: '',\n                      quantity: '1',\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Tool\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { FiPlus, FiTrash2, FiUsers, FiEdit2 } from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\ninterface Recipient {\n  id: string;\n  first_name: string;\n  last_name: string;\n  relationship: string;\n  clothing_size: string;\n  notes: string;\n}\n\nexport default function Recipients() {\n  const [recipients, setRecipients] = useState<Recipient[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingRecipient, setEditingRecipient] = useState<Recipient | null>(null);\n  const [formData, setFormData] = useState({\n    firstName: '',\n    lastName: '',\n    relationship: '',\n    clothingSize: '',\n    notes: '',\n  });\n\n  useEffect(() => {\n    fetchRecipients();\n  }, []);\n\n  const fetchRecipients = async () => {\n    try {\n      const response = await axios.get('/api/recipients');\n      setRecipients(response.data.data.recipients);\n    } catch (error: any) {\n      console.error('Error fetching recipients:', error);\n      toast.error('Failed to load recipients');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateRecipient = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await axios.post('/api/recipients', formData);\n      toast.success('Recipient added successfully!');\n      setShowCreateModal(false);\n      setFormData({\n        firstName: '',\n        lastName: '',\n        relationship: '',\n        clothingSize: '',\n        notes: '',\n      });\n      fetchRecipients();\n    } catch (error: any) {\n      console.error('Error creating recipient:', error);\n      toast.error(error.response?.data?.message || 'Failed to add recipient');\n    }\n  };\n\n  const handleEditClick = (recipient: Recipient) => {\n    setEditingRecipient(recipient);\n    setFormData({\n      firstName: recipient.first_name || '',\n      lastName: recipient.last_name || '',\n      relationship: recipient.relationship || '',\n      clothingSize: recipient.clothing_size || '',\n      notes: recipient.notes || '',\n    });\n    setShowEditModal(true);\n  };\n\n  const handleUpdateRecipient = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingRecipient) return;\n\n    try {\n      await axios.put(`/api/recipients/${editingRecipient.id}`, formData);\n      toast.success('Recipient updated successfully!');\n      setShowEditModal(false);\n      setEditingRecipient(null);\n      setFormData({\n        firstName: '',\n        lastName: '',\n        relationship: '',\n        clothingSize: '',\n        notes: '',\n      });\n      fetchRecipients();\n    } catch (error: any) {\n      console.error('Error updating recipient:', error);\n      toast.error(error.response?.data?.message || 'Failed to update recipient');\n    }\n  };\n\n  const handleDeleteRecipient = async (id: string, name: string) => {\n    if (!confirm(`Are you sure you want to delete \"${name}\"?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`/api/recipients/${id}`);\n      toast.success('Recipient deleted successfully');\n      fetchRecipients();\n    } catch (error: any) {\n      console.error('Error deleting recipient:', error);\n      toast.error('Failed to delete recipient');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading recipients...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Recipients</h1>\n          <p className=\"text-gray-600 mt-1\">Manage gift recipients and their preferences</p>\n        </div>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n        >\n          <FiPlus className=\"mr-2\" />\n          Add Recipient\n        </button>\n      </div>\n\n      {recipients.length === 0 ? (\n        <div className=\"bg-white rounded-lg shadow p-12 text-center\">\n          <FiUsers className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No recipients yet</h3>\n          <p className=\"text-gray-500 mb-4\">Start tracking people you knit for</p>\n          <button\n            onClick={() => setShowCreateModal(true)}\n            className=\"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n          >\n            <FiPlus className=\"mr-2\" />\n            Add Your First Recipient\n          </button>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {recipients.map((recipient) => (\n            <div\n              key={recipient.id}\n              className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6\"\n            >\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                {recipient.first_name} {recipient.last_name}\n              </h3>\n\n              {recipient.relationship && (\n                <p className=\"text-sm text-gray-600 mb-3\">{recipient.relationship}</p>\n              )}\n\n              {recipient.clothing_size && (\n                <div className=\"text-sm text-gray-500 mb-2\">\n                  <span className=\"font-medium\">Size:</span> {recipient.clothing_size}\n                </div>\n              )}\n\n              {recipient.notes && (\n                <p className=\"text-sm text-gray-600 mt-3 line-clamp-2\">{recipient.notes}</p>\n              )}\n\n              <div className=\"flex items-center gap-2 pt-4 border-t border-gray-200 mt-4\">\n                <button\n                  onClick={() => handleEditClick(recipient)}\n                  className=\"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiEdit2 className=\"mr-2 h-4 w-4\" />\n                  Edit\n                </button>\n                <button\n                  onClick={() =>\n                    handleDeleteRecipient(\n                      recipient.id,\n                      `${recipient.first_name} ${recipient.last_name}`\n                    )\n                  }\n                  className=\"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm\"\n                >\n                  <FiTrash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Create Recipient Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Add Recipient</h2>\n            </div>\n\n            <form onSubmit={handleCreateRecipient} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    First Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.firstName}\n                    onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Last Name\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.lastName}\n                    onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Relationship\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.relationship}\n                    onChange={(e) => setFormData({ ...formData, relationship: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Friend, Family, Child\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Clothing Size\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.clothingSize}\n                    onChange={(e) => setFormData({ ...formData, clothingSize: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Medium, Large\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Preferences, measurements, color likes/dislikes, etc.\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Add Recipient\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Recipient Modal */}\n      {showEditModal && editingRecipient && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <h2 className=\"text-2xl font-bold text-gray-900\">Edit Recipient</h2>\n            </div>\n\n            <form onSubmit={handleUpdateRecipient} className=\"p-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    First Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.firstName}\n                    onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Last Name\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.lastName}\n                    onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Relationship\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.relationship}\n                    onChange={(e) => setFormData({ ...formData, relationship: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Friend, Family, Child\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Clothing Size\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.clothingSize}\n                    onChange={(e) => setFormData({ ...formData, clothingSize: e.target.value })}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    placeholder=\"e.g., Medium, Large\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Notes</label>\n                <textarea\n                  value={formData.notes}\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"Preferences, measurements, color likes/dislikes, etc.\"\n                />\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingRecipient(null);\n                    setFormData({\n                      firstName: '',\n                      lastName: '',\n                      relationship: '',\n                      clothingSize: '',\n                      notes: '',\n                    });\n                  }}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition\"\n                >\n                  Update Recipient\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport {\n  FiUser,\n  FiLock,\n  FiSettings,\n  FiBarChart2,\n  FiCheckCircle,\n  FiAlertCircle,\n  FiEdit2,\n  FiSave,\n  FiX,\n} from 'react-icons/fi';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { useAuthStore } from '../stores/authStore';\n\n// Email validation regex\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\ninterface Stats {\n  totalProjects: number;\n  activeProjects: number;\n  completedProjects: number;\n  totalPatterns: number;\n  totalYarns: number;\n}\n\nexport default function Profile() {\n  const { user, setUser } = useAuthStore();\n  const [activeTab, setActiveTab] = useState<'profile' | 'security' | 'stats'>('profile');\n  const [stats, setStats] = useState<Stats>({\n    totalProjects: 0,\n    activeProjects: 0,\n    completedProjects: 0,\n    totalPatterns: 0,\n    totalYarns: 0,\n  });\n  const [loading, setLoading] = useState(false);\n  const [editMode, setEditMode] = useState(false);\n  const [profileForm, setProfileForm] = useState({\n    firstName: user?.firstName || '',\n    lastName: user?.lastName || '',\n    email: user?.email || '',\n  });\n  const [passwordForm, setPasswordForm] = useState({\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: '',\n  });\n\n  useEffect(() => {\n    fetchStats();\n  }, []);\n\n  useEffect(() => {\n    if (user) {\n      setProfileForm({\n        firstName: user.firstName,\n        lastName: user.lastName,\n        email: user.email,\n      });\n    }\n  }, [user]);\n\n  const fetchStats = async () => {\n    try {\n      const [projectsRes, patternsRes, yarnsRes] = await Promise.all([\n        axios.get('/api/projects').catch(() => ({ data: { data: { projects: [] } } })),\n        axios.get('/api/patterns').catch(() => ({ data: { data: { patterns: [] } } })),\n        axios.get('/api/yarn').catch(() => ({ data: { data: { yarn: [] } } })),\n      ]);\n\n      const projects = projectsRes.data.data.projects || [];\n      const activeProjects = projects.filter(\n        (p: any) => p.status === 'active' || p.status === 'in_progress'\n      );\n      const completedProjects = projects.filter((p: any) => p.status === 'completed');\n\n      setStats({\n        totalProjects: projects.length,\n        activeProjects: activeProjects.length,\n        completedProjects: completedProjects.length,\n        totalPatterns: patternsRes.data.data.patterns?.length || 0,\n        totalYarns: yarnsRes.data.data.yarn?.length || 0,\n      });\n    } catch (error) {\n      console.error('Error fetching stats:', error);\n    }\n  };\n\n  const handleUpdateProfile = async () => {\n    if (!profileForm.firstName.trim() || !profileForm.lastName.trim()) {\n      toast.error('First name and last name are required');\n      return;\n    }\n\n    if (!profileForm.email.trim()) {\n      toast.error('Email is required');\n      return;\n    }\n\n    if (!EMAIL_REGEX.test(profileForm.email)) {\n      toast.error('Please enter a valid email address');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await axios.put('/api/auth/profile', {\n        firstName: profileForm.firstName,\n        lastName: profileForm.lastName,\n        email: profileForm.email,\n      });\n\n      setUser(response.data.data.user);\n      toast.success('Profile updated successfully!');\n      setEditMode(false);\n    } catch (error) {\n      console.error('Error updating profile:', error);\n      const axiosError = error as { response?: { data?: { message?: string } } };\n      toast.error(axiosError.response?.data?.message || 'Failed to update profile');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChangePassword = async () => {\n    if (!passwordForm.currentPassword || !passwordForm.newPassword || !passwordForm.confirmPassword) {\n      toast.error('All password fields are required');\n      return;\n    }\n\n    if (passwordForm.newPassword.length < 8) {\n      toast.error('New password must be at least 8 characters');\n      return;\n    }\n\n    if (passwordForm.newPassword !== passwordForm.confirmPassword) {\n      toast.error('New passwords do not match');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      await axios.put('/api/auth/change-password', {\n        currentPassword: passwordForm.currentPassword,\n        newPassword: passwordForm.newPassword,\n      });\n\n      toast.success('Password changed successfully!');\n      setPasswordForm({\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: '',\n      });\n    } catch (error) {\n      console.error('Error changing password:', error);\n      const axiosError = error as { response?: { data?: { message?: string } } };\n      toast.error(axiosError.response?.data?.message || 'Failed to change password');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleResendVerification = async () => {\n    setLoading(true);\n    try {\n      await axios.post('/api/auth/resend-verification');\n      toast.success('Verification email sent! Please check your inbox.');\n    } catch (error: any) {\n      console.error('Error resending verification:', error);\n      toast.error(error.response?.data?.message || 'Failed to send verification email');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-500\">Loading profile...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">My Profile</h1>\n        <p className=\"text-gray-600\">Manage your account settings and preferences</p>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"mb-6 border-b border-gray-200\">\n        <div className=\"flex gap-6\">\n          <button\n            onClick={() => setActiveTab('profile')}\n            className={`pb-3 px-1 border-b-2 font-medium transition ${\n              activeTab === 'profile'\n                ? 'border-purple-600 text-purple-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            <div className=\"flex items-center gap-2\">\n              <FiUser className=\"h-4 w-4\" />\n              Profile\n            </div>\n          </button>\n          <button\n            onClick={() => setActiveTab('security')}\n            className={`pb-3 px-1 border-b-2 font-medium transition ${\n              activeTab === 'security'\n                ? 'border-purple-600 text-purple-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            <div className=\"flex items-center gap-2\">\n              <FiLock className=\"h-4 w-4\" />\n              Security\n            </div>\n          </button>\n          <button\n            onClick={() => setActiveTab('stats')}\n            className={`pb-3 px-1 border-b-2 font-medium transition ${\n              activeTab === 'stats'\n                ? 'border-purple-600 text-purple-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            <div className=\"flex items-center gap-2\">\n              <FiBarChart2 className=\"h-4 w-4\" />\n              Statistics\n            </div>\n          </button>\n        </div>\n      </div>\n\n      {/* Profile Tab */}\n      {activeTab === 'profile' && (\n        <div className=\"space-y-6\">\n          {/* Email Verification Status */}\n          {!user.emailVerified && (\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n              <div className=\"flex items-start gap-3\">\n                <FiAlertCircle className=\"h-5 w-5 text-yellow-600 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <h3 className=\"font-medium text-yellow-900\">Email Not Verified</h3>\n                  <p className=\"text-sm text-yellow-700 mt-1\">\n                    Please verify your email address to access all features.\n                  </p>\n                  <button\n                    onClick={handleResendVerification}\n                    disabled={loading}\n                    className=\"mt-2 text-sm text-yellow-800 underline hover:text-yellow-900 disabled:opacity-50\"\n                  >\n                    Resend verification email\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Profile Information */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900 flex items-center gap-2\">\n                <FiUser className=\"h-5 w-5\" />\n                Personal Information\n              </h2>\n              {!editMode && (\n                <button\n                  onClick={() => setEditMode(true)}\n                  className=\"flex items-center gap-2 px-4 py-2 text-purple-600 hover:bg-purple-50 rounded-lg transition\"\n                >\n                  <FiEdit2 className=\"h-4 w-4\" />\n                  Edit\n                </button>\n              )}\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    First Name\n                  </label>\n                  {editMode ? (\n                    <input\n                      type=\"text\"\n                      value={profileForm.firstName}\n                      onChange={(e) =>\n                        setProfileForm({ ...profileForm, firstName: e.target.value })\n                      }\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    />\n                  ) : (\n                    <p className=\"text-gray-900 py-2\">{user.firstName}</p>\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Last Name\n                  </label>\n                  {editMode ? (\n                    <input\n                      type=\"text\"\n                      value={profileForm.lastName}\n                      onChange={(e) =>\n                        setProfileForm({ ...profileForm, lastName: e.target.value })\n                      }\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                    />\n                  ) : (\n                    <p className=\"text-gray-900 py-2\">{user.lastName}</p>\n                  )}\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Email Address\n                  {user.emailVerified && (\n                    <span className=\"ml-2 text-green-600 text-xs inline-flex items-center gap-1\">\n                      <FiCheckCircle className=\"h-3 w-3\" />\n                      Verified\n                    </span>\n                  )}\n                </label>\n                {editMode ? (\n                  <input\n                    type=\"email\"\n                    value={profileForm.email}\n                    onChange={(e) => setProfileForm({ ...profileForm, email: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                  />\n                ) : (\n                  <p className=\"text-gray-900 py-2\">{user.email}</p>\n                )}\n              </div>\n\n              {editMode && (\n                <div className=\"flex gap-3 pt-4\">\n                  <button\n                    onClick={() => {\n                      setEditMode(false);\n                      setProfileForm({\n                        firstName: user.firstName,\n                        lastName: user.lastName,\n                        email: user.email,\n                      });\n                    }}\n                    className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center justify-center gap-2\"\n                  >\n                    <FiX className=\"h-4 w-4\" />\n                    Cancel\n                  </button>\n                  <button\n                    onClick={handleUpdateProfile}\n                    disabled={loading}\n                    className=\"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50\"\n                  >\n                    <FiSave className=\"h-4 w-4\" />\n                    {loading ? 'Saving...' : 'Save Changes'}\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Security Tab */}\n      {activeTab === 'security' && (\n        <div className=\"space-y-6\">\n          {/* Change Password */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2\">\n              <FiLock className=\"h-5 w-5\" />\n              Change Password\n            </h2>\n\n            <div className=\"space-y-4 max-w-md\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Current Password\n                </label>\n                <input\n                  type=\"password\"\n                  value={passwordForm.currentPassword}\n                  onChange={(e) =>\n                    setPasswordForm({ ...passwordForm, currentPassword: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  New Password\n                </label>\n                <input\n                  type=\"password\"\n                  value={passwordForm.newPassword}\n                  onChange={(e) =>\n                    setPasswordForm({ ...passwordForm, newPassword: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Must be at least 8 characters long\n                </p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Confirm New Password\n                </label>\n                <input\n                  type=\"password\"\n                  value={passwordForm.confirmPassword}\n                  onChange={(e) =>\n                    setPasswordForm({ ...passwordForm, confirmPassword: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                />\n              </div>\n\n              <button\n                onClick={handleChangePassword}\n                disabled={loading}\n                className=\"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition disabled:opacity-50\"\n              >\n                {loading ? 'Changing Password...' : 'Change Password'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Statistics Tab */}\n      {activeTab === 'stats' && (\n        <div className=\"space-y-6\">\n          {/* Stats Overview */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"text-sm font-medium text-gray-600\">Total Projects</h3>\n                <FiSettings className=\"h-5 w-5 text-purple-600\" />\n              </div>\n              <p className=\"text-3xl font-bold text-gray-900\">{stats.totalProjects}</p>\n              <p className=\"text-sm text-gray-500 mt-1\">\n                {stats.activeProjects} active, {stats.completedProjects} completed\n              </p>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"text-sm font-medium text-gray-600\">Pattern Library</h3>\n                <FiUser className=\"h-5 w-5 text-blue-600\" />\n              </div>\n              <p className=\"text-3xl font-bold text-gray-900\">{stats.totalPatterns}</p>\n              <p className=\"text-sm text-gray-500 mt-1\">patterns collected</p>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"text-sm font-medium text-gray-600\">Yarn Stash</h3>\n                <FiBarChart2 className=\"h-5 w-5 text-green-600\" />\n              </div>\n              <p className=\"text-3xl font-bold text-gray-900\">{stats.totalYarns}</p>\n              <p className=\"text-sm text-gray-500 mt-1\">skeins in stash</p>\n            </div>\n          </div>\n\n          {/* Account Info */}\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Account Information</h2>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between py-2 border-b border-gray-100\">\n                <span className=\"text-gray-600\">Account Status</span>\n                <span className=\"font-medium text-green-600\">Active</span>\n              </div>\n              <div className=\"flex justify-between py-2 border-b border-gray-100\">\n                <span className=\"text-gray-600\">User ID</span>\n                <span className=\"font-mono text-sm text-gray-900\">{user.id}</span>\n              </div>\n              <div className=\"flex justify-between py-2\">\n                <span className=\"text-gray-600\">Email Verification</span>\n                <span\n                  className={`font-medium ${\n                    user.emailVerified ? 'text-green-600' : 'text-yellow-600'\n                  }`}\n                >\n                  {user.emailVerified ? 'Verified' : 'Not Verified'}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, FormEvent } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useAuthStore } from '../../stores/authStore';\nimport { toast } from 'react-toastify';\n\n// Email validation regex\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nexport default function Login() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [rememberMe, setRememberMe] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [errors, setErrors] = useState<{ email?: string; password?: string }>({});\n  const navigate = useNavigate();\n  const login = useAuthStore((state) => state.login);\n\n  const validateForm = (): boolean => {\n    const newErrors: { email?: string; password?: string } = {};\n\n    if (!email.trim()) {\n      newErrors.email = 'Email is required';\n    } else if (!EMAIL_REGEX.test(email)) {\n      newErrors.email = 'Please enter a valid email address';\n    }\n\n    if (!password) {\n      newErrors.password = 'Password is required';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      await login(email, password, rememberMe);\n      toast.success('Login successful!');\n      navigate('/dashboard');\n    } catch (error) {\n      console.error('Login error:', error);\n      const axiosError = error as { response?: { data?: { message?: string } } };\n      const message = axiosError.response?.data?.message || 'Login failed. Please check your credentials.';\n      toast.error(message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full max-w-md mx-auto\">\n      <div className=\"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-8 transition-colors duration-200\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2\">Rowly</h1>\n          <p className=\"text-gray-600 dark:text-gray-300\">Sign in to your account</p>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div>\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Email Address\n            </label>\n            <input\n              id=\"email\"\n              type=\"email\"\n              value={email}\n              onChange={(e) => {\n                setEmail(e.target.value);\n                if (errors.email) setErrors({ ...errors, email: undefined });\n              }}\n              className={`w-full px-4 py-2 border ${errors.email ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'} bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition`}\n              placeholder=\"you@example.com\"\n              disabled={isLoading}\n              required\n            />\n            {errors.email && (\n              <p className=\"mt-1 text-sm text-red-500\">{errors.email}</p>\n            )}\n          </div>\n\n          <div>\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Password\n            </label>\n            <input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => {\n                setPassword(e.target.value);\n                if (errors.password) setErrors({ ...errors, password: undefined });\n              }}\n              className={`w-full px-4 py-2 border ${errors.password ? 'border-red-500' : 'border-gray-300 dark:border-gray-600'} bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition`}\n              placeholder=\"\"\n              disabled={isLoading}\n              required\n            />\n            {errors.password && (\n              <p className=\"mt-1 text-sm text-red-500\">{errors.password}</p>\n            )}\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <label className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                checked={rememberMe}\n                onChange={(e) => setRememberMe(e.target.checked)}\n                className=\"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"\n                disabled={isLoading}\n              />\n              <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">Remember me for 30 days</span>\n            </label>\n            <Link\n              to=\"/forgot-password\"\n              className=\"text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition\"\n            >\n              Forgot password?\n            </Link>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"w-full bg-purple-600 dark:bg-purple-700 text-white py-2 px-4 rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 transition disabled:opacity-50 disabled:cursor-not-allowed font-medium\"\n          >\n            {isLoading ? 'Signing in...' : 'Sign In'}\n          </button>\n        </form>\n\n        <div className=\"mt-6 text-center\">\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            Don't have an account?{' '}\n            <Link to=\"/register\" className=\"text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 font-medium transition\">\n              Sign up\n            </Link>\n          </p>\n        </div>\n\n        <div className=\"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700\">\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 text-center\">\n            Demo account: <span className=\"font-mono\">demo@rowlyknit.com</span> / <span className=\"font-mono\">Demo123!@#</span>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","export default function Register() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">Register</h1></div>; }\n","export default function ForgotPassword() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">ForgotPassword</h1></div>; }\n","export default function ResetPassword() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">ResetPassword</h1></div>; }\n","export default function VerifyEmail() { return <div className=\"p-6\"><h1 className=\"text-3xl font-bold\">VerifyEmail</h1></div>; }\n","import { Link } from 'react-router-dom';\nimport { FiHome, FiArrowLeft } from 'react-icons/fi';\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex flex-col items-center justify-center px-4\">\n      <div className=\"text-center max-w-md\">\n        {/* 404 Icon */}\n        <div className=\"mb-8\">\n          <span className=\"text-9xl font-bold text-gray-200\">404</span>\n        </div>\n\n        {/* Message */}\n        <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">\n          Page Not Found\n        </h1>\n        <p className=\"text-gray-600 mb-8\">\n          Oops! The page you're looking for doesn't exist or has been moved.\n          Don't worry, even the best knitters drop a stitch sometimes.\n        </p>\n\n        {/* Navigation Options */}\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n          <Link\n            to=\"/\"\n            className=\"inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium\"\n          >\n            <FiHome size={20} />\n            Go to Dashboard\n          </Link>\n          <button\n            onClick={() => window.history.back()}\n            className=\"inline-flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium\"\n          >\n            <FiArrowLeft size={20} />\n            Go Back\n          </button>\n        </div>\n\n        {/* Quick Links */}\n        <div className=\"mt-12 pt-8 border-t border-gray-200\">\n          <p className=\"text-sm text-gray-500 mb-4\">Or try one of these:</p>\n          <div className=\"flex flex-wrap justify-center gap-4 text-sm\">\n            <Link to=\"/projects\" className=\"text-blue-600 hover:underline\">\n              Projects\n            </Link>\n            <Link to=\"/patterns\" className=\"text-blue-600 hover:underline\">\n              Patterns\n            </Link>\n            <Link to=\"/yarn\" className=\"text-blue-600 hover:underline\">\n              Yarn Stash\n            </Link>\n            <Link to=\"/tools\" className=\"text-blue-600 hover:underline\">\n              Tools\n            </Link>\n            <Link to=\"/recipients\" className=\"text-blue-600 hover:underline\">\n              Recipients\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { Routes, Route, Navigate } from 'react-router-dom';\nimport { useAuthStore } from './stores/authStore';\nimport PWAInstallPrompt from './components/PWAInstallPrompt';\nimport OfflineIndicator from './components/OfflineIndicator';\nimport { RateLimitNotifier } from './components/RateLimitNotifier';\n\n// Layouts\nimport MainLayout from './components/layouts/MainLayout';\nimport AuthLayout from './components/layouts/AuthLayout';\n\n// Pages\nimport Dashboard from './pages/Dashboard';\nimport Projects from './pages/Projects';\nimport ProjectDetail from './pages/ProjectDetail';\nimport Patterns from './pages/Patterns';\nimport PatternDetail from './pages/PatternDetail';\nimport PatternBuilder from './pages/PatternBuilder';\nimport YarnStash from './pages/YarnStash';\nimport Tools from './pages/Tools';\nimport Recipients from './pages/Recipients';\nimport Profile from './pages/Profile';\nimport Login from './pages/auth/Login';\nimport Register from './pages/auth/Register';\nimport ForgotPassword from './pages/auth/ForgotPassword';\nimport ResetPassword from './pages/auth/ResetPassword';\nimport VerifyEmail from './pages/auth/VerifyEmail';\nimport NotFound from './pages/NotFound';\n\n// Protected route wrapper\nfunction PrivateRoute({ children }: { children: React.ReactNode }) {\n  const { isAuthenticated } = useAuthStore();\n  return isAuthenticated ? <>{children}</> : <Navigate to=\"/login\" replace />;\n}\n\n// Public route wrapper (redirect to dashboard if authenticated)\nfunction PublicRoute({ children }: { children: React.ReactNode }) {\n  const { isAuthenticated } = useAuthStore();\n  return !isAuthenticated ? <>{children}</> : <Navigate to=\"/dashboard\" replace />;\n}\n\nfunction App() {\n  return (\n    <>\n      <OfflineIndicator />\n      <PWAInstallPrompt />\n      <RateLimitNotifier />\n      <Routes>\n        {/* Auth routes */}\n      <Route element={<AuthLayout />}>\n        <Route\n          path=\"/login\"\n          element={\n            <PublicRoute>\n              <Login />\n            </PublicRoute>\n          }\n        />\n        <Route\n          path=\"/register\"\n          element={\n            <PublicRoute>\n              <Register />\n            </PublicRoute>\n          }\n        />\n        <Route\n          path=\"/forgot-password\"\n          element={\n            <PublicRoute>\n              <ForgotPassword />\n            </PublicRoute>\n          }\n        />\n        <Route path=\"/reset-password\" element={<ResetPassword />} />\n        <Route path=\"/verify-email\" element={<VerifyEmail />} />\n      </Route>\n\n      {/* Protected routes */}\n      <Route\n        element={\n          <PrivateRoute>\n            <MainLayout />\n          </PrivateRoute>\n        }\n      >\n        <Route path=\"/\" element={<Navigate to=\"/dashboard\" replace />} />\n        <Route path=\"/dashboard\" element={<Dashboard />} />\n        <Route path=\"/projects\" element={<Projects />} />\n        <Route path=\"/projects/:id\" element={<ProjectDetail />} />\n        <Route path=\"/patterns\" element={<Patterns />} />\n        <Route path=\"/patterns/:id\" element={<PatternDetail />} />\n        <Route path=\"/patterns/:id/builder\" element={<PatternBuilder />} />\n        <Route path=\"/pattern-builder\" element={<PatternBuilder />} />\n        <Route path=\"/yarn\" element={<YarnStash />} />\n        <Route path=\"/tools\" element={<Tools />} />\n        <Route path=\"/recipients\" element={<Recipients />} />\n        <Route path=\"/profile\" element={<Profile />} />\n      </Route>\n\n      {/* 404 */}\n      <Route path=\"*\" element={<NotFound />} />\n      </Routes>\n    </>\n  );\n}\n\nexport default App;\n","import { Component, ErrorInfo, ReactNode } from 'react';\nimport { FiAlertTriangle, FiRefreshCw } from 'react-icons/fi';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n}\n\nclass ErrorBoundary extends Component<Props, State> {\n  public state: State = {\n    hasError: false,\n    error: null,\n    errorInfo: null,\n  };\n\n  public static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error, errorInfo: null };\n  }\n\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\n    this.setState({\n      error,\n      errorInfo,\n    });\n  }\n\n  private handleReset = () => {\n    this.setState({ hasError: false, error: null, errorInfo: null });\n    window.location.reload();\n  };\n\n  public render() {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      return (\n        <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4\">\n          <div className=\"max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-8\">\n            <div className=\"flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-red-100 dark:bg-red-900/20 rounded-full mx-auto mb-4 md:mb-6\">\n              <FiAlertTriangle className=\"w-8 h-8 md:w-10 md:h-10 text-red-600 dark:text-red-400\" />\n            </div>\n\n            <h2 className=\"text-xl md:text-2xl font-bold text-gray-900 dark:text-white text-center mb-3 md:mb-4\">\n              Something went wrong\n            </h2>\n\n            <p className=\"text-sm md:text-base text-gray-600 dark:text-gray-400 text-center mb-6 md:mb-8\">\n              We're sorry for the inconvenience. The app encountered an unexpected error.\n            </p>\n\n            {import.meta.env.DEV && this.state.error && (\n              <div className=\"mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-auto max-h-40 md:max-h-60\">\n                <p className=\"text-xs md:text-sm font-mono text-red-600 dark:text-red-400 break-all\">\n                  {this.state.error.toString()}\n                </p>\n                {this.state.errorInfo && (\n                  <pre className=\"text-xs mt-2 text-gray-600 dark:text-gray-400 overflow-auto\">\n                    {this.state.errorInfo.componentStack}\n                  </pre>\n                )}\n              </div>\n            )}\n\n            <button\n              onClick={this.handleReset}\n              className=\"w-full flex items-center justify-center gap-2 px-6 py-3 md:py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors min-h-[56px] md:min-h-[64px]\"\n            >\n              <FiRefreshCw className=\"w-5 h-5 md:w-6 md:h-6\" />\n              <span className=\"text-base md:text-lg\">Reload App</span>\n            </button>\n\n            <p className=\"text-xs md:text-sm text-gray-500 dark:text-gray-400 text-center mt-4 md:mt-6\">\n              If this problem persists, please contact support\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { BrowserRouter } from 'react-router-dom';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { ToastContainer, toast } from 'react-toastify';\nimport App from './App';\nimport ErrorBoundary from './components/ErrorBoundary';\nimport { WebSocketProvider } from './contexts/WebSocketContext';\nimport './lib/axios'; // Initialize axios configuration with withCredentials\nimport './styles/index.css';\nimport 'react-toastify/dist/ReactToastify.css';\n\n// Global error handlers for debugging\nwindow.addEventListener('error', (event) => {\n  console.error('Global error:', event.error);\n  console.error('Error message:', event.message);\n  console.error('Error source:', event.filename, event.lineno, event.colno);\n});\n\nwindow.addEventListener('unhandledrejection', (event) => {\n  console.error('Unhandled promise rejection:', event.reason);\n});\n\n// Global API error handler - shows toast notifications for API errors\nwindow.addEventListener('api-error', ((event: CustomEvent<{ status: number; message: string }>) => {\n  const { status, message } = event.detail;\n  // Only show toast for certain errors (not 404s for resources that might not exist)\n  if (status >= 500) {\n    toast.error(message);\n  } else if (status === 422) {\n    toast.warning(message);\n  }\n}) as EventListener);\n\n// Rate limit exceeded handler\nwindow.addEventListener('rate-limit-exceeded', ((event: CustomEvent<{ message: string; retryAfter?: number }>) => {\n  const { message, retryAfter } = event.detail;\n  toast.warning(`${message}${retryAfter ? ` Please wait ${retryAfter} seconds.` : ''}`, {\n    autoClose: retryAfter ? retryAfter * 1000 : 5000,\n  });\n}) as EventListener);\n\n// IMPORTANT: Unregister old service workers and clear cache to fix React undefined issue\n// This ensures we don't serve stale JS bundles from the service worker cache\nif ('serviceWorker' in navigator && import.meta.env.PROD) {\n  window.addEventListener('load', async () => {\n    try {\n      // Get all service worker registrations\n      const registrations = await navigator.serviceWorker.getRegistrations();\n\n      // Unregister all existing service workers\n      for (const registration of registrations) {\n        console.log('Unregistering old service worker...');\n        await registration.unregister();\n      }\n\n      // Clear all caches\n      if ('caches' in window) {\n        const cacheNames = await caches.keys();\n        for (const cacheName of cacheNames) {\n          console.log('Deleting cache:', cacheName);\n          await caches.delete(cacheName);\n        }\n      }\n\n      console.log(' All service workers unregistered and caches cleared');\n\n      // Now register the new service worker\n      const registration = await navigator.serviceWorker.register('/sw.js');\n      console.log(' New ServiceWorker registered:', registration);\n    } catch (error) {\n      console.error(' ServiceWorker error:', error);\n    }\n  });\n}\n\n// Create React Query client\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 1000 * 60 * 5, // 5 minutes\n      retry: 1,\n      refetchOnWindowFocus: false,\n    },\n  },\n});\n\n// Add error logging to catch initialization errors\ntry {\n  const rootElement = document.getElementById('root');\n\n  if (!rootElement) {\n    throw new Error('Root element not found! DOM might not be ready.');\n  }\n\n  console.log('Initializing React app...');\n  console.log('React version:', React.version);\n  console.log('Environment:', import.meta.env.MODE);\n\n  ReactDOM.createRoot(rootElement).render(\n    <React.StrictMode>\n      <ErrorBoundary>\n        <QueryClientProvider client={queryClient}>\n          <BrowserRouter>\n            <WebSocketProvider>\n              <App />\n              <ToastContainer\n                position=\"top-right\"\n                autoClose={3000}\n                hideProgressBar={false}\n                newestOnTop\n                closeOnClick\n                rtl={false}\n                pauseOnFocusLoss\n                draggable\n                pauseOnHover\n              />\n            </WebSocketProvider>\n          </BrowserRouter>\n        </QueryClientProvider>\n      </ErrorBoundary>\n    </React.StrictMode>\n  );\n\n  console.log(' React app initialized successfully');\n} catch (error) {\n  console.error(' Failed to initialize React app:', error);\n\n  // Display error to user\n  const rootElement = document.getElementById('root');\n  if (rootElement) {\n    rootElement.innerHTML = `\n      <div style=\"padding: 20px; font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto;\">\n        <h1 style=\"color: #dc2626;\">Application Error</h1>\n        <p>The application failed to start. Please check the browser console for details.</p>\n        <pre style=\"background: #f3f4f6; padding: 15px; border-radius: 5px; overflow: auto;\">\n          ${error instanceof Error ? error.message : String(error)}\n          ${error instanceof Error && error.stack ? '\\n\\n' + error.stack : ''}\n        </pre>\n        <button onclick=\"location.reload()\" style=\"margin-top: 20px; padding: 10px 20px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer;\">\n          Reload Page\n        </button>\n      </div>\n    `;\n  }\n}\n"],"file":"assets/index-f3ME2EaM.js"}