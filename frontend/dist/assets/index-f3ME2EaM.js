var ss=Object.defineProperty;var as=(t,a,s)=>a in t?ss(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var Xe=(t,a,s)=>as(t,typeof a!="symbol"?a+"":a,s);import{r,j as e,F as xe,a as Ae,b as ns,c as ls,Q as f,d as Ue,e as Oe,f as os,g as is,R as nt,h as Be,i as Ze,k as cs,l as Tt,m as ds,n as _t,o as us,p as ms,q as xs,s as nr,t as Ye,v as ze,w as $e,x as qe,y as Rt,z as lt,L as be,A as Je,B as gs,O as lr,C as ue,D as Ne,E as or,G as ge,H as ot,I as Mt,J as mt,K as Dt,M as it,N as ct,P as hs,S as ps,T as xt,U as et,V as ir,W as At,X as $t,Y as cr,Z as dr,_ as ur,$ as bs,a0 as fs,a1 as qt,a2 as dt,a3 as Ee,a4 as gt,a5 as We,a6 as ys,a7 as js,a8 as Ke,a9 as vs,aa as ws,ab as mr,ac as xr,ad as Ns,ae as gr,af as hr,ag as Lt,ah as ht,ai as pr,aj as ut,ak as It,al as ks,am as Cs,an as Ss,ao as zt,ap as rt,aq as Ot,ar as Ht,as as Ps,at as Fs,au as Wt,av as Kt,aw as _s,ax as je,ay as Bt,az as $s,aA as Es,aB as Ts,aC as Rs}from"./vendor-react-Bk_IM2t1.js";import{c as br,p as fr,Q as Ms}from"./vendor-state-BHpSTJu1.js";import{q as E,t as Ds,u as As}from"./vendor-other-Ccb91pWV.js";import{f as Nt,a as yr}from"./vendor-utils-6R1gXQp1.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))C(u);new MutationObserver(u=>{for(const F of u)if(F.type==="childList")for(const j of F.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&C(j)}).observe(document,{childList:!0,subtree:!0});function s(u){const F={};return u.integrity&&(F.integrity=u.integrity),u.referrerPolicy&&(F.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?F.credentials="include":u.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function C(u){if(u.ep)return;u.ep=!0;const F=s(u);fetch(u.href,F)}})();const Le=br()(fr((t,a)=>({user:null,accessToken:null,isAuthenticated:!1,login:async(s,C,u)=>{const F=await E.post("/api/auth/login",{email:s,password:C,rememberMe:u}),{user:j,accessToken:k}=F.data.data;t({user:j,accessToken:k,isAuthenticated:!0}),E.defaults.headers.common.Authorization=`Bearer ${k}`},register:async s=>{await E.post("/api/auth/register",s)},logout:async()=>{try{await E.post("/api/auth/logout")}catch(s){console.error("Logout error:",s)}finally{t({user:null,accessToken:null,isAuthenticated:!1}),delete E.defaults.headers.common.Authorization}},setUser:s=>{t({user:s})},setToken:s=>{t({accessToken:s}),E.defaults.headers.common.Authorization=`Bearer ${s}`},refreshToken:async()=>{var s;try{const C=await E.post("/api/auth/refresh");if(C.data.success&&((s=C.data.data)!=null&&s.accessToken)){const u=C.data.data.accessToken;return t({accessToken:u}),E.defaults.headers.common.Authorization=`Bearer ${u}`,u}return null}catch(C){return console.error("Token refresh failed:",C),t({user:null,accessToken:null,isAuthenticated:!1}),delete E.defaults.headers.common.Authorization,null}},checkAuth:async()=>{const{accessToken:s}=a();if(s)try{E.defaults.headers.common.Authorization=`Bearer ${s}`;const C=await E.get("/api/auth/profile"),{user:u}=C.data.data;t({user:u,isAuthenticated:!0})}catch(C){console.error("Auth check failed:",C),t({user:null,accessToken:null,isAuthenticated:!1}),delete E.defaults.headers.common.Authorization}}}),{name:"rowly-auth",partialize:t=>({user:t.user,accessToken:t.accessToken,isAuthenticated:t.isAuthenticated})}));if(typeof window<"u"){const t=()=>{const a=Le.getState();a.accessToken&&a.checkAuth().catch(s=>{console.error("checkAuth failed on initialization:",s)})};"requestIdleCallback"in window?window.requestIdleCallback(t,{timeout:2e3}):setTimeout(t,1e3)}function Ls(){const[t,a]=r.useState(null),[s,C]=r.useState(!1);r.useEffect(()=>{const j=k=>{k.preventDefault(),a(k),localStorage.getItem("pwa-install-dismissed")||C(!0)};return window.addEventListener("beforeinstallprompt",j),()=>{window.removeEventListener("beforeinstallprompt",j)}},[]);const u=async()=>{if(!t)return;await t.prompt();const{outcome:j}=await t.userChoice;console.log(j==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),a(null),C(!1)},F=()=>{C(!1);const j=Date.now()+30*24*60*60*1e3;localStorage.setItem("pwa-install-dismissed",j.toString())};return!s||!t?null:e.jsxs("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-purple-200 dark:border-purple-700 p-6 z-50 animate-slide-up",role:"dialog","aria-labelledby":"pwa-install-title","aria-describedby":"pwa-install-description",children:[e.jsx("button",{onClick:F,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition","aria-label":"Dismiss install prompt",children:e.jsx(xe,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center",children:e.jsx(Ae,{className:"h-6 w-6 text-purple-600 dark:text-purple-400","aria-hidden":"true"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{id:"pwa-install-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-1",children:"Install Rowly App"}),e.jsx("p",{id:"pwa-install-description",className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Install Rowly on your device for quick access and offline use!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"flex-1 px-4 py-2 bg-purple-600 dark:bg-purple-700 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition font-medium","aria-label":"Install Rowly app",children:"Install"}),e.jsx("button",{onClick:F,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition","aria-label":"Dismiss for now",children:"Not now"})]})]})]})]})}function Is(){const[t,a]=r.useState(navigator.onLine),[s,C]=r.useState(!1);return r.useEffect(()=>{const u=()=>{a(!0),C(!0),setTimeout(()=>C(!1),3e3)},F=()=>{a(!1),C(!0)};return window.addEventListener("online",u),window.addEventListener("offline",F),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",F)}},[]),!s&&t?null:e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ${s?"translate-y-0":"-translate-y-full"}`,role:"status","aria-live":"polite","aria-atomic":"true",children:e.jsx("div",{className:`px-4 py-3 text-center text-white font-medium ${t?"bg-green-600":"bg-orange-600"}`,children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"h-5 w-5","aria-hidden":"true"}),e.jsx("span",{children:"Back online! Your changes will sync automatically."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"h-5 w-5","aria-hidden":"true"}),e.jsx("span",{children:"You're offline. Changes will sync when you reconnect."})]})})})})}const zs=()=>(r.useEffect(()=>{const t=a=>{const s=a,{message:C,tier:u,limit:F,retryAfter:j}=s.detail;let k="";if(j){const l=Math.ceil(j/60),P=j%60;l>0?k=l===1?"1 minute":`${l} minutes`:k=P===1?"1 second":`${P} seconds`}f.warning(e.jsxs("div",{children:[e.jsx("strong",{children:"Rate Limit Reached"}),e.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"14px"},children:C||`You've reached your ${u} tier limit of ${F} requests.`}),k&&e.jsxs("p",{style:{margin:"4px 0 0 0",fontSize:"13px",opacity:.9},children:["Please wait ",k," before trying again."]})]}),{autoClose:j?Math.min(j*1e3,1e4):5e3,closeOnClick:!0,pauseOnHover:!0,draggable:!0})};return window.addEventListener("rate-limit-exceeded",t),()=>{window.removeEventListener("rate-limit-exceeded",t)}},[]),null);function Os(){const[t,a]=r.useState(!1),[s,C]=r.useState(""),[u,F]=r.useState([]),[j,k]=r.useState(!1),l=r.useRef(null),P=Ue();r.useEffect(()=>{const v=d=>{(d.metaKey||d.ctrlKey)&&d.key==="k"&&(d.preventDefault(),a(!0)),d.key==="Escape"&&a(!1)};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[]),r.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),r.useEffect(()=>{if(!s.trim()){F([]);return}const v=setTimeout(async()=>{await p(s)},300);return()=>clearTimeout(v)},[s]);const p=async v=>{var d,y,w,c,o;k(!0);try{const[N,g,n,S,T]=await Promise.all([E.get(`/api/projects?search=${encodeURIComponent(v)}`).catch(()=>({data:{data:{projects:[]}}})),E.get(`/api/patterns?search=${encodeURIComponent(v)}`).catch(()=>({data:{data:{patterns:[]}}})),E.get(`/api/yarn?search=${encodeURIComponent(v)}`).catch(()=>({data:{data:{yarn:[]}}})),E.get(`/api/recipients?search=${encodeURIComponent(v)}`).catch(()=>({data:{data:{recipients:[]}}})),E.get(`/api/tools?search=${encodeURIComponent(v)}`).catch(()=>({data:{data:{tools:[]}}}))]),h=[];(d=N.data.data.projects)==null||d.slice(0,5).forEach(b=>{h.push({id:b.id,type:"project",title:b.name,subtitle:b.description||b.status,url:`/projects/${b.id}`})}),(y=g.data.data.patterns)==null||y.slice(0,3).forEach(b=>{h.push({id:b.id,type:"pattern",title:b.name,subtitle:b.designer||b.pattern_type,url:"/patterns"})}),(w=n.data.data.yarn)==null||w.slice(0,3).forEach(b=>{h.push({id:b.id,type:"yarn",title:`${b.brand} ${b.name}`,subtitle:`${b.color_name||""} - ${b.weight||""}`,url:"/yarn"})}),(c=S.data.data.recipients)==null||c.slice(0,2).forEach(b=>{h.push({id:b.id,type:"recipient",title:b.name,subtitle:b.relationship,url:"/recipients"})}),(o=T.data.data.tools)==null||o.slice(0,2).forEach(b=>{h.push({id:b.id,type:"tool",title:b.name,subtitle:b.tool_type,url:"/tools"})}),F(h)}catch(N){console.error("Search error:",N),f.error("Search failed")}finally{k(!1)}},m=v=>{P(v.url),a(!1),C("")},i=v=>{switch(v){case"project":return"bg-purple-100 text-purple-800";case"pattern":return"bg-blue-100 text-blue-800";case"yarn":return"bg-pink-100 text-pink-800";case"recipient":return"bg-green-100 text-green-800";case"tool":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20 px-4",role:"dialog","aria-modal":"true","aria-label":"Global search",onClick:v=>{v.target===v.currentTarget&&(a(!1),C(""))},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[60vh] flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}),e.jsx("input",{ref:l,type:"text",value:s,onChange:v=>C(v.target.value),placeholder:"Search projects, patterns, yarn, and more...",className:"flex-1 outline-none text-lg bg-transparent text-gray-900 dark:text-gray-100","aria-label":"Search input",autoComplete:"off"}),e.jsx("button",{onClick:()=>{a(!1),C("")},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Close search",children:e.jsx(xe,{className:"h-5 w-5","aria-hidden":"true"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",role:"region","aria-live":"polite","aria-label":"Search results",children:[j&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",role:"status",children:"Searching..."}),!j&&s&&u.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",role:"status",children:"No results found"}),!j&&u.length>0&&e.jsx("div",{className:"space-y-1",role:"list",children:u.map(v=>e.jsxs("button",{onClick:()=>m(v),className:"w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition flex items-center justify-between",role:"listitem","aria-label":`${v.type}: ${v.title}${v.subtitle?` - ${v.subtitle}`:""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.title}),v.subtitle&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:v.subtitle})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${i(v.type)}`,children:v.type})]},`${v.type}-${v.id}`))}),!j&&!s&&e.jsxs("div",{className:"py-8 text-center text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"mb-2",children:"Start typing to search"}),e.jsx("p",{className:"text-sm",children:"Projects, patterns, yarn, recipients, and tools"})]})]}),e.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between",children:[e.jsx("span",{children:"Press ESC to close"}),e.jsx("span",{children:"⌘K to open"})]})]})}):e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition","aria-label":"Open global search",title:"Search (⌘K)",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"}),e.jsx("kbd",{className:"hidden sm:inline-block px-2 py-0.5 text-xs font-semibold text-gray-500 bg-gray-200 border border-gray-300 rounded",children:"⌘K"})]})}const jr=br()(fr(t=>({theme:"light",toggleTheme:()=>{t(a=>{const s=a.theme==="light"?"dark":"light";return st(s),{theme:s}})},setTheme:a=>{st(a),t({theme:a})}}),{name:"rowly-theme",onRehydrateStorage:()=>t=>{t!=null&&t.theme&&st(t.theme)}}));function st(t){const a=window.document.documentElement;t==="dark"?a.classList.add("dark"):a.classList.remove("dark")}const{theme:Bs}=jr.getState();st(Bs);function vr(){const{theme:t,toggleTheme:a}=jr();return e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200","aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,title:`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx(os,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}):e.jsx(is,{className:"w-5 h-5 text-yellow-500"})})}const Us="modulepreload",Vs=function(t){return"/"+t},Gt={},Ys=function(a,s,C){let u=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const j=document.querySelector("meta[property=csp-nonce]"),k=(j==null?void 0:j.nonce)||(j==null?void 0:j.getAttribute("nonce"));u=Promise.allSettled(s.map(l=>{if(l=Vs(l),l in Gt)return;Gt[l]=!0;const P=l.endsWith(".css"),p=P?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const m=document.createElement("link");if(m.rel=P?"stylesheet":Us,P||(m.as="script"),m.crossOrigin="",m.href=l,k&&m.setAttribute("nonce",k),document.head.appendChild(m),P)return new Promise((i,v)=>{m.addEventListener("load",i),m.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${l}`)))})}))}function F(j){const k=new Event("vite:preloadError",{cancelable:!0});if(k.payload=j,window.dispatchEvent(k),!k.defaultPrevented)throw j}return u.then(j=>{for(const k of j||[])k.status==="rejected"&&F(k.reason);return a().catch(F)})},qs="rowly-offline",Hs=1;let He=null;const wr=async()=>He||(He=await Ds(qs,Hs,{upgrade(t,a,s,C){if(t.objectStoreNames.contains("patterns")||t.createObjectStore("patterns",{keyPath:"id"}),t.objectStoreNames.contains("pdf-cache")||t.createObjectStore("pdf-cache",{keyPath:"patternId"}),!t.objectStoreNames.contains("counters")){const u=t.createObjectStore("counters",{keyPath:"id"});u.createIndex("project_id","project_id"),u.createIndex("synced","synced")}if(!t.objectStoreNames.contains("sync-queue")){const u=t.createObjectStore("sync-queue",{keyPath:"id",autoIncrement:!0});u.createIndex("synced","synced"),u.createIndex("timestamp","timestamp")}if(t.objectStoreNames.contains("projects")||t.createObjectStore("projects",{keyPath:"id"}),!t.objectStoreNames.contains("sessions")){const u=t.createObjectStore("sessions",{keyPath:"id"});u.createIndex("project_id","project_id"),u.createIndex("synced","synced")}if(!t.objectStoreNames.contains("notes")){const u=t.createObjectStore("notes",{keyPath:"id"});u.createIndex("type","type"),u.createIndex("synced","synced")}}}),He),he=async()=>He||wr(),Ws=async t=>{await(await he()).put("patterns",{id:t.id,name:t.name,file_url:t.file_url,data:t,cached_at:new Date().toISOString()})},Ks=async t=>(await he()).get("patterns",t),Gs=async()=>(await he()).getAll("patterns"),Xs=async(t,a)=>{await(await he()).put("pdf-cache",{patternId:t,blob:a,cached_at:new Date().toISOString()})},Qs=async t=>(await he()).get("pdf-cache",t),Js=async(t,a=!0)=>{await(await he()).put("counters",{id:t.id,project_id:t.project_id,value:t.current_value,updated_at:Date.now(),synced:a})},Zs=async t=>(await he()).get("counters",t),ea=async t=>(await he()).transaction("counters").store.index("project_id").getAll(t),ta=async t=>{await(await he()).add("sync-queue",{...t,timestamp:Date.now(),synced:!1,retries:0})},at=async()=>(await he()).getAll("sync-queue"),Nr=async()=>(await he()).transaction("sync-queue").store.index("synced").getAll(!1),kr=async t=>{const a=await he(),s=await a.get("sync-queue",t);s&&await a.put("sync-queue",{...s,synced:!0})},Cr=async t=>{const a=await he(),s=await a.get("sync-queue",t);s&&await a.put("sync-queue",{...s,retries:s.retries+1})},Sr=async t=>{await(await he()).delete("sync-queue",t)},ra=async t=>{await(await he()).put("projects",{id:t.id,data:t,cached_at:new Date().toISOString()})},sa=async t=>(await he()).get("projects",t),aa=async(t,a=!0)=>{await(await he()).put("sessions",{id:t.id,project_id:t.project_id,data:t,cached_at:new Date().toISOString(),synced:a})},na=async t=>(await he()).get("sessions",t),la=async t=>(await(await he()).transaction("sessions").store.index("project_id").getAll(t)).map(u=>u.data),oa=async(t,a,s=!0)=>{await(await he()).put("notes",{id:t.id,type:a,data:t,cached_at:new Date().toISOString(),synced:s})},ia=async t=>(await he()).get("notes",t),ca=async()=>(await he()).transaction("notes").store.index("synced").getAll(!1),da=async()=>{const t=await he(),a=["patterns","pdf-cache","counters","projects","sessions","notes"];for(const s of a)await t.clear(s)},ua=async()=>"storage"in navigator&&"estimate"in navigator.storage&&(await navigator.storage.estimate()).usage||0,ma=Object.freeze(Object.defineProperty({__proto__:null,addToSyncQueue:ta,cacheCounter:Js,cacheNote:oa,cachePDF:Xs,cachePattern:Ws,cacheProject:ra,cacheSession:aa,clearCache:da,deleteSyncItem:Sr,getAllCachedPatterns:Gs,getCacheSize:ua,getCounterFromCache:Zs,getDB:he,getNoteFromCache:ia,getPDFFromCache:Qs,getPatternFromCache:Ks,getProjectCountersFromCache:ea,getProjectFromCache:sa,getProjectSessionsFromCache:la,getSessionFromCache:na,getSyncQueue:at,getUnsyncedItems:Nr,getUnsyncedNotes:ca,incrementSyncRetry:Cr,initDB:wr,markSyncItemComplete:kr},Symbol.toStringTag,{value:"Module"})),kt=3,xa=2e3;class ga{constructor(){Xe(this,"isSyncing",!1);Xe(this,"syncListeners",new Set);window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline())}onSyncStatusChange(a){return this.syncListeners.add(a),()=>this.syncListeners.delete(a)}notifyListeners(a){this.syncListeners.forEach(s=>s(a))}async getSyncStatus(){const s=(await at()).filter(u=>!u.synced),C=s.filter(u=>u.retries>=kt);return{isSyncing:this.isSyncing,pendingCount:s.length,failedCount:C.length,lastSyncTime:void 0}}async handleOnline(){console.log("Device is online, starting sync..."),await this.processSyncQueue()}handleOffline(){console.log("Device is offline"),this.isSyncing=!1}async processSyncQueue(){if(this.isSyncing){console.log("Sync already in progress");return}if(!navigator.onLine){console.log("Device is offline, skipping sync");return}this.isSyncing=!0,this.notifyListeners(await this.getSyncStatus());try{const a=await Nr();console.log(`Processing ${a.length} unsynced items`);for(const s of a){if(s.retries>=kt){console.error(`Item ${s.id} has exceeded max retries, skipping`);continue}try{await this.syncItem(s),await kr(s.id),console.log(`Successfully synced item ${s.id}`)}catch(C){console.error(`Failed to sync item ${s.id}:`,C),await Cr(s.id);const u=xa*Math.pow(2,s.retries);await this.sleep(u)}}this.notifyListeners(await this.getSyncStatus())}catch(a){console.error("Error processing sync queue:",a)}finally{this.isSyncing=!1}}async syncItem(a){const s={method:a.method,url:a.endpoint,data:a.data,headers:{"Content-Type":"application/json"}};await E(s)}async sync(){return this.processSyncQueue()}async clearQueue(){const a=await at();for(const s of a)s.id&&await Sr(s.id);this.notifyListeners(await this.getSyncStatus())}async getFailedItems(){return(await at()).filter(s=>!s.synced&&s.retries>=kt)}async retryFailed(){const a=await this.getFailedItems();for(const s of a)s.id&&await(await Ys(()=>Promise.resolve().then(()=>ma),void 0).then(u=>u.getDB())).put("sync-queue",{...s,retries:0});await this.processSyncQueue()}sleep(a){return new Promise(s=>setTimeout(s,a))}}const Qe=new ga,ha=()=>{const[t,a]=r.useState(navigator.onLine),[s,C]=r.useState({isSyncing:!1,pendingCount:0,failedCount:0}),[u,F]=r.useState(!1),[j,k]=r.useState([]);nt.useEffect(()=>{const d=()=>a(!0),y=()=>a(!1);return window.addEventListener("online",d),window.addEventListener("offline",y),()=>{window.removeEventListener("online",d),window.removeEventListener("offline",y)}},[]),nt.useEffect(()=>{const d=Qe.onSyncStatusChange(y=>{C(y)});return Qe.getSyncStatus().then(C),()=>{typeof d=="function"&&d()}},[]);const l=async()=>{try{await Qe.sync()}catch(d){console.error("Manual sync failed:",d)}},P=async()=>{try{await Qe.retryFailed(),F(!1)}catch(d){console.error("Retry failed:",d)}},p=async()=>{F(!0);const d=await Qe.getFailedItems();k(d)},m=()=>t?s.failedCount>0?"text-red-600":s.pendingCount>0?"text-yellow-600":"text-green-600":"text-gray-500",i=()=>t?s.isSyncing?e.jsx(Tt,{className:"w-5 h-5 animate-spin"}):s.failedCount>0?e.jsx(Be,{className:"w-5 h-5"}):s.pendingCount>0?e.jsx(ds,{className:"w-5 h-5"}):e.jsx(Ze,{className:"w-5 h-5"}):e.jsx(cs,{className:"w-5 h-5"}),v=()=>t?s.isSyncing?"Syncing...":s.failedCount>0?`${s.failedCount} failed`:s.pendingCount>0?`${s.pendingCount} pending`:"Synced":"Offline";return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:t?l:void 0,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${t?"hover:bg-gray-100 dark:hover:bg-gray-700":"cursor-not-allowed opacity-70"}`,title:t?"Click to sync now":"Device is offline",children:[e.jsx("span",{className:m(),children:i()}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:v()})]}),s.failedCount>0&&e.jsx("button",{onClick:p,className:"text-xs text-red-600 hover:text-red-700 dark:text-red-400 underline ml-2",children:"View failed items"}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Be,{className:"w-6 h-6 text-red-600"}),"Sync Conflicts"]}),e.jsx("button",{onClick:()=>F(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(xe,{className:"w-6 h-6"})})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["The following changes could not be synced after ",3," attempts. You can retry syncing or resolve them manually."]}),j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ze,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No failed items"})]}):e.jsx("div",{className:"space-y-3 mb-6",children:j.map((d,y)=>e.jsxs("div",{className:"border border-red-200 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:d.type}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d.method," ",d.endpoint]})]}),e.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400",children:[d.retries," retries"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Timestamp: ",new Date(d.timestamp).toLocaleString()]})]},d.id||y))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Close"}),e.jsx("button",{onClick:P,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Retry All"})]})]})})]})},pa=({conflicts:t,onResolve:a,onResolveAll:s})=>{const[C,u]=r.useState(null),[F,j]=r.useState(null);if(t.length===0)return null;const k=async(i,v)=>{j(i);try{await a(i,v)}catch(d){console.error("Failed to resolve conflict:",d),alert("Failed to resolve conflict")}finally{j(null)}},l=async i=>{if(confirm(`Are you sure you want to use ${i==="local"?"local":"server"} version for all conflicts?`))try{await s(i)}catch(v){console.error("Failed to resolve all conflicts:",v),alert("Failed to resolve conflicts")}},P=i=>{u(C===i?null:i)},p=i=>typeof i=="object"?JSON.stringify(i,null,2):String(i),m=i=>{switch(i){case"counter":return"Counter";case"session":return"Session";case"note":return"Note";case"project":return"Project";default:return i}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-2 border-orange-500",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_t,{className:"w-6 h-6 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Sync Conflicts Detected"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:[t.length," conflict",t.length!==1?"s":""," found between your local changes and the server. Please review and resolve each conflict."]}),e.jsxs("div",{className:"flex gap-3 mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("button",{onClick:()=>l("local"),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm",children:"Use Local for All"}),e.jsx("button",{onClick:()=>l("server"),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors text-sm",children:"Use Server for All"})]}),e.jsx("div",{className:"space-y-3",children:t.map(i=>{const v=C===i.id,d=F===i.id;return e.jsxs("div",{className:"border border-orange-200 dark:border-orange-800 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>P(i.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 text-left",children:[e.jsx(_t,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[m(i.resourceType)," - ",i.field]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",i.resourceId.slice(0,8),"..."]})]})]}),v?e.jsx(us,{className:"w-5 h-5 text-gray-400"}):e.jsx(ms,{className:"w-5 h-5 text-gray-400"})]}),v&&e.jsxs("div",{className:"px-4 py-4 bg-orange-50 dark:bg-orange-900/20 border-t border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Your Local Version"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-800",children:e.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap",children:p(i.localValue)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Server Version"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700",children:e.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 overflow-x-auto whitespace-pre-wrap",children:p(i.serverValue)})})]})]}),i.lastSyncedValue&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Last Synced Value (for reference)"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-700",children:e.jsx("pre",{className:"text-xs text-gray-500 dark:text-gray-400 overflow-x-auto whitespace-pre-wrap",children:p(i.lastSyncedValue)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>k(i.id,"local"),disabled:d,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:d?"Resolving...":"Use Local"}),e.jsx("button",{onClick:()=>k(i.id,"server"),disabled:d,className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:d?"Resolving...":"Use Server"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:["Conflict detected at:"," ",new Date(i.timestamp).toLocaleString()]})]})]},i.id)})})]})};function ba(){var m,i;const{user:t,logout:a}=Le(),s=Ue(),C=xs(),[u,F]=r.useState([]),j=async()=>{await a(),s("/login")},k=async(v,d)=>{F(y=>y.filter(w=>w.id!==v)),console.log(`Resolved conflict ${v} with ${d}`)},l=async v=>{F([]),console.log(`Resolved all conflicts with ${v}`)},P=[{name:"Dashboard",href:"/dashboard",icon:nr,shortName:"Home"},{name:"Projects",href:"/projects",icon:Ye,shortName:"Projects"},{name:"Patterns",href:"/patterns",icon:ze,shortName:"Patterns"},{name:"Pattern Builder",href:"/pattern-builder",icon:$e,shortName:"Builder"},{name:"Yarn Stash",href:"/yarn",icon:qe,shortName:"Stash"},{name:"Tools",href:"/tools",icon:Rt,shortName:"Tools"},{name:"Recipients",href:"/recipients",icon:lt,shortName:"Recipients"}],p=P.slice(0,5);return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200 pb-20 md:pb-0",children:[e.jsx("aside",{className:"hidden md:fixed md:inset-y-0 md:left-0 md:w-64 md:block bg-white dark:bg-gray-800 shadow-lg transition-colors duration-200",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 h-16 bg-purple-600 dark:bg-purple-700",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Rowly"}),e.jsx(vr,{})]}),e.jsx("div",{className:"px-4 py-3",children:e.jsx(Os,{})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-4","aria-label":"Main navigation",children:P.map(v=>{const d=v.icon,y=C.pathname===v.href;return e.jsxs(be,{to:v.href,className:`flex items-center px-6 py-3 text-sm font-medium transition ${y?"bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 border-r-4 border-purple-600 dark:border-purple-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-purple-600 dark:hover:text-purple-400"}`,"aria-label":v.name,"aria-current":y?"page":void 0,children:[e.jsx(d,{className:"mr-3 h-5 w-5","aria-hidden":"true"}),v.name]},v.name)})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"h-10 w-10 rounded-full bg-purple-600 dark:bg-purple-700 flex items-center justify-center text-white font-semibold",children:[(m=t==null?void 0:t.firstName)==null?void 0:m[0],(i=t==null?void 0:t.lastName)==null?void 0:i[0]]})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t==null?void 0:t.email})]})]}),e.jsxs(be,{to:"/profile",className:"flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg mb-2 transition",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Profile"]}),e.jsxs("button",{onClick:j,className:"w-full flex items-center px-3 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",children:[e.jsx(gs,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 md:hidden z-40","aria-label":"Main navigation",children:e.jsx("div",{className:"flex justify-around items-center h-20",children:p.map(v=>{const d=v.icon,y=C.pathname===v.href;return e.jsxs(be,{to:v.href,className:`flex flex-col items-center justify-center flex-1 h-full min-w-0 ${y?"text-purple-600 dark:text-purple-400":"text-gray-600 dark:text-gray-400"}`,"aria-label":v.name,"aria-current":y?"page":void 0,children:[e.jsx(d,{className:"h-7 w-7 mb-1","aria-hidden":"true"}),e.jsx("span",{className:"text-xs font-medium truncate",children:v.shortName})]},v.name)})})}),e.jsxs("div",{className:"md:ml-64",children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(ha,{})}),u.length>0&&e.jsx("div",{className:"p-4 md:p-6 lg:p-8 pb-0",children:e.jsx(pa,{conflicts:u,onResolve:k,onResolveAll:l})}),e.jsx("main",{className:"p-4 md:p-6 lg:p-8",children:e.jsx(lr,{})})]})]})}function fa(){return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center transition-colors duration-200",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(vr,{})}),e.jsx("div",{className:"max-w-md w-full px-4",children:e.jsx(lr,{})})]})}function ya(){const{user:t}=Le(),[a,s]=r.useState([{name:"Active Projects",value:"0",icon:Ye,href:"/projects",color:"bg-purple-500"},{name:"Patterns",value:"0",icon:ze,href:"/patterns",color:"bg-blue-500"},{name:"Yarn Skeins",value:"0",icon:qe,href:"/yarn",color:"bg-green-500"},{name:"Recipients",value:"0",icon:lt,href:"/recipients",color:"bg-orange-500"}]),[C,u]=r.useState(!0),[F,j]=r.useState([]),[k,l]=r.useState([]);r.useEffect(()=>{P()},[]);const P=async()=>{try{const[m,i,v,d,y,w]=await Promise.all([E.get("/api/projects/stats"),E.get("/api/patterns/stats"),E.get("/api/yarn/stats"),E.get("/api/recipients/stats"),E.get("/api/projects?limit=5"),E.get("/api/yarn")]);s([{name:"Active Projects",value:String(m.data.data.stats.active_count||0),icon:Ye,href:"/projects",color:"bg-purple-500"},{name:"Patterns",value:String(i.data.data.stats.total_count||0),icon:ze,href:"/patterns",color:"bg-blue-500"},{name:"Yarn Skeins",value:String(v.data.data.stats.total_skeins||0),icon:qe,href:"/yarn",color:"bg-green-500"},{name:"Recipients",value:String(d.data.data.stats.total_count||0),icon:lt,href:"/recipients",color:"bg-orange-500"}]),j(y.data.data.projects||[]);const o=(w.data.data.yarn||[]).filter(N=>!N.low_stock_alert||!N.low_stock_threshold?!1:(N.quantity_remaining||N.skeins||0)<=N.low_stock_threshold);l(o)}catch(m){console.error("Error fetching dashboard data:",m)}finally{u(!1)}},p=[{name:"New Project",description:"Start tracking a new knitting project",href:"/projects",icon:Ye,color:"text-purple-600 bg-purple-50 hover:bg-purple-100"},{name:"Add Pattern",description:"Save a new knitting pattern",href:"/patterns",icon:ze,color:"text-blue-600 bg-blue-50 hover:bg-blue-100"},{name:"Add Yarn",description:"Add yarn to your stash",href:"/yarn",icon:qe,color:"text-green-600 bg-green-50 hover:bg-green-100"}];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Welcome back, ",t==null?void 0:t.firstName,"!"]}),e.jsx("p",{className:"text-gray-600",children:"Here's what's happening with your knitting projects today."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:C?e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading statistics..."})}):a.map(m=>{const i=m.icon;return e.jsx(be,{to:m.href,className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:m.name}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:m.value})]}),e.jsx("div",{className:`${m.color} p-3 rounded-lg`,children:e.jsx(i,{className:"h-6 w-6 text-white"})})]})},m.name)})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:p.map(m=>{const i=m.icon;return e.jsx(be,{to:m.href,className:`${m.color} rounded-lg p-6 transition`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(i,{className:"h-6 w-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:m.name}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:m.description})]})]})},m.name)})})]}),!C&&k.length>0&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-500 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-start mb-4",children:[e.jsx(Be,{className:"h-6 w-6 text-orange-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-orange-900 mb-1",children:"Low Stock Alerts"}),e.jsx("p",{className:"text-sm text-orange-700",children:"The following yarn items are running low and need restocking:"})]})]}),e.jsx("div",{className:"space-y-3",children:k.map(m=>{const i=m.quantity_remaining||m.skeins||0,v=m.low_stock_threshold||0,d=v>0?i/v*100:0;return e.jsx(be,{to:"/yarn",className:"flex items-center justify-between p-4 bg-white rounded-lg hover:shadow-md transition",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[m.brand," ",m.name]}),e.jsxs("span",{className:"text-sm font-medium text-orange-600",children:[i," / ",v," ",m.unit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all",style:{width:`${Math.min(100,d)}%`}})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),m.color&&e.jsxs("span",{className:"mr-3",children:["Color: ",m.color]}),m.weight&&e.jsxs("span",{children:["Weight: ",m.weight]})]})]})},m.id)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-orange-200",children:e.jsxs(be,{to:"/yarn",className:"text-sm font-medium text-orange-700 hover:text-orange-800 flex items-center",children:["View all yarn in stash",e.jsx("span",{className:"ml-2",children:"→"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Recent Projects"}),C?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Loading recent projects..."})}):F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ye,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No projects yet"}),e.jsxs(be,{to:"/projects",className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Create Your First Project"]})]}):e.jsx("div",{className:"space-y-4",children:F.map(m=>e.jsxs(be,{to:`/projects/${m.id}`,className:"flex items-center justify-between p-4 hover:bg-gray-50 rounded-lg transition",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(Ye,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:m.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[m.type&&e.jsx("span",{className:"capitalize",children:m.type}),m.status&&e.jsx("span",{className:"ml-2 capitalize",children:m.status})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(m.created_at).toLocaleDateString()})]},m.id))})]})]})}function ja(){const[t,a]=r.useState([]),[s,C]=r.useState(!0),[u,F]=r.useState(!1),[j,k]=r.useState(!1),[l,P]=r.useState(null),[p,m]=r.useState(""),[i,v]=r.useState("all"),[d,y]=r.useState("all"),[w,c]=r.useState({name:"",description:"",projectType:"sweater",startDate:new Date().toISOString().split("T")[0],targetCompletionDate:""});r.useEffect(()=>{o()},[]);const o=async()=>{try{const x=await E.get("/api/projects");a(x.data.data.projects)}catch(x){console.error("Error fetching projects:",x),f.error("Failed to load projects")}finally{C(!1)}},N=async x=>{var M,I;if(x.preventDefault(),!j){k(!0);try{await E.post("/api/projects",w),f.success("Project created successfully!"),F(!1),c({name:"",description:"",projectType:"sweater",startDate:new Date().toISOString().split("T")[0],targetCompletionDate:""}),o()}catch(V){console.error("Error creating project:",V);const J=V;f.error(((I=(M=J.response)==null?void 0:M.data)==null?void 0:I.message)||"Failed to create project")}finally{k(!1)}}},g=async(x,M)=>{if(!l&&confirm(`Are you sure you want to delete "${M}"?`)){P(x);try{await E.delete(`/api/projects/${x}`),f.success("Project deleted successfully"),o()}catch(I){console.error("Error deleting project:",I),f.error("Failed to delete project")}finally{P(null)}}},n=x=>{switch(x){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paused":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},S=x=>x?new Date(x).toLocaleDateString():"Not set",T=r.useMemo(()=>t.filter(x=>{var L,Z;const M=p.toLowerCase(),I=!p||x.name.toLowerCase().includes(M)||((L=x.description)==null?void 0:L.toLowerCase().includes(M))||((Z=x.project_type)==null?void 0:Z.toLowerCase().includes(M)),V=i==="all"||x.status===i,J=d==="all"||x.project_type===d;return I&&V&&J}),[t,p,i,d]),h=r.useMemo(()=>{const x=new Set(t.map(M=>M.project_type).filter(Boolean));return Array.from(x).sort()},[t]),b=()=>{m(""),v("all"),y("all")},$=p||i!=="all"||d!=="all";return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading projects..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Projects"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your knitting projects"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"New Project"]})]}),t.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search projects...",value:p,onChange:x=>m(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("select",{value:i,onChange:x=>v(x.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"})]}),e.jsxs("select",{value:d,onChange:x=>y(x.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),h.map(x=>e.jsx("option",{value:x,children:x.charAt(0).toUpperCase()+x.slice(1)},x))]}),$&&e.jsxs("button",{onClick:b,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx(xe,{className:"mr-2"}),"Clear"]})]}),$&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Showing ",T.length," of ",t.length," projects"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(Ne,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No projects yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking your knitting projects"}),e.jsxs("button",{onClick:()=>F(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Create Your First Project"]})]}):T.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(Oe,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No matching projects"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Try adjusting your search or filters"}),e.jsxs("button",{onClick:b,className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(xe,{className:"mr-2"}),"Clear Filters"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(x=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:x.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${n(x.status)}`,children:x.status||"active"})]}),x.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:x.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[x.project_type&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",x.project_type]}),x.start_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(or,{className:"mr-2 h-4 w-4"}),"Started: ",S(x.start_date)]}),x.target_completion_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Due: ",S(x.target_completion_date)]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsx(be,{to:`/projects/${x.id}`,className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition text-center text-sm font-medium",children:"View Details"}),e.jsx("button",{onClick:()=>g(x.id,x.name),disabled:l===x.id,className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete project",children:l===x.id?e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-red-600 border-t-transparent inline-block"}):e.jsx(ge,{className:"h-4 w-4"})})]})]},x.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Project"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name *"}),e.jsx("input",{type:"text",value:w.name,onChange:x=>c({...w,name:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Cozy Winter Sweater",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:w.description,onChange:x=>c({...w,description:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Describe your project..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Type"}),e.jsxs("select",{value:w.projectType,onChange:x=>c({...w,projectType:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:w.startDate,onChange:x=>c({...w,startDate:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Completion"}),e.jsx("input",{type:"date",value:w.targetCompletionDate,onChange:x=>c({...w,targetCompletionDate:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),disabled:j,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Creating...":"Create Project"})]})]})]})})]})}function va({photos:t,onDelete:a}){const[s,C]=r.useState(null),[u,F]=r.useState(1),j=y=>{C(y),F(1)},k=()=>{C(null),F(1)},l=()=>{s!==null&&s>0&&(C(s-1),F(1))},P=()=>{s!==null&&s<t.length-1&&(C(s+1),F(1))},p=y=>{const w=document.createElement("a");w.href=y.file_path,w.download=y.filename,document.body.appendChild(w),w.click(),document.body.removeChild(w)},m=()=>{F(y=>Math.min(y+.25,3))},i=()=>{F(y=>Math.max(y-.25,.5))},v=y=>{if(s!==null)switch(y.key){case"Escape":k();break;case"ArrowLeft":l();break;case"ArrowRight":P();break;case"+":case"=":m();break;case"-":case"_":i();break}};if(t.length===0)return e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"No photos yet. Upload your first photo!"})});const d=s!==null?t[s]:null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map((y,w)=>e.jsxs("div",{className:"relative group cursor-pointer aspect-square overflow-hidden rounded-lg bg-gray-100",onClick:()=>j(w),children:[e.jsx("img",{src:y.thumbnail_path,alt:y.caption||`Photo ${w+1}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center",children:e.jsx(ot,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity h-8 w-8"})}),a&&e.jsx("button",{onClick:c=>{c.stopPropagation(),confirm("Are you sure you want to delete this photo?")&&a(y.id)},className:"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700",children:e.jsx(ge,{className:"h-4 w-4"})})]},y.id))}),d&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center",onClick:k,onKeyDown:v,tabIndex:0,children:[e.jsx("button",{onClick:k,className:"absolute top-4 right-4 p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10","aria-label":"Close",children:e.jsx(xe,{className:"h-8 w-8"})}),s>0&&e.jsx("button",{onClick:y=>{y.stopPropagation(),l()},className:"absolute left-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10","aria-label":"Previous",children:e.jsx(Mt,{className:"h-8 w-8"})}),s<t.length-1&&e.jsx("button",{onClick:y=>{y.stopPropagation(),P()},className:"absolute right-4 p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition z-10","aria-label":"Next",children:e.jsx(mt,{className:"h-8 w-8"})}),e.jsx("div",{className:"relative max-w-7xl max-h-full p-4 flex items-center justify-center",onClick:y=>y.stopPropagation(),children:e.jsx("img",{src:d.file_path,alt:d.caption||"Photo",className:"max-w-full max-h-[80vh] object-contain rounded-lg",style:{transform:`scale(${u})`,transition:"transform 0.2s"}})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-4 bg-black bg-opacity-75 px-6 py-3 rounded-full z-10",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),i()},disabled:u<=.5,className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Zoom out",children:e.jsx(Dt,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-white text-sm font-medium min-w-[60px] text-center",children:[Math.round(u*100),"%"]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),m()},disabled:u>=3,className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Zoom in",children:e.jsx(ot,{className:"h-5 w-5"})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),p(d)},className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition","aria-label":"Download",children:e.jsx(Ae,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-white text-sm",children:[s+1," / ",t.length]})]}),d.caption&&e.jsx("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 px-6 py-2 rounded-full max-w-2xl",children:e.jsx("p",{className:"text-white text-sm text-center",children:d.caption})})]})]})}function wa({onUpload:t,accept:a="image/jpeg,image/jpg,image/png,image/webp",maxSize:s=10}){const[C,u]=r.useState(null),[F,j]=r.useState(null),[k,l]=r.useState(!1),[P,p]=r.useState(!1),m=r.useRef(null),i=o=>{if(!a.split(",").some(n=>o.type.match(n.trim()))){f.error(`Invalid file type. Accepted types: ${a}`);return}if(o.size/(1024*1024)>s){f.error(`File size exceeds ${s}MB limit`);return}u(o);const g=new FileReader;g.onloadend=()=>{j(g.result)},g.readAsDataURL(o)},v=o=>{var g;const N=(g=o.target.files)==null?void 0:g[0];N&&i(N)},d=o=>{var g;o.preventDefault(),o.stopPropagation(),p(!1);const N=(g=o.dataTransfer.files)==null?void 0:g[0];N&&i(N)},y=o=>{o.preventDefault(),o.stopPropagation(),o.type==="dragenter"||o.type==="dragover"?p(!0):o.type==="dragleave"&&p(!1)},w=async()=>{var o,N;if(C){l(!0);try{await t(C),f.success("File uploaded successfully!"),u(null),j(null),m.current&&(m.current.value="")}catch(g){console.error("Upload error:",g),f.error(((N=(o=g.response)==null?void 0:o.data)==null?void 0:N.message)||g.message||"Failed to upload file. Please try again.")}finally{l(!1)}}},c=()=>{u(null),j(null),m.current&&(m.current.value="")};return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:d,className:`relative border-2 border-dashed rounded-lg p-6 transition-colors ${P?"border-purple-500 bg-purple-50":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("input",{ref:m,type:"file",accept:a,onChange:v,className:"hidden"}),F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:F,alt:"Preview",className:"max-w-full max-h-64 mx-auto rounded-lg object-contain"}),e.jsx("button",{type:"button",onClick:c,className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition",children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium",children:C==null?void 0:C.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(((C==null?void 0:C.size)||0)/1024/1024).toFixed(2)," MB"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:w,disabled:k,className:"flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Uploading...":"Upload Photo"}),e.jsx("button",{type:"button",onClick:c,disabled:k,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50",children:"Cancel"})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(it,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>{var o;return(o=m.current)==null?void 0:o.click()},className:"text-purple-600 hover:text-purple-700 font-medium",children:"Click to upload"}),e.jsx("span",{className:"text-gray-600",children:" or drag and drop"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["PNG, JPG, or WebP up to ",s,"MB"]})]})]})})}const Pr=r.createContext(void 0),Na=({children:t})=>{const[a,s]=r.useState(null),[C,u]=r.useState(!1),{accessToken:F,refreshToken:j}=Le(),k=r.useRef(null),l=r.useRef(!1);r.useEffect(()=>{if(!F){k.current&&(k.current.disconnect(),k.current=null,s(null),u(!1));return}const N=As("http://localhost:5000",{auth:{token:F},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5});return N.on("connect",()=>{console.log("✅ Socket.IO connected:",N.id),u(!0),l.current=!1}),N.on("disconnect",g=>{console.log("❌ Socket.IO disconnected:",g),u(!1)}),N.on("connect_error",async g=>{console.error("Socket.IO connection error:",g),u(!1);const n=g.message.toLowerCase();if((n.includes("auth")||n.includes("unauthorized")||n.includes("jwt")||n.includes("token"))&&!l.current){l.current=!0,console.log("🔄 Attempting to refresh token for Socket.IO...");try{const S=await j();S?(console.log("✅ Token refreshed successfully, reconnecting Socket.IO..."),N.auth&&(N.auth.token=S),N.connect()):console.error("❌ Token refresh failed, cannot reconnect Socket.IO")}catch(S){console.error("❌ Error during token refresh:",S)}finally{l.current=!1}}}),N.on("error",async g=>{var n,S,T;if(console.error("Socket.IO error event:",g),(g.type==="auth"||(n=g.message)!=null&&n.includes("auth")||(S=g.message)!=null&&S.includes("unauthorized")||(T=g.message)!=null&&T.includes("token"))&&!l.current){l.current=!0,console.log("🔄 Auth error received, attempting to refresh token...");try{const h=await j();h&&(console.log("✅ Token refreshed, reconnecting Socket.IO..."),N.disconnect(),N.auth&&(N.auth.token=h),N.connect())}catch(h){console.error("❌ Error during token refresh:",h)}finally{l.current=!1}}}),k.current=N,s(N),()=>{k.current&&(k.current.disconnect(),k.current=null)}},[F,j]);const P=r.useCallback(o=>{var N;(N=k.current)!=null&&N.connected&&(k.current.emit("join:project",o),console.log(`Joined project room: ${o}`))},[]),p=r.useCallback(o=>{var N;(N=k.current)!=null&&N.connected&&(k.current.emit("leave:project",o),console.log(`Left project room: ${o}`))},[]),m=r.useCallback((o,N,g)=>{var n;(n=k.current)!=null&&n.connected&&k.current.emit("counter:update",{counterId:o,projectId:N,currentValue:g})},[]),i=r.useCallback((o,N,g)=>{var n;(n=k.current)!=null&&n.connected&&k.current.emit("counter:increment",{counterId:o,projectId:N,currentValue:g})},[]),v=r.useCallback((o,N,g)=>{var n;(n=k.current)!=null&&n.connected&&k.current.emit("counter:decrement",{counterId:o,projectId:N,currentValue:g})},[]),d=r.useCallback((o,N)=>{var g;(g=k.current)!=null&&g.connected&&k.current.emit("counter:reset",{counterId:o,projectId:N})},[]),y=r.useCallback(o=>{k.current&&(k.current.on("counter:updated",o),k.current.on("counter:incremented",o),k.current.on("counter:decremented",o))},[]),w=r.useCallback(o=>{k.current&&(k.current.off("counter:updated",o),k.current.off("counter:incremented",o),k.current.off("counter:decremented",o))},[]),c={socket:a,isConnected:C,joinProject:P,leaveProject:p,emitCounterUpdate:m,emitCounterIncrement:i,emitCounterDecrement:v,emitCounterReset:d,onCounterUpdate:y,offCounterUpdate:w};return e.jsx(Pr.Provider,{value:c,children:t})},Fr=()=>{const t=r.useContext(Pr);if(t===void 0)throw new Error("useWebSocket must be used within a WebSocketProvider");return t};function Ct(t,a=500){let s=0;return function(...u){const F=Date.now();F-s>=a&&(s=F,t(...u))}}function Xt({counter:t,onUpdate:a,onEdit:s,onDelete:C,onToggleVisibility:u}){const[F,j]=r.useState(t.current_value),[k,l]=r.useState(!1),[P,p]=r.useState(!1),m=r.useRef(null),i=r.useRef(null),v=r.useRef(null),d=r.useRef(()=>{}),y=r.useRef(()=>{}),[w,c]=r.useState(null),[o,N]=r.useState(null),{isConnected:g,emitCounterIncrement:n,emitCounterDecrement:S,emitCounterReset:T,onCounterUpdate:h,offCounterUpdate:b}=Fr();r.useEffect(()=>{j(t.current_value)},[t.current_value]),r.useEffect(()=>{const A=G=>{i.current&&!i.current.contains(G.target)&&p(!1)};if(P)return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[P]),r.useEffect(()=>{const A=G=>{G.counterId===t.id&&(j(G.currentValue),$("light"),f.info(`${t.name} updated to ${G.currentValue}`,{autoClose:1e3}))};return h(A),()=>b(A)},[t.id,t.name,h,b]);const $=A=>{if("vibrate"in navigator){const G={light:[10],medium:[20],heavy:[30,10,30]};navigator.vibrate(G[A])}},x=async A=>{try{await E.put(`/api/projects/${t.project_id}/counters/${t.id}`,{current_value:A})}catch(G){console.error("Error updating counter:",G),f.error("Failed to update counter"),j(t.current_value)}},M=()=>{if(!t.increment_pattern)return t.increment_by;const A=t.increment_pattern;switch(A.type){case"simple":return t.increment_by;case"custom_fixed":return A.increment||t.increment_by;case"every_n":return A.increment||1;default:return t.increment_by}},I=()=>{const A=M();j(G=>{const Y=G+A;return console.log(`[Counter ${t.name}] Increment: ${G} -> ${Y} (+${A})`),t.max_value&&Y>t.max_value?(console.warn(`[Counter ${t.name}] Cannot exceed max value ${t.max_value}`),f.warning(`Cannot exceed maximum value of ${t.max_value}`),G):(x(Y),n(t.id,t.project_id,Y),Y)}),ie("increment"),$("light")},V=()=>{const A=M();j(G=>{const Y=G-A;return console.log(`[Counter ${t.name}] Decrement: ${G} -> ${Y} (-${A})`),Y<t.min_value?(console.warn(`[Counter ${t.name}] Cannot go below min value ${t.min_value}`),f.warning(`Cannot go below minimum value of ${t.min_value}`),G):(x(Y),S(t.id,t.project_id,Y),Y)}),ie("decrement"),$("light")},J=r.useCallback(Ct(I,500),[F,t]),L=r.useCallback(Ct(V,500),[F,t]);d.current=I,y.current=V;const Z=()=>{console.log("[Voice] Increment command received"),d.current(),f.success("Row added! 🎤",{autoClose:800})},ee=()=>{console.log("[Voice] Decrement command received"),y.current(),f.info("Row removed! 🎤",{autoClose:800})},K=async()=>{if(confirm(`Reset "${t.name}" to ${t.min_value}?`)){const A=t.min_value;j(A),x(A),T(t.id,t.project_id),$("medium"),f.success("Counter reset")}},X=r.useCallback(Ct(K,500),[F,t]),R=A=>{N(null),c(A.targetTouches[0].clientX)},te=A=>{N(A.targetTouches[0].clientX)},H=()=>{if(!w||!o)return;const A=w-o,G=A>50,Y=A<-50;G&&J(),Y&&L()},ie=A=>{try{const G=new(window.AudioContext||window.webkitAudioContext),Y=G.createOscillator(),z=G.createGain();Y.connect(z),z.connect(G.destination),Y.frequency.value=A==="increment"?800:600,Y.type="sine",z.gain.setValueAtTime(.3,G.currentTime),z.gain.exponentialRampToValueAtTime(.01,G.currentTime+.1),Y.start(G.currentTime),Y.stop(G.currentTime+.1)}catch(G){console.error("Audio feedback error:",G)}};r.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const A=window.SpeechRecognition||window.webkitSpeechRecognition;m.current=new A,m.current.continuous=!0,m.current.interimResults=!1,m.current.lang="en-US",m.current.maxAlternatives=1,m.current.onresult=G=>{const Y=G.results.length-1,z=G.results[Y][0].transcript.toLowerCase().trim(),O=G.results[Y][0].confidence;console.log(`[Voice] Recognized: "${z}" (confidence: ${(O*100).toFixed(0)}%)`),z.includes("next")||z.includes("plus")||z.includes("add")?Z():z.includes("back")||z.includes("minus")||z.includes("undo")?ee():z.includes("reset")?(console.log("[Voice] Reset command received"),X()):console.log(`[Voice] Unrecognized command: "${z}"`)},m.current.onerror=G=>{console.error("[Voice] Recognition error:",G.error),G.error!=="no-speech"&&G.error!=="aborted"&&(f.error(`Voice error: ${G.error}`,{autoClose:2e3}),(G.error==="not-allowed"||G.error==="service-not-allowed")&&l(!1))},m.current.onstart=()=>{console.log("[Voice] Recognition started")},m.current.onend=()=>{if(console.log("[Voice] Recognition ended, isListening:",k),k)try{setTimeout(()=>{k&&m.current&&(m.current.start(),console.log("[Voice] Recognition restarted"))},100)}catch(G){console.error("[Voice] Error restarting recognition:",G),l(!1)}}}return()=>{if(m.current&&k)try{m.current.stop(),console.log("[Voice] Recognition stopped (cleanup)")}catch(A){console.error("[Voice] Error stopping recognition:",A)}}},[k]);const D=()=>{if(!m.current){f.error("Voice control not supported in this browser");return}if(k)m.current.stop(),l(!1),f.info("Voice control stopped");else try{m.current.start(),l(!0),f.success("Voice control activated!")}catch{f.error("Failed to start voice control")}},re=t.target_value?F/t.target_value*100:0,se=M();return e.jsxs("div",{ref:v,className:"border-2 rounded-xl p-4 md:p-6 bg-gradient-to-br from-white to-gray-50 shadow-sm hover:shadow-md transition-shadow select-none",style:{borderColor:t.display_color},onTouchStart:R,onTouchMove:te,onTouchEnd:H,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:t.display_color}}),e.jsx("h3",{className:"font-semibold text-lg md:text-base text-gray-900",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded-full whitespace-nowrap",children:t.type})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:D,className:`p-3 md:p-2 rounded-lg transition min-w-[48px] min-h-[48px] md:min-w-0 md:min-h-0 flex items-center justify-center ${k?"bg-red-100 text-red-600 hover:bg-red-200 animate-pulse":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:k?"Stop voice control":"Start voice control","aria-label":k?"Stop voice control":"Start voice control","aria-pressed":k,children:k?e.jsx(ct,{className:"h-5 w-5 md:h-4 md:w-4","aria-hidden":"true"}):e.jsx(hs,{className:"h-5 w-5 md:h-4 md:w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsx("button",{onClick:()=>p(!P),className:"p-3 md:p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition min-w-[48px] min-h-[48px] md:min-w-0 md:min-h-0 flex items-center justify-center",children:e.jsx(ps,{className:"h-5 w-5 md:h-4 md:w-4"})}),P&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10",children:[s&&e.jsx("button",{onClick:()=>{s(t),p(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-100 text-sm",children:"Edit Counter"}),u&&e.jsxs("button",{onClick:()=>{u(t.id),p(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-100 text-sm flex items-center gap-2",children:[t.is_visible?e.jsx(xt,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"}),t.is_visible?"Hide":"Show"]}),C&&e.jsx("button",{onClick:()=>{confirm(`Delete "${t.name}"?`)&&C(t.id),p(!1)},className:"w-full text-left px-4 py-2 hover:bg-red-50 text-red-600 text-sm border-t border-gray-100",children:"Delete Counter"})]})]})]})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-6xl md:text-7xl font-bold mb-2 tabular-nums",style:{color:t.display_color},role:"status","aria-live":"polite","aria-label":`Current count: ${F}`,children:F}),t.target_value&&e.jsxs("p",{className:"text-base md:text-sm text-gray-500","aria-label":`Target: ${t.target_value}`,children:["of ",t.target_value]}),t.increment_pattern&&t.increment_pattern.description&&e.jsx("p",{className:"text-sm md:text-xs text-gray-400 mt-1",children:t.increment_pattern.description})]}),t.target_value&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${Math.min(re,100)}%`,backgroundColor:t.display_color}})}),e.jsxs("p",{className:"text-xs text-gray-500 text-center mt-1",children:[Math.round(re),"% complete"]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",role:"group","aria-label":"Counter controls",children:[e.jsxs("button",{onClick:L,disabled:F<=t.min_value,className:"flex-1 h-20 md:h-16 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 disabled:bg-gray-50 disabled:text-gray-300 text-gray-700 rounded-xl font-semibold transition flex items-center justify-center gap-2 text-xl md:text-lg touch-manipulation","aria-label":`Decrease ${t.name} by ${se}`,"aria-disabled":F<=t.min_value,children:[e.jsx(ir,{className:"h-7 w-7 md:h-6 md:w-6","aria-hidden":"true"}),e.jsxs("span",{className:"hidden sm:inline",children:["-",se]})]}),e.jsx("button",{onClick:X,className:"h-20 md:h-16 w-20 md:w-16 flex-shrink-0 bg-yellow-100 hover:bg-yellow-200 active:bg-yellow-300 text-yellow-700 rounded-xl transition flex items-center justify-center touch-manipulation",title:"Reset counter","aria-label":`Reset ${t.name} to ${t.min_value}`,children:e.jsx(Tt,{className:"h-7 w-7 md:h-6 md:w-6","aria-hidden":"true"})}),e.jsxs("button",{onClick:J,className:"flex-1 h-20 md:h-16 text-white rounded-xl font-semibold transition flex items-center justify-center gap-2 text-xl md:text-lg touch-manipulation",style:{backgroundColor:t.display_color},"aria-label":`Increase ${t.name} by ${se}`,children:[e.jsx(ue,{className:"h-7 w-7 md:h-6 md:w-6","aria-hidden":"true"}),e.jsxs("span",{className:"hidden sm:inline",children:["+",se]})]})]}),t.notes&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:t.notes})}),g&&e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2 text-xs text-green-600",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Live sync"]})]})}const Qt=["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#EC4899","#6366F1","#14B8A6"],ka=[{value:"simple",label:"Simple (+1 each)",description:"Standard counting, +1 per row"},{value:"every_n_garter",label:"Garter Stitch Ridges",description:"+1 every 2 rows (ridge counting)"},{value:"every_n_cable",label:"Cable Repeats",description:"+1 every 4 rows (cable pattern)"},{value:"custom",label:"Custom Pattern",description:"Define your own increment pattern"}];function Ca({counter:t,onSave:a,onCancel:s}){var b,$;const[C,u]=r.useState((t==null?void 0:t.name)||""),[F,j]=r.useState((t==null?void 0:t.type)||"rows"),[k,l]=r.useState((t==null?void 0:t.current_value)||0),[P,p]=r.useState((t==null?void 0:t.target_value)||""),[m]=r.useState((t==null?void 0:t.increment_by)||1),[i,v]=r.useState((t==null?void 0:t.min_value)||0),[d,y]=r.useState((t==null?void 0:t.max_value)||""),[w,c]=r.useState((t==null?void 0:t.display_color)||Qt[0]),[o,N]=r.useState((t==null?void 0:t.notes)||""),[g,n]=r.useState(((b=t==null?void 0:t.increment_pattern)==null?void 0:b.type)||"simple"),[S,T]=r.useState((($=t==null?void 0:t.increment_pattern)==null?void 0:$.increment)||1),h=x=>{x.preventDefault();let M;g==="simple"?M={type:"simple"}:g==="every_n_garter"?M={type:"every_n",rule:"every_n_rows",n:2,increment:1,description:"Garter stitch ridge counting"}:g==="every_n_cable"?M={type:"every_n",rule:"every_n_rows",n:4,increment:1,description:"Cable pattern repeat"}:g==="custom"&&(M={type:"custom_fixed",increment:S,description:`Custom: +${S} per action`});const I={name:C,type:F,currentValue:k,targetValue:P?Number(P):void 0,incrementBy:m,minValue:i,maxValue:d?Number(d):void 0,displayColor:w,notes:o,incrementPattern:M};a(I)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t?"Edit Counter":"Create Counter"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter Name *"}),e.jsx("input",{type:"text",value:C,onChange:x=>u(x.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",placeholder:"e.g., Main Row Counter",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter Type"}),e.jsxs("select",{value:F,onChange:x=>j(x.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"rows",children:"Row Counter"}),e.jsx("option",{value:"stitches",children:"Stitch Counter"}),e.jsx("option",{value:"repeats",children:"Repeat Counter"}),e.jsx("option",{value:"custom",children:"Custom Counter"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Value"}),e.jsx("input",{type:"number",value:k,onChange:x=>l(Number(x.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Value (optional)"}),e.jsx("input",{type:"number",value:P,onChange:x=>p(x.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",placeholder:"No limit"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Value"}),e.jsx("input",{type:"number",value:i,onChange:x=>v(Number(x.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Value (optional)"}),e.jsx("input",{type:"number",value:d,onChange:x=>y(x.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",placeholder:"No limit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Increment Pattern"}),e.jsx("div",{className:"space-y-2",children:ka.map(x=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"incrementPattern",value:x.value,checked:g===x.value,onChange:M=>n(M.target.value),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:x.label}),e.jsx("div",{className:"text-sm text-gray-500",children:x.description})]})]},x.value))}),g==="custom"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Increment Value"}),e.jsx("input",{type:"number",value:S,onChange:x=>T(Number(x.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",min:"1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter Color"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Qt.map(x=>e.jsx("button",{type:"button",onClick:()=>c(x),className:`w-10 h-10 rounded-lg border-2 transition ${w===x?"border-gray-900 scale-110":"border-gray-200"}`,style:{backgroundColor:x}},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:o,onChange:x=>N(x.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent text-gray-900",rows:3,placeholder:"Add any notes or reminders for this counter..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition",children:t?"Update Counter":"Create Counter"})]})]})]})})}function Sa({counter:t,onClose:a,onUpdate:s}){const[C,u]=r.useState([]),[F,j]=r.useState(!0);r.useEffect(()=>{k()},[t.id]);const k=async()=>{try{j(!0);const i=await E.get(`/api/projects/${t.project_id}/counters/${t.id}/history`);u(i.data.data.history)}catch(i){console.error("Error fetching history:",i),f.error("Failed to load history")}finally{j(!1)}},l=async i=>{try{await E.post(`/api/projects/${t.project_id}/counters/${t.id}/undo/${i}`),f.success("Counter reverted!"),k(),s()}catch(v){console.error("Error undoing action:",v),f.error("Failed to undo action")}},P=i=>{const v=new Date(i),y=new Date().getTime()-v.getTime(),w=Math.floor(y/6e4),c=Math.floor(y/36e5),o=Math.floor(y/864e5);return w<1?"Just now":w<60?`${w} minute${w>1?"s":""} ago`:c<24?`${c} hour${c>1?"s":""} ago`:`${o} day${o>1?"s":""} ago`},p=i=>{switch(i){case"increment":return"text-green-600 bg-green-50";case"decrement":return"text-yellow-600 bg-yellow-50";case"reset":return"text-red-600 bg-red-50";case"set":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}},m=i=>{switch(i){case"increment":return"+";case"decrement":return"-";case"reset":return"↺";case"set":return"=";default:return"•"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Counter History"}),e.jsx("p",{className:"text-sm text-gray-500",children:t.name})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No history yet"})]}):e.jsx("div",{className:"space-y-3",children:C.map(i=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-sm transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${p(i.action)}`,children:m(i.action)}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[i.old_value," → ",i.new_value]}),e.jsx("div",{className:"text-sm text-gray-500",children:i.action.charAt(0).toUpperCase()+i.action.slice(1)})]})]}),i.user_note&&e.jsxs("div",{className:"ml-11 mb-2 text-sm text-gray-600 italic",children:['"',i.user_note,'"']}),e.jsxs("div",{className:"ml-11 text-xs text-gray-400 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-3 w-3"}),P(i.created_at)," •"," ",new Date(i.created_at).toLocaleString()]})]}),e.jsx("button",{onClick:()=>{confirm(`Revert counter to ${i.old_value}? This will create a new history entry.`)&&l(i.id)},className:"ml-3 p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition",title:"Undo to this point",children:e.jsx(At,{className:"h-4 w-4"})})]})},i.id))})}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4",children:e.jsx("button",{onClick:a,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition",children:"Close"})})]})})}function Pa({projectId:t,counters:a,onClose:s}){const[C,u]=r.useState([]),[F,j]=r.useState(!0),[k,l]=r.useState(""),[P,p]=r.useState(""),[m,i]=r.useState("reset_on_target"),[v,d]=r.useState("equals"),[y,w]=r.useState(""),[c,o]=r.useState("reset"),[N,g]=r.useState("");r.useEffect(()=>{n()},[t]);const n=async()=>{try{j(!0);const $=await E.get(`/api/projects/${t}/counter-links`);u($.data.data.links)}catch($){console.error("Error fetching links:",$),f.error("Failed to load counter links")}finally{j(!1)}},S=async $=>{var x,M;if($.preventDefault(),!k||!P){f.error("Please select both source and target counters");return}if(k===P){f.error("Cannot link a counter to itself");return}try{const I={sourceCounterId:k,targetCounterId:P,linkType:m,isActive:!0};(m==="reset_on_target"||m==="conditional")&&(I.triggerCondition={type:v,value:Number(y)},I.action={type:c,value:c==="reset"||c==="set"?Number(N):void 0}),await E.post(`/api/projects/${t}/counter-links`,I),f.success("Counter link created!"),l(""),p(""),w(""),g(""),n()}catch(I){console.error("Error creating link:",I);const V=((M=(x=I.response)==null?void 0:x.data)==null?void 0:M.message)||"Failed to create link";f.error(V)}},T=async $=>{try{await E.delete(`/api/projects/${t}/counter-links/${$}`),f.success("Link deleted!"),n()}catch(x){console.error("Error deleting link:",x),f.error("Failed to delete link")}},h=$=>{var x;return((x=a.find(M=>M.id===$))==null?void 0:x.name)||"Unknown"},b=$=>{var I,V,J,L,Z,ee;const x=h($.source_counter_id),M=h($.target_counter_id);switch($.link_type){case"reset_on_target":return`When ${x} ${(I=$.trigger_condition)==null?void 0:I.type} ${(V=$.trigger_condition)==null?void 0:V.value}, reset ${M} to ${(J=$.action)==null?void 0:J.value}`;case"conditional":return`When ${x} ${(L=$.trigger_condition)==null?void 0:L.type} ${(Z=$.trigger_condition)==null?void 0:Z.value}, ${(ee=$.action)==null?void 0:ee.type} ${M}`;case"advance_together":return`${x} and ${M} advance together`;default:return"Unknown link type"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Link Counters"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create automatic counter relationships"})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("form",{onSubmit:S,className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Create New Link"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Source Counter"}),e.jsxs("select",{value:k,onChange:$=>l($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",required:!0,children:[e.jsx("option",{value:"",children:"Select counter..."}),a.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Counter"}),e.jsxs("select",{value:P,onChange:$=>p($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",required:!0,children:[e.jsx("option",{value:"",children:"Select counter..."}),a.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link Type"}),e.jsxs("select",{value:m,onChange:$=>i($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",children:[e.jsx("option",{value:"reset_on_target",children:"Reset on Target"}),e.jsx("option",{value:"conditional",children:"Conditional Action"}),e.jsx("option",{value:"advance_together",children:"Advance Together"})]})]}),(m==="reset_on_target"||m==="conditional")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trigger Condition"}),e.jsxs("select",{value:v,onChange:$=>d($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",children:[e.jsx("option",{value:"equals",children:"Equals (=)"}),e.jsx("option",{value:"greater_than",children:"Greater than (>)"}),e.jsx("option",{value:"less_than",children:"Less than (<)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trigger Value"}),e.jsx("input",{type:"number",value:y,onChange:$=>w($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",placeholder:"e.g., 8",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Action Type"}),e.jsxs("select",{value:c,onChange:$=>o($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",children:[e.jsx("option",{value:"reset",children:"Reset to value"}),e.jsx("option",{value:"set",children:"Set to value"}),e.jsx("option",{value:"increment",children:"Increment"})]})]}),(c==="reset"||c==="set")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Action Value"}),e.jsx("input",{type:"number",value:N,onChange:$=>g($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600",placeholder:"e.g., 1",required:!0})]})]})]}),e.jsxs("button",{type:"submit",className:"w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition flex items-center justify-center gap-2",children:[e.jsx($t,{className:"h-4 w-4"}),"Create Link"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Existing Links"}),F?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):C.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No links created yet"}):e.jsx("div",{className:"space-y-2",children:C.map($=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-sm transition",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($t,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-900",children:b($)})]}),!$.is_active&&e.jsx("span",{className:"text-xs text-yellow-600",children:"Inactive"})]}),e.jsx("button",{onClick:()=>{confirm("Delete this link?")&&T($.id)},className:"ml-3 p-2 text-red-600 hover:bg-red-50 rounded-lg transition",children:e.jsx(ge,{className:"h-4 w-4"})})]},$.id))})]})]}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4",children:e.jsx("button",{onClick:s,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition",children:"Close"})})]})})}function Jt({projectId:t}){const[a,s]=r.useState([]),[C,u]=r.useState(!0),[F,j]=r.useState(!1),[k,l]=r.useState(!1),[P,p]=r.useState(!1),[m,i]=r.useState(!1),[v,d]=r.useState(null),[y,w]=r.useState(null);r.useEffect(()=>{c()},[t]);const c=async()=>{try{u(!0);const T=await E.get(`/api/projects/${t}/counters`);s(T.data.data.counters.sort((h,b)=>h.sort_order-b.sort_order))}catch(T){console.error("Error fetching counters:",T),f.error("Failed to load counters")}finally{u(!1)}},o=async T=>{try{const h=a.length>0?Math.max(...a.map(b=>b.sort_order)):0;await E.post(`/api/projects/${t}/counters`,{...T,sortOrder:h+1}),f.success("Counter created!"),j(!1),c()}catch(h){console.error("Error creating counter:",h),f.error("Failed to create counter")}},N=async(T,h)=>{try{await E.put(`/api/projects/${t}/counters/${T}`,h),f.success("Counter updated!"),j(!1),d(null),c()}catch(b){console.error("Error updating counter:",b),f.error("Failed to update counter")}},g=async T=>{try{await E.delete(`/api/projects/${t}/counters/${T}`),f.success("Counter deleted!"),c()}catch(h){console.error("Error deleting counter:",h),f.error("Failed to delete counter")}},n=async T=>{const h=a.find(b=>b.id===T);if(h)try{await E.put(`/api/projects/${t}/counters/${T}`,{is_visible:!h.is_visible}),c()}catch(b){console.error("Error toggling visibility:",b),f.error("Failed to update counter")}},S=a.filter(T=>T.is_visible&&T.is_active);return C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Counters"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"History"]}),e.jsxs("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition flex items-center gap-2",children:[e.jsx($t,{className:"h-4 w-4"}),"Link Counters"]}),e.jsxs("button",{onClick:()=>{d(null),j(!0)},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Add Counter"]})]})]}),S.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No counters yet. Add your first counter to get started!"}),e.jsxs("button",{onClick:()=>j(!0),className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Add Counter"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(T=>e.jsx(Xt,{counter:T,onUpdate:c,onEdit:h=>{d(h),j(!0)},onDelete:g,onToggleVisibility:n},T.id))}),a.filter(T=>!T.is_visible&&T.is_active).length>0&&e.jsxs("details",{className:"mt-6",children:[e.jsxs("summary",{className:"cursor-pointer text-sm text-gray-600 hover:text-gray-900",children:["Show hidden counters (",a.filter(T=>!T.is_visible).length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4 opacity-50",children:a.filter(T=>!T.is_visible&&T.is_active).map(T=>e.jsx(Xt,{counter:T,onUpdate:c,onEdit:h=>{d(h),j(!0)},onDelete:g,onToggleVisibility:n},T.id))})]}),F&&e.jsx(Ca,{projectId:t,counter:v,onSave:T=>{v?N(v.id,T):o(T)},onCancel:()=>{j(!1),d(null)}}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Select Counter for History"]}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:a.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No counters available"}):e.jsx("div",{className:"space-y-2",children:a.map(T=>e.jsxs("button",{onClick:()=>{w(T),p(!1),l(!0)},className:"w-full text-left px-4 py-3 bg-gray-50 hover:bg-purple-50 rounded-lg transition flex items-center justify-between group",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Current: ",T.current_value,T.target_value&&` / ${T.target_value}`]})]}),e.jsx(Ne,{className:"h-5 w-5 text-gray-400 group-hover:text-purple-600"})]},T.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsx("button",{onClick:()=>p(!1),className:"w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"})})]})}),k&&y&&e.jsx(Sa,{counter:y,onClose:()=>{l(!1),w(null)},onUpdate:c}),m&&e.jsx(Pa,{projectId:t,counters:a,onClose:()=>i(!1),onSave:()=>{i(!1),c()}})]})}const _r=({projectId:t,currentSession:a,onStartSession:s,onEndSession:C,onPauseSession:u,getCurrentCounterValues:F})=>{const[j,k]=r.useState(0),[l,P]=r.useState(!1),[p,m]=r.useState(!1),[i,v]=r.useState(""),[d,y]=r.useState(),w=r.useRef(null);r.useEffect(()=>{if(a&&!a.end_time){const S=new Date(a.start_time).getTime(),T=Date.now();k(Math.floor((T-S)/1e3)),P(!0)}else k(0),P(!1)},[a]),r.useEffect(()=>(l?w.current=setInterval(()=>{k(S=>S+1)},1e3):w.current&&(clearInterval(w.current),w.current=null),()=>{w.current&&clearInterval(w.current)}),[l]);const c=async()=>{try{await s(),P(!0)}catch(S){console.error("Failed to start session:",S)}},o=async()=>{if(u)try{await u(),P(!1)}catch(S){console.error("Failed to pause session:",S)}},N=()=>{m(!0)},g=async()=>{try{await C(i,d),m(!1),v(""),y(void 0),P(!1),k(0)}catch(S){console.error("Failed to end session:",S)}},n=S=>{const T=Math.floor(S/3600),h=Math.floor(S%3600/60),b=S%60;return T>0?`${T}:${h.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`:`${h}:${b.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Knitting Session"]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-gray-900 dark:text-white tabular-nums mb-2",children:n(j)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:l?"Session in progress":"No active session"})]}),e.jsx("div",{className:"flex gap-3 justify-center",children:l?e.jsxs(e.Fragment,{children:[u&&e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(dr,{className:"w-6 h-6"}),"Pause"]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(ur,{className:"w-6 h-6"}),"End Session"]})]}):e.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(cr,{className:"w-6 h-6"}),"Start Session"]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"End Knitting Session"}),e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Session Duration"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(j)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"How was this session?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y("productive"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${d==="productive"?"border-green-500 bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300":"border-gray-300 dark:border-gray-600 hover:border-green-500"}`,children:"😊 Productive"}),e.jsx("button",{onClick:()=>y("relaxed"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${d==="relaxed"?"border-blue-500 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300":"border-gray-300 dark:border-gray-600 hover:border-blue-500"}`,children:"😌 Relaxed"}),e.jsx("button",{onClick:()=>y("frustrated"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors ${d==="frustrated"?"border-orange-500 bg-orange-50 dark:bg-orange-900 text-orange-700 dark:text-orange-300":"border-gray-300 dark:border-gray-600 hover:border-orange-500"}`,children:"😤 Frustrated"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Notes (optional)"}),e.jsx("textarea",{value:i,onChange:S=>v(S.target.value),placeholder:"Add any notes about this session...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:g,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"End Session"})]})]})})]})},$r=({sessions:t,onDeleteSession:a})=>{const[s,C]=r.useState(null),u=i=>{const v=Math.floor(i/3600),d=Math.floor(i%3600/60);return v>0?`${v}h ${d}m`:`${d}m`},F=i=>{if(!i.duration_seconds||i.duration_seconds===0)return 0;const v=i.duration_seconds/3600;return Math.round(i.rows_completed/v)},j=i=>{switch(i){case"productive":return"😊";case"relaxed":return"😌";case"frustrated":return"😤";default:return"🧶"}},k=i=>{switch(i){case"productive":return"text-green-600 dark:text-green-400";case"relaxed":return"text-blue-600 dark:text-blue-400";case"frustrated":return"text-orange-600 dark:text-orange-400";default:return"text-gray-600 dark:text-gray-400"}},l=i=>{C(s===i?null:i)},P=t.reduce((i,v)=>i+(v.duration_seconds||0),0),p=t.reduce((i,v)=>i+v.rows_completed,0),m=P>0?Math.round(p/P*3600):0;return t.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Session History"]}),e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No sessions recorded yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start a knitting session to track your progress"})]})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Session History"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Sessions"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Time"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u(P)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Avg Pace"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:m}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"rows/hour"})]})]}),e.jsx("div",{className:"space-y-3",children:t.map(i=>{const v=s===i.id,d=F(i);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>l(i.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl ${k(i.mood)}`,children:j(i.mood)}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:Nt(new Date(i.start_time),"MMM d, yyyy")}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Nt(new Date(i.start_time),"h:mm a"),i.end_time&&` - ${Nt(new Date(i.end_time),"h:mm a")}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:u(i.duration_seconds||0)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.rows_completed," rows"]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${v?"transform rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),v&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(bs,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Pace:"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[d," rows/hour"]})]}),i.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(fs,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Location:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:i.location})]})]}),i.starting_counter_values&&i.ending_counter_values&&Object.keys(i.starting_counter_values).length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Counter Progress"}),e.jsx("div",{className:"space-y-1",children:Object.entries(i.starting_counter_values).map(([y,w])=>{var N;const c=((N=i.ending_counter_values)==null?void 0:N[y])||w,o=c-w;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Counter ",y.slice(0,8)]}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[w," → ",c,o>0&&e.jsxs("span",{className:"text-green-600 dark:text-green-400 ml-1",children:["(+",o,")"]})]})]},y)})})]}),i.notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Notes"}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded",children:i.notes})]}),a&&e.jsx("button",{onClick:()=>a(i.id),className:"text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium",children:"Delete Session"})]})]},i.id)})})]})},Fa=({projectId:t,milestones:a,totalTimeSeconds:s,totalRows:C,completedRows:u,onAddMilestone:F,onUpdateMilestone:j,onDeleteMilestone:k})=>{const[l,P]=r.useState(!1),[p,m]=r.useState(null),[i,v]=r.useState({name:"",target_rows:0}),d=n=>{const S=Math.floor(n/3600),T=Math.floor(n%3600/60);return S===0?`${T}m`:S<10?`${S}h ${T}m`:`${S}h`},y=()=>{if(s===0)return 0;const n=s/3600;return Math.round(u/n)},w=()=>{const n=y();if(n===0)return"Not enough data";const T=(C-u)/n;if(T<1)return`~${Math.round(T*60)} minutes`;if(T<24)return`~${Math.round(T)} hours`;const h=Math.round(T/24);return`~${h} day${h!==1?"s":""}`},c=async()=>{if(i.name.trim())try{await F({project_id:t,name:i.name,target_rows:i.target_rows||void 0,actual_rows:0,time_spent_seconds:0,sort_order:a.length}),v({name:"",target_rows:0}),P(!1)}catch(n){console.error("Failed to add milestone:",n)}},o=async n=>{try{await j(n.id,{completed_at:n.completed_at?void 0:new Date().toISOString(),actual_rows:n.actual_rows||u})}catch(S){console.error("Failed to complete milestone:",S)}},N=C>0?u/C*100:0,g=y();return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Project Progress"]}),e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Add Milestone"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Total Time"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:d(s)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Rows Complete"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[u,C>0&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["/",C]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Average Pace"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:g}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"rows/hour"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Time Remaining"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:w()})]})]}),C>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Overall Progress"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[N.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${Math.min(N,100)}%`}})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Milestones"}),a.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500 dark:text-gray-400",children:[e.jsx(qt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No milestones yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Break down your project into manageable sections"})]}):e.jsx("div",{className:"space-y-2",children:a.sort((n,S)=>n.sort_order-S.sort_order).map(n=>{const S=!!n.completed_at,T=n.target_rows?Math.min((n.actual_rows||0)/n.target_rows*100,100):0;return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${S?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("button",{onClick:()=>o(n),className:"mt-0.5",children:S?e.jsx(Ze,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(qt,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${S?"text-green-900 dark:text-green-300 line-through":"text-gray-900 dark:text-white"}`,children:n.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-x-3",children:[n.target_rows&&e.jsxs("span",{children:["Target: ",n.target_rows," rows"]}),n.time_spent_seconds>0&&e.jsxs("span",{children:["Time: ",d(n.time_spent_seconds)]})]})]})]}),e.jsx("button",{onClick:()=>k(n.id),className:"text-red-600 hover:text-red-700 dark:text-red-400 p-1",children:e.jsx(ge,{className:"w-4 h-4"})})]}),n.target_rows&&!S&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${T}%`}})})})]},n.id)})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Add Milestone"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Milestone Name"}),e.jsx("input",{type:"text",value:i.name,onChange:n=>v({...i,name:n.target.value}),placeholder:"e.g., Ribbing, Body, Sleeves",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Target Rows (optional)"}),e.jsx("input",{type:"number",value:i.target_rows||"",onChange:n=>v({...i,target_rows:parseInt(n.target.value)||0}),placeholder:"Number of rows for this section",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>P(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:!i.name.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:"Add Milestone"})]})]})})]})},_a=({projectId:t,totalRows:a=0,getCurrentCounterValues:s})=>{const[C,u]=r.useState(null),[F,j]=r.useState([]),[k,l]=r.useState([]),[P,p]=r.useState(!0),[m,i]=r.useState("timer");r.useEffect(()=>{d(),y(),v()},[t]);const v=async()=>{try{const h=await E.get(`/api/projects/${t}/sessions/active`);h.data.success&&h.data.data&&u(h.data.data)}catch{console.log("No active session")}},d=async()=>{try{p(!0);const h=await E.get(`/api/projects/${t}/sessions`);j(h.data.success?h.data.data.sessions||[]:[])}catch(h){console.error("Failed to fetch sessions:",h),j([])}finally{p(!1)}},y=async()=>{try{const h=await E.get(`/api/projects/${t}/milestones`);l(h.data.success?h.data.data.milestones||[]:[])}catch(h){console.error("Failed to fetch milestones:",h),l([])}},w=async()=>{try{const h=await E.post(`/api/projects/${t}/sessions/start`,{mood:void 0,location:void 0,notes:void 0}),b=h.data.success?h.data.data.session:h.data;return u(b),b}catch(h){throw console.error("Failed to start session:",h),h}},c=async(h,b)=>{if(C)try{await E.post(`/api/projects/${t}/sessions/${C.id}/end`,{notes:h,mood:b}),u(null),d()}catch($){throw console.error("Failed to end session:",$),$}},o=async h=>{try{await E.delete(`/api/projects/${t}/sessions/${h}`),j(F.filter(b=>b.id!==h))}catch(b){console.error("Failed to delete session:",b)}},N=async h=>{try{const b=await E.post(`/api/projects/${t}/milestones`,{name:h.name,targetRows:h.target_rows}),$=b.data.success?b.data.data.milestone:b.data;l([...k,$])}catch(b){throw console.error("Failed to add milestone:",b),b}},g=async(h,b)=>{try{const $=await E.put(`/api/projects/${t}/milestones/${h}`,{name:b.name,targetRows:b.target_rows,actualRows:b.actual_rows,timeSpentSeconds:b.time_spent_seconds,completedAt:b.completed_at}),x=$.data.success?$.data.data.milestone:$.data;l(k.map(M=>M.id===h?x:M))}catch($){throw console.error("Failed to update milestone:",$),$}},n=async h=>{try{await E.delete(`/api/projects/${t}/milestones/${h}`),l(k.filter(b=>b.id!==h))}catch(b){throw console.error("Failed to delete milestone:",b),b}},S=F.reduce((h,b)=>h+(b.duration_seconds||0),0),T=F.reduce((h,b)=>h+b.rows_completed,0);return P?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"Loading sessions..."})}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>i("timer"),className:`flex-1 px-4 py-3 font-medium transition-colors ${m==="timer"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Session Timer"}),e.jsx("button",{onClick:()=>i("progress"),className:`flex-1 px-4 py-3 font-medium transition-colors ${m==="progress"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Progress"}),e.jsxs("button",{onClick:()=>i("history"),className:`flex-1 px-4 py-3 font-medium transition-colors ${m==="history"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:["History (",F.length,")"]})]}),e.jsxs("div",{className:"p-6",children:[m==="timer"&&e.jsx(_r,{projectId:t,currentSession:C,onStartSession:w,onEndSession:c,getCurrentCounterValues:s}),m==="progress"&&e.jsx(Fa,{projectId:t,milestones:k,totalTimeSeconds:S,totalRows:a,completedRows:T,onAddMilestone:N,onUpdateMilestone:g,onDeleteMilestone:n}),m==="history"&&e.jsx($r,{sessions:F,onDeleteSession:o})]})]})})},Zt=({projectId:t,patternId:a,notes:s,getCurrentCounterValues:C,onSaveNote:u,onDeleteNote:F,onUpdateTranscription:j})=>{const[k,l]=r.useState(!1),[P,p]=r.useState(0),[m,i]=r.useState(null),[v,d]=r.useState(null),[y,w]=r.useState(""),c=r.useRef(null),o=r.useRef([]),N=r.useRef(null),g=r.useRef(0),n=r.useRef(new Map),S=r.useRef("audio/webm");r.useEffect(()=>()=>{n.current.forEach(L=>{L.pause(),L.src=""}),n.current.clear()},[]);const T=()=>{const L=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/mpeg","audio/wav"];for(const Z of L)if(MediaRecorder.isTypeSupported(Z))return console.log(`✅ Using audio mime type: ${Z}`),Z;return console.warn("⚠️ No preferred mime type supported, using browser default"),""},h=async()=>{try{if(!window.MediaRecorder){alert("❌ Audio recording is not supported in this browser. Please use Chrome, Firefox, Edge, or Safari.");return}const L=await navigator.mediaDevices.getUserMedia({audio:!0}),Z=T();S.current=Z;const ee=Z?{mimeType:Z}:{},K=new MediaRecorder(L,ee);c.current=K,o.current=[],K.ondataavailable=X=>{X.data.size>0&&(console.log(`📦 Audio chunk received: ${X.data.size} bytes`),o.current.push(X.data))},K.onstop=async()=>{console.log(`🎤 Recording stopped. Total chunks: ${o.current.length}`);const X=K.mimeType||S.current,R=new Blob(o.current,{type:X});if(console.log(`📁 Audio blob created: ${R.size} bytes, type: ${X}`),L.getTracks().forEach(H=>H.stop()),R.size===0){console.error("❌ Audio blob is empty - no data was recorded"),alert("Recording failed: No audio data was captured. Please try again.");return}const te=g.current;console.log(`⏱️  Recording duration: ${te} seconds`);try{await u(R,te,void 0),console.log("✅ Audio note saved successfully")}catch(H){console.error("Failed to save audio note:",H),alert("Failed to save audio note")}},K.onerror=X=>{var R;console.error("🔴 MediaRecorder error:",X.error),alert(`Recording error: ${((R=X.error)==null?void 0:R.message)||"Unknown error occurred"}`)},K.start(1e3),l(!0),p(0),g.current=0,N.current=setInterval(()=>{g.current+=1,p(g.current)},1e3)}catch(L){if(console.error("Failed to start recording:",L),L instanceof DOMException)switch(L.name){case"NotAllowedError":alert("🎤 Microphone access denied. Please allow microphone permissions in your browser settings and try again.");break;case"NotFoundError":alert("🎤 No microphone found. Please connect a microphone and try again.");break;case"NotReadableError":alert("🎤 Microphone is already in use by another application. Please close other apps using the microphone and try again.");break;default:alert(`🎤 Failed to access microphone: ${L.message}`)}else alert("Failed to access microphone. Please grant microphone permissions.")}},b=()=>{c.current&&k&&(c.current.stop(),l(!1),N.current&&(clearInterval(N.current),N.current=null))},$=L=>{if(m){const ee=n.current.get(m);ee&&(ee.pause(),ee.currentTime=0)}let Z=n.current.get(L.id);Z||(Z=new Audio(L.audio_url),Z.onended=()=>i(null),n.current.set(L.id,Z)),m===L.id?(Z.pause(),i(null)):(Z.play(),i(L.id))},x=async L=>{if(confirm("Are you sure you want to delete this audio note?"))try{const Z=n.current.get(L);Z&&(Z.pause(),Z.src="",n.current.delete(L)),await F(L)}catch(Z){console.error("Failed to delete note:",Z),alert("Failed to delete note")}},M=L=>{d(L.id),w(L.transcription||"")},I=async L=>{if(j)try{await j(L,y),d(null),w("")}catch(Z){console.error("Failed to update transcription:",Z),alert("Failed to update transcription")}},V=()=>{d(null),w("")},J=L=>{const Z=Math.floor(L/60),ee=L%60;return`${Z}:${ee.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Audio Notes"}),e.jsx("div",{className:"mb-6",children:k?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"w-4 h-4 bg-red-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white tabular-nums",children:J(P)})]}),e.jsxs("button",{onClick:b,className:"w-full flex items-center justify-center gap-3 px-6 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(ur,{className:"w-6 h-6"}),"Stop Recording"]})]}):e.jsxs("button",{onClick:h,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors min-h-[60px]",children:[e.jsx(ct,{className:"w-6 h-6"}),"Start Recording"]})}),e.jsx("div",{className:"space-y-3",children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ct,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No audio notes yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Record your first voice note"})]}):s.map(L=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:yr(new Date(L.created_at),{addSuffix:!0})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Duration: ",J(L.duration_seconds)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(L),className:`p-2 rounded-lg transition-colors ${m===L.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,title:m===L.id?"Pause":"Play",children:m===L.id?e.jsx(dr,{className:"w-5 h-5"}):e.jsx(cr,{className:"w-5 h-5"})}),e.jsx("a",{href:L.audio_url,download:`audio-note-${L.id}.webm`,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Download",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>x(L.id),className:"p-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30",title:"Delete",children:e.jsx(ge,{className:"w-5 h-5"})})]})]}),v===L.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:y,onChange:Z=>w(Z.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm",rows:3,placeholder:"Add transcription or notes..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(L.id),className:"flex items-center gap-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm",children:[e.jsx(dt,{className:"w-4 h-4"}),"Save"]}),e.jsxs("button",{onClick:V,className:"flex items-center gap-1 px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm",children:[e.jsx(xe,{className:"w-4 h-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Transcription"}),j&&e.jsx("button",{onClick:()=>M(L),className:"text-blue-600 dark:text-blue-400 hover:text-blue-700",children:e.jsx(Ee,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:L.transcription||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:"No transcription available. Click edit to add notes."})})]}),L.counter_values&&Object.keys(L.counter_values).length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"At: "}),Object.entries(L.counter_values).map(([Z,ee])=>`${Z}: ${ee}`).join(", ")]})]},L.id))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"💡 Tip: Click the microphone icon to record voice notes hands-free while knitting"})]})},$a=[{name:"Black",value:"#000000"},{name:"Blue",value:"#3B82F6"},{name:"Red",value:"#EF4444"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Orange",value:"#F97316"},{name:"Pink",value:"#EC4899"},{name:"Yellow",value:"#FBBF24"}],Ea=[2,4,6,8,12],Ta=({patternId:t,projectId:a,pageNumber:s,onSave:C,initialData:u})=>{const F=r.useRef(null),j=r.useRef(null),[k,l]=r.useState(!1),[P,p]=r.useState([]),[m,i]=r.useState([]),[v,d]=r.useState([]),[y,w]=r.useState([]),[c,o]=r.useState("pen"),[N,g]=r.useState("#000000"),[n,S]=r.useState(4),[T,h]=r.useState(!1),[b,$]=r.useState(!1);r.useEffect(()=>{const K=F.current,X=j.current;if(!K||!X)return;const R=X.getBoundingClientRect();K.width=R.width,K.height=Math.max(R.height,400);const te=K.getContext("2d");if(te&&(te.fillStyle="#FFFFFF",te.fillRect(0,0,K.width,K.height),u)){const H=new Image;H.onload=()=>{te.drawImage(H,0,0)},H.src=u}},[u]),r.useEffect(()=>{const K=F.current;if(!K)return;const X=K.getContext("2d");X&&(X.fillStyle="#FFFFFF",X.fillRect(0,0,K.width,K.height),m.forEach(R=>{if(!(R.points.length<2)){X.beginPath(),X.strokeStyle=R.tool==="eraser"?"#FFFFFF":R.color,X.lineWidth=R.tool==="eraser"?R.width*2:R.width,X.lineCap="round",X.lineJoin="round",X.moveTo(R.points[0].x,R.points[0].y);for(let te=1;te<R.points.length;te++)X.lineTo(R.points[te].x,R.points[te].y);X.stroke()}}))},[m]);const x=K=>{const X=F.current;if(!X)return{x:0,y:0};const R=X.getBoundingClientRect();let te,H;return"touches"in K?(te=K.touches[0].clientX,H=K.touches[0].clientY):(te=K.clientX,H=K.clientY),{x:te-R.left,y:H-R.top}},M=K=>{K.preventDefault(),l(!0);const X=x(K);p([X])},I=K=>{if(!k)return;K.preventDefault();const X=x(K);p(ie=>[...ie,X]);const R=F.current,te=R==null?void 0:R.getContext("2d");if(!te||P.length===0)return;te.beginPath(),te.strokeStyle=c==="eraser"?"#FFFFFF":N,te.lineWidth=c==="eraser"?n*2:n,te.lineCap="round",te.lineJoin="round";const H=P[P.length-1];te.moveTo(H.x,H.y),te.lineTo(X.x,X.y),te.stroke()},V=()=>{if(k){if(l(!1),P.length>1){const K={points:P,color:N,width:n,tool:c};d(X=>[...X,m]),w([]),i(X=>[...X,K])}p([])}},J=()=>{if(v.length===0)return;const K=v[v.length-1];w(X=>[...X,m]),i(K),d(X=>X.slice(0,-1))},L=()=>{if(y.length===0)return;const K=y[y.length-1];d(X=>[...X,m]),i(K),w(X=>X.slice(0,-1))},Z=()=>{m.length!==0&&(d(K=>[...K,m]),w([]),i([]))},ee=async()=>{const K=F.current;if(!K)return;const X=K.toDataURL("image/png");if(C)try{await C(X),alert("Notes saved successfully!")}catch(R){console.error("Failed to save notes:",R),alert("Failed to save notes")}else{const R=document.createElement("a");R.download=`notes-${Date.now()}.png`,R.href=X,R.click()}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Handwritten Notes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:J,disabled:v.length===0,className:"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed",title:"Undo",children:e.jsx(At,{className:"w-5 h-5"})}),e.jsx("button",{onClick:L,disabled:y.length===0,className:"p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded disabled:opacity-30 disabled:cursor-not-allowed",title:"Redo",children:e.jsx(gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:Z,className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Clear all",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ee,className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Save/Export",children:e.jsx(Ae,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o("pen"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${c==="pen"?"bg-blue-600 text-white":"bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500"}`,children:[e.jsx(We,{className:"w-4 h-4"}),"Pen"]}),e.jsxs("button",{onClick:()=>o("eraser"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${c==="eraser"?"bg-blue-600 text-white":"bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-500"}`,children:[e.jsx(ys,{className:"w-4 h-4"}),"Eraser"]})]}),c==="pen"&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>h(!T),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsx("div",{className:"w-6 h-6 rounded border-2 border-gray-300",style:{backgroundColor:N}})]}),T&&e.jsx("div",{className:"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:$a.map(K=>e.jsx("button",{onClick:()=>{g(K.value),h(!1)},className:`w-8 h-8 rounded border-2 transition-transform hover:scale-110 ${N===K.value?"border-blue-600 ring-2 ring-blue-300":"border-gray-300"}`,style:{backgroundColor:K.value},title:K.name},K.value))})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>$(!b),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg",children:[e.jsx("div",{className:"rounded-full bg-gray-900 dark:bg-white",style:{width:n*2,height:n*2}}),n,"px"]}),b&&e.jsx("div",{className:"absolute top-full mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"flex flex-col gap-2",children:Ea.map(K=>e.jsxs("button",{onClick:()=>{S(K),$(!1)},className:`flex items-center gap-3 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${n===K?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("div",{className:"rounded-full bg-gray-900 dark:bg-white",style:{width:K*2,height:K*2}}),e.jsxs("span",{className:"text-sm",children:[K,"px"]})]},K))})})]})]}),e.jsx("div",{ref:j,className:"border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden bg-white",style:{touchAction:"none"},children:e.jsx("canvas",{ref:F,onMouseDown:M,onMouseMove:I,onMouseUp:V,onMouseLeave:V,onTouchStart:M,onTouchMove:I,onTouchEnd:V,className:"cursor-crosshair"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Draw on the canvas with your mouse, trackpad, or touch screen. Use the eraser to remove strokes."})]})},Ve={gauge_swatch:{name:"Gauge Swatch",icon:"📏",description:"Record gauge measurements for accurate sizing"},fit_adjustment:{name:"Fit Adjustment",icon:"📐",description:"Track modifications to pattern measurements"},yarn_substitution:{name:"Yarn Substitution",icon:"🧶",description:"Document yarn changes and gauge comparison"},finishing_techniques:{name:"Finishing Techniques",icon:"✨",description:"Notes on bind-off, seaming, and blocking"}},Ra=({projectId:t,memos:a,onSaveMemo:s,onDeleteMemo:C})=>{const[u,F]=r.useState(!1),[j,k]=r.useState("gauge_swatch"),[l,P]=r.useState({}),p=c=>{k(c),P({}),F(!0)},m=async()=>{try{await s(j,l),F(!1),P({})}catch(c){console.error("Failed to save memo:",c),alert("Failed to save memo")}},i=async c=>{if(confirm("Are you sure you want to delete this memo?"))try{await C(c)}catch(o){console.error("Failed to delete memo:",o),alert("Failed to delete memo")}},v=c=>{const o=d(c),N=new Blob([o],{type:"text/plain"}),g=URL.createObjectURL(N),n=document.createElement("a");n.href=g,n.download=`${Ve[c.template_type].name.replace(/\s/g,"_")}_${c.id}.txt`,n.click(),URL.revokeObjectURL(g)},d=c=>{const o=Ve[c.template_type].name,N=new Date(c.created_at).toLocaleDateString();let g=`${o}
`;switch(g+=`Date: ${N}
`,g+=`${"=".repeat(50)}

`,c.template_type){case"gauge_swatch":const n=c.data;g+=`Needle Size: ${n.needle_size}
`,g+=`Stitches per Inch: ${n.stitches_per_inch}
`,g+=`Rows per Inch: ${n.rows_per_inch}
`,g+=`Swatch Dimensions: ${n.swatch_width}" × ${n.swatch_height}"
`,n.notes&&(g+=`
Notes: ${n.notes}
`);break;case"fit_adjustment":const S=c.data;g+=`Measurement: ${S.measurement_name}
`,g+=`Original: ${S.original_value}
`,g+=`Adjusted: ${S.adjusted_value}
`,g+=`Reason: ${S.reason}
`,S.notes&&(g+=`
Notes: ${S.notes}
`);break;case"yarn_substitution":const T=c.data;g+=`Original Yarn: ${T.original_yarn_name} (${T.original_yarn_weight})
`,g+=`Original Yardage: ${T.original_yardage} yards
`,g+=`Replacement Yarn: ${T.replacement_yarn_name} (${T.replacement_yarn_weight})
`,g+=`Replacement Yardage: ${T.replacement_yardage} yards
`,g+=`Gauge Comparison: ${T.gauge_comparison}
`,T.notes&&(g+=`
Notes: ${T.notes}
`);break;case"finishing_techniques":const h=c.data;g+=`Bind-Off Method: ${h.bind_off_method}
`,g+=`Seaming Technique: ${h.seaming_technique}
`,g+=`Blocking Instructions: ${h.blocking_instructions}
`,h.notes&&(g+=`
Notes: ${h.notes}
`);break}return g},y=()=>{switch(j){case"gauge_swatch":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Needle Size"}),e.jsx("input",{type:"text",value:l.needle_size||"",onChange:c=>P({...l,needle_size:c.target.value}),placeholder:"e.g., US 7 / 4.5mm",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Stitches per Inch"}),e.jsx("input",{type:"number",step:"0.1",value:l.stitches_per_inch||"",onChange:c=>P({...l,stitches_per_inch:parseFloat(c.target.value)}),placeholder:"4.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Rows per Inch"}),e.jsx("input",{type:"number",step:"0.1",value:l.rows_per_inch||"",onChange:c=>P({...l,rows_per_inch:parseFloat(c.target.value)}),placeholder:"6.0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Swatch Width (inches)"}),e.jsx("input",{type:"number",step:"0.5",value:l.swatch_width||"",onChange:c=>P({...l,swatch_width:parseFloat(c.target.value)}),placeholder:"4",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Swatch Height (inches)"}),e.jsx("input",{type:"number",step:"0.5",value:l.swatch_height||"",onChange:c=>P({...l,swatch_height:parseFloat(c.target.value)}),placeholder:"4",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:l.notes||"",onChange:c=>P({...l,notes:c.target.value}),placeholder:"Any additional observations...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3})]})]});case"fit_adjustment":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Measurement Name"}),e.jsx("input",{type:"text",value:l.measurement_name||"",onChange:c=>P({...l,measurement_name:c.target.value}),placeholder:"e.g., Sleeve length, Bust circumference",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Value"}),e.jsx("input",{type:"number",step:"0.5",value:l.original_value||"",onChange:c=>P({...l,original_value:parseFloat(c.target.value)}),placeholder:"36",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Adjusted Value"}),e.jsx("input",{type:"number",step:"0.5",value:l.adjusted_value||"",onChange:c=>P({...l,adjusted_value:parseFloat(c.target.value)}),placeholder:"38",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Reason for Change"}),e.jsx("input",{type:"text",value:l.reason||"",onChange:c=>P({...l,reason:c.target.value}),placeholder:"e.g., Prefer looser fit, Accommodate larger bust",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:l.notes||"",onChange:c=>P({...l,notes:c.target.value}),placeholder:"Additional details...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:2})]})]});case"yarn_substitution":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Yarn Name"}),e.jsx("input",{type:"text",value:l.original_yarn_name||"",onChange:c=>P({...l,original_yarn_name:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Weight"}),e.jsx("input",{type:"text",value:l.original_yarn_weight||"",onChange:c=>P({...l,original_yarn_weight:c.target.value}),placeholder:"DK, Worsted, etc.",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Original Yardage"}),e.jsx("input",{type:"number",value:l.original_yardage||"",onChange:c=>P({...l,original_yardage:parseInt(c.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Replacement Yarn Name"}),e.jsx("input",{type:"text",value:l.replacement_yarn_name||"",onChange:c=>P({...l,replacement_yarn_name:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Replacement Weight"}),e.jsx("input",{type:"text",value:l.replacement_yarn_weight||"",onChange:c=>P({...l,replacement_yarn_weight:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Replacement Yardage"}),e.jsx("input",{type:"number",value:l.replacement_yardage||"",onChange:c=>P({...l,replacement_yardage:parseInt(c.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Gauge Comparison"}),e.jsx("input",{type:"text",value:l.gauge_comparison||"",onChange:c=>P({...l,gauge_comparison:c.target.value}),placeholder:"e.g., Same gauge, Slightly looser",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:l.notes||"",onChange:c=>P({...l,notes:c.target.value}),placeholder:"Differences in texture, drape, etc.",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:2})]})]});case"finishing_techniques":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Bind-Off Method"}),e.jsx("input",{type:"text",value:l.bind_off_method||"",onChange:c=>P({...l,bind_off_method:c.target.value}),placeholder:"e.g., Standard, Sewn, I-cord",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Seaming Technique"}),e.jsx("input",{type:"text",value:l.seaming_technique||"",onChange:c=>P({...l,seaming_technique:c.target.value}),placeholder:"e.g., Mattress stitch, Kitchener stitch",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Blocking Instructions"}),e.jsx("textarea",{value:l.blocking_instructions||"",onChange:c=>P({...l,blocking_instructions:c.target.value}),placeholder:"Wet blocking, steam blocking, measurements, etc.",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Notes (optional)"}),e.jsx("textarea",{value:l.notes||"",onChange:c=>P({...l,notes:c.target.value}),placeholder:"Any other finishing details...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:2})]})]})}},w=c=>{const o=Ve[c.template_type];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:o.icon}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:o.name})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:yr(new Date(c.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v(c),className:"p-1 text-blue-600 hover:text-blue-700 dark:text-blue-400",title:"Export",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(c.id),className:"p-1 text-red-600 hover:text-red-700 dark:text-red-400",title:"Delete",children:e.jsx(ge,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-3 rounded",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:d(c)})})]},c.id)};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Structured Memos"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-6",children:Object.entries(Ve).map(([c,o])=>e.jsxs("button",{onClick:()=>p(c),className:"flex items-start gap-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 dark:hover:border-blue-500 transition-colors text-left",children:[e.jsx("span",{className:"text-3xl",children:o.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o.description})]})]},c))}),e.jsx("div",{className:"space-y-3",children:a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No memos yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Click a template above to create your first memo"})]}):a.map(w)}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-2xl",children:Ve[j].icon}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:Ve[j].name})]}),y(),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Save Memo"})]})]})})]})},Ma=[{value:"counter_value",label:"Counter reaches value"},{value:"row_interval",label:"Every N rows"},{value:"stitch_count",label:"Stitch count milestone"},{value:"time_based",label:"Time-based reminder"}],Da=[{value:"notification",label:"🔔 Notification"},{value:"sound",label:"🔊 Sound"},{value:"vibration",label:"📳 Vibration"},{value:"visual",label:"✨ Visual"}];function Aa({projectId:t,counters:a}){const[s,C]=r.useState([]),[u,F]=r.useState(!1),[j,k]=r.useState(null),[l,P]=r.useState({name:"",counterId:"",triggerType:"counter_value",operator:"equals",triggerValue:"",interval:"",alertMessage:"",alertType:"notification"});r.useEffect(()=>{p()},[t]);const p=async()=>{try{const w=await E.get(`/api/projects/${t}/magic-markers`);C(w.data.data.magicMarkers||[])}catch(w){console.error("Error fetching magic markers:",w)}},m=async()=>{var c,o;if(!l.name.trim()){f.error("Please enter a marker name");return}if(!l.alertMessage.trim()){f.error("Please enter an alert message");return}let w={};switch(l.triggerType){case"counter_value":if(!l.triggerValue||l.triggerValue.trim()===""){f.error("Please enter trigger value");return}const N=parseInt(l.triggerValue);if(isNaN(N)){f.error("Trigger value must be a valid number");return}w={operator:l.operator,value:N};break;case"row_interval":if(!l.interval||l.interval.trim()===""){f.error("Please enter interval");return}const g=parseInt(l.interval);if(isNaN(g)||g<=0){f.error("Interval must be a positive number");return}w={interval:g};break;case"stitch_count":if(!l.triggerValue||l.triggerValue.trim()===""){f.error("Please enter stitch count");return}const n=parseInt(l.triggerValue);if(isNaN(n)||n<=0){f.error("Stitch count must be a positive number");return}w={count:n};break;case"time_based":if(!l.interval||l.interval.trim()===""){f.error("Please enter time interval (minutes)");return}const S=parseInt(l.interval);if(isNaN(S)||S<=0){f.error("Time interval must be a positive number");return}w={minutes:S};break}try{await E.post(`/api/projects/${t}/magic-markers`,{name:l.name,counterId:l.counterId||null,triggerType:l.triggerType,triggerCondition:w,alertMessage:l.alertMessage,alertType:l.alertType,isActive:!0}),f.success("Magic marker created!"),F(!1),d(),p()}catch(N){console.error("Error creating marker:",N),f.error(((o=(c=N.response)==null?void 0:c.data)==null?void 0:o.message)||"Failed to create marker")}},i=async w=>{try{await E.patch(`/api/projects/${t}/magic-markers/${w}/toggle`),p()}catch(c){console.error("Error toggling marker:",c),f.error("Failed to toggle marker")}},v=async(w,c)=>{if(confirm(`Delete magic marker "${c}"?`))try{await E.delete(`/api/projects/${t}/magic-markers/${w}`),f.success("Marker deleted"),p()}catch(o){console.error("Error deleting marker:",o),f.error("Failed to delete marker")}},d=()=>{P({name:"",counterId:"",triggerType:"counter_value",operator:"equals",triggerValue:"",interval:"",alertMessage:"",alertType:"notification"})},y=w=>{const c=w.trigger_condition;switch(w.trigger_type){case"counter_value":return`When counter ${{equals:"=",greater_than:">",less_than:"<",multiple_of:"is multiple of"}[c.operator]||c.operator} ${c.value}`;case"row_interval":return`Every ${c.interval} rows`;case"stitch_count":return`At ${c.count} stitches`;case"time_based":return`Every ${c.minutes} minutes`;default:return w.trigger_type}};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-purple-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Magic Markers"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.length,")"]})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition",children:[e.jsx(ue,{className:"h-4 w-4"}),"New Marker"]})]}),s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Be,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No magic markers yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Create markers to get alerts at important milestones"})]}):e.jsx("div",{className:"space-y-3",children:s.map(w=>e.jsx("div",{className:`border rounded-lg p-4 ${w.is_active?"border-purple-200 bg-purple-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w.name}),w.is_active?e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full",children:"Active"}):e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-600 text-xs rounded-full",children:"Inactive"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:y(w)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Alert:"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:w.alert_message})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>i(w.id),className:"p-2 hover:bg-white rounded transition",title:w.is_active?"Disable":"Enable",children:w.is_active?e.jsx(vs,{className:"h-5 w-5 text-green-600"}):e.jsx(ws,{className:"h-5 w-5 text-gray-400"})}),e.jsx("button",{onClick:()=>v(w.id,w.name),className:"p-2 hover:bg-white rounded transition text-red-600",title:"Delete",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})},w.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"New Magic Marker"}),e.jsx("button",{onClick:()=>{F(!1),d()},className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Marker Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:w=>P({...l,name:w.target.value}),placeholder:"e.g., Decrease reminder",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Counter (optional)"}),e.jsxs("select",{value:l.counterId,onChange:w=>P({...l,counterId:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"All counters"}),a.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trigger Type"}),e.jsx("select",{value:l.triggerType,onChange:w=>P({...l,triggerType:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500",children:Ma.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),(l.triggerType==="counter_value"||l.triggerType==="stitch_count")&&e.jsxs(e.Fragment,{children:[l.triggerType==="counter_value"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comparison Operator"}),e.jsxs("select",{value:l.operator,onChange:w=>P({...l,operator:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"equals",children:"Equals (=)"}),e.jsx("option",{value:"greater_than",children:"Greater than (>)"}),e.jsx("option",{value:"less_than",children:"Less than (<)"}),e.jsx("option",{value:"multiple_of",children:"Is multiple of"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trigger Value"}),e.jsx("input",{type:"number",value:l.triggerValue,onChange:w=>P({...l,triggerValue:w.target.value}),placeholder:"e.g., 100",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]}),(l.triggerType==="row_interval"||l.triggerType==="time_based")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l.triggerType==="time_based"?"Interval (minutes)":"Every N Rows"}),e.jsx("input",{type:"number",value:l.interval,onChange:w=>P({...l,interval:w.target.value}),placeholder:l.triggerType==="time_based"?"e.g., 30":"e.g., 10",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alert Message *"}),e.jsx("textarea",{value:l.alertMessage,onChange:w=>P({...l,alertMessage:w.target.value}),placeholder:"e.g., Time to start decreases for the sleeve!",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alert Type"}),e.jsx("select",{value:l.alertType,onChange:w=>P({...l,alertType:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500",children:Da.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{F(!1),d()},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:m,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:"Create"})]})]})]})})]})}function Er({size:t="md",text:a,fullScreen:s=!1,className:C=""}){const u={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"},F={sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"},j=e.jsxs("div",{className:`flex flex-col items-center justify-center gap-3 ${C}`,children:[e.jsx(mr,{className:`${u[t]} text-purple-600 dark:text-purple-400 animate-spin`,"aria-label":"Loading",role:"status"}),a&&e.jsx("p",{className:`${F[t]} text-gray-600 dark:text-gray-400 font-medium`,children:a})]});return s?e.jsx("div",{className:"fixed inset-0 bg-gray-50 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 flex items-center justify-center z-50",children:j}):j}xr.workerSrc="/pdf.worker.min.js";function er({patterns:t,mode:a="normal"}){const[s,C]=r.useState(null),[u,F]=r.useState([]),[j,k]=r.useState(null),[l,P]=r.useState(null),[p,m]=r.useState(1),[i,v]=r.useState(1),[d,y]=r.useState(!1);r.useEffect(()=>{t.length>0&&!s&&C(t[0])},[t]),r.useEffect(()=>{s&&w(s.id)},[s]),r.useEffect(()=>{if(u.length>0&&!j){const b=u.find($=>$.file_type==="pdf");b&&k(b)}},[u]);const w=async b=>{try{y(!0);const x=(await E.get(`/api/uploads/patterns/${b}/files`)).data.data.files||[];F(x)}catch($){console.error("Error fetching pattern files:",$),F([])}finally{y(!1)}},c=b=>{const $=t.find(x=>x.id===b);$&&(C($),k(null),m(1))},o=b=>{const $=u.find(x=>x.id===b);$&&(k($),m(1))},N=({numPages:b})=>{P(b)},g=()=>{m(b=>Math.max(b-1,1))},n=()=>{m(b=>Math.min(b+1,l||b))},S=()=>{v(b=>Math.min(b+.2,2))},T=()=>{v(b=>Math.max(b-.2,.5))},h=u.filter(b=>b.file_type==="pdf");return t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:`font-semibold text-gray-900 mb-4 ${a==="knitting"?"text-xl":"text-lg"}`,children:"Pattern Preview"}),e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No patterns linked to this project yet."}),e.jsx("p",{className:"text-sm mt-2",children:"Add a pattern to see it here."})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:`font-semibold text-gray-900 ${a==="knitting"?"text-xl":"text-lg"}`,children:"Pattern Preview"}),s&&e.jsxs(be,{to:`/patterns/${s.id}`,className:"text-purple-600 hover:text-purple-700 flex items-center gap-1 text-sm",children:["Open Full View ",e.jsx(Ns,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Pattern"}),e.jsx("select",{value:(s==null?void 0:s.id)||"",onChange:b=>c(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent",children:t.map(b=>e.jsxs("option",{value:b.id,children:[b.name," ",b.designer?`by ${b.designer}`:""]},b.id))})]}),h.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select PDF File"}),e.jsx("select",{value:(j==null?void 0:j.id)||"",onChange:b=>o(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent",children:h.map(b=>e.jsx("option",{value:b.id,children:b.original_filename},b.id))})]})]}),(s==null?void 0:s.description)&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.description})})]}),d?e.jsx("div",{className:"flex items-center justify-center py-12 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):j&&j.file_type==="pdf"?e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,disabled:p<=1,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",p," of ",l||"?"]}),e.jsx("button",{onClick:n,disabled:p>=(l||0),className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"Next"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:T,disabled:i<=.5,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"-"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[Math.round(i*100),"%"]}),e.jsx("button",{onClick:S,disabled:i>=2,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"+"})]})]}),e.jsx("div",{className:"overflow-auto bg-gray-50",style:{maxHeight:a==="knitting"?"600px":"500px"},children:e.jsx(gr,{file:`/api/uploads/patterns/${s==null?void 0:s.id}/files/${j.id}/download`,onLoadSuccess:N,loading:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}),error:e.jsx("div",{className:"flex items-center justify-center py-12 text-red-600",children:e.jsx("p",{children:"Failed to load PDF. Please try again."})}),children:e.jsx(hr,{pageNumber:p,scale:i,renderTextLayer:!0,renderAnnotationLayer:!0})})})]}):h.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("p",{className:"text-gray-500",children:"No PDF files found for this pattern."}),s&&e.jsx(be,{to:`/patterns/${s.id}`,className:"inline-block mt-2 text-purple-600 hover:text-purple-700 text-sm",children:"Upload a PDF file →"})]}):null]})}function La(){const{id:t}=Lt(),a=Ue(),{joinProject:s,leaveProject:C}=Fr(),[u,F]=r.useState(null),[j,k]=r.useState([]),[l,P]=r.useState(!0),[p,m]=r.useState(!1),[i,v]=r.useState(!1),[d,y]=r.useState(!1),[w,c]=r.useState(!1),[o,N]=r.useState([]),[g,n]=r.useState([]),[S,T]=r.useState("audio"),[h,b]=r.useState(!1),[$,x]=r.useState(""),[M,I]=r.useState(!1),[V,J]=r.useState(!1),[L,Z]=r.useState(!1),[ee,K]=r.useState(!1),[X,R]=r.useState([]),[te,H]=r.useState([]),[ie,D]=r.useState([]),[re,se]=r.useState([]),[A,G]=r.useState(""),[Y,z]=r.useState(""),[O,Q]=r.useState({skeins:"",yards:""}),[le,me]=r.useState(""),[fe,Te]=r.useState(!1),[B,de]=r.useState({name:"",description:"",designer:"",difficulty:"intermediate"}),[ye,q]=r.useState(null),[U,ne]=r.useState({name:"",description:"",status:"active",notes:"",recipientId:""}),ae=r.useRef(!0),Ce=r.useRef(!1);r.useEffect(()=>(ae.current=!0,(async()=>{if(!Ce.current){Ce.current=!0;try{await Promise.all([pe(),ft(),_e(),tt(),yt()])}catch(W){ae.current&&console.error("Error loading project data:",W)}finally{Ce.current=!1}}})(),t&&s(t),()=>{ae.current=!1,t&&C(t)}),[t]);const[Se,Pe]=r.useState(null),[Ie,ve]=r.useState([]);r.useEffect(()=>{i&&(oe(),we())},[i]);const we=async()=>{try{const _=await E.get(`/api/projects/${t}/sessions/active`);_.data.success&&_.data.data&&Pe(_.data.data)}catch{Pe(null)}},oe=async()=>{try{const _=await E.get(`/api/projects/${t}/sessions`);ve(_.data.success?_.data.data.sessions||[]:[])}catch(_){console.error("Failed to fetch sessions:",_),ve([])}},pe=async()=>{try{const W=(await E.get(`/api/projects/${t}`)).data.data.project;F(W),ne({name:W.name,description:W.description||"",status:W.status||"active",notes:W.notes||"",recipientId:W.recipient_id||""})}catch(_){console.error("Error fetching project:",_),f.error("Failed to load project"),a("/projects")}finally{P(!1)}},_e=async()=>{try{const[_,W,ce,ke]=await Promise.all([E.get("/api/patterns"),E.get("/api/yarn"),E.get("/api/tools"),E.get("/api/recipients")]);R(_.data.data.patterns||[]),H(W.data.data.yarn||[]),D(ce.data.data.tools||[]),se(ke.data.data.recipients||[])}catch(_){console.error("Error fetching available items:",_)}},Re=async _=>{_.preventDefault();try{await E.put(`/api/projects/${t}`,U),f.success("Project updated successfully!"),m(!1),pe()}catch(W){console.error("Error updating project:",W),f.error("Failed to update project")}},pt=async()=>{if(confirm(`Are you sure you want to delete "${u==null?void 0:u.name}"?`))try{await E.delete(`/api/projects/${t}`),f.success("Project deleted successfully"),a("/projects")}catch(_){console.error("Error deleting project:",_),f.error("Failed to delete project")}},bt=()=>{x((u==null?void 0:u.notes)||""),b(!0)},Lr=async()=>{try{await E.put(`/api/projects/${t}`,{name:u==null?void 0:u.name,description:u==null?void 0:u.description,status:u==null?void 0:u.status,notes:$}),f.success("Notes saved successfully!"),b(!1),pe()}catch(_){console.error("Error saving notes:",_),f.error("Failed to save notes")}},Ir=()=>{x(""),b(!1)},zr=async()=>{var _,W;if(!A){f.error("Please select a pattern");return}try{await E.post(`/api/projects/${t}/patterns`,{patternId:A}),f.success("Pattern added to project!"),I(!1),G(""),pe()}catch(ce){console.error("Error adding pattern:",ce),f.error(((W=(_=ce.response)==null?void 0:_.data)==null?void 0:W.message)||"Failed to add pattern")}},Or=async _=>{try{await E.delete(`/api/projects/${t}/patterns/${_}`),f.success("Pattern removed from project"),pe()}catch(W){console.error("Error removing pattern:",W),f.error("Failed to remove pattern")}},Br=async _=>{var W,ce;if(_.preventDefault(),!ye){f.error("Please select a pattern file to upload");return}if(!B.name.trim()){f.error("Please enter a pattern name");return}Te(!0);try{const Ge=(await E.post("/api/patterns",B)).data.data.pattern;f.success("Pattern created!");const wt=new FormData;wt.append("file",ye),wt.append("description","Pattern file"),await E.post(`/api/uploads/patterns/${Ge.id}/files`,wt,{headers:{"Content-Type":"multipart/form-data"}}),f.success("File uploaded!"),await E.post(`/api/projects/${t}/patterns`,{patternId:Ge.id}),f.success("Pattern added to project!"),J(!1),de({name:"",description:"",designer:"",difficulty:"intermediate"}),q(null),pe(),_e()}catch(ke){console.error("Error uploading pattern:",ke),f.error(((ce=(W=ke.response)==null?void 0:W.data)==null?void 0:ce.message)||"Failed to upload pattern")}finally{Te(!1)}},Ur=async()=>{var _,W;if(!Y){f.error("Please select yarn");return}try{await E.post(`/api/projects/${t}/yarn`,{yarnId:Y,skeinsUsed:O.skeins?parseFloat(O.skeins):void 0,yardsUsed:O.yards?parseFloat(O.yards):void 0}),f.success("Yarn added to project! Stash has been updated."),Z(!1),z(""),Q({skeins:"",yards:""}),pe(),_e()}catch(ce){console.error("Error adding yarn:",ce),f.error(((W=(_=ce.response)==null?void 0:_.data)==null?void 0:W.message)||"Failed to add yarn")}},Vr=async _=>{if(confirm("Remove this yarn? The used amount will be restored to your stash."))try{await E.delete(`/api/projects/${t}/yarn/${_}`),f.success("Yarn removed and restored to stash"),pe(),_e()}catch(W){console.error("Error removing yarn:",W),f.error("Failed to remove yarn")}},Yr=async()=>{var _,W;if(!le){f.error("Please select a tool");return}try{await E.post(`/api/projects/${t}/tools`,{toolId:le}),f.success("Tool added to project!"),K(!1),me(""),pe()}catch(ce){console.error("Error adding tool:",ce),f.error(((W=(_=ce.response)==null?void 0:_.data)==null?void 0:W.message)||"Failed to add tool")}},qr=async _=>{try{await E.delete(`/api/projects/${t}/tools/${_}`),f.success("Tool removed from project"),pe()}catch(W){console.error("Error removing tool:",W),f.error("Failed to remove tool")}},ft=async()=>{try{const _=await E.get(`/api/uploads/projects/${t}/photos`);k(_.data.data.photos)}catch(_){console.error("Error fetching photos:",_)}},tt=async()=>{try{const _=await E.get(`/api/projects/${t}/audio-notes`);N(_.data.data.audioNotes||[])}catch(_){console.error("Error fetching audio notes:",_)}},yt=async()=>{try{const _=await E.get(`/api/projects/${t}/structured-memos`);n(_.data.data.memos||[])}catch(_){console.error("Error fetching structured memos:",_)}},Ut=async(_,W,ce)=>{const ke=new FormData;ke.append("audio",_,"audio-note.webm"),ke.append("durationSeconds",W.toString()),ce&&ke.append("transcription",ce);try{await E.post(`/api/projects/${t}/audio-notes`,ke,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Audio note saved!"),tt()}catch(Ge){throw console.error("Error saving audio note:",Ge),f.error("Failed to save audio note"),Ge}},Vt=async _=>{try{await E.delete(`/api/projects/${t}/audio-notes/${_}`),f.success("Audio note deleted"),tt()}catch(W){throw console.error("Error deleting audio note:",W),f.error("Failed to delete audio note"),W}},Yt=async(_,W)=>{try{await E.put(`/api/projects/${t}/audio-notes/${_}`,{transcription:W}),f.success("Transcription updated"),tt()}catch(ce){throw console.error("Error updating transcription:",ce),f.error("Failed to update transcription"),ce}},Hr=async(_,W)=>{try{await E.post(`/api/projects/${t}/structured-memos`,{templateType:_,data:W}),f.success("Memo saved!"),yt()}catch(ce){throw console.error("Error saving memo:",ce),f.error("Failed to save memo"),ce}},Wr=async _=>{try{await E.delete(`/api/projects/${t}/structured-memos/${_}`),f.success("Memo deleted"),yt()}catch(W){throw console.error("Error deleting memo:",W),f.error("Failed to delete memo"),W}},Kr=()=>{v(!i),i?f.info("Knitting Mode deactivated"):f.success("Knitting Mode activated! 🧶")},Gr=()=>{const _={};return u!=null&&u.counters&&u.counters.forEach(W=>{_[W.id]=W.current_count||0}),_},Xr=async()=>{try{const _=await E.post(`/api/projects/${t}/sessions/start`,{mood:void 0,location:void 0,notes:"Knitting session"}),W=_.data.success?_.data.data.session:_.data;return Pe(W),await oe(),f.success("Knitting session started! 🎉"),W}catch(_){throw console.error("Failed to start session:",_),f.error("Failed to start session"),_}},Qr=async(_,W)=>{if(Se)try{await E.post(`/api/projects/${t}/sessions/${Se.id}/end`,{notes:_,mood:W}),Pe(null),await oe(),f.success("Session ended and saved!")}catch(ce){throw console.error("Failed to end session:",ce),f.error("Failed to end session"),ce}},Jr=async _=>{try{await E.delete(`/api/projects/${t}/sessions/${_}`),await oe(),f.success("Session deleted")}catch(W){console.error("Failed to delete session:",W),f.error("Failed to delete session")}},Zr=async _=>{const W=new FormData;W.append("photo",_);try{await E.post(`/api/uploads/projects/${t}/photos`,W,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Photo uploaded successfully!"),ft()}catch(ce){throw console.error("Error uploading photo:",ce),f.error("Failed to upload photo"),ce}},es=async _=>{try{await E.delete(`/api/uploads/projects/${t}/photos/${_}`),f.success("Photo deleted successfully"),ft()}catch(W){console.error("Error deleting photo:",W),f.error("Failed to delete photo")}},jt=_=>_?new Date(_).toLocaleDateString():"Not set",ts=_=>{switch(_){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paused":return"bg-yellow-100 text-yellow-800";case"planned":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},rs=_=>{const W=_.yarn_remaining||0,ce=_.yarn_total||1;return Math.max(0,Math.min(100,W/ce*100))};if(l)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Er,{size:"lg",text:"Loading project..."})});if(!u)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Project not found"}),e.jsx(be,{to:"/projects",className:"text-purple-600 hover:text-purple-700 mt-4 inline-block",children:"Back to Projects"})]});const vt=re.find(_=>_.id===U.recipientId);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(be,{to:"/projects",className:"inline-flex items-center text-purple-600 hover:text-purple-700 mb-4",children:[e.jsx(ht,{className:"mr-2"}),"Back to Projects"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:u.name}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${ts(u.status)}`,children:u.status})]}),u.project_type&&e.jsxs("p",{className:"text-gray-600",children:["Type: ",u.project_type]}),vt&&e.jsxs("p",{className:"text-gray-600 flex items-center mt-1",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Gift for: ",vt.first_name," ",vt.last_name]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:Kr,className:`px-4 py-3 md:py-2 rounded-lg transition flex items-center min-h-[48px] md:min-h-0 ${i?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[i?e.jsx(xt,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}):e.jsx(et,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:i?"Exit Knitting Mode":"Knitting Mode"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-3 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center min-h-[48px] md:min-h-0",children:[e.jsx(Ee,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Edit"})]}),e.jsxs("button",{onClick:pt,className:"px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition flex items-center min-h-[48px] md:min-h-0",children:[e.jsx(ge,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Delete"})]})]})]})]}),i?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[u.patterns&&u.patterns.length>0&&e.jsx(er,{patterns:u.patterns,mode:"knitting"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-4 md:mb-6",children:"Active Counters"}),e.jsx(Jt,{projectId:t})]})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:"Session Timer"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(!d),className:`p-2 rounded-lg transition ${d?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,title:"Voice Notes",children:e.jsx(ct,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>c(!w),className:`p-2 rounded-lg transition ${w?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,title:"History",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsx(_r,{projectId:t,currentSession:Se,onStartSession:Xr,onEndSession:Qr,getCurrentCounterValues:Gr})]}),d&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4",children:"Voice Notes"}),e.jsx(Zt,{projectId:t,notes:o,onSaveNote:Ut,onDeleteNote:Vt,onUpdateTranscription:Yt})]}),w&&Ie.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4",children:"Session History"}),e.jsx($r,{sessions:Ie,onDeleteSession:Jr})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[u.description&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:u.description})]}),u.patterns&&u.patterns.length>0&&e.jsx(er,{patterns:u.patterns,mode:"normal"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(pr,{className:"h-5 w-5 text-purple-600 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Photos"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",j.length,")"]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(wa,{onUpload:Zr})}),e.jsx(va,{photos:j,onDelete:es})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Counters"}),e.jsx(Jt,{projectId:t})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(Aa,{projectId:t,counters:(u==null?void 0:u.counters)||[]})}),e.jsx(_a,{projectId:t,totalRows:0,getCurrentCounterValues:()=>({})}),e.jsxs("div",{id:"notes-section",className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 pt-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Notes"}),e.jsxs("nav",{className:"flex -mb-px gap-6",children:[e.jsx("button",{onClick:()=>T("audio"),className:`pb-3 text-sm font-medium border-b-2 ${S==="audio"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Audio Notes"}),e.jsx("button",{onClick:()=>T("handwritten"),className:`pb-3 text-sm font-medium border-b-2 ${S==="handwritten"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Handwritten"}),e.jsx("button",{onClick:()=>T("memos"),className:`pb-3 text-sm font-medium border-b-2 ${S==="memos"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Structured Memos"})]})]}),e.jsxs("div",{className:"p-6",children:[S==="audio"&&e.jsx(Zt,{projectId:t,notes:o,onSaveNote:Ut,onDeleteNote:Vt,onUpdateTranscription:Yt}),S==="handwritten"&&e.jsx(Ta,{projectId:t,onSave:async _=>{try{const ce=await(await fetch(_)).blob(),ke=new FormData;ke.append("image",ce,"handwritten-note.png"),await E.post(`/api/projects/${t}/handwritten-notes`,ke,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Handwritten note saved!")}catch(W){throw console.error("Error saving handwritten note:",W),W}}}),S==="memos"&&e.jsx(Ra,{projectId:t,memos:g,onSaveMemo:Hr,onDeleteMemo:Wr})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Timeline"}),e.jsxs("div",{className:"space-y-3",children:[u.start_date&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(or,{className:"mt-1 mr-3 h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Started"}),e.jsx("p",{className:"text-sm text-gray-600",children:jt(u.start_date)})]})]}),u.target_completion_date&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ne,{className:"mt-1 mr-3 h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Target Completion"}),e.jsx("p",{className:"text-sm text-gray-600",children:jt(u.target_completion_date)})]})]}),u.completion_date&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(dt,{className:"mt-1 mr-3 h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Completed"}),e.jsx("p",{className:"text-sm text-gray-600",children:jt(u.completion_date)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),!h&&e.jsx("button",{onClick:bt,className:"text-purple-600 hover:text-purple-700",title:"Edit notes",children:e.jsx(Ee,{className:"h-4 w-4"})})]}),h?e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:$,onChange:_=>x(_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",rows:6,placeholder:"Add notes about your project..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Lr,className:"flex-1 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm flex items-center justify-center gap-2",children:[e.jsx(dt,{className:"h-4 w-4"}),"Save"]}),e.jsxs("button",{onClick:Ir,className:"flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm flex items-center justify-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Cancel"]})]})]}):e.jsx("div",{children:u.notes?e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:u.notes}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No notes added yet"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Patterns"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(!0),className:"text-purple-600 hover:text-purple-700 text-xs flex items-center gap-1",title:"Select existing pattern",children:[e.jsx(ue,{className:"h-4 w-4"}),"Select"]}),e.jsxs("button",{onClick:()=>J(!0),className:"px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 flex items-center gap-1",title:"Upload new pattern",children:[e.jsx(ue,{className:"h-3 w-3"}),"Upload"]})]})]}),u.patterns&&u.patterns.length>0?e.jsx("ul",{className:"space-y-2",children:u.patterns.map(_=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx(be,{to:`/patterns/${_.id}`,className:"text-purple-600 hover:text-purple-700 flex-1",children:_.name}),e.jsx("button",{onClick:()=>Or(_.id),className:"text-red-600 hover:text-red-700 ml-2",title:"Remove pattern",children:e.jsx(xe,{className:"h-4 w-4"})})]},_.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No patterns added"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Tools"}),e.jsx("button",{onClick:()=>K(!0),className:"text-purple-600 hover:text-purple-700",title:"Add tool",children:e.jsx(ue,{className:"h-5 w-5"})})]}),u.tools&&u.tools.length>0?e.jsx("ul",{className:"space-y-2",children:u.tools.map(_=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-700 flex-1",children:[_.name,_.size&&e.jsxs("span",{className:"text-gray-500",children:[" (",_.size,")"]})]}),e.jsx("button",{onClick:()=>qr(_.id),className:"text-red-600 hover:text-red-700 ml-2",title:"Remove tool",children:e.jsx(xe,{className:"h-4 w-4"})})]},_.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No tools added"})]}),u.yarn&&u.yarn.length>0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Yarn Usage"}),e.jsx("button",{onClick:()=>Z(!0),className:"text-purple-600 hover:text-purple-700",title:"Add yarn",children:e.jsx(ue,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"space-y-4",children:u.yarn.map(_=>{const W=rs(_),ce=_.low_stock_alert&&_.yards_remaining<=(_.low_stock_threshold||0);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:[_.brand," ",_.name,_.color&&e.jsxs("span",{className:"text-gray-600",children:[" - ",_.color]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:_.weight})]}),e.jsx("button",{onClick:()=>Vr(_.id),className:"text-red-600 hover:text-red-700 p-1",title:"Remove yarn",children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Used in Project"}),e.jsxs("p",{className:"text-xs font-medium text-gray-900",children:[_.skeins_used||0," skeins, ",_.yards_used||0," yds"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining in Stash"}),e.jsxs("p",{className:"text-xs font-medium text-gray-900",children:[_.skeins_remaining||0," skeins, ",_.yards_remaining||0," yds"]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Stash Level"}),e.jsxs("span",{children:[W.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${W<20?"bg-red-500":W<50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${W}%`}})})]}),ce&&e.jsxs("div",{className:"flex items-center text-orange-600 text-xs mt-2",children:[e.jsx(Be,{className:"mr-1 h-3 w-3"}),"Low stock! Only ",_.yards_remaining," yards remaining"]})]},_.id)})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Yarn Usage"}),e.jsx("button",{onClick:()=>Z(!0),className:"text-purple-600 hover:text-purple-700",title:"Add yarn",children:e.jsx(ue,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"No yarn added"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Project"})}),e.jsxs("form",{onSubmit:Re,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name"}),e.jsx("input",{type:"text",value:U.name,onChange:_=>ne({...U,name:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:U.description,onChange:_=>ne({...U,description:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:U.status,onChange:_=>ne({...U,status:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gift Recipient (Optional)"}),e.jsxs("select",{value:U.recipientId,onChange:_=>ne({...U,recipientId:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"None"}),re.map(_=>e.jsxs("option",{value:_.id,children:[_.first_name," ",_.last_name]},_.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:U.notes,onChange:_=>ne({...U,notes:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:5,placeholder:"Add notes about your project..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Save Changes"})]})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Pattern to Project"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Pattern"}),e.jsxs("select",{value:A,onChange:_=>G(_.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Choose a pattern..."}),X.filter(_=>{var W;return!((W=u==null?void 0:u.patterns)!=null&&W.some(ce=>ce.id===_.id))}).map(_=>e.jsxs("option",{value:_.id,children:[_.name,_.designer&&` by ${_.designer}`]},_.id))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{I(!1),G("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:zr,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Pattern"})]})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Upload New Pattern"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload a PDF pattern and add it to this project"})]}),e.jsxs("form",{onSubmit:Br,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:B.name,onChange:_=>de({...B,name:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Cable Knit Sweater",required:!0,disabled:fe})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:B.designer,onChange:_=>de({...B,designer:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Jane Doe",disabled:fe})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:B.difficulty,onChange:_=>de({...B,difficulty:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:fe,children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:B.description,onChange:_=>de({...B,description:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Brief description of the pattern...",disabled:fe})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern File (PDF) *"}),e.jsx("input",{type:"file",accept:".pdf,application/pdf",onChange:_=>{var W;return q(((W=_.target.files)==null?void 0:W[0])||null)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100",required:!0,disabled:fe}),ye&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",ye.name," (",(ye.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{J(!1),de({name:"",description:"",designer:"",difficulty:"intermediate"}),q(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",disabled:fe,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:fe,children:fe?"Uploading...":"Upload & Add to Project"})]})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Yarn to Project"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Yarn"}),e.jsxs("select",{value:Y,onChange:_=>z(_.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose yarn..."}),te.filter(_=>_.skeins_remaining>0).map(_=>e.jsxs("option",{value:_.id,children:[_.brand," ",_.name," - ",_.color,"(",_.skeins_remaining," skeins, ",_.yards_remaining," yds available)"]},_.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Skeins to Use"}),e.jsx("input",{type:"number",value:O.skeins,onChange:_=>Q({...O,skeins:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yards to Use"}),e.jsx("input",{type:"number",value:O.yards,onChange:_=>Q({...O,yards:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0",min:"0",step:"1"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"The specified amount will be deducted from your stash automatically."}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{Z(!1),z(""),Q({skeins:"",yards:""})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Ur,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Yarn"})]})]})]})}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Tool to Project"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Tool"}),e.jsxs("select",{value:le,onChange:_=>me(_.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-4",children:[e.jsx("option",{value:"",children:"Choose a tool..."}),ie.filter(_=>{var W;return!((W=u==null?void 0:u.tools)!=null&&W.some(ce=>ce.id===_.id))}).map(_=>e.jsxs("option",{value:_.id,children:[_.name,_.size&&` (${_.size})`,_.type&&` - ${_.type}`]},_.id))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{K(!1),me("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Yr,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Tool"})]})]})]})})]})}const Ia=[{name:"Yellow",value:"#FBBF24"},{name:"Red",value:"#EF4444"},{name:"Blue",value:"#3B82F6"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Pink",value:"#EC4899"}];function Tr({patternId:t,projectId:a,currentPage:s=1,currentZoom:C=1,onJumpToBookmark:u}){const[F,j]=r.useState([]),[k,l]=r.useState(!1),[P,p]=r.useState(null),[m,i]=r.useState({name:"",pageNumber:s,notes:"",color:"#FBBF24"});r.useEffect(()=>{v()},[t,a]);const v=async()=>{try{const n=a?{projectId:a}:{},S=await E.get(`/api/patterns/${t}/bookmarks`,{params:n});j(S.data.data.bookmarks)}catch(n){console.error("Error fetching bookmarks:",n)}},d=async()=>{var n,S;if(!m.name.trim()){f.error("Please enter a bookmark name");return}try{await E.post(`/api/patterns/${t}/bookmarks`,{name:m.name,pageNumber:m.pageNumber,zoomLevel:C,notes:m.notes||null,color:m.color,projectId:a||null}),f.success("Bookmark created!"),l(!1),o(),v()}catch(T){console.error("Error creating bookmark:",T),f.error(((S=(n=T.response)==null?void 0:n.data)==null?void 0:S.message)||"Failed to create bookmark")}},y=async()=>{var n,S;if(P)try{await E.put(`/api/patterns/${t}/bookmarks/${P.id}`,{name:m.name,pageNumber:m.pageNumber,notes:m.notes||null,color:m.color}),f.success("Bookmark updated!"),p(null),o(),v()}catch(T){console.error("Error updating bookmark:",T),f.error(((S=(n=T.response)==null?void 0:n.data)==null?void 0:S.message)||"Failed to update bookmark")}},w=async n=>{if(confirm("Delete this bookmark?"))try{await E.delete(`/api/patterns/${t}/bookmarks/${n}`),f.success("Bookmark deleted"),v()}catch(S){console.error("Error deleting bookmark:",S),f.error("Failed to delete bookmark")}},c=async()=>{try{await E.post(`/api/patterns/${t}/bookmarks`,{name:`Page ${s}`,pageNumber:s,zoomLevel:C,color:"#FBBF24",projectId:a||null}),f.success(`Bookmark added for page ${s}!`),v()}catch(n){console.error("Error creating quick bookmark:",n),f.error("Failed to create bookmark")}},o=()=>{i({name:"",pageNumber:s,notes:"",color:"#FBBF24"})},N=()=>{o(),l(!0)},g=n=>{i({name:n.name,pageNumber:n.page_number,notes:n.notes||"",color:n.color}),p(n)};return e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5 text-yellow-400"}),e.jsx("h3",{className:"text-white font-semibold",children:"Bookmarks"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["(",F.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,className:"p-2 bg-gray-600 hover:bg-gray-500 rounded text-white text-sm",title:"Quick bookmark current page",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs("button",{onClick:N,className:"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded text-white text-sm flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"New"]})]})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:F.length===0?e.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"No bookmarks yet"}):F.map(n=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 rounded-lg hover:bg-gray-750 cursor-pointer group",children:[e.jsx("div",{className:"w-1 h-12 rounded-full flex-shrink-0",style:{backgroundColor:n.color}}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>u(n),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-white font-medium truncate",children:n.name}),e.jsx(mt,{className:"h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400",children:[e.jsxs("span",{children:["Page ",n.page_number]}),n.notes&&e.jsx("span",{className:"truncate max-w-xs",children:n.notes})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),g(n)},className:"p-1.5 hover:bg-gray-600 rounded text-blue-400",title:"Edit bookmark",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),w(n.id)},className:"p-1.5 hover:bg-gray-600 rounded text-red-400",title:"Delete bookmark",children:e.jsx(ge,{className:"h-4 w-4"})})]})]},n.id))}),(k||P)&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:P?"Edit Bookmark":"New Bookmark"}),e.jsx("button",{onClick:()=>{l(!1),p(null),o()},className:"text-gray-400 hover:text-white",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Bookmark Name *"}),e.jsx("input",{type:"text",value:m.name,onChange:n=>i({...m,name:n.target.value}),placeholder:"e.g., Current row, Sleeve decreases",className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Page Number"}),e.jsx("input",{type:"number",value:m.pageNumber,onChange:n=>i({...m,pageNumber:parseInt(n.target.value)}),min:1,className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Ia.map(n=>e.jsx("button",{onClick:()=>i({...m,color:n.value}),className:`w-full h-10 rounded border-2 ${m.color===n.value?"border-white":"border-gray-600 hover:border-gray-400"}`,style:{backgroundColor:n.value},title:n.name},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:m.notes,onChange:n=>i({...m,notes:n.target.value}),placeholder:"Additional notes or instructions",rows:3,className:"w-full px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{l(!1),p(null),o()},className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Cancel"}),e.jsx("button",{onClick:P?y:d,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:P?"Update":"Create"})]})]})]})})]})}const tr=[{name:"Yellow",value:"#FBBF24"},{name:"Red",value:"#EF4444"},{name:"Blue",value:"#3B82F6"},{name:"Green",value:"#10B981"},{name:"Purple",value:"#8B5CF6"},{name:"Pink",value:"#EC4899"}];function za({patternId:t,projectId:a,pageNumber:s,isActive:C}){var M,I;const[u,F]=r.useState([]),[j,k]=r.useState(!1),[l,P]=r.useState(null),[p,m]=r.useState(null),[i,v]=r.useState(tr[0].value),[d,y]=r.useState(.3),[w,c]=r.useState(!0),o=r.useRef(null),N=r.useRef(null);r.useEffect(()=>{C&&g()},[t,a,s,C]),r.useEffect(()=>{C&&n()},[u,C]);const g=async()=>{try{const V={pageNumber:s};a&&(V.projectId=a);const J=await E.get(`/api/patterns/${t}/highlights`,{params:V});F(J.data.data.highlights||[])}catch(V){console.error("Error fetching highlights:",V)}},n=()=>{const V=o.current;if(!V)return;const J=V.getContext("2d");J&&(J.clearRect(0,0,V.width,V.height),u.forEach(L=>{J.fillStyle=L.color,J.globalAlpha=L.opacity,J.fillRect(L.coordinates.x,L.coordinates.y,L.coordinates.width,L.coordinates.height)}),p&&(J.fillStyle=i,J.globalAlpha=d,J.fillRect(p.x,p.y,p.width,p.height)),J.globalAlpha=1)},S=V=>{const J=o.current;if(!J)return{x:0,y:0};const L=J.getBoundingClientRect();return{x:V.clientX-L.left,y:V.clientY-L.top}},T=V=>{if(!C)return;const J=S(V);P(J),k(!0)},h=V=>{if(!j||!l)return;const J=S(V),L=J.x-l.x,Z=J.y-l.y;m({x:L<0?J.x:l.x,y:Z<0?J.y:l.y,width:Math.abs(L),height:Math.abs(Z)}),n()},b=async()=>{if(!j||!p){k(!1);return}p.width>5&&p.height>5&&await $(p),k(!1),P(null),m(null)},$=async V=>{try{await E.post(`/api/patterns/${t}/highlights`,{pageNumber:s,coordinates:V,color:i,opacity:d,projectId:a||null}),f.success("Highlight saved!"),g()}catch(J){console.error("Error saving highlight:",J),f.error("Failed to save highlight")}},x=async()=>{if(confirm("Clear all highlights on this page?"))try{await Promise.all(u.map(V=>E.delete(`/api/patterns/${t}/highlights/${V.id}`))),f.success("All highlights cleared"),F([])}catch(V){console.error("Error clearing highlights:",V),f.error("Failed to clear highlights")}};return C?e.jsxs(e.Fragment,{children:[e.jsx("canvas",{ref:o,className:"absolute inset-0 w-full h-full z-30 pointer-events-auto",style:{cursor:j?"crosshair":"default"},width:((M=N.current)==null?void 0:M.clientWidth)||800,height:((I=N.current)==null?void 0:I.clientHeight)||1e3,onMouseDown:T,onMouseMove:h,onMouseUp:b,onMouseLeave:b}),e.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:"Highlighter"}),e.jsx("button",{onClick:()=>c(!w),className:"p-1 hover:bg-gray-700 rounded text-gray-400",children:w?e.jsx(xt,{className:"h-4 w-4"}):e.jsx(et,{className:"h-4 w-4"})})]}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-300 bg-gray-700 rounded p-2",children:e.jsx("p",{children:"Click and drag to highlight"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:tr.map(V=>e.jsx("button",{onClick:()=>v(V.value),className:`h-10 rounded border-2 ${i===V.value?"border-white":"border-gray-600"}`,style:{backgroundColor:V.value},title:V.name},V.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:["Opacity: ",Math.round(d*100),"%"]}),e.jsx("input",{type:"range",min:"0.1",max:"0.6",step:"0.1",value:d,onChange:V=>y(parseFloat(V.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"text-xs text-gray-400 pt-2 border-t border-gray-700",children:[u.length," highlight",u.length!==1?"s":""," on this page"]}),u.length>0&&e.jsxs("button",{onClick:x,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Clear All"]})]})]})]}):null}const rr=[{name:"Yellow",value:"#FBBF24",opacity:.3},{name:"Red",value:"#EF4444",opacity:.3},{name:"Blue",value:"#3B82F6",opacity:.3},{name:"Green",value:"#10B981",opacity:.3},{name:"Purple",value:"#8B5CF6",opacity:.3}];function Oa({pageNumber:t,onPositionChange:a}){const[s,C]=r.useState({x:50,y:50}),[u,F]=r.useState(3),[j,k]=r.useState(!1),[l,P]=r.useState(!1),[p,m]=r.useState(rr[0].value),[i,v]=r.useState(.3),[d,y]=r.useState(!1),[w,c]=r.useState(!0),[o,N]=r.useState(!1),[g,n]=r.useState({x:0,y:0}),S=r.useCallback(x=>{d||(x.preventDefault(),k(!0),n({x:x.clientX-s.x*window.innerWidth/100,y:x.clientY-s.y*window.innerHeight/100}))},[d,s]),T=r.useCallback(x=>{if(!j||d)return;const M=(x.clientX-g.x)/window.innerWidth*100,I=(x.clientY-g.y)/window.innerHeight*100;C({x:Math.max(0,Math.min(100,M)),y:Math.max(0,Math.min(100-u,I))})},[j,d,g,u]),h=r.useCallback(()=>{j&&(k(!1),a==null||a(s)),P(!1)},[j,s,a]),b=r.useCallback(x=>{d||(x.stopPropagation(),P(!0))},[d]),$=r.useCallback(x=>{if(!l||d)return;const M=x.clientY/window.innerHeight*100-s.y;F(Math.max(1,Math.min(20,M)))},[l,d,s.y]);return r.useEffect(()=>{const x=M=>{if(w)switch(M.key){case"ArrowUp":d||(M.preventDefault(),C(I=>({...I,y:Math.max(0,I.y-1)})));break;case"ArrowDown":d||(M.preventDefault(),C(I=>({...I,y:Math.min(100-u,I.y+1)})));break;case"l":case"L":(M.ctrlKey||M.metaKey)&&(M.preventDefault(),y(!d));break;case"h":case"H":(M.ctrlKey||M.metaKey)&&(M.preventDefault(),c(!w));break}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[w,d,u]),r.useEffect(()=>{if(j)return window.addEventListener("mousemove",T),window.addEventListener("mouseup",h),()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",h)}},[j,T,h]),r.useEffect(()=>{if(l)return window.addEventListener("mousemove",$),window.addEventListener("mouseup",h),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",h)}},[l,$,h]),w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed z-40 transition-opacity ${j?"cursor-move":""} ${d?"pointer-events-none":"cursor-move"}`,style:{left:`${s.x}%`,top:`${s.y}%`,width:"90%",height:`${u}%`,backgroundColor:p,opacity:i,transform:"translate(-50%, 0)"},onMouseDown:S,onMouseEnter:()=>!d&&N(!0),onMouseLeave:()=>N(!1),children:[o&&!d&&e.jsxs("div",{className:"absolute top-0 right-0 flex items-center gap-1 bg-gray-900 bg-opacity-90 rounded-bl-lg p-1",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),c(!1)},className:"p-1 hover:bg-gray-700 rounded text-white",title:"Hide marker",children:e.jsx(xt,{className:"h-3 w-3"})}),e.jsx(It,{className:"h-3 w-3 text-white",title:"Drag to move"})]}),!d&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize bg-gray-900 bg-opacity-50 hover:bg-opacity-75",onMouseDown:b,title:"Drag to resize"})]}),e.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-gray-800 rounded-lg shadow-lg p-3 space-y-3 w-64",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:"Row Marker"}),e.jsx("button",{onClick:()=>c(!1),className:"p-1 hover:bg-gray-700 rounded text-gray-400",title:"Hide marker (Ctrl+H)",children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"flex gap-2",children:rr.map(x=>e.jsx("button",{onClick:()=>m(x.value),className:`w-8 h-8 rounded border-2 ${p===x.value?"border-white":"border-gray-600"}`,style:{backgroundColor:x.value},title:x.name},x.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:["Opacity: ",Math.round(i*100),"%"]}),e.jsx("input",{type:"range",min:"0.1",max:"0.8",step:"0.1",value:i,onChange:x=>v(parseFloat(x.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-2",children:["Height: ",u.toFixed(1),"%"]}),e.jsx("input",{type:"range",min:"1",max:"20",step:"0.5",value:u,onChange:x=>F(parseFloat(x.target.value)),className:"w-full"})]}),e.jsxs("button",{onClick:()=>y(!d),className:`w-full px-3 py-2 rounded text-sm font-medium ${d?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:[d?"🔒 Locked":"🔓 Unlocked"," (Ctrl+L)"]}),e.jsxs("div",{className:"text-xs text-gray-400 space-y-1 pt-2 border-t border-gray-700",children:[e.jsx("p",{children:"• Drag marker to move"}),e.jsx("p",{children:"• Drag bottom edge to resize"}),e.jsx("p",{children:"• Arrow keys to fine-tune"}),e.jsx("p",{children:"• Ctrl+L to lock/unlock"}),e.jsx("p",{children:"• Ctrl+H to hide/show"})]})]})]}):e.jsxs("button",{onClick:()=>c(!0),className:"fixed top-20 right-4 z-50 px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg shadow-lg flex items-center gap-2",title:"Show row marker (Ctrl+H)",children:[e.jsx(et,{className:"h-4 w-4"}),"Show Marker"]})}xr.workerSrc="/pdf.worker.min.js";const Me=[.5,.75,1,1.25,1.5,1.75,2];function Rr({fileUrl:t,filename:a,patternId:s,projectId:C,onClose:u,fullscreen:F=!0,initialPage:j,initialZoom:k}){const[l,P]=r.useState(0),[p,m]=r.useState(j||1),[i,v]=r.useState(()=>k?Me.reduce((ie,D,re)=>Math.abs(D-k)<Math.abs(Me[ie]-k)?re:ie,2):2),[d,y]=r.useState(0),[w,c]=r.useState(""),[o,N]=r.useState(!1),[g,n]=r.useState(!1),[S,T]=r.useState(!!s),[h,b]=r.useState(!1),[$,x]=r.useState(!1),M=Me[i];r.useEffect(()=>{j&&j>=1&&j<=l&&m(j)},[j,l]),r.useEffect(()=>{if(k){const H=Me.reduce((ie,D,re)=>Math.abs(D-k)<Math.abs(Me[ie]-k)?re:ie,2);v(H)}},[k]);function I({numPages:H}){P(H),m(1),f.success(`PDF loaded: ${H} pages`)}function V(H){console.error("Error loading PDF:",H),f.error("Failed to load PDF file")}const J=r.useCallback(()=>{i<Me.length-1&&v(H=>H+1)},[i]),L=r.useCallback(()=>{i>0&&v(H=>H-1)},[i]),Z=r.useCallback(()=>{y(H=>(H+90)%360)},[]),ee=r.useCallback(()=>{p<l&&m(H=>H+1)},[p,l]),K=r.useCallback(()=>{p>1&&m(H=>H-1)},[p]),X=r.useCallback(H=>{H>=1&&H<=l&&m(H)},[l]),R=r.useCallback(()=>{document.fullscreenElement?(document.exitFullscreen(),n(!1)):(document.documentElement.requestFullscreen(),n(!0))},[]),te=r.useCallback(H=>{if(m(H.page_number),H.zoom_level){const ie=Me.findIndex(D=>Math.abs(D-H.zoom_level)<.01);ie!==-1&&v(ie)}f.success(`Jumped to: ${H.name}`)},[]);return r.useEffect(()=>{const H=ie=>{switch(ie.key){case"ArrowRight":case"PageDown":ee();break;case"ArrowLeft":case"PageUp":K();break;case"Home":m(1);break;case"End":m(l);break;case"+":case"=":J();break;case"-":L();break;case"f":case"F":(ie.ctrlKey||ie.metaKey)&&(ie.preventDefault(),N(!0));break;case"Escape":N(!1);break}};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[p,l,ee,K,J,L]),r.useEffect(()=>{const H=()=>{n(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",H),()=>document.removeEventListener("fullscreenchange",H)},[]),e.jsxs("div",{className:F?"fixed inset-0 bg-gray-900 z-50 flex flex-col":"bg-gray-900 flex flex-col h-full",children:[e.jsxs("div",{className:"bg-gray-800 text-white p-3 flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"font-semibold text-lg truncate max-w-md",children:a}),e.jsx("span",{className:"text-sm text-gray-400",children:l>0&&`${l} pages`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:K,disabled:p<=1,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous page (←)",children:e.jsx(Mt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:p,onChange:H=>X(parseInt(H.target.value)),className:"w-14 px-2 py-1 bg-gray-600 text-white text-center rounded border-none focus:ring-2 focus:ring-purple-500",min:1,max:l}),e.jsxs("span",{className:"text-gray-400",children:["/ ",l]})]}),e.jsx("button",{onClick:ee,disabled:p>=l,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Next page (→)",children:e.jsx(mt,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:L,disabled:i<=0,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom out (-)",children:e.jsx(Dt,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-sm font-medium w-12 text-center",children:[Math.round(M*100),"%"]}),e.jsx("button",{onClick:J,disabled:i>=Me.length-1,className:"p-1 hover:bg-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom in (+)",children:e.jsx(ot,{className:"h-5 w-5"})})]}),e.jsx("button",{onClick:Z,className:"p-2 hover:bg-gray-700 rounded-lg",title:"Rotate clockwise",children:e.jsx(gt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>N(!o),className:`p-2 hover:bg-gray-700 rounded-lg ${o?"bg-gray-700":""}`,title:"Search (Ctrl+F)",children:e.jsx(Oe,{className:"h-5 w-5"})}),s&&e.jsx("button",{onClick:()=>T(!S),className:`p-2 hover:bg-gray-700 rounded-lg ${S?"bg-gray-700":""}`,title:"Bookmarks",children:e.jsx(ut,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>b(!h),className:`p-2 hover:bg-gray-700 rounded-lg ${h?"bg-gray-700":""}`,title:"Row marker",children:e.jsx(It,{className:"h-5 w-5"})}),s&&e.jsx("button",{onClick:()=>x(!$),className:`p-2 hover:bg-gray-700 rounded-lg ${$?"bg-gray-700":""}`,title:"Highlighter",children:e.jsx(We,{className:"h-5 w-5"})}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-700 rounded-lg",title:"Toggle fullscreen",children:e.jsx(ks,{className:"h-5 w-5"})}),u&&e.jsx("button",{onClick:u,className:"p-2 hover:bg-gray-700 rounded-lg ml-2",title:"Close viewer (Esc)",children:e.jsx(xe,{className:"h-5 w-5"})})]})]}),o&&e.jsx("div",{className:"bg-gray-800 border-t border-gray-700 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3 max-w-md",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",value:w,onChange:H=>c(H.target.value),placeholder:"Search in document...",className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border-none focus:ring-2 focus:ring-purple-500",autoFocus:!0})}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-gray-700 rounded-lg text-white",children:e.jsx(xe,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[S&&s&&e.jsx("div",{className:"w-80 flex-shrink-0 border-r border-gray-700 overflow-y-auto",children:e.jsx(Tr,{patternId:s,projectId:C,currentPage:p,currentZoom:M,onJumpToBookmark:te})}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-800 p-4",children:e.jsx("div",{className:"flex justify-center min-h-full",children:e.jsx(gr,{file:t,onLoadSuccess:I,onLoadError:V,loading:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-white text-lg",children:"Loading PDF..."})}),error:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-red-500 text-lg",children:"Failed to load PDF"})}),children:e.jsx(hr,{pageNumber:p,scale:M,rotate:d,renderTextLayer:!0,renderAnnotationLayer:!0,className:"shadow-2xl",loading:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-white",children:"Loading page..."})})})})})})]}),e.jsxs("div",{className:"md:hidden bg-gray-800 text-white text-center py-2 border-t border-gray-700",children:["Page ",p," of ",l]}),h&&e.jsx(Oa,{pageNumber:p}),$&&s&&e.jsx(za,{patternId:s,projectId:C,pageNumber:p,isActive:$})]})}const Mr=()=>{const[t,a]=r.useState([]),[s,C]=r.useState([]),[u,F]=r.useState(!1),[j,k]=r.useState("Pattern"),[l,P]=r.useState(!1),[p,m]=r.useState(null),[i,v]=r.useState(null);r.useEffect(()=>{d()},[]);const d=async()=>{try{const n=await E.get("/api/patterns");n.data.success&&a(n.data.data.patterns)}catch(n){console.error("Failed to fetch patterns:",n),v("Failed to load patterns")}},y=n=>{C(S=>S.includes(n)?S.filter(T=>T!==n):[...S,n])},w=n=>{if(n===0)return;const S=[...s];[S[n-1],S[n]]=[S[n],S[n-1]],C(S)},c=n=>{if(n===s.length-1)return;const S=[...s];[S[n],S[n+1]]=[S[n+1],S[n]],C(S)},o=async()=>{var n,S;if(s.length===0){v("Please select at least one pattern");return}P(!0),v(null),m(null);try{const T=await E.post("/api/patterns/collate",{patternIds:s,addDividers:u,dividerText:j});T.data.success&&m(T.data.data.collation)}catch(T){console.error("Failed to collate patterns:",T),v(((S=(n=T.response)==null?void 0:n.data)==null?void 0:S.message)||"Failed to merge PDFs")}finally{P(!1)}},N=n=>{const S=t.find(T=>T.id===n);return(S==null?void 0:S.name)||"Unknown Pattern"},g=n=>n<1024?n+" B":n<1024*1024?(n/1024).toFixed(2)+" KB":(n/(1024*1024)).toFixed(2)+" MB";return e.jsxs("div",{className:"pdf-collation",children:[e.jsxs("div",{className:"collation-header",children:[e.jsx("h2",{children:"Merge Pattern PDFs"}),e.jsx("p",{className:"description",children:"Select multiple patterns to merge into a single PDF file"})]}),i&&e.jsx("div",{className:"error-message",role:"alert",children:i}),e.jsxs("div",{className:"collation-content",children:[e.jsxs("div",{className:"pattern-selection",children:[e.jsx("h3",{children:"Available Patterns"}),e.jsx("div",{className:"pattern-list",children:t.map(n=>e.jsxs("div",{className:`pattern-item ${s.includes(n.id)?"selected":""}`,onClick:()=>y(n.id),children:[e.jsx("input",{type:"checkbox",checked:s.includes(n.id),onChange:()=>y(n.id),onClick:S=>S.stopPropagation()}),e.jsxs("div",{className:"pattern-info",children:[e.jsx("div",{className:"pattern-name",children:n.name}),n.designer&&e.jsxs("div",{className:"pattern-designer",children:["by ",n.designer]}),n.category&&e.jsx("span",{className:"pattern-category",children:n.category})]})]},n.id))})]}),s.length>0&&e.jsxs("div",{className:"selected-patterns",children:[e.jsxs("h3",{children:["Merge Order (",s.length," patterns)"]}),e.jsx("div",{className:"pattern-order-list",children:s.map((n,S)=>e.jsxs("div",{className:"pattern-order-item",children:[e.jsxs("span",{className:"order-number",children:[S+1,"."]}),e.jsx("span",{className:"pattern-name",children:N(n)}),e.jsxs("div",{className:"order-controls",children:[e.jsx("button",{onClick:()=>w(S),disabled:S===0,className:"btn-icon","aria-label":"Move up",children:"↑"}),e.jsx("button",{onClick:()=>c(S),disabled:S===s.length-1,className:"btn-icon","aria-label":"Move down",children:"↓"}),e.jsx("button",{onClick:()=>y(n),className:"btn-icon btn-remove","aria-label":"Remove",children:"×"})]})]},n))})]}),e.jsxs("div",{className:"collation-options",children:[e.jsx("h3",{children:"Options"}),e.jsx("div",{className:"option",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:u,onChange:n=>F(n.target.checked)}),"Add divider pages between patterns"]})}),u&&e.jsx("div",{className:"option",children:e.jsxs("label",{children:["Divider text:",e.jsx("input",{type:"text",value:j,onChange:n=>k(n.target.value),placeholder:"Pattern",maxLength:255})]})})]}),e.jsxs("div",{className:"collation-actions",children:[e.jsx("button",{onClick:o,disabled:l||s.length===0,className:"btn-primary",children:l?"Merging PDFs...":"Merge PDFs"}),s.length>0&&e.jsx("button",{onClick:()=>C([]),className:"btn-secondary",disabled:l,children:"Clear Selection"})]}),p&&e.jsxs("div",{className:"collation-result",children:[e.jsx("h3",{children:"✓ PDF Merged Successfully!"}),e.jsxs("div",{className:"result-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Patterns merged:"})," ",p.patternCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total pages:"})," ",p.pageCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"File size:"})," ",g(p.fileSize)]})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("a",{href:p.fileUrl,download:!0,className:"btn-primary",target:"_blank",rel:"noopener noreferrer",children:"Download Merged PDF"}),e.jsx("button",{onClick:()=>{m(null),C([])},className:"btn-secondary",children:"Merge More Patterns"})]})]})]}),e.jsx("style",{children:`
        .pdf-collation {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
        }

        .collation-header {
          margin-bottom: 30px;
        }

        .collation-header h2 {
          font-size: 24px;
          font-weight: 600;
          margin-bottom: 8px;
        }

        .description {
          color: #6b7280;
          font-size: 14px;
        }

        .error-message {
          background-color: #fef2f2;
          border: 1px solid #fecaca;
          color: #991b1b;
          padding: 12px 16px;
          border-radius: 6px;
          margin-bottom: 20px;
        }

        .collation-content {
          display: grid;
          gap: 30px;
        }

        .pattern-selection h3,
        .selected-patterns h3,
        .collation-options h3 {
          font-size: 18px;
          font-weight: 600;
          margin-bottom: 16px;
        }

        .pattern-list {
          display: grid;
          gap: 12px;
          max-height: 400px;
          overflow-y: auto;
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
        }

        .pattern-item {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          padding: 12px;
          border: 2px solid #e5e7eb;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.2s;
        }

        .pattern-item:hover {
          border-color: #3b82f6;
          background-color: #eff6ff;
        }

        .pattern-item.selected {
          border-color: #3b82f6;
          background-color: #dbeafe;
        }

        .pattern-item input[type='checkbox'] {
          margin-top: 2px;
          width: 18px;
          height: 18px;
          cursor: pointer;
        }

        .pattern-info {
          flex: 1;
        }

        .pattern-name {
          font-weight: 500;
          margin-bottom: 4px;
        }

        .pattern-designer {
          font-size: 14px;
          color: #6b7280;
          margin-bottom: 4px;
        }

        .pattern-category {
          display: inline-block;
          font-size: 12px;
          padding: 2px 8px;
          background-color: #f3f4f6;
          border-radius: 4px;
          color: #4b5563;
        }

        .pattern-order-list {
          display: grid;
          gap: 8px;
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
        }

        .pattern-order-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 10px 12px;
          background-color: #f9fafb;
          border-radius: 6px;
        }

        .order-number {
          font-weight: 600;
          color: #6b7280;
          min-width: 30px;
        }

        .pattern-order-item .pattern-name {
          flex: 1;
        }

        .order-controls {
          display: flex;
          gap: 4px;
        }

        .btn-icon {
          width: 32px;
          height: 32px;
          border: 1px solid #d1d5db;
          background-color: white;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        }

        .btn-icon:hover:not(:disabled) {
          background-color: #f3f4f6;
          border-color: #9ca3af;
        }

        .btn-icon:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-icon.btn-remove {
          color: #dc2626;
          font-size: 24px;
        }

        .btn-icon.btn-remove:hover:not(:disabled) {
          background-color: #fef2f2;
          border-color: #fca5a5;
        }

        .collation-options {
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 20px;
        }

        .option {
          margin-bottom: 16px;
        }

        .option:last-child {
          margin-bottom: 0;
        }

        .option label {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 14px;
        }

        .option input[type='checkbox'] {
          width: 18px;
          height: 18px;
          cursor: pointer;
        }

        .option input[type='text'] {
          margin-left: 8px;
          padding: 6px 12px;
          border: 1px solid #d1d5db;
          border-radius: 4px;
          font-size: 14px;
        }

        .collation-actions {
          display: flex;
          gap: 12px;
        }

        .btn-primary,
        .btn-secondary {
          padding: 12px 24px;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
          border: none;
          font-size: 14px;
        }

        .btn-primary {
          background-color: #3b82f6;
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          background-color: #2563eb;
        }

        .btn-primary:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: white;
          color: #374151;
          border: 1px solid #d1d5db;
        }

        .btn-secondary:hover:not(:disabled) {
          background-color: #f9fafb;
        }

        .collation-result {
          background-color: #f0fdf4;
          border: 2px solid #86efac;
          border-radius: 8px;
          padding: 24px;
        }

        .collation-result h3 {
          color: #166534;
          font-size: 20px;
          margin-bottom: 16px;
        }

        .result-info {
          margin-bottom: 20px;
        }

        .result-info p {
          margin-bottom: 8px;
          font-size: 14px;
          color: #166534;
        }

        .result-actions {
          display: flex;
          gap: 12px;
        }

        .result-actions a {
          text-decoration: none;
        }

        @media (max-width: 768px) {
          .pdf-collation {
            padding: 16px;
          }

          .collation-header h2 {
            font-size: 20px;
          }

          .collation-actions {
            flex-direction: column;
          }

          .result-actions {
            flex-direction: column;
          }

          .btn-primary,
          .btn-secondary {
            width: 100%;
          }
        }
      `})]})},Ba=({chartData:t,symbols:a,rows:s,cols:C,title:u,isInTheRound:F=!1})=>{const[j,k]=r.useState(1),[l,P]=r.useState(0),[p,m]=r.useState({x:0,y:0}),[i,v]=r.useState(!1),[d,y]=r.useState({x:0,y:0}),[w,c]=r.useState(!0),[o,N]=r.useState(null),[g,n]=r.useState(null),[S,T]=r.useState(null),[h,b]=r.useState({width:800,height:600}),[$,x]=r.useState(null),[M,I]=r.useState([{zoom:1,rotation:0,pan:{x:0,y:0}}]),[V,J]=r.useState(0),L=r.useRef(null),Z=r.useRef(null),ee=40,K=60;r.useEffect(()=>{const q=()=>{if(Z.current){const ne=Z.current.getBoundingClientRect();b({width:Math.max(600,ne.width),height:Math.max(400,ne.height-80)})}};q();const U=new ResizeObserver(q);return Z.current&&U.observe(Z.current),()=>U.disconnect()},[]),r.useEffect(()=>{const q=U=>{if(!(U.target instanceof HTMLInputElement||U.target instanceof HTMLTextAreaElement))switch(U.key){case"ArrowUp":if(U.preventDefault(),g){const ne=Math.min(s,g.row+1);n({...g,row:ne}),N(ne)}break;case"ArrowDown":if(U.preventDefault(),g){const ne=Math.max(1,g.row-1);n({...g,row:ne}),N(ne)}break;case"ArrowLeft":if(U.preventDefault(),g){const ne=Math.max(0,g.col-1);n({...g,col:ne})}break;case"ArrowRight":if(U.preventDefault(),g){const ne=Math.min(C-1,g.col+1);n({...g,col:ne})}break;case"+":case"=":U.preventDefault(),Q();break;case"-":case"_":U.preventDefault(),le();break;case"Home":U.preventDefault(),g&&(n({row:s,col:0}),N(s));break;case"End":U.preventDefault(),g&&(n({row:1,col:C-1}),N(1));break;case"Escape":U.preventDefault(),n(null),N(null);break}};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[g,s,C]);const X=r.useCallback(()=>{const q={zoom:j,rotation:l,pan:p},U=M.slice(0,V+1);U.push(q),I(U),J(U.length-1)},[j,l,p,M,V]),R=()=>{if(V>0){const q=V-1,U=M[q];k(U.zoom),P(U.rotation),m(U.pan),J(q)}},te=()=>{if(V<M.length-1){const q=V+1,U=M[q];k(U.zoom),P(U.rotation),m(U.pan),J(q)}};r.useEffect(()=>{H()},[t,j,l,p,o,g,S,h]);const H=(q,U=!1)=>{const ne=q||L.current;if(!ne)return;const ae=ne.getContext("2d");if(!ae)return;const Ce=U?C*ee+K*2:ne.width,Se=U?s*ee+K*2:ne.height;U&&(ne.width=Ce,ne.height=Se),ae.clearRect(0,0,Ce,Se),ae.save(),U||(ae.translate(Ce/2+p.x,Se/2+p.y),ae.scale(j,j),ae.rotate(l*Math.PI/180),ae.translate(-Ce/2,-Se/2));const Pe=C*ee,Ie=s*ee,ve=(Ce-Pe)/2,we=(Se-Ie)/2;ae.strokeStyle="#e5e7eb",ae.lineWidth=1;for(let oe=0;oe<=s;oe++)ae.beginPath(),ae.moveTo(ve,we+oe*ee),ae.lineTo(ve+Pe,we+oe*ee),ae.stroke();for(let oe=0;oe<=C;oe++)ae.beginPath(),ae.moveTo(ve+oe*ee,we),ae.lineTo(ve+oe*ee,we+Ie),ae.stroke();ae.fillStyle="#6b7280",ae.font="bold 12px Arial",ae.textAlign="right",ae.textBaseline="middle";for(let oe=0;oe<s;oe++){const pe=s-oe,_e=we+oe*ee+ee/2;F&&pe%2===0?ae.fillStyle="#3b82f6":ae.fillStyle="#6b7280",ae.fillText(pe.toString(),ve-10,_e)}ae.textAlign="center",ae.textBaseline="top",ae.fillStyle="#6b7280";for(let oe=0;oe<C;oe++){const pe=ve+oe*ee+ee/2;ae.fillText((oe+1).toString(),pe,we-20)}if(S!==null&&!U){ae.fillStyle="rgba(34, 197, 94, 0.15)";const oe=s-S;ae.fillRect(ve,we+oe*ee,Pe,ee),ae.fillStyle="#22c55e",ae.beginPath(),ae.moveTo(ve-5,we+oe*ee+ee/2-6),ae.lineTo(ve-5,we+oe*ee+ee/2+6),ae.lineTo(ve-15,we+oe*ee+ee/2),ae.fill()}if(o!==null&&!U){ae.fillStyle="rgba(59, 130, 246, 0.2)";const oe=s-o;ae.fillRect(ve,we+oe*ee,Pe,ee)}if(g&&!U){ae.strokeStyle="#22c55e",ae.lineWidth=3;const oe=s-g.row;ae.strokeRect(ve+g.col*ee,we+oe*ee,ee,ee)}ae.textAlign="center",ae.textBaseline="middle",ae.font="20px Arial",t.forEach(oe=>{const pe=a.find(bt=>bt.id===oe.symbol),_e=s-oe.row,Re=ve+oe.col*ee+ee/2,pt=we+_e*ee+ee/2;pe&&(ae.fillStyle=pe.color||"#000000",ae.fillText(pe.symbol,Re,pt))}),ae.restore()},ie=q=>{q.preventDefault();const U=q.deltaY>0?-.1:.1,ne=Math.max(.5,Math.min(3,j+U));k(ne)},D=q=>{if(q.length<2)return 0;const U=q[0].clientX-q[1].clientX,ne=q[0].clientY-q[1].clientY;return Math.sqrt(U*U+ne*ne)},re=q=>{if(q.touches.length===1)v(!0),y({x:q.touches[0].clientX-p.x,y:q.touches[0].clientY-p.y});else if(q.touches.length===2){const U=D(q.touches),ne=(q.touches[0].clientX+q.touches[1].clientX)/2,ae=(q.touches[0].clientY+q.touches[1].clientY)/2;x({x:ne,y:ae,dist:U})}},se=q=>{if(q.preventDefault(),q.touches.length===1&&i)m({x:q.touches[0].clientX-d.x,y:q.touches[0].clientY-d.y});else if(q.touches.length===2&&$){const U=D(q.touches),ne=U/$.dist,ae=Math.max(.5,Math.min(3,j*ne));k(ae),x({...$,dist:U})}},A=()=>{v(!1),x(null),X()},G=q=>{v(!0),y({x:q.clientX-p.x,y:q.clientY-p.y})},Y=q=>{i&&m({x:q.clientX-d.x,y:q.clientY-d.y})},z=()=>{i&&X(),v(!1)},O=q=>{if(i)return;const U=L.current;if(!U)return;const ne=U.getBoundingClientRect(),ae=q.clientX-ne.left,Ce=q.clientY-ne.top,Se=C*ee,Pe=s*ee,Ie=(U.width-Se)/2,ve=(U.height-Pe)/2,we=(ae-p.x-U.width/2)/j+U.width/2,oe=(Ce-p.y-U.height/2)/j+U.height/2,pe=Math.floor((we-Ie)/ee),_e=Math.floor((oe-ve)/ee),Re=s-_e;pe>=0&&pe<C&&Re>0&&Re<=s?(n({row:Re,col:pe}),N(Re)):(n(null),N(null))},Q=()=>{const q=Math.min(3,j+.2);k(q),X()},le=()=>{const q=Math.max(.5,j-.2);k(q),X()},me=()=>{const q=(l+90)%360;P(q),X()},fe=()=>{k(1),m({x:0,y:0}),P(0),N(null),n(null),X()},Te=()=>{const q=L.current;if(!q)return;const U=document.createElement("a");U.download=`${u||"chart"}.png`,U.href=q.toDataURL("image/png"),U.click()},B=()=>{const q=document.createElement("canvas");H(q,!0);const U=window.open("","_blank");U&&(U.document.write(`
      <html>
        <head>
          <title>${u||"Knitting Chart"}</title>
          <style>
            body { margin: 0; padding: 20px; }
            img { max-width: 100%; height: auto; }
            h1 { font-family: Arial, sans-serif; margin-bottom: 20px; }
            @media print {
              body { padding: 0; }
              h1 { page-break-after: avoid; }
            }
          </style>
        </head>
        <body>
          <h1>${u||"Knitting Chart"}</h1>
          <img src="${q.toDataURL()}" />
        </body>
      </html>
    `),U.document.close(),setTimeout(()=>{U.print()},250))},de=()=>{S===null?T(1):S<s&&T(S+1)},ye=()=>{S!==null&&S>1&&T(S-1)};return e.jsxs("div",{className:"chart-viewer",ref:Z,children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[u&&e.jsx("h2",{className:"chart-title",children:u}),S&&e.jsxs("div",{className:"current-row-indicator",children:[e.jsx("span",{className:"current-row-label",children:"Current Row:"}),e.jsx("span",{className:"current-row-number",children:S})]})]}),e.jsxs("div",{className:"chart-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("button",{onClick:le,className:"control-btn",title:"Zoom Out (-)","aria-label":"Zoom out",children:e.jsx(Dt,{})}),e.jsxs("span",{className:"zoom-level",children:[Math.round(j*100),"%"]}),e.jsx("button",{onClick:Q,className:"control-btn",title:"Zoom In (+)","aria-label":"Zoom in",children:e.jsx(ot,{})})]}),F&&e.jsx("button",{onClick:me,className:"control-btn",title:"Rotate Chart","aria-label":"Rotate chart",children:e.jsx(gt,{})}),e.jsxs("div",{className:"control-group",children:[e.jsx("button",{onClick:ye,className:"control-btn",title:"Previous Row",disabled:S===null||S===1,"aria-label":"Previous row",children:e.jsx(Mt,{})}),e.jsx("button",{onClick:de,className:"control-btn",title:"Next Row",disabled:S===s,"aria-label":"Next row",children:e.jsx(mt,{})}),S&&e.jsx("button",{onClick:()=>T(null),className:"control-btn active",title:"Clear Current Row","aria-label":"Clear current row",children:e.jsx(dt,{})})]}),e.jsx("button",{onClick:()=>c(!w),className:`control-btn ${w?"active":""}`,title:"Toggle Legend","aria-label":"Toggle legend",children:e.jsx(Cs,{})}),e.jsx("button",{onClick:Te,className:"control-btn",title:"Export to PNG","aria-label":"Export to PNG",children:e.jsx(Ae,{})}),e.jsx("button",{onClick:B,className:"control-btn",title:"Print Chart","aria-label":"Print chart",children:e.jsx(Ss,{})}),e.jsxs("div",{className:"control-group",children:[e.jsx("button",{onClick:R,className:"control-btn-text",disabled:V===0,title:"Undo (Ctrl+Z)",children:"Undo"}),e.jsx("button",{onClick:te,className:"control-btn-text",disabled:V===M.length-1,title:"Redo (Ctrl+Y)",children:"Redo"})]}),e.jsx("button",{onClick:fe,className:"control-btn-text",children:"Reset View"})]})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("canvas",{ref:L,width:h.width,height:h.height,onWheel:ie,onMouseDown:G,onMouseMove:Y,onMouseUp:z,onMouseLeave:z,onClick:O,onTouchStart:re,onTouchMove:se,onTouchEnd:A,style:{cursor:i?"grabbing":"grab",touchAction:"none"},tabIndex:0,role:"img","aria-label":"Interactive knitting chart"}),w&&e.jsxs("div",{className:"symbol-legend",role:"complementary","aria-label":"Symbol legend",children:[e.jsx("h3",{className:"legend-title",children:"Symbol Legend"}),e.jsx("div",{className:"legend-items",children:a.map(q=>e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-symbol",style:{color:q.color||"#000000"},"aria-hidden":"true",children:q.symbol}),e.jsxs("div",{className:"legend-info",children:[e.jsx("div",{className:"legend-name",children:q.name}),e.jsx("div",{className:"legend-description",children:q.description})]})]},q.id))})]}),g&&e.jsxs("div",{className:"chart-info",role:"status","aria-live":"polite",children:[e.jsx("strong",{children:"Selected:"})," Row ",g.row,", Stitch ",g.col+1]}),e.jsx("div",{className:"keyboard-hint",role:"note",children:e.jsx("small",{children:"Keyboard: Arrow keys to navigate • +/- to zoom • Esc to deselect"})})]}),e.jsx("style",{children:`
        .chart-viewer {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          min-height: 500px;
        }

        .chart-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 16px;
          background-color: #f9fafb;
          border-bottom: 1px solid #e5e7eb;
          flex-wrap: wrap;
          gap: 12px;
        }

        .chart-title-section {
          display: flex;
          align-items: center;
          gap: 16px;
        }

        .chart-title {
          font-size: 20px;
          font-weight: 600;
          color: #111827;
          margin: 0;
        }

        .current-row-indicator {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 6px 12px;
          background-color: #22c55e;
          color: white;
          border-radius: 6px;
          font-size: 14px;
          font-weight: 500;
        }

        .current-row-label {
          opacity: 0.9;
        }

        .current-row-number {
          font-size: 18px;
          font-weight: 700;
        }

        .chart-controls {
          display: flex;
          gap: 8px;
          align-items: center;
          flex-wrap: wrap;
        }

        .control-group {
          display: flex;
          gap: 4px;
          align-items: center;
          padding: 0 4px;
          border-left: 1px solid #d1d5db;
        }

        .control-group:first-child {
          border-left: none;
          padding-left: 0;
        }

        .control-btn {
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
          border: 1px solid #d1d5db;
          background-color: white;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.2s;
          color: #374151;
        }

        .control-btn:hover:not(:disabled) {
          background-color: #f3f4f6;
          border-color: #9ca3af;
        }

        .control-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .control-btn.active {
          background-color: #3b82f6;
          color: white;
          border-color: #3b82f6;
        }

        .control-btn-text {
          padding: 8px 12px;
          border: 1px solid #d1d5db;
          background-color: white;
          border-radius: 6px;
          cursor: pointer;
          font-size: 13px;
          font-weight: 500;
          transition: all 0.2s;
          color: #374151;
        }

        .control-btn-text:hover:not(:disabled) {
          background-color: #f3f4f6;
          border-color: #9ca3af;
        }

        .control-btn-text:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .zoom-level {
          font-size: 13px;
          font-weight: 500;
          color: #4b5563;
          min-width: 45px;
          text-align: center;
        }

        .chart-container {
          position: relative;
          flex: 1;
          background-color: #ffffff;
          overflow: hidden;
        }

        canvas {
          display: block;
          width: 100%;
          height: 100%;
        }

        canvas:focus {
          outline: 2px solid #3b82f6;
          outline-offset: -2px;
        }

        .symbol-legend {
          position: absolute;
          top: 16px;
          right: 16px;
          background-color: white;
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
          max-width: 300px;
          max-height: calc(100% - 80px);
          overflow-y: auto;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .legend-title {
          font-size: 16px;
          font-weight: 600;
          margin: 0 0 12px 0;
          color: #111827;
        }

        .legend-items {
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .legend-item {
          display: flex;
          gap: 12px;
          align-items: flex-start;
        }

        .legend-symbol {
          font-size: 24px;
          font-weight: bold;
          min-width: 32px;
          text-align: center;
        }

        .legend-info {
          flex: 1;
        }

        .legend-name {
          font-weight: 500;
          font-size: 14px;
          color: #111827;
          margin-bottom: 2px;
        }

        .legend-description {
          font-size: 12px;
          color: #6b7280;
        }

        .chart-info {
          position: absolute;
          bottom: 50px;
          left: 50%;
          transform: translateX(-50%);
          background-color: rgba(17, 24, 39, 0.9);
          color: white;
          padding: 8px 16px;
          border-radius: 6px;
          font-size: 14px;
          pointer-events: none;
          white-space: nowrap;
        }

        .keyboard-hint {
          position: absolute;
          bottom: 16px;
          left: 50%;
          transform: translateX(-50%);
          background-color: rgba(249, 250, 251, 0.95);
          color: #6b7280;
          padding: 6px 12px;
          border-radius: 6px;
          font-size: 12px;
          pointer-events: none;
          border: 1px solid #e5e7eb;
        }

        @media print {
          .chart-header,
          .chart-controls,
          .symbol-legend,
          .chart-info,
          .keyboard-hint {
            display: none !important;
          }

          .chart-viewer {
            height: auto;
          }

          canvas {
            width: 100% !important;
            height: auto !important;
          }
        }

        @media (max-width: 768px) {
          .chart-header {
            flex-direction: column;
            align-items: stretch;
          }

          .chart-title-section {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
          }

          .chart-controls {
            justify-content: center;
            flex-wrap: wrap;
          }

          .control-group {
            border-left: none;
            padding: 0;
          }

          .symbol-legend {
            position: static;
            max-width: 100%;
            margin: 16px;
            max-height: 300px;
          }

          .keyboard-hint {
            display: none;
          }
        }
      `})]})};function Ua(){const t=Ue(),[a,s]=r.useState([]),[C,u]=r.useState(!0),[F,j]=r.useState(!1),[k,l]=r.useState(!1),[P,p]=r.useState(!1),[m,i]=r.useState(null),[v,d]=r.useState([]),[y,w]=r.useState(!1),[c,o]=r.useState(null),[N,g]=r.useState(""),[n,S]=r.useState("all"),[T,h]=r.useState("all"),[b,$]=r.useState({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"});r.useEffect(()=>{x()},[]);const x=async()=>{try{const R=await E.get("/api/patterns");s(R.data.data.patterns)}catch(R){console.error("Error fetching patterns:",R),f.error("Failed to load patterns")}finally{u(!1)}},M=async R=>{var te,H;R.preventDefault(),w(!0);try{const D=(await E.post("/api/patterns",b)).data.data.pattern;if(f.success("Pattern created!"),v.length>0){let re=0;for(const se of v)try{const A=new FormData;A.append("file",se),await E.post(`/api/uploads/patterns/${D.id}/files`,A,{headers:{"Content-Type":"multipart/form-data"}}),re++}catch(A){console.error(`Failed to upload ${se.name}:`,A)}re===v.length?f.success(`Pattern created with ${re} PDF${re>1?"s":""}!`):f.warning(`Pattern created but only ${re}/${v.length} files uploaded`)}j(!1),$({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"}),d([]),x()}catch(ie){console.error("Error creating pattern:",ie),f.error(((H=(te=ie.response)==null?void 0:te.data)==null?void 0:H.message)||"Failed to create pattern")}finally{w(!1)}},I=R=>{i(R),$({name:R.name||"",description:R.description||"",designer:R.designer||"",difficulty:R.difficulty||"intermediate",category:R.category||"sweater"}),l(!0)},V=async R=>{var te,H;if(R.preventDefault(),!!m)try{await E.put(`/api/patterns/${m.id}`,b),f.success("Pattern updated successfully!"),l(!1),i(null),$({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"}),x()}catch(ie){console.error("Error updating pattern:",ie),f.error(((H=(te=ie.response)==null?void 0:te.data)==null?void 0:H.message)||"Failed to update pattern")}},J=async(R,te)=>{if(!c&&confirm(`Are you sure you want to delete "${te}"?`)){o(R);try{await E.delete(`/api/patterns/${R}`),f.success("Pattern deleted successfully"),x()}catch(H){console.error("Error deleting pattern:",H),f.error("Failed to delete pattern")}finally{o(null)}}},L=R=>{switch(R){case"beginner":return"bg-green-100 text-green-800";case"intermediate":return"bg-yellow-100 text-yellow-800";case"advanced":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},Z=r.useMemo(()=>a.filter(R=>{var re,se,A;const te=N.toLowerCase(),H=!N||R.name.toLowerCase().includes(te)||((re=R.description)==null?void 0:re.toLowerCase().includes(te))||((se=R.designer)==null?void 0:se.toLowerCase().includes(te))||((A=R.category)==null?void 0:A.toLowerCase().includes(te)),ie=n==="all"||R.difficulty===n,D=T==="all"||R.category===T;return H&&ie&&D}),[a,N,n,T]),ee=r.useMemo(()=>{const R=new Set(a.map(te=>te.category).filter(Boolean));return Array.from(R).sort()},[a]),K=()=>{g(""),S("all"),h("all")},X=N||n!=="all"||T!=="all";return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading patterns..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Patterns"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your knitting pattern library"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",disabled:a.length===0,children:[e.jsx(ze,{className:"mr-2"}),"Merge PDFs"]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"New Pattern"]})]})]}),a.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search patterns, designers...",value:N,onChange:R=>g(R.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("select",{value:n,onChange:R=>S(R.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]}),e.jsxs("select",{value:T,onChange:R=>h(R.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Categories"}),ee.map(R=>e.jsx("option",{value:R,children:R.charAt(0).toUpperCase()+R.slice(1)},R))]}),X&&e.jsxs("button",{onClick:K,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx(xe,{className:"mr-2"}),"Clear"]})]}),X&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Showing ",Z.length," of ",a.length," patterns"]})]}),a.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(ze,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No patterns yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start building your pattern library"}),e.jsxs("button",{onClick:()=>j(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Your First Pattern"]})]}):Z.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(Oe,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No matching patterns"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Try adjusting your search or filters"}),e.jsxs("button",{onClick:K,className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(xe,{className:"mr-2"}),"Clear Filters"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Z.map(R=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition",children:[e.jsxs("div",{onClick:()=>t(`/patterns/${R.id}`),className:"cursor-pointer p-6 pb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1 hover:text-purple-600 transition",children:R.name}),R.difficulty&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${L(R.difficulty)}`,children:R.difficulty})]}),R.designer&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["by ",R.designer]}),R.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:R.description}),R.category&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Category: ",R.category]})]}),e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:te=>{te.stopPropagation(),t(`/patterns/${R.id}/builder`)},className:"flex-1 px-3 py-2 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition flex items-center justify-center text-sm",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Edit Pattern"]}),e.jsx("button",{onClick:te=>{te.stopPropagation(),I(R)},className:"px-3 py-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 transition flex items-center justify-center text-sm",title:"Edit pattern details",children:e.jsx(zt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:te=>{te.stopPropagation(),J(R.id,R.name)},disabled:c===R.id,className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete pattern",children:c===R.id?e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-red-600 border-t-transparent inline-block"}):e.jsx(ge,{className:"h-4 w-4"})})]})})]},R.id))}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add New Pattern"})}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:R=>$({...b,name:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Classic Raglan Sweater",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:b.designer,onChange:R=>$({...b,designer:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Pattern designer name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:b.difficulty,onChange:R=>$({...b,difficulty:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:b.category,onChange:R=>$({...b,category:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:R=>$({...b,description:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Pattern details, notes, etc."})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern PDF Files (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Upload one or more PDF files for this pattern"}),e.jsx("input",{type:"file",accept:".pdf,application/pdf",multiple:!0,onChange:R=>{R.target.files&&d(Array.from(R.target.files))},disabled:y,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed"}),v.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Selected files (",v.length,"):"]}),v.map((R,te)=>e.jsxs("div",{className:"text-sm text-gray-600 flex items-center justify-between bg-gray-50 px-3 py-2 rounded",children:[e.jsx("span",{children:R.name}),e.jsxs("span",{className:"text-gray-500",children:["(",(R.size/1024/1024).toFixed(2)," MB)"]})]},te))]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{j(!1),d([])},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",disabled:y,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:y,children:y?"Creating & Uploading...":"Add Pattern"})]})]})]})}),k&&m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Pattern"})}),e.jsxs("form",{onSubmit:V,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:R=>$({...b,name:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Classic Raglan Sweater",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:b.designer,onChange:R=>$({...b,designer:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Pattern designer name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:b.difficulty,onChange:R=>$({...b,difficulty:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:b.category,onChange:R=>$({...b,category:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:R=>$({...b,description:R.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Pattern details, notes, etc."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{l(!1),i(null),$({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater"})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Pattern"})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Merge Pattern PDFs"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),e.jsx("div",{className:"p-6",children:e.jsx(Mr,{})})]})})]})}function Va({files:t,onUpload:a,onDelete:s,onDownload:C,patternId:u}){const[F,j]=r.useState(null),[k,l]=r.useState(""),[P,p]=r.useState(!1),[m,i]=r.useState(!1),[v,d]=r.useState(null),y=r.useRef(null),w=["application/pdf","application/x-pdf","application/acrobat","applications/vnd.pdf","text/pdf","text/x-pdf",".pdf","image/jpeg","image/jpg","image/png","image/webp","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].join(","),c=b=>{const $=b.name.toLowerCase(),M=[".pdf",".jpg",".jpeg",".png",".webp",".doc",".docx",".txt"].some(L=>$.endsWith(L)),V=w.split(",").map(L=>L.trim()).includes(b.type);if(!M&&!V){alert(`Invalid file type: ${b.type||"unknown"}

Accepted file types:
- PDF documents (.pdf)
- Images (.jpg, .png, .webp)
- Word documents (.doc, .docx)
- Text files (.txt)

Please make sure your file has the correct extension.`);return}const J=b.size/(1024*1024);if(J>25){alert(`File size (${J.toFixed(1)}MB) exceeds the 25MB limit.

Please choose a smaller file or compress your PDF.`);return}j(b)},o=b=>{var x;const $=(x=b.target.files)==null?void 0:x[0];$&&c($)},N=b=>{var x;b.preventDefault(),b.stopPropagation(),i(!1);const $=(x=b.dataTransfer.files)==null?void 0:x[0];$&&c($)},g=b=>{b.preventDefault(),b.stopPropagation(),b.type==="dragenter"||b.type==="dragover"?i(!0):b.type==="dragleave"&&i(!1)},n=async()=>{if(F){p(!0);try{await a(F,k),j(null),l(""),y.current&&(y.current.value="")}catch(b){console.error("Upload error:",b),alert("Failed to upload file. Please try again.")}finally{p(!1)}}},S=()=>{j(null),l(""),y.current&&(y.current.value="")},T=b=>{switch(b){case"pdf":return e.jsx(rt,{className:"w-6 h-6 text-red-500"});case"image":return e.jsx(pr,{className:"w-6 h-6 text-blue-500"});case"document":return e.jsx(Ke,{className:"w-6 h-6 text-blue-600"});default:return e.jsx(rt,{className:"w-6 h-6 text-gray-500"})}},h=b=>b<1024?b+" B":b<1024*1024?(b/1024).toFixed(1)+" KB":(b/(1024*1024)).toFixed(1)+" MB";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Upload Pattern Files"}),e.jsxs("div",{className:`
            border-2 border-dashed rounded-lg p-8 text-center transition-colors
            ${m?"border-pink-500 bg-pink-50 dark:bg-pink-900/10":"border-gray-300 dark:border-gray-600 hover:border-pink-400 dark:hover:border-pink-500"}
          `,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:N,children:[e.jsx(it,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:"PDF, Images, Word documents, or text files (MAX. 25MB)"}),e.jsx("input",{ref:y,type:"file",className:"hidden",accept:w,onChange:o}),e.jsx("button",{type:"button",onClick:()=>{var b;return(b=y.current)==null?void 0:b.click()},className:"mt-4 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors",children:"Select File"})]}),F&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(rt,{className:"w-6 h-6 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:F.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h(F.size)})]})]}),e.jsx("button",{onClick:S,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (optional)"}),e.jsx("input",{type:"text",value:k,onChange:b=>l(b.target.value),placeholder:"E.g., Main pattern, Size chart, Assembly instructions...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsx("button",{onClick:n,disabled:P,className:"w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:P?"Uploading...":"Upload File"})]})]}),t.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Pattern Files (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-650 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[T(b.file_type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:b.original_filename}),b.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:b.description}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:[h(b.size)," • ",new Date(b.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[b.file_type==="pdf"&&u&&e.jsx("button",{onClick:()=>d(b),className:"p-2 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors",title:"View PDF",children:e.jsx(et,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C(b.id,b.original_filename),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Download",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this file?")&&s(b.id)},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(ge,{className:"w-5 h-5"})})]})]},b.id))})]}),v&&v.file_type==="pdf"&&u&&e.jsx(Rr,{fileUrl:`/api/uploads/patterns/${u}/files/${v.id}/download`,filename:v.original_filename,patternId:u,onClose:()=>d(null)})]})}function Ya({patternId:t,chartData:a,onSave:s,onCancel:C}){const[u,F]=r.useState((a==null?void 0:a.title)||""),[j,k]=r.useState((a==null?void 0:a.rows)||20),[l,P]=r.useState((a==null?void 0:a.cols)||20),[p,m]=r.useState((a==null?void 0:a.isInTheRound)||!1),[i,v]=r.useState((a==null?void 0:a.notes)||""),[d,y]=r.useState((a==null?void 0:a.chartData)||[]),[w,c]=r.useState([]),[o,N]=r.useState(null),[g,n]=r.useState("pencil"),[S,T]=r.useState(!1),[h,b]=r.useState([]),[$,x]=r.useState(-1),[M,I]=r.useState(!1),[V,J]=r.useState(1),L=r.useRef(null);r.useEffect(()=>{Z()},[]),r.useEffect(()=>{h.length===0&&(b([d]),x(0))},[]);const Z=async()=>{try{const O=(await E.get("/api/chart-symbols")).data.data.symbols;c(O),O.length>0&&!o&&N(O[0])}catch(z){console.error("Error fetching symbols:",z),f.error("Failed to load chart symbols")}},ee=z=>{const O=h.slice(0,$+1);O.push(z),b(O),x(O.length-1)},K=()=>{$>0&&(x($-1),y(h[$-1]))},X=()=>{$<h.length-1&&(x($+1),y(h[$+1]))},R=(z,O)=>{const Q=d.find(le=>le.row===z&&le.col===O);return(Q==null?void 0:Q.symbol)||null},te=(z,O)=>{if(g==="pencil"&&o){const Q=d.filter(le=>!(le.row===z&&le.col===O));Q.push({row:z,col:O,symbol:o.id}),y(Q),ee(Q)}else if(g==="eraser"){const Q=d.filter(le=>!(le.row===z&&le.col===O));y(Q),ee(Q)}else if(g==="fill"&&o){const Q=[...d];for(let le=0;le<j;le++)for(let me=0;me<l;me++)R(le,me)||Q.push({row:le,col:me,symbol:o.id});y(Q),ee(Q)}},H=(z,O)=>{T(!0),te(z,O)},ie=(z,O)=>{S&&te(z,O)},D=()=>{T(!1)},re=async()=>{var z,O;if(!u.trim()){f.error("Chart title is required");return}if(j<1||j>1e3){f.error("Rows must be between 1 and 1000");return}if(l<1||l>1e3){f.error("Columns must be between 1 and 1000");return}I(!0);try{const Q=[...new Set(d.map(me=>me.symbol))],le={title:u,rows:j,cols:l,isInTheRound:p,notes:i,chartData:d,symbolIds:Q};a!=null&&a.id?(await E.put(`/api/patterns/${t}/charts/${a.id}`,le),f.success("Chart updated successfully")):(await E.post(`/api/patterns/${t}/charts`,le),f.success("Chart created successfully")),s==null||s()}catch(Q){console.error("Error saving chart:",Q),f.error(((O=(z=Q.response)==null?void 0:z.data)==null?void 0:O.message)||"Failed to save chart")}finally{I(!1)}},se=(z,O)=>{if(z<1||z>1e3||O<1||O>1e3){f.error("Grid size must be between 1 and 1000");return}const Q=d.filter(le=>le.row<z&&le.col<O);y(Q),ee(Q),k(z),P(O)},A=()=>{window.confirm("Are you sure you want to clear the entire chart?")&&(y([]),ee([]))},G=()=>{const z=[];for(let O=0;O<j;O++)for(let Q=0;Q<l;Q++){const le=R(O,Q),me=le?w.find(fe=>fe.id===le):null;z.push(e.jsx("div",{className:"chart-cell",style:{backgroundColor:(me==null?void 0:me.color)||"#fff",border:"1px solid #ddd",cursor:"pointer",fontSize:`${12*V}px`,width:`${20*V}px`,height:`${20*V}px`,display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},onMouseDown:()=>H(O,Q),onMouseEnter:()=>ie(O,Q),onMouseUp:D,children:me==null?void 0:me.symbol},`${O}-${Q}`))}return z},Y=()=>[...new Set(w.map(O=>O.category))].map(O=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2 capitalize",children:O}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:w.filter(Q=>Q.category===O).map(Q=>e.jsxs("button",{onClick:()=>N(Q),className:`p-2 border rounded hover:bg-gray-100 transition ${(o==null?void 0:o.id)===Q.id?"border-blue-500 bg-blue-50":"border-gray-300"}`,style:{backgroundColor:Q.color||"#fff"},title:`${Q.name} - ${Q.description}`,children:[e.jsx("div",{className:"text-xl",children:Q.symbol}),e.jsx("div",{className:"text-xs mt-1 text-gray-600",children:Q.name})]},Q.id))})]},O));return e.jsxs("div",{className:"chart-editor bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:a!=null&&a.id?"Edit Chart":"Create New Chart"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:re,disabled:M,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(Ot,{}),M?"Saving...":"Save"]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:[e.jsx(xe,{}),"Cancel"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chart Title"}),e.jsx("input",{type:"text",value:u,onChange:z=>F(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Main Cable Pattern"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rows"}),e.jsx("input",{type:"number",value:j,onChange:z=>se(parseInt(z.target.value)||1,l),min:"1",max:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e.jsx("input",{type:"number",value:l,onChange:z=>se(j,parseInt(z.target.value)||1),min:"1",max:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:z=>m(z.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Knit in the round"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:i,onChange:z=>v(z.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Add notes about this chart..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tools"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>n("pencil"),className:`p-2 border rounded-lg flex flex-col items-center gap-1 ${g==="pencil"?"border-blue-500 bg-blue-50":"border-gray-300"}`,children:[e.jsx(We,{}),e.jsx("span",{className:"text-xs",children:"Pencil"})]}),e.jsxs("button",{onClick:()=>n("eraser"),className:`p-2 border rounded-lg flex flex-col items-center gap-1 ${g==="eraser"?"border-blue-500 bg-blue-50":"border-gray-300"}`,children:[e.jsx(ge,{}),e.jsx("span",{className:"text-xs",children:"Eraser"})]}),e.jsxs("button",{onClick:()=>n("fill"),className:`p-2 border rounded-lg flex flex-col items-center gap-1 ${g==="fill"?"border-blue-500 bg-blue-50":"border-gray-300"}`,children:[e.jsx($e,{}),e.jsx("span",{className:"text-xs",children:"Fill"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:K,disabled:$<=0,className:"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 flex items-center justify-center gap-1",title:"Undo",children:[e.jsx(At,{}),"Undo"]}),e.jsxs("button",{onClick:X,disabled:$>=h.length-1,className:"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 flex items-center justify-center gap-1",title:"Redo",children:[e.jsx(gt,{}),"Redo"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>J(Math.max(.5,V-.25)),className:"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 flex items-center justify-center gap-1",children:[e.jsx(ir,{}),"Zoom Out"]}),e.jsxs("button",{onClick:()=>J(Math.min(2,V+.25)),className:"flex-1 p-2 border border-gray-300 rounded-lg hover:bg-gray-100 flex items-center justify-center gap-1",children:[e.jsx(ue,{}),"Zoom In"]})]}),e.jsxs("button",{onClick:A,className:"w-full p-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 flex items-center justify-center gap-1",children:[e.jsx(ge,{}),"Clear Chart"]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Symbol Palette"}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:Y()})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Chart Grid"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[j," × ",l," (",d.length," cells filled)"]})]}),e.jsx("div",{ref:L,className:"overflow-auto max-h-[600px] bg-white border border-gray-200 rounded",onMouseLeave:D,children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${l}, ${20*V}px)`,gap:0,width:"fit-content"},children:G()})}),o&&g==="pencil"&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",style:{backgroundColor:o.color},children:o.symbol}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:o.name}),e.jsx("div",{className:"text-sm text-gray-600",children:o.description})]})]})})]})})]})]})}function qa({onUpload:t,onCancel:a}){var c;const[s,C]=r.useState(null),[u,F]=r.useState(!1),[j,k]=r.useState(null),l=r.useRef(null),P=o=>{var n;const N=(n=o.target.files)==null?void 0:n[0];if(!N)return;if(!["application/json","text/csv","text/plain"].includes(N.type)&&!N.name.match(/\.(json|csv|txt)$/i)){f.error("Please upload a JSON, CSV, or TXT file");return}C(N),p(N)},p=async o=>{try{const N=await o.text();let g=null;if(o.name.endsWith(".json")){const n=JSON.parse(N);g=m(n)}else o.name.endsWith(".csv")?g=i(N):o.name.endsWith(".txt")&&(g=v(N));if(g){if(!g.title||!g.rows||!g.cols)throw new Error("Invalid chart data: missing required fields (title, rows, cols)");if(g.rows<1||g.rows>1e3||g.cols<1||g.cols>1e3)throw new Error("Invalid chart dimensions: rows and cols must be between 1 and 1000");k(g),f.success("Chart data parsed successfully")}else throw new Error("Unable to parse file")}catch(N){console.error("Error parsing file:",N),f.error(N.message||"Failed to parse chart file"),C(null),k(null)}},m=o=>({title:o.title||"Imported Chart",rows:parseInt(o.rows)||20,cols:parseInt(o.cols)||20,isInTheRound:o.isInTheRound||!1,notes:o.notes||"",chartData:Array.isArray(o.chartData)?o.chartData:[],symbolIds:Array.isArray(o.symbolIds)?o.symbolIds:[]}),i=o=>{const N=o.trim().split(`
`),g=[];let n=0,S=0;const T=new Set,h=N[0].toLowerCase().includes("row")?1:0;for(let b=h;b<N.length;b++){const $=N[b].split(",").map(x=>x.trim());if($.length>=3){const x=parseInt($[0]),M=parseInt($[1]),I=$[2];!isNaN(x)&&!isNaN(M)&&I&&(g.push({row:x,col:M,symbol:I}),n=Math.max(n,x),S=Math.max(S,M),T.add(I))}}return{title:"Imported Chart from CSV",rows:n+1,cols:S+1,isInTheRound:!1,notes:"",chartData:g,symbolIds:Array.from(T)}},v=o=>{const N=o.trim().split(`
`);let g="Imported Chart from Text",n=0,S=0,T=!1;const h=[];let b=!1;for(const I of N)I.toLowerCase().startsWith("title:")?g=I.substring(6).trim():I.toLowerCase().startsWith("rows:")?n=parseInt(I.substring(5).trim())||0:I.toLowerCase().startsWith("cols:")?S=parseInt(I.substring(5).trim())||0:I.toLowerCase().startsWith("intheround:")?T=I.substring(11).trim().toLowerCase()==="true":I.toLowerCase().startsWith("grid:")?b=!0:b&&I.trim()&&h.push(I);(!n||!S)&&(n=h.length,S=Math.max(...h.map(I=>I.length)));const $=[],x={};let M=0;for(let I=0;I<h.length;I++)for(let V=0;V<h[I].length;V++){const J=h[I][V];J&&J!==" "&&(x[J]||(x[J]=`symbol-${M++}`),$.push({row:I,col:V,symbol:x[J]}))}return{title:g,rows:n,cols:S,isInTheRound:T,notes:"Imported from text file",chartData:$,symbolIds:Object.values(x)}},d=()=>{if(!j){f.error("No chart data to upload");return}F(!0),setTimeout(()=>{t(j),F(!1)},500)},y=o=>{o.preventDefault();const N=o.dataTransfer.files[0];if(N&&l.current){const g=new DataTransfer;g.items.add(N),l.current.files=g.files,P({target:l.current})}},w=o=>{o.preventDefault()};return e.jsxs("div",{className:"chart-upload bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Import Chart"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:e.jsx(xe,{size:24})})]}),j?e.jsxs("div",{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(Ze,{className:"text-green-600 mt-1",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-1",children:"Chart Parsed Successfully"}),e.jsx("p",{className:"text-sm text-green-700",children:'Review the chart details below and click "Import Chart" to continue.'})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded",children:j.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dimensions"}),e.jsxs("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded",children:[j.rows," × ",j.cols]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"In the Round"}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded",children:j.isInTheRound?"Yes":"No"})]}),j.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded",children:j.notes})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chart Data"}),e.jsxs("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded",children:[j.chartData.length," cells, ",((c=j.symbolIds)==null?void 0:c.length)||0," unique symbols"]})]})]}),s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center gap-3",children:[e.jsx(rt,{className:"text-blue-600",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:s.name}),e.jsxs("div",{className:"text-xs text-blue-600",children:[(s.size/1024).toFixed(2)," KB"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:d,disabled:u,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 font-medium",children:[e.jsx(it,{}),u?"Importing...":"Import Chart"]}),e.jsx("button",{onClick:()=>{C(null),k(null)},className:"px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 font-medium",children:"Choose Different File"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{onDrop:y,onDragOver:w,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition cursor-pointer",onClick:()=>{var o;return(o=l.current)==null?void 0:o.click()},children:[e.jsx(it,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"Drop your chart file here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Supported formats: JSON, CSV, TXT"}),e.jsx("input",{ref:l,type:"file",accept:".json,.csv,.txt",onChange:P,className:"hidden"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"File Format Examples"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"JSON Format:"}),e.jsx("pre",{className:"bg-gray-100 p-3 rounded text-sm overflow-x-auto",children:`{
  "title": "My Chart",
  "rows": 20,
  "cols": 20,
  "isInTheRound": false,
  "notes": "Optional notes",
  "chartData": [
    {"row": 0, "col": 0, "symbol": "symbol-id"},
    {"row": 0, "col": 1, "symbol": "symbol-id"}
  ],
  "symbolIds": ["symbol-id-1", "symbol-id-2"]
}`})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"CSV Format:"}),e.jsx("pre",{className:"bg-gray-100 p-3 rounded text-sm overflow-x-auto",children:`row,col,symbol
0,0,symbol-id-1
0,1,symbol-id-2
1,0,symbol-id-1`})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Text Format:"}),e.jsx("pre",{className:"bg-gray-100 p-3 rounded text-sm overflow-x-auto",children:`Title: My Chart
Rows: 10
Cols: 10
InTheRound: false
Grid:
.-.-.-.-
--------
.-.-.-.-`})]})]})]})]})]})}function Ha({patternId:t,onClose:a}){const[s,C]=r.useState([]),[u,F]=r.useState(!0),[j,k]=r.useState(!1),[l,P]=r.useState(null),[p,m]=r.useState({name:"",pageNumber:"",sortOrder:""});r.useEffect(()=>{i()},[t]);const i=async()=>{try{const g=await E.get(`/api/patterns/${t}/sections`);C(g.data.data.sections||[])}catch(g){console.error("Error fetching sections:",g),f.error("Failed to load sections")}finally{F(!1)}},v=async()=>{var g,n;if(!p.name.trim()){f.error("Section name is required");return}try{const S={name:p.name,sortOrder:s.length};p.pageNumber&&(S.pageNumber=parseInt(p.pageNumber)),await E.post(`/api/patterns/${t}/sections`,S),f.success("Section created!"),k(!1),N(),i()}catch(S){console.error("Error creating section:",S),f.error(((n=(g=S.response)==null?void 0:g.data)==null?void 0:n.message)||"Failed to create section")}},d=async()=>{var g,n;if(l){if(!p.name.trim()){f.error("Section name is required");return}try{const S={name:p.name};p.pageNumber&&(S.pageNumber=parseInt(p.pageNumber)),p.sortOrder&&(S.sortOrder=parseInt(p.sortOrder)),await E.put(`/api/patterns/${t}/sections/${l.id}`,S),f.success("Section updated!"),P(null),N(),i()}catch(S){console.error("Error updating section:",S),f.error(((n=(g=S.response)==null?void 0:g.data)==null?void 0:n.message)||"Failed to update section")}}},y=async(g,n)=>{if(confirm(`Delete section "${n}"?`))try{await E.delete(`/api/patterns/${t}/sections/${g}`),f.success("Section deleted"),i()}catch(S){console.error("Error deleting section:",S),f.error("Failed to delete section")}},w=g=>{var n;P(g),m({name:g.name,pageNumber:((n=g.page_number)==null?void 0:n.toString())||"",sortOrder:g.sort_order.toString()})},c=async(g,n)=>{if(n!==0)try{await E.put(`/api/patterns/${t}/sections/${g.id}`,{sortOrder:n-1}),i()}catch{f.error("Failed to reorder section")}},o=async(g,n)=>{if(n!==s.length-1)try{await E.put(`/api/patterns/${t}/sections/${g.id}`,{sortOrder:n+1}),i()}catch{f.error("Failed to reorder section")}},N=()=>{m({name:"",pageNumber:"",sortOrder:""}),k(!1),P(null)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Pattern Sections"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading sections..."})]}):e.jsx(e.Fragment,{children:s.length===0&&!j&&!l?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(It,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No sections yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:'Organize your pattern into sections like "Body", "Sleeves", "Finishing", etc.'}),e.jsxs("button",{onClick:()=>k(!0),className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Create First Section"]})]}):e.jsxs(e.Fragment,{children:[!j&&!l&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"New Section"]})}),(j||l)&&e.jsxs("div",{className:"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:l?"Edit Section":"New Section"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:g=>m({...p,name:g.target.value}),placeholder:"e.g., Body, Sleeves, Finishing",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Number (optional)"}),e.jsx("input",{type:"number",value:p.pageNumber,onChange:g=>m({...p,pageNumber:g.target.value}),placeholder:"e.g., 5",min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Link this section to a specific page in the pattern"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:N,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:l?d:v,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:l?"Update":"Create"})]})]})]}),s.length>0&&e.jsx("div",{className:"space-y-2",children:s.map((g,n)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:g.name}),g.page_number&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Page ",g.page_number]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>c(g,n),disabled:n===0,className:"p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>o(g,n),disabled:n===s.length-1,className:"p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>w(g),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"Edit",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>y(g.id,g.name),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})},g.id))})]})})})]})})}function Wa({patternId:t,projectId:a,onClose:s}){const[C,u]=r.useState("bookmarks"),[F,j]=r.useState([]),[k,l]=r.useState([]),[P,p]=r.useState([]),[m,i]=r.useState(!0),[v,d]=r.useState(!1),[y,w]=r.useState(!1),[c,o]=r.useState({name:"",pageNumber:"",notes:"",color:"#FBBF24"}),[N,g]=r.useState({pageNumber:"",annotationType:"text",text:""});r.useEffect(()=>{n()},[t,C]);const n=async()=>{i(!0);try{if(C==="bookmarks"){const x=await E.get(`/api/patterns/${t}/bookmarks${a?`?projectId=${a}`:""}`);j(x.data.data.bookmarks||[])}else if(C==="highlights"){const x=await E.get(`/api/patterns/${t}/highlights${a?`?projectId=${a}`:""}`);l(x.data.data.highlights||[])}else if(C==="annotations"){const x=await E.get(`/api/patterns/${t}/annotations${a?`?projectId=${a}`:""}`);p(x.data.data.annotations||[])}}catch(x){console.error("Error fetching data:",x),f.error("Failed to load data")}finally{i(!1)}},S=async()=>{var x,M;if(!c.name.trim()){f.error("Bookmark name is required");return}if(!c.pageNumber){f.error("Page number is required");return}try{await E.post(`/api/patterns/${t}/bookmarks`,{name:c.name,pageNumber:parseInt(c.pageNumber),notes:c.notes||null,color:c.color,projectId:a||null}),f.success("Bookmark created!"),d(!1),o({name:"",pageNumber:"",notes:"",color:"#FBBF24"}),n()}catch(I){console.error("Error creating bookmark:",I),f.error(((M=(x=I.response)==null?void 0:x.data)==null?void 0:M.message)||"Failed to create bookmark")}},T=async()=>{var x,M;if(!N.pageNumber){f.error("Page number is required");return}if(!N.text.trim()){f.error("Annotation text is required");return}try{await E.post(`/api/patterns/${t}/annotations`,{pageNumber:parseInt(N.pageNumber),annotationType:N.annotationType,data:{text:N.text},projectId:a||null}),f.success("Annotation created!"),w(!1),g({pageNumber:"",annotationType:"text",text:""}),n()}catch(I){console.error("Error creating annotation:",I),f.error(((M=(x=I.response)==null?void 0:x.data)==null?void 0:M.message)||"Failed to create annotation")}},h=async(x,M)=>{if(confirm(`Delete bookmark "${M}"?`))try{await E.delete(`/api/patterns/${t}/bookmarks/${x}`),f.success("Bookmark deleted"),n()}catch(I){console.error("Error deleting bookmark:",I),f.error("Failed to delete bookmark")}},b=async x=>{if(confirm("Delete this highlight?"))try{await E.delete(`/api/patterns/${t}/highlights/${x}`),f.success("Highlight deleted"),n()}catch(M){console.error("Error deleting highlight:",M),f.error("Failed to delete highlight")}},$=async x=>{if(confirm("Delete this annotation?"))try{await E.delete(`/api/patterns/${t}/annotations/${x}`),f.success("Annotation deleted"),n()}catch(M){console.error("Error deleting annotation:",M),f.error("Failed to delete annotation")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Pattern Annotations"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex px-6",children:[e.jsx("button",{onClick:()=>u("bookmarks"),className:`px-4 py-3 font-medium border-b-2 transition ${C==="bookmarks"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"h-4 w-4"}),"Bookmarks (",F.length,")"]})}),e.jsx("button",{onClick:()=>u("highlights"),className:`px-4 py-3 font-medium border-b-2 transition ${C==="highlights"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-4 w-4"}),"Highlights (",k.length,")"]})}),e.jsx("button",{onClick:()=>u("annotations"),className:`px-4 py-3 font-medium border-b-2 transition ${C==="annotations"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Notes (",P.length,")"]})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[C==="bookmarks"&&e.jsxs(e.Fragment,{children:[!v&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"New Bookmark"]})}),v&&e.jsxs("div",{className:"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"New Bookmark"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bookmark Name *"}),e.jsx("input",{type:"text",value:c.name,onChange:x=>o({...c,name:x.target.value}),placeholder:"e.g., Current row, Sleeve decreases",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Number *"}),e.jsx("input",{type:"number",value:c.pageNumber,onChange:x=>o({...c,pageNumber:x.target.value}),placeholder:"e.g., 5",min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:c.notes,onChange:x=>o({...c,notes:x.target.value}),placeholder:"Add notes about this bookmark",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("input",{type:"color",value:c.color,onChange:x=>o({...c,color:x.target.value}),className:"h-10 w-20 border border-gray-300 rounded cursor-pointer"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d(!1),o({name:"",pageNumber:"",notes:"",color:"#FBBF24"})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:S,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:"Create"})]})]})]}),F.length===0&&!v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ut,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No bookmarks yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Save your place in the pattern with bookmarks"})]}):e.jsx("div",{className:"space-y-2",children:F.map(x=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mt-1",style:{backgroundColor:x.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:x.name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Page ",x.page_number]}),x.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:x.notes})]})]}),e.jsx("button",{onClick:()=>h(x.id,x.name),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(ge,{className:"h-4 w-4"})})]})},x.id))})]}),C==="highlights"&&e.jsx("div",{children:k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ht,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No highlights yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Highlights must be created directly on the PDF viewer"})]}):e.jsx("div",{className:"space-y-2",children:k.map(x=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-3 h-3 rounded mt-1",style:{backgroundColor:x.color,opacity:x.opacity}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm text-gray-900",children:["Page ",x.page_number]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Created ",new Date(x.created_at).toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>b(x.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(ge,{className:"h-4 w-4"})})]})},x.id))})}),C==="annotations"&&e.jsxs(e.Fragment,{children:[!y&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition inline-flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"New Note"]})}),y&&e.jsxs("div",{className:"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"New Note"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Number *"}),e.jsx("input",{type:"number",value:N.pageNumber,onChange:x=>g({...N,pageNumber:x.target.value}),placeholder:"e.g., 5",min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note Text *"}),e.jsx("textarea",{value:N.text,onChange:x=>g({...N,text:x.target.value}),placeholder:"Add your notes, modifications, or reminders",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{w(!1),g({pageNumber:"",annotationType:"text",text:""})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:T,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded",children:"Create"})]})]})]}),P.length===0&&!y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No notes yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Add personal notes, modifications, and annotations to your pattern"})]}):e.jsx("div",{className:"space-y-2",children:P.map(x=>{var M;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 mb-1",children:["Page ",x.page_number]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:((M=x.data)==null?void 0:M.text)||"(No text)"}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(x.created_at).toLocaleDateString()})]}),e.jsx("button",{onClick:()=>$(x.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(ge,{className:"h-4 w-4"})})]})},x.id)})})]})]})})]})})}function Ka(){const{id:t}=Lt(),a=Ue(),[s,C]=r.useState(null),[u,F]=r.useState([]),[j,k]=r.useState(!0),[l,P]=r.useState(!1),[p,m]=r.useState("overview"),[i,v]=r.useState(null),[d,y]=r.useState({name:"",description:"",designer:"",difficulty:"intermediate",category:"sweater",yarnRequirements:"",needleSize:"",gauge:"",sizesAvailable:"",notes:""}),[w,c]=r.useState(!1),[o,N]=r.useState(!1),[g,n]=r.useState(!1),[S,T]=r.useState([]),[h,b]=r.useState(null),[$,x]=r.useState(!1),[M,I]=r.useState(!1),[V,J]=r.useState(!1),[L,Z]=r.useState(null),[ee,K]=r.useState(void 0),[X,R]=r.useState(void 0);r.useEffect(()=>{t&&(te(),H(),Y())},[t]),r.useEffect(()=>{if(u.length>0&&!i){const B=u.find(de=>de.file_type==="pdf");B&&v(B)}},[u,i]);const te=async()=>{try{const B=await E.get(`/api/patterns/${t}`);C(B.data.data.pattern)}catch(B){console.error("Error fetching pattern:",B),f.error("Failed to load pattern"),a("/patterns")}finally{k(!1)}},H=async()=>{try{const B=await E.get(`/api/uploads/patterns/${t}/files`);F(B.data.data.files||[])}catch(B){console.error("Error fetching pattern files:",B)}},ie=()=>{s&&(y({name:s.name||"",description:s.description||"",designer:s.designer||"",difficulty:s.difficulty||"intermediate",category:s.category||"sweater",yarnRequirements:s.yarn_requirements||"",needleSize:s.needle_size||"",gauge:s.gauge||"",sizesAvailable:s.sizes_available||"",notes:s.notes||""}),P(!0))},D=async B=>{var de,ye;if(B.preventDefault(),!!s)try{await E.put(`/api/patterns/${s.id}`,d),f.success("Pattern updated successfully!"),P(!1),te()}catch(q){console.error("Error updating pattern:",q),f.error(((ye=(de=q.response)==null?void 0:de.data)==null?void 0:ye.message)||"Failed to update pattern")}},re=async()=>{if(s&&confirm(`Are you sure you want to delete "${s.name}"? This will also delete all associated files.`))try{await E.delete(`/api/patterns/${s.id}`),f.success("Pattern deleted successfully"),a("/patterns")}catch(B){console.error("Error deleting pattern:",B),f.error("Failed to delete pattern")}},se=async(B,de)=>{var q,U;const ye=new FormData;ye.append("file",B),de&&ye.append("description",de);try{await E.post(`/api/uploads/patterns/${t}/files`,ye,{headers:{"Content-Type":"multipart/form-data"}}),f.success("File uploaded successfully!"),H()}catch(ne){throw console.error("Error uploading file:",ne),f.error(((U=(q=ne.response)==null?void 0:q.data)==null?void 0:U.message)||"Failed to upload file"),ne}},A=async(B,de)=>{try{const ye=await E.get(`/api/uploads/patterns/${t}/files/${B}/download`,{responseType:"blob"}),q=window.URL.createObjectURL(new Blob([ye.data])),U=document.createElement("a");U.href=q,U.setAttribute("download",de),document.body.appendChild(U),U.click(),U.remove(),window.URL.revokeObjectURL(q)}catch(ye){console.error("Error downloading file:",ye),f.error("Failed to download file")}},G=async B=>{try{await E.delete(`/api/uploads/patterns/${t}/files/${B}`),f.success("File deleted successfully"),H()}catch(de){console.error("Error deleting file:",de),f.error("Failed to delete file")}},Y=async()=>{try{const B=await E.get(`/api/patterns/${t}/charts`);T(B.data.data.charts||[])}catch(B){console.error("Error fetching charts:",B)}},z=async B=>{try{return(await E.get(`/api/patterns/${t}/charts/${B}`)).data.data.chart}catch(de){return console.error("Error fetching chart:",de),f.error("Failed to load chart"),null}},O=()=>{x(!1),I(!1),Z(null),Y()},Q=async B=>{const de=await z(B.id);de&&(Z(de),x(!0))},le=async B=>{const de=await z(B.id);de&&(b(de),J(!0))},me=async(B,de)=>{if(confirm(`Are you sure you want to delete "${de}"?`))try{await E.delete(`/api/patterns/${t}/charts/${B}`),f.success("Chart deleted successfully"),Y()}catch(ye){console.error("Error deleting chart:",ye),f.error("Failed to delete chart")}},fe=B=>{Z(B),I(!1),x(!0)},Te=B=>{switch(B){case"beginner":return"bg-green-100 text-green-800";case"intermediate":return"bg-yellow-100 text-yellow-800";case"advanced":return"bg-orange-100 text-orange-800";case"expert":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return j?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Er,{size:"lg",text:"Loading pattern..."})}):s?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("button",{onClick:()=>a("/patterns"),className:"flex items-center text-purple-600 hover:text-purple-700 mb-3 md:mb-4 min-h-[48px]",children:[e.jsx(ht,{className:"mr-2 h-5 w-5"}),e.jsx("span",{className:"text-base md:text-sm",children:"Back to Patterns"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:s.name}),s.difficulty&&e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full self-start ${Te(s.difficulty)}`,children:s.difficulty})]}),s.designer&&e.jsxs("p",{className:"text-base md:text-sm text-gray-600",children:["by ",s.designer]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>a(`/patterns/${t}/builder`),className:"flex items-center justify-center px-4 py-3 md:py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition min-h-[48px] md:min-h-0 flex-1 sm:flex-none",children:[e.jsx($e,{className:"mr-2 h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"text-base md:text-sm",children:"Edit Pattern"})]}),e.jsx("button",{onClick:ie,className:"flex items-center justify-center px-4 py-3 md:py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition min-h-[48px] md:min-h-0",title:"Edit pattern details",children:e.jsx(zt,{className:"h-5 w-5 md:h-4 md:w-4"})}),e.jsx("button",{onClick:re,className:"flex items-center justify-center px-4 py-3 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition min-h-[48px] md:min-h-0",title:"Delete pattern",children:e.jsx(ge,{className:"h-5 w-5 md:h-4 md:w-4"})})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-4 md:mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>m("overview"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${p==="overview"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"})]})}),e.jsx("button",{onClick:()=>m("viewer"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${p==="viewer"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} ${i?"":"opacity-50 cursor-not-allowed"}`,disabled:!i,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PDF Viewer"})]})}),e.jsx("button",{onClick:()=>m("charts"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${p==="charts"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Charts"})]})}),e.jsx("button",{onClick:()=>m("tools"),className:`px-4 md:px-6 py-4 md:py-3 text-sm md:text-base font-medium border-b-2 whitespace-nowrap flex-shrink-0 ${p==="tools"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Tools"})]})})]})})}),p==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pattern Information"}),s.description&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-600",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.category&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Category"}),e.jsx("p",{className:"text-gray-900",children:s.category})]}),s.needle_size&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Needle Size"}),e.jsx("p",{className:"text-gray-900",children:s.needle_size})]}),s.gauge&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Gauge"}),e.jsx("p",{className:"text-gray-900",children:s.gauge})]}),s.sizes_available&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Sizes Available"}),e.jsx("p",{className:"text-gray-900",children:s.sizes_available})]})]}),s.yarn_requirements&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Yarn Requirements"}),e.jsx("p",{className:"text-gray-600",children:s.yarn_requirements})]}),s.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:s.notes})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Statistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Times Used"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:s.times_used||0})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Files Attached"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:u.length})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Created"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.created_at).toLocaleDateString()})]}),s.updated_at&&s.updated_at!==s.created_at&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Last Updated"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.updated_at).toLocaleDateString()})]})]})]})]}),e.jsx(Va,{files:u,onUpload:se,onDelete:G,onDownload:A,patternId:t}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsx(Tr,{patternId:t,onJumpToBookmark:B=>{K(B.page_number),B.zoom_level&&R(B.zoom_level),f.info(`Jumping to page ${B.page_number}`),m("viewer")}})})]}),p==="viewer"&&i&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",style:{height:"800px"},children:e.jsx(Rr,{fileUrl:`/api/uploads/patterns/${t}/files/${i.id}/download`,filename:i.original_filename,patternId:t,fullscreen:!1,initialPage:ee,initialZoom:X})}),p==="charts"&&!$&&!M&&!V&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Pattern Charts"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>a(`/patterns/${t}/builder`),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx($e,{}),"Pattern Builder"]}),e.jsxs("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[e.jsx($e,{}),"Import Chart"]}),e.jsxs("button",{onClick:()=>{Z(null),x(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx($e,{}),"Create Chart"]})]})]}),S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($e,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Charts Yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create or import knitting charts to visualize your pattern"}),e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap",children:[e.jsx("button",{onClick:()=>a(`/patterns/${t}/builder`),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Pattern Builder"}),e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Import Chart"}),e.jsx("button",{onClick:()=>{Z(null),x(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create New Chart"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(B=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:B.title}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Q(B),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit Chart",children:e.jsx(Ee,{size:16})}),e.jsx("button",{onClick:()=>me(B.id,B.title),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete Chart",children:e.jsx(ge,{size:16})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[e.jsxs("div",{children:["Size: ",B.rows," × ",B.cols]}),e.jsxs("div",{children:["Type: ",B.is_in_the_round?"In the Round":"Flat"]}),B.notes&&e.jsx("div",{className:"text-xs text-gray-500 line-clamp-2",children:B.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>le(B),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm font-medium",children:"View Chart"}),e.jsx("button",{onClick:()=>a(`/patterns/${t}/builder?chart=${B.id}`),className:"flex-1 px-3 py-2 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm font-medium",children:"Edit in Builder"})]})]},B.id))})]}),p==="charts"&&$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Ya,{patternId:t,chartData:L,onSave:O,onCancel:()=>{x(!1),Z(null)}})})}),p==="charts"&&M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx(qa,{onUpload:fe,onCancel:()=>I(!1)})}),p==="charts"&&V&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:h.title}),e.jsx("button",{onClick:()=>{J(!1),b(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx(xe,{size:24})})]}),e.jsx(Ba,{chartData:h.chartData,symbols:h.symbols,rows:h.rows,cols:h.cols,title:h.title,isInTheRound:h.is_in_the_round})]})}),p==="tools"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pattern Tools"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Pattern Sections"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Organize your pattern into sections for easier navigation"}),e.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Manage Sections"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Pattern Annotations"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Add notes and annotations directly to your pattern"}),e.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Annotations"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Pattern Collation"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Combine multiple PDFs into a single pattern document"}),e.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Collate PDFs"})]})]})]}),w&&s&&e.jsx(Ha,{patternId:s.id,onClose:()=>c(!1)}),o&&s&&e.jsx(Wa,{patternId:s.id,onClose:()=>N(!1)}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Collate Pattern PDFs"}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),e.jsx("div",{className:"p-6",children:e.jsx(Mr,{})})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Pattern"})}),e.jsxs("form",{onSubmit:D,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Name *"}),e.jsx("input",{type:"text",value:d.name,onChange:B=>y({...d,name:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designer"}),e.jsx("input",{type:"text",value:d.designer,onChange:B=>y({...d,designer:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Difficulty"}),e.jsxs("select",{value:d.difficulty,onChange:B=>y({...d,difficulty:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:d.category,onChange:B=>y({...d,category:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"sweater",children:"Sweater"}),e.jsx("option",{value:"scarf",children:"Scarf"}),e.jsx("option",{value:"hat",children:"Hat"}),e.jsx("option",{value:"blanket",children:"Blanket"}),e.jsx("option",{value:"socks",children:"Socks"}),e.jsx("option",{value:"shawl",children:"Shawl"}),e.jsx("option",{value:"toy",children:"Toy/Amigurumi"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Needle Size"}),e.jsx("input",{type:"text",value:d.needleSize,onChange:B=>y({...d,needleSize:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7, 4.5mm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gauge"}),e.jsx("input",{type:"text",value:d.gauge,onChange:B=>y({...d,gauge:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 20 sts x 28 rows = 4 inches"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sizes Available"}),e.jsx("input",{type:"text",value:d.sizesAvailable,onChange:B=>y({...d,sizesAvailable:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., XS, S, M, L, XL"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:B=>y({...d,description:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yarn Requirements"}),e.jsx("textarea",{value:d.yarnRequirements,onChange:B=>y({...d,yarnRequirements:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:2,placeholder:"e.g., 800 yards worsted weight yarn"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:B=>y({...d,notes:B.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Additional notes, modifications, tips, etc."})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>P(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Pattern"})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Pattern not found"})})}E.defaults.baseURL="http://localhost:5000";E.defaults.timeout=3e4;E.defaults.withCredentials=!0;E.defaults.headers.common["Content-Type"]="application/json";let De=null;async function Dr(){try{return De=(await E.get("/api/csrf-token")).data.csrfToken,De||""}catch(t){return console.error("Failed to fetch CSRF token:",t),""}}async function Ga(){return De||Dr()}E.interceptors.request.use(async t=>{const a=["POST","PUT","DELETE","PATCH"];if(t.method&&a.includes(t.method.toUpperCase()))try{const s=await Ga();s&&(t.headers["x-csrf-token"]=s)}catch(s){console.error("Failed to attach CSRF token:",s)}return t},t=>Promise.reject(t));let St=!1,Et=[];const Pt=(t,a=null)=>{Et.forEach(s=>{t?s.reject(t):s.resolve(a)}),Et=[]};async function Xa(){var t;try{const a=await E.post("/api/auth/refresh");return a.data.success&&((t=a.data.data)!=null&&t.accessToken)?a.data.data.accessToken:null}catch(a){return console.error("Failed to refresh access token:",a),null}}E.interceptors.response.use(t=>t,async t=>{var s,C,u,F,j,k,l,P,p,m,i,v;const a=t.config;if(((s=t.response)==null?void 0:s.status)===401&&a){if((C=a.url)!=null&&C.includes("/auth/refresh")||(u=a.url)!=null&&u.includes("/auth/login")){De=null;const d=window.location.pathname;return["/login","/register","/forgot-password","/reset-password","/verify-email"].some(w=>d.includes(w))||(window.location.href="/login"),Promise.reject(t)}if(a._retry){De=null;const d=window.location.pathname;return["/login","/register","/forgot-password","/reset-password","/verify-email"].some(w=>d.includes(w))||(window.location.href="/login"),Promise.reject(t)}if(St)return new Promise((d,y)=>{Et.push({resolve:d,reject:y})}).then(()=>E(a)).catch(d=>Promise.reject(d));a._retry=!0,St=!0;try{const d=await Xa();if(d)return Pt(null,d),E.defaults.headers.common.Authorization=`Bearer ${d}`,E(a);{Pt(t,null),De=null;const y=window.location.pathname;return["/login","/register","/forgot-password","/reset-password","/verify-email"].some(c=>y.includes(c))||(window.location.href="/login"),Promise.reject(t)}}catch(d){Pt(d,null),De=null;const y=window.location.pathname;return["/login","/register","/forgot-password","/reset-password","/verify-email"].some(c=>y.includes(c))||(window.location.href="/login"),Promise.reject(t)}finally{St=!1}}if(((F=t.response)==null?void 0:F.status)===403&&(j=t.response.data.error)!=null&&j.includes("CSRF")&&a&&!a._retry){a._retry=!0;try{return await Dr(),E(a)}catch(y){return console.error("Failed to retry request after CSRF refresh:",y),Promise.reject(t)}}if(((k=t.response)==null?void 0:k.status)===429&&a){const y=a._rateLimitRetryCount||0;if(y<3&&!a._rateLimitRetry){a._rateLimitRetry=!0,a._rateLimitRetryCount=y+1;const w=t.response.headers["retry-after"],c=w?parseInt(w,10):null,o=c?c*1e3:Math.pow(2,y+1)*1e3;return await new Promise(N=>setTimeout(N,o)),a._rateLimitRetry=!1,E(a)}else{const w=t.response.headers["retry-after"],c=t.response.data;window.dispatchEvent(new CustomEvent("rate-limit-exceeded",{detail:{message:c.message||"Rate limit exceeded",tier:c.tier,limit:c.limit,retryAfter:w?parseInt(w,10):null}})),console.warn("Rate limit exceeded. Max retries reached. Retry after:",w)}}if(!t.response&&a){const y=a._retryCount||0;if(y<3){a._retryCount=y+1;const w=Math.pow(2,y)*1e3;return await new Promise(c=>setTimeout(c,w)),E(a)}}if(((l=t.response)==null?void 0:l.status)===404&&(console.warn("Resource not found:",a==null?void 0:a.url),window.dispatchEvent(new CustomEvent("api-error",{detail:{status:404,message:"The requested resource was not found"}}))),((P=t.response)==null?void 0:P.status)===500&&(console.error("Server error:",t.response.data),window.dispatchEvent(new CustomEvent("api-error",{detail:{status:500,message:"A server error occurred. Please try again later."}}))),((p=t.response)==null?void 0:p.status)===503&&(console.error("Service unavailable. Server might be down."),window.dispatchEvent(new CustomEvent("api-error",{detail:{status:503,message:"Service is temporarily unavailable. Please try again later."}}))),((m=t.response)==null?void 0:m.status)===422){const y=((v=(i=t.response.data.errors)==null?void 0:i[0])==null?void 0:v.msg)||"Validation error";window.dispatchEvent(new CustomEvent("api-error",{detail:{status:422,message:y}}))}return Promise.reject(t)});const Fe={basic:{name:"Basic Stitches",symbols:[{id:"k",symbol:"□",name:"Knit",abbr:"k",description:"Knit stitch"},{id:"p",symbol:"—",name:"Purl",abbr:"p",description:"Purl stitch"},{id:"yo",symbol:"○",name:"Yarn Over",abbr:"yo",description:"Yarn over"},{id:"sl",symbol:"v",name:"Slip",abbr:"sl",description:"Slip stitch"},{id:"no-stitch",symbol:"◊",name:"No Stitch",abbr:"",description:"No stitch (placeholder)"},{id:"k-tbl",symbol:"⊠",name:"Knit TBL",abbr:"k tbl",description:"Knit through back loop"},{id:"p-tbl",symbol:"⊞",name:"Purl TBL",abbr:"p tbl",description:"Purl through back loop"},{id:"wrap",symbol:"◐",name:"Wrap",abbr:"w&t",description:"Wrap and turn"}]},decreases:{name:"Decreases",symbols:[{id:"k2tog",symbol:"╲",name:"K2tog",abbr:"k2tog",description:"Knit 2 together (right lean)"},{id:"ssk",symbol:"╱",name:"SSK",abbr:"ssk",description:"Slip, slip, knit (left lean)"},{id:"p2tog",symbol:"⟩",name:"P2tog",abbr:"p2tog",description:"Purl 2 together"},{id:"ssp",symbol:"⟨",name:"SSP",abbr:"ssp",description:"Slip, slip, purl"},{id:"k3tog",symbol:"▽",name:"K3tog",abbr:"k3tog",description:"Knit 3 together"},{id:"sssk",symbol:"△",name:"SSSK",abbr:"sssk",description:"Slip, slip, slip, knit"},{id:"p3tog",symbol:"▼",name:"P3tog",abbr:"p3tog",description:"Purl 3 together"},{id:"cdd",symbol:"⌃",name:"CDD",abbr:"cdd",description:"Central double decrease"},{id:"sk2p",symbol:"^",name:"SK2P",abbr:"sk2p",description:"Slip, k2tog, pass slipped st over"}]},increases:{name:"Increases",symbols:[{id:"kfb",symbol:"∨",name:"KFB",abbr:"kfb",description:"Knit front and back"},{id:"pfb",symbol:"∧",name:"PFB",abbr:"pfb",description:"Purl front and back"},{id:"m1",symbol:"◁",name:"M1",abbr:"m1",description:"Make 1"},{id:"m1l",symbol:"◀",name:"M1L",abbr:"m1l",description:"Make 1 left"},{id:"m1r",symbol:"▶",name:"M1R",abbr:"m1r",description:"Make 1 right"},{id:"m1p",symbol:"▽",name:"M1P",abbr:"m1p",description:"Make 1 purl"},{id:"kll",symbol:"◄",name:"KLL",abbr:"kll",description:"Knit left lifted increase"},{id:"krl",symbol:"►",name:"KRL",abbr:"krl",description:"Knit right lifted increase"},{id:"yo-twice",symbol:"◎",name:"YO Twice",abbr:"yo x2",description:"Yarn over twice"}]},cables2:{name:"2-Stitch Cables",symbols:[{id:"1-1-rc",symbol:"⋈",name:"1/1 RC",abbr:"1/1 rc",description:"1 over 1 right cable",width:2},{id:"1-1-lc",symbol:"⋉",name:"1/1 LC",abbr:"1/1 lc",description:"1 over 1 left cable",width:2},{id:"1-1-rpc",symbol:"⋊",name:"1/1 RPC",abbr:"1/1 rpc",description:"1 over 1 right purl cable",width:2},{id:"1-1-lpc",symbol:"⋋",name:"1/1 LPC",abbr:"1/1 lpc",description:"1 over 1 left purl cable",width:2}]},cables3:{name:"3-Stitch Cables",symbols:[{id:"2-1-rc",symbol:"⊳",name:"2/1 RC",abbr:"2/1 rc",description:"2 over 1 right cable",width:3},{id:"2-1-lc",symbol:"⊲",name:"2/1 LC",abbr:"2/1 lc",description:"2 over 1 left cable",width:3},{id:"2-1-rpc",symbol:"▷",name:"2/1 RPC",abbr:"2/1 rpc",description:"2 over 1 right purl cable",width:3},{id:"2-1-lpc",symbol:"◁",name:"2/1 LPC",abbr:"2/1 lpc",description:"2 over 1 left purl cable",width:3}]},cables4:{name:"4-Stitch Cables",symbols:[{id:"2-2-rc",symbol:"▸",name:"2/2 RC",abbr:"2/2 rc",description:"2 over 2 right cable",width:4},{id:"2-2-lc",symbol:"◂",name:"2/2 LC",abbr:"2/2 lc",description:"2 over 2 left cable",width:4},{id:"2-2-rpc",symbol:"▹",name:"2/2 RPC",abbr:"2/2 rpc",description:"2 over 2 right purl cable",width:4},{id:"2-2-lpc",symbol:"◃",name:"2/2 LPC",abbr:"2/2 lpc",description:"2 over 2 left purl cable",width:4},{id:"c4f",symbol:"⊕",name:"C4F",abbr:"c4f",description:"Cable 4 front",width:4},{id:"c4b",symbol:"⊗",name:"C4B",abbr:"c4b",description:"Cable 4 back",width:4}]},cables6:{name:"6-Stitch Cables",symbols:[{id:"3-3-rc",symbol:"⋗",name:"3/3 RC",abbr:"3/3 rc",description:"3 over 3 right cable",width:6},{id:"3-3-lc",symbol:"⋖",name:"3/3 LC",abbr:"3/3 lc",description:"3 over 3 left cable",width:6},{id:"c6f",symbol:"⊛",name:"C6F",abbr:"c6f",description:"Cable 6 front",width:6},{id:"c6b",symbol:"⊚",name:"C6B",abbr:"c6b",description:"Cable 6 back",width:6}]},lace:{name:"Lace & Eyelets",symbols:[{id:"lace-yo",symbol:"○",name:"Yarn Over",abbr:"yo",description:"Yarn over"},{id:"lace-yo-twice",symbol:"◎",name:"Double YO",abbr:"yo x2",description:"Yarn over twice"},{id:"nupps",symbol:"⊙",name:"Nupps",abbr:"nupps",description:"Nupps (bobble)"},{id:"k-yo-3",symbol:"⊕",name:"K YO 3x",abbr:"k yo x3",description:"Knit wrapping yarn 3 times"}]},special:{name:"Bobbles & Special",symbols:[{id:"bobble",symbol:"●",name:"Bobble",abbr:"bobble",description:"Make bobble (5 from 1)"},{id:"mb5",symbol:"⬤",name:"MB5",abbr:"mb5",description:"Make 5-stitch bobble"},{id:"cluster",symbol:"◉",name:"Cluster",abbr:"cluster",description:"Cluster stitch"},{id:"puff",symbol:"◘",name:"Puff",abbr:"puff",description:"Puff stitch"},{id:"popcorn",symbol:"◙",name:"Popcorn",abbr:"popcorn",description:"Popcorn stitch"}]},edging:{name:"Cast On & Bind Off",symbols:[{id:"co",symbol:"⌐",name:"Cast On",abbr:"co",description:"Cast on stitch"},{id:"bo",symbol:"⌙",name:"Bind Off",abbr:"bo",description:"Bind off stitch"},{id:"bo-rem",symbol:"┐",name:"BO Rem",abbr:"bo rem",description:"Stitch remaining after bind off"}]},colorwork:{name:"Colorwork",symbols:[{id:"mc",symbol:"■",name:"Main Color",abbr:"mc",description:"Main color stitch"},{id:"cc1",symbol:"▪",name:"CC1",abbr:"cc1",description:"Contrast color 1"},{id:"cc2",symbol:"▫",name:"CC2",abbr:"cc2",description:"Contrast color 2"},{id:"cc3",symbol:"□",name:"CC3",abbr:"cc3",description:"Contrast color 3"}]},shortRows:{name:"Short Rows",symbols:[{id:"wt",symbol:"◐",name:"W&T",abbr:"w&t",description:"Wrap and turn"},{id:"pickup-wrap",symbol:"◑",name:"Pickup Wrap",abbr:"pickup",description:"Pick up wrap"}]},brioche:{name:"Brioche",symbols:[{id:"brk",symbol:"⊡",name:"BRK",abbr:"brk",description:"Brioche knit"},{id:"brp",symbol:"⊟",name:"BRP",abbr:"brp",description:"Brioche purl"},{id:"sl-yo",symbol:"◊",name:"Sl+YO",abbr:"sl yo",description:"Slip with yarn over"}]}},Ar=()=>{const t=[];return Object.keys(Fe).forEach(a=>{const s=Fe[a];s.symbols.forEach(C=>{t.push({...C,category:s.name,categoryKey:a})})}),t},Qa=t=>{const a=Ar(),s=t.toLowerCase();return a.filter(C=>C.name.toLowerCase().includes(s)||C.abbr.toLowerCase().includes(s)||C.description.toLowerCase().includes(s))},Ja=()=>Object.keys(Fe).map(t=>({key:t,name:Fe[t].name,count:Fe[t].symbols.length,description:Fe[t].description})),Za=Ar().length,sr=Za,en=Fe.basic.symbols[0];function ar(){var ie;const{id:t}=Lt(),a=Ue(),[s]=Ps(),C=s.get("chart"),u=Ja(),[F,j]=r.useState(en),[k,l]=r.useState("basic"),[P,p]=r.useState({}),[m,i]=r.useState(12),[v,d]=r.useState(16),[y,w]=r.useState("Untitled Pattern"),[c,o]=r.useState(""),[N,g]=r.useState(!1),[n,S]=r.useState(null),[T,h]=r.useState(t||null),[b,$]=r.useState(!1);r.useEffect(()=>{t&&I()},[t,C]);const x=D=>{if(!D)return[];if(Array.isArray(D))return D;if(typeof D=="string")try{return JSON.parse(D)}catch{return[]}return[]},M=D=>{const re=x(D);if(re.length===0)return;const se={};re.forEach(A=>{const G=`${A.row}-${A.col}`;let Y;for(const z of Object.keys(Fe))if(Y=Fe[z].symbols.find(O=>O.symbol===A.symbol||O.name===A.name||O.abbr===A.abbr),Y)break;if(Y){se[G]={symbol:Y};const z=A.width||Y.width||1;if(z>1)for(let O=1;O<z;O++){const Q=`${A.row}-${A.col+O}`;se[Q]={symbol:Y,isOccupied:!0,parentKey:G}}}}),p(se)},I=async()=>{var D;if(t)try{const re=await E.get(`/api/patterns/${t}`);if(re.data.success&&w(re.data.data.pattern.name||"Untitled Pattern"),C){const se=await E.get(`/api/patterns/${t}/charts/${C}`);if(se.data.success&&se.data.data.chart){const A=se.data.data.chart;S(A.id),w(A.title||y),i(A.rows||12),d(A.cols||16),M(A.chart_data||A.chartData)}}else{const se=await E.get(`/api/patterns/${t}/charts`);if(se.data.success&&((D=se.data.data.charts)==null?void 0:D.length)>0){const A=se.data.data.charts[0];S(A.id),w(A.title||y),i(A.rows||12),d(A.cols||16),M(A.chart_data)}}}catch(re){console.error("Error loading chart:",re)}},V=(D,re,se=F)=>{const A=`${D}-${re}`,G=se.width||1;if(re+G>v){f.warning(`This ${se.name} symbol needs ${G} stitches but only ${v-re} available`);return}const Y=P[A];if(Y!=null&&Y.isOccupied&&Y.parentKey){const z=Y.parentKey,O=P[z];if(O){const Q=O.symbol.width||1;p(le=>{const me={...le};for(let fe=0;fe<Q;fe++){const[Te,B]=z.split("-").map(Number);delete me[`${Te}-${B+fe}`]}return me})}}p(z=>{const O={...z};if(O[A]={symbol:se},G>1)for(let Q=1;Q<G;Q++){const le=`${D}-${re+Q}`;O[le]={symbol:se,isOccupied:!0,parentKey:A}}return O})},J=()=>{window.confirm("Clear entire pattern?")&&p({})},L=(D,re)=>{const se=`${D}-${re}`,A=P[se];A&&p(G=>{const Y={...G};if(A.isOccupied&&A.parentKey){const z=A.parentKey,O=G[z];if(O){const Q=O.symbol.width||1,[le,me]=z.split("-").map(Number);for(let fe=0;fe<Q;fe++)delete Y[`${le}-${me+fe}`]}}else{const z=A.symbol.width||1;for(let O=0;O<z;O++)delete Y[`${D}-${re+O}`]}return Y})},Z=(D,re)=>{b?L(D,re):V(D,re)},ee=()=>{const D=Object.entries(P).filter(([z,O])=>!O.isOccupied).map(([z,O])=>{const[Q,le]=z.split("-").map(Number);return{row:Q,col:le,symbol:O.symbol.symbol,name:O.symbol.name,abbr:O.symbol.abbr,width:O.symbol.width||1}}),re={name:y,rows:m,columns:v,totalSymbols:sr,data:D,created:new Date().toISOString()},se=JSON.stringify(re,null,2),A=new Blob([se],{type:"application/json"}),G=URL.createObjectURL(A),Y=document.createElement("a");Y.href=G,Y.download=`${y.replace(/\s+/g,"-").toLowerCase()}-pattern.json`,Y.click(),URL.revokeObjectURL(G),f.success("Pattern exported successfully!")},K=()=>{let D=`Pattern: ${y}

Cast on ${v} stitches.

`;for(let re=0;re<m;re++){D+=`Row ${re+1}: `;const se=[];let A=0;for(;A<v;){const G=`${re}-${A}`,Y=P[G];Y&&!Y.isOccupied?(Y.symbol.abbr&&se.push(Y.symbol.abbr),A+=Y.symbol.width||1):(!Y||Y.isOccupied)&&A++}D+=se.join(", ")||"Empty row",D+=`
`}navigator.clipboard.writeText(D).then(()=>{f.success("Pattern instructions copied to clipboard!")}).catch(()=>{console.log(D),f.info("Pattern instructions generated - check browser console")})},X=async()=>{var D,re;if(!y.trim()){f.error("Please enter a pattern name");return}g(!0);try{let se=T;if(!se){const Y=await E.post("/api/patterns",{name:y,description:"Created with Pattern Builder",category:"custom"});if(Y.data.success)se=Y.data.data.pattern.id,h(se);else throw new Error("Failed to create pattern")}const A=Object.entries(P).filter(([Y,z])=>!z.isOccupied).map(([Y,z])=>{const[O,Q]=Y.split("-").map(Number);return{row:O,col:Q,symbol:z.symbol.symbol,name:z.symbol.name,abbr:z.symbol.abbr,width:z.symbol.width||1}});if(n)await E.put(`/api/patterns/${se}/charts/${n}`,{title:y,rows:m,cols:v,chartData:A,notes:`Pattern with ${Object.keys(P).length} stitches`}),f.success("Pattern updated successfully!");else{const Y=await E.post(`/api/patterns/${se}/charts`,{title:y,rows:m,cols:v,chartData:A,notes:`Pattern with ${Object.keys(P).length} stitches`});Y.data.success&&S(Y.data.data.chart.id),f.success("Pattern saved to your library!")}const G={name:y,rows:m,columns:v,data:P,patternId:se,chartId:n,savedAt:new Date().toISOString()};localStorage.setItem("rowly-pattern-backup",JSON.stringify(G))}catch(se){console.error("Error saving pattern:",se),f.error(((re=(D=se.response)==null?void 0:D.data)==null?void 0:re.message)||"Failed to save pattern. Please try again.");const A={name:y,rows:m,columns:v,data:P},G=JSON.parse(localStorage.getItem("rowly-patterns")||"[]");G.push(A),localStorage.setItem("rowly-patterns",JSON.stringify(G)),f.info("Pattern saved locally as backup.")}finally{g(!1)}},R=()=>{var D;return c.trim()?Qa(c):((D=Fe[k])==null?void 0:D.symbols)||[]},te=D=>{l(D),o("")},H=(D,re="2xl")=>{const se=re==="lg"?"stitch-symbol-lg":re==="xl"?"stitch-symbol-xl":"stitch-symbol-2xl",A=D.width&&D.width>1?e.jsx("span",{className:"absolute -top-1 -right-1 bg-purple-600 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center",children:D.width}):null;return e.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[e.jsx("span",{className:`stitch-symbol ${se} select-none text-gray-900 dark:text-gray-100`,"data-fallback":D.fallback,title:`${D.name}${D.abbr?` (${D.abbr})`:""}${D.width?` - ${D.width} sts wide`:""}`,children:D.symbol}),A]})};return e.jsxs("div",{className:"max-w-[1400px] mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:T&&e.jsxs("button",{onClick:()=>a(`/patterns/${T}`),className:"flex items-center text-purple-600 hover:text-purple-700 min-h-[48px]",children:[e.jsx(ht,{className:"mr-2 h-5 w-5"}),e.jsx("span",{className:"text-base",children:"Back to Pattern"})]})}),e.jsxs("button",{onClick:()=>a("/patterns"),className:"flex items-center gap-2 px-4 py-2 bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-lg transition min-h-[48px]",children:[e.jsx(ze,{className:"h-5 w-5"}),e.jsx("span",{className:"text-base font-medium",children:"Pattern Library"})]})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Knitting Pattern Builder"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create and design custom knitting patterns with standard stitch symbols"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[280px_1fr_300px] gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"text-purple-600 w-5 h-5"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Symbol Palette"})]}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[sr," symbols"]})]}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-3",placeholder:"Search all symbols...",value:c,onChange:D=>o(D.target.value)}),e.jsx("div",{className:"mb-3 -mx-1",children:e.jsx("div",{className:"flex flex-wrap gap-1 max-h-24 overflow-y-auto p-1",children:u.map(D=>e.jsxs("button",{onClick:()=>te(D.key),className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap transition-colors ${k===D.key&&!c?"bg-purple-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-purple-50 dark:hover:bg-gray-600"}`,title:D.description,children:[D.name," (",D.count,")"]},D.key))})}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto pr-1",children:c?e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:[R().length,' results for "',c,'"']}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:R().map(D=>e.jsx("div",{className:`aspect-square border rounded-lg flex items-center justify-center cursor-pointer transition-all hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-purple-500 hover:scale-105 ${F.id===D.id?"border-purple-500 bg-purple-50 dark:bg-purple-900/30":"border-gray-200 dark:border-gray-600"}`,onClick:()=>j(D),draggable:!0,onDragStart:re=>re.dataTransfer.setData("symbol",JSON.stringify(D)),title:`${D.name}${D.abbr?` (${D.abbr})`:""}: ${D.description}`,children:H(D,"xl")},D.id))}),R().length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:['No symbols found for "',c,'"']})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:(ie=Fe[k])==null?void 0:ie.name}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:R().map(D=>e.jsx("div",{className:`aspect-square border rounded-lg flex items-center justify-center cursor-pointer transition-all hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-purple-500 hover:scale-105 ${F.id===D.id?"border-purple-500 bg-purple-50 dark:bg-purple-900/30":"border-gray-200 dark:border-gray-600"}`,onClick:()=>j(D),draggable:!0,onDragStart:re=>re.dataTransfer.setData("symbol",JSON.stringify(D)),title:`${D.name}${D.abbr?` (${D.abbr})`:""}: ${D.description}`,children:H(D,"xl")},D.id))})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-xl",children:"📋"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Pattern Chart"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Rows:"}),e.jsx("input",{type:"number",value:m,onChange:D=>i(Math.max(1,parseInt(D.target.value)||1)),className:"w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded focus:ring-2 focus:ring-purple-500",min:"1",max:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Stitches:"}),e.jsx("input",{type:"number",value:v,onChange:D=>d(Math.max(1,parseInt(D.target.value)||1)),className:"w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded focus:ring-2 focus:ring-purple-500",min:"1",max:"100"})]}),e.jsxs("div",{className:"flex items-center gap-1 border border-gray-300 dark:border-gray-600 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>$(!1),className:`px-3 py-1 rounded-lg transition text-sm flex items-center gap-1 ${b?"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600":"bg-purple-600 text-white"}`,title:"Draw mode - click to place symbols",children:[e.jsx(We,{className:"w-4 h-4"}),"Draw"]}),e.jsxs("button",{onClick:()=>$(!0),className:`px-3 py-1 rounded-lg transition text-sm flex items-center gap-1 ${b?"bg-red-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600"}`,title:"Eraser mode - click to delete symbols",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Erase"]})]}),e.jsx("button",{onClick:J,className:"px-3 py-1 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition text-sm",children:"Clear All"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Tip: Right-click any cell to delete its symbol"}),e.jsx("div",{className:"overflow-auto max-h-[600px] border-2 border-gray-300 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"inline-grid gap-px bg-gray-300 dark:bg-gray-600 border border-gray-300 dark:border-gray-600",style:{gridTemplateColumns:`repeat(${v}, 40px)`,gridTemplateRows:`repeat(${m}, 40px)`},children:Array.from({length:m*v}).map((D,re)=>{const se=Math.floor(re/v),A=re%v,G=`${se}-${A}`,Y=P[G],z=Y==null?void 0:Y.isOccupied,O=Y==null?void 0:Y.symbol;return e.jsxs("div",{className:`w-10 h-10 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 flex items-center justify-center cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-700 ${Y&&!z?"bg-purple-50 dark:bg-purple-900/30":""} ${z?"bg-purple-100 dark:bg-purple-800/40 opacity-60":""}`,onClick:()=>Z(se,A),onContextMenu:Q=>{Q.preventDefault(),L(se,A)},onDragOver:Q=>Q.preventDefault(),onDrop:Q=>{Q.preventDefault();const le=JSON.parse(Q.dataTransfer.getData("symbol"));V(se,A,le)},title:z?"Part of multi-stitch symbol":O?`${O.name}${O.abbr?` (${O.abbr})`:""}`:"Empty cell",children:[Y&&!z&&O&&e.jsx("span",{className:"stitch-symbol stitch-symbol-xl pointer-events-none text-gray-900 dark:text-gray-100","data-fallback":O.fallback,children:O.symbol}),z&&e.jsx("span",{className:"text-purple-400 dark:text-purple-500 text-xs",children:"..."})]},G)})})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-xl",children:"⚙️"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Pattern Info"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Pattern Name"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500",placeholder:"My Pattern",value:y,onChange:D=>w(D.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Selected Symbol"}),e.jsx("div",{className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[H(F,"2xl"),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-sm text-gray-900 dark:text-gray-100",children:[F.name,F.abbr&&e.jsxs("span",{className:"ml-1 text-xs font-normal text-purple-600 dark:text-purple-400",children:["(",F.abbr,")"]})]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:F.description})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Stitch Count"}),e.jsxs("div",{className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Stitches:"}),e.jsx("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:Object.keys(P).filter(D=>!P[D].isOccupied&&P[D].symbol.symbol!=="□").length})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Pattern Stats"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Rows:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:m})]}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Stitches per row:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:v})]}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total cells:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:m*v})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsxs("button",{onClick:ee,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(Ae,{}),"Export Pattern"]}),e.jsxs("button",{onClick:K,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition",children:[e.jsx(Ke,{}),"Generate Instructions"]}),e.jsxs("button",{onClick:X,disabled:N,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[N?e.jsx(mr,{className:"animate-spin"}):e.jsx(Ot,{}),N?"Saving...":"Save to Library"]})]})]})]})]})]})}function tn(){const[t,a]=r.useState([]),[s,C]=r.useState(!0),[u,F]=r.useState(!1),[j,k]=r.useState(!1),[l,P]=r.useState(null),[p,m]=r.useState([]),[i,v]=r.useState(!1),[d,y]=r.useState({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1});r.useEffect(()=>{w()},[]);const w=async()=>{try{const h=await E.get("/api/yarn");a(h.data.data.yarn)}catch(h){console.error("Error fetching yarn:",h),f.error("Failed to load yarn")}finally{C(!1)}},c=async h=>{var b,$;h.preventDefault();try{await E.post("/api/yarn",d),f.success("Yarn added successfully!"),F(!1),y({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1}),w()}catch(x){console.error("Error creating yarn:",x),f.error((($=(b=x.response)==null?void 0:b.data)==null?void 0:$.message)||"Failed to add yarn")}},o=async h=>{var b,$,x;P(h),y({brand:h.brand||"",name:h.name||"",color:h.color||"",weight:h.weight||"worsted",fiberContent:h.fiber_content||"",yardsTotal:((b=h.yards_total)==null?void 0:b.toString())||"",skeinsTotal:(($=h.skeins_total)==null?void 0:$.toString())||"1",lowStockThreshold:((x=h.low_stock_threshold)==null?void 0:x.toString())||"",lowStockAlert:h.low_stock_alert||!1});try{const M=await E.get(`/api/uploads/yarn/${h.id}/photos`);m(M.data.data.photos||[])}catch(M){console.error("Error fetching yarn photos:",M),m([])}k(!0)},N=async h=>{var $,x;if(!l||!h.target.files||h.target.files.length===0)return;const b=h.target.files[0];v(!0);try{const M=new FormData;M.append("photo",b);const I=await E.post(`/api/uploads/yarn/${l.id}/photos`,M,{headers:{"Content-Type":"multipart/form-data"}});f.success("Photo uploaded successfully!"),m([...p,I.data.data.photo]),h.target.value=""}catch(M){console.error("Error uploading photo:",M),f.error(((x=($=M.response)==null?void 0:$.data)==null?void 0:x.message)||"Failed to upload photo")}finally{v(!1)}},g=async h=>{if(l&&confirm("Are you sure you want to delete this photo?"))try{await E.delete(`/api/uploads/yarn/${l.id}/photos/${h}`),f.success("Photo deleted successfully"),m(p.filter(b=>b.id!==h))}catch(b){console.error("Error deleting photo:",b),f.error("Failed to delete photo")}},n=async h=>{var b,$;if(h.preventDefault(),!!l)try{await E.put(`/api/yarn/${l.id}`,d),f.success("Yarn updated successfully!"),k(!1),P(null),y({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1}),w()}catch(x){console.error("Error updating yarn:",x),f.error((($=(b=x.response)==null?void 0:b.data)==null?void 0:$.message)||"Failed to update yarn")}},S=async(h,b)=>{if(confirm(`Are you sure you want to delete "${b}"?`))try{await E.delete(`/api/yarn/${h}`),f.success("Yarn deleted successfully"),w()}catch($){console.error("Error deleting yarn:",$),f.error("Failed to delete yarn")}},T=h=>({lace:"bg-purple-100 text-purple-800",fingering:"bg-blue-100 text-blue-800",sport:"bg-green-100 text-green-800",dk:"bg-yellow-100 text-yellow-800",worsted:"bg-orange-100 text-orange-800",bulky:"bg-red-100 text-red-800"})[h==null?void 0:h.toLowerCase()]||"bg-gray-100 text-gray-800";return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading yarn stash..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Yarn Stash"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your yarn inventory"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Yarn"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(qe,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No yarn in stash"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking your yarn collection"}),e.jsxs("button",{onClick:()=>F(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Your First Yarn"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(h=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[h.brand&&`${h.brand} `,h.name]}),h.color&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:h.color})]}),h.weight&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${T(h.weight)}`,children:h.weight})]}),h.fiber_content&&e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:h.fiber_content}),e.jsxs("div",{className:"space-y-2 mb-4",children:[h.skeins_remaining!==void 0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Skeins:"}),e.jsx("span",{className:"font-medium text-gray-900",children:h.skeins_remaining})]}),h.yards_remaining!==void 0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Yards:"}),e.jsx("span",{className:"font-medium text-gray-900",children:h.yards_remaining})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>o(h),className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>S(h.id,h.name),className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},h.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Yarn to Stash"})}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:d.brand,onChange:h=>y({...d,brand:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Lion Brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yarn Name *"}),e.jsx("input",{type:"text",value:d.name,onChange:h=>y({...d,name:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Wool-Ease",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("input",{type:"text",value:d.color,onChange:h=>y({...d,color:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Navy Blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight"}),e.jsxs("select",{value:d.weight,onChange:h=>y({...d,weight:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"lace",children:"Lace"}),e.jsx("option",{value:"fingering",children:"Fingering"}),e.jsx("option",{value:"sport",children:"Sport"}),e.jsx("option",{value:"dk",children:"DK"}),e.jsx("option",{value:"worsted",children:"Worsted"}),e.jsx("option",{value:"bulky",children:"Bulky"}),e.jsx("option",{value:"super-bulky",children:"Super Bulky"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiber Content"}),e.jsx("input",{type:"text",value:d.fiberContent,onChange:h=>y({...d,fiberContent:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 100% Wool, 80% Acrylic 20% Wool"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Skeins"}),e.jsx("input",{type:"number",value:d.skeinsTotal,onChange:h=>y({...d,skeinsTotal:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yards per Skein"}),e.jsx("input",{type:"number",value:d.yardsTotal,onChange:h=>y({...d,yardsTotal:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 364"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add to Stash"})]})]})]})}),j&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Yarn"})}),e.jsxs("form",{onSubmit:n,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:d.brand,onChange:h=>y({...d,brand:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Lion Brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yarn Name *"}),e.jsx("input",{type:"text",value:d.name,onChange:h=>y({...d,name:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Wool-Ease",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("input",{type:"text",value:d.color,onChange:h=>y({...d,color:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Navy Blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight"}),e.jsxs("select",{value:d.weight,onChange:h=>y({...d,weight:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"lace",children:"Lace"}),e.jsx("option",{value:"fingering",children:"Fingering"}),e.jsx("option",{value:"sport",children:"Sport"}),e.jsx("option",{value:"dk",children:"DK"}),e.jsx("option",{value:"worsted",children:"Worsted"}),e.jsx("option",{value:"bulky",children:"Bulky"}),e.jsx("option",{value:"super-bulky",children:"Super Bulky"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiber Content"}),e.jsx("input",{type:"text",value:d.fiberContent,onChange:h=>y({...d,fiberContent:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 100% Wool, 80% Acrylic 20% Wool"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Skeins"}),e.jsx("input",{type:"number",value:d.skeinsTotal,onChange:h=>y({...d,skeinsTotal:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yards per Skein"}),e.jsx("input",{type:"number",value:d.yardsTotal,onChange:h=>y({...d,yardsTotal:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 364"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Photos"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Add photo to visualize your yarn"}),e.jsx("input",{type:"file",accept:"image/*",onChange:N,disabled:i,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed"}),i&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Uploading..."})]}),p.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:p.map(h=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:h.thumbnail_path,alt:h.original_filename,className:"w-full h-24 object-cover rounded-lg border border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>g(h.id),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete photo",children:e.jsx(ge,{className:"h-3 w-3"})})]},h.id))}),p.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4 bg-gray-50 rounded-lg",children:"No photos yet. Upload a photo to see what your yarn looks like!"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Low Stock Alerts"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Low Stock Threshold (yards)"}),e.jsx("input",{type:"number",value:d.lowStockThreshold,onChange:h=>y({...d,lowStockThreshold:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., 100",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get notified when yards drop below this amount"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.lowStockAlert,onChange:h=>y({...d,lowStockAlert:h.target.checked}),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Enable low stock alerts"})]})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),P(null),m([]),y({brand:"",name:"",color:"",weight:"worsted",fiberContent:"",yardsTotal:"",skeinsTotal:"1",lowStockThreshold:"",lowStockAlert:!1})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Yarn"})]})]})]})})]})}function rn(){const[t,a]=r.useState([]),[s,C]=r.useState(!0),[u,F]=r.useState(!1),[j,k]=r.useState(!1),[l,P]=r.useState(null),[p,m]=r.useState({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"});r.useEffect(()=>{i()},[]);const i=async()=>{try{const o=await E.get("/api/tools");a(o.data.data.tools)}catch(o){console.error("Error fetching tools:",o),f.error("Failed to load tools")}finally{C(!1)}},v=async o=>{var N,g;o.preventDefault();try{await E.post("/api/tools",p),f.success("Tool added successfully!"),F(!1),m({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"}),i()}catch(n){console.error("Error creating tool:",n),f.error(((g=(N=n.response)==null?void 0:N.data)==null?void 0:g.message)||"Failed to add tool")}},d=o=>{var N;P(o),m({name:o.name||"",type:o.type||"needle",size:o.size||"",material:o.material||"",brand:o.brand||"",quantity:((N=o.quantity)==null?void 0:N.toString())||"1"}),k(!0)},y=async o=>{var N,g;if(o.preventDefault(),!!l)try{await E.put(`/api/tools/${l.id}`,p),f.success("Tool updated successfully!"),k(!1),P(null),m({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"}),i()}catch(n){console.error("Error updating tool:",n),f.error(((g=(N=n.response)==null?void 0:N.data)==null?void 0:g.message)||"Failed to update tool")}},w=async(o,N)=>{if(confirm(`Are you sure you want to delete "${N}"?`))try{await E.delete(`/api/tools/${o}`),f.success("Tool deleted successfully"),i()}catch(g){console.error("Error deleting tool:",g),f.error("Failed to delete tool")}},c=o=>({needle:"bg-blue-100 text-blue-800",hook:"bg-purple-100 text-purple-800",circular:"bg-green-100 text-green-800",dpn:"bg-yellow-100 text-yellow-800",accessory:"bg-gray-100 text-gray-800"})[o==null?void 0:o.toLowerCase()]||"bg-gray-100 text-gray-800";return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading tools..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tools"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your knitting tools inventory"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Tool"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(Rt,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tools yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking your knitting tools"}),e.jsxs("button",{onClick:()=>F(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Your First Tool"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(o=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o.name}),o.size&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Size ",o.size]})]}),o.type&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${c(o.type)}`,children:o.type})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[o.brand&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Brand:"})," ",o.brand]}),o.material&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Material:"})," ",o.material]}),o.quantity&&e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",o.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>d(o),className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>w(o.id,o.name),className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},o.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Tool"})}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tool Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:o=>m({...p,name:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7 Circular Needles",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:p.type,onChange:o=>m({...p,type:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"needle",children:"Straight Needle"}),e.jsx("option",{value:"circular",children:"Circular Needle"}),e.jsx("option",{value:"dpn",children:"Double-Pointed Needles (DPN)"}),e.jsx("option",{value:"hook",children:"Crochet Hook"}),e.jsx("option",{value:"accessory",children:"Accessory"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Size"}),e.jsx("input",{type:"text",value:p.size,onChange:o=>m({...p,size:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7, 4.5mm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Material"}),e.jsx("input",{type:"text",value:p.material,onChange:o=>m({...p,material:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Bamboo, Metal, Wood"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:p.brand,onChange:o=>m({...p,brand:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Clover, Addi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:p.quantity,onChange:o=>m({...p,quantity:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Tool"})]})]})]})}),j&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Tool"})}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tool Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:o=>m({...p,name:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7 Circular Needles",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:p.type,onChange:o=>m({...p,type:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"needle",children:"Straight Needle"}),e.jsx("option",{value:"circular",children:"Circular Needle"}),e.jsx("option",{value:"dpn",children:"Double-Pointed Needles (DPN)"}),e.jsx("option",{value:"hook",children:"Crochet Hook"}),e.jsx("option",{value:"accessory",children:"Accessory"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Size"}),e.jsx("input",{type:"text",value:p.size,onChange:o=>m({...p,size:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., US 7, 4.5mm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Material"}),e.jsx("input",{type:"text",value:p.material,onChange:o=>m({...p,material:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Bamboo, Metal, Wood"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:p.brand,onChange:o=>m({...p,brand:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Clover, Addi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:p.quantity,onChange:o=>m({...p,quantity:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",min:"1"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),P(null),m({name:"",type:"needle",size:"",material:"",brand:"",quantity:"1"})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Tool"})]})]})]})})]})}function sn(){const[t,a]=r.useState([]),[s,C]=r.useState(!0),[u,F]=r.useState(!1),[j,k]=r.useState(!1),[l,P]=r.useState(null),[p,m]=r.useState({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""});r.useEffect(()=>{i()},[]);const i=async()=>{try{const c=await E.get("/api/recipients");a(c.data.data.recipients)}catch(c){console.error("Error fetching recipients:",c),f.error("Failed to load recipients")}finally{C(!1)}},v=async c=>{var o,N;c.preventDefault();try{await E.post("/api/recipients",p),f.success("Recipient added successfully!"),F(!1),m({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""}),i()}catch(g){console.error("Error creating recipient:",g),f.error(((N=(o=g.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to add recipient")}},d=c=>{P(c),m({firstName:c.first_name||"",lastName:c.last_name||"",relationship:c.relationship||"",clothingSize:c.clothing_size||"",notes:c.notes||""}),k(!0)},y=async c=>{var o,N;if(c.preventDefault(),!!l)try{await E.put(`/api/recipients/${l.id}`,p),f.success("Recipient updated successfully!"),k(!1),P(null),m({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""}),i()}catch(g){console.error("Error updating recipient:",g),f.error(((N=(o=g.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to update recipient")}},w=async(c,o)=>{if(confirm(`Are you sure you want to delete "${o}"?`))try{await E.delete(`/api/recipients/${c}`),f.success("Recipient deleted successfully"),i()}catch(N){console.error("Error deleting recipient:",N),f.error("Failed to delete recipient")}};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading recipients..."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Recipients"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage gift recipients and their preferences"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Recipient"]})]}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(lt,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No recipients yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking people you knit for"}),e.jsxs("button",{onClick:()=>F(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[e.jsx(ue,{className:"mr-2"}),"Add Your First Recipient"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(c=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[c.first_name," ",c.last_name]}),c.relationship&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:c.relationship}),c.clothing_size&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",c.clothing_size]}),c.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-3 line-clamp-2",children:c.notes}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200 mt-4",children:[e.jsxs("button",{onClick:()=>d(c),className:"flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition flex items-center justify-center text-sm",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>w(c.id,`${c.first_name} ${c.last_name}`),className:"flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition flex items-center justify-center text-sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]},c.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Recipient"})}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:p.firstName,onChange:c=>m({...p,firstName:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:p.lastName,onChange:c=>m({...p,lastName:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship"}),e.jsx("input",{type:"text",value:p.relationship,onChange:c=>m({...p,relationship:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Friend, Family, Child"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Clothing Size"}),e.jsx("input",{type:"text",value:p.clothingSize,onChange:c=>m({...p,clothingSize:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Medium, Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:p.notes,onChange:c=>m({...p,notes:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Preferences, measurements, color likes/dislikes, etc."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Recipient"})]})]})]})}),j&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Recipient"})}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:p.firstName,onChange:c=>m({...p,firstName:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:p.lastName,onChange:c=>m({...p,lastName:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship"}),e.jsx("input",{type:"text",value:p.relationship,onChange:c=>m({...p,relationship:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Friend, Family, Child"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Clothing Size"}),e.jsx("input",{type:"text",value:p.clothingSize,onChange:c=>m({...p,clothingSize:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"e.g., Medium, Large"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:p.notes,onChange:c=>m({...p,notes:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:3,placeholder:"Preferences, measurements, color likes/dislikes, etc."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{k(!1),P(null),m({firstName:"",lastName:"",relationship:"",clothingSize:"",notes:""})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Update Recipient"})]})]})]})})]})}const an=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function nn(){const{user:t,setUser:a}=Le(),[s,C]=r.useState("profile"),[u,F]=r.useState({totalProjects:0,activeProjects:0,completedProjects:0,totalPatterns:0,totalYarns:0}),[j,k]=r.useState(!1),[l,P]=r.useState(!1),[p,m]=r.useState({firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",email:(t==null?void 0:t.email)||""}),[i,v]=r.useState({currentPassword:"",newPassword:"",confirmPassword:""});r.useEffect(()=>{d()},[]),r.useEffect(()=>{t&&m({firstName:t.firstName,lastName:t.lastName,email:t.email})},[t]);const d=async()=>{var o,N;try{const[g,n,S]=await Promise.all([E.get("/api/projects").catch(()=>({data:{data:{projects:[]}}})),E.get("/api/patterns").catch(()=>({data:{data:{patterns:[]}}})),E.get("/api/yarn").catch(()=>({data:{data:{yarn:[]}}}))]),T=g.data.data.projects||[],h=T.filter($=>$.status==="active"||$.status==="in_progress"),b=T.filter($=>$.status==="completed");F({totalProjects:T.length,activeProjects:h.length,completedProjects:b.length,totalPatterns:((o=n.data.data.patterns)==null?void 0:o.length)||0,totalYarns:((N=S.data.data.yarn)==null?void 0:N.length)||0})}catch(g){console.error("Error fetching stats:",g)}},y=async()=>{var o,N;if(!p.firstName.trim()||!p.lastName.trim()){f.error("First name and last name are required");return}if(!p.email.trim()){f.error("Email is required");return}if(!an.test(p.email)){f.error("Please enter a valid email address");return}k(!0);try{const g=await E.put("/api/auth/profile",{firstName:p.firstName,lastName:p.lastName,email:p.email});a(g.data.data.user),f.success("Profile updated successfully!"),P(!1)}catch(g){console.error("Error updating profile:",g);const n=g;f.error(((N=(o=n.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to update profile")}finally{k(!1)}},w=async()=>{var o,N;if(!i.currentPassword||!i.newPassword||!i.confirmPassword){f.error("All password fields are required");return}if(i.newPassword.length<8){f.error("New password must be at least 8 characters");return}if(i.newPassword!==i.confirmPassword){f.error("New passwords do not match");return}k(!0);try{await E.put("/api/auth/change-password",{currentPassword:i.currentPassword,newPassword:i.newPassword}),f.success("Password changed successfully!"),v({currentPassword:"",newPassword:"",confirmPassword:""})}catch(g){console.error("Error changing password:",g);const n=g;f.error(((N=(o=n.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to change password")}finally{k(!1)}},c=async()=>{var o,N;k(!0);try{await E.post("/api/auth/resend-verification"),f.success("Verification email sent! Please check your inbox.")}catch(g){console.error("Error resending verification:",g),f.error(((N=(o=g.response)==null?void 0:o.data)==null?void 0:N.message)||"Failed to send verification email")}finally{k(!1)}};return t?e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"My Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("button",{onClick:()=>C("profile"),className:`pb-3 px-1 border-b-2 font-medium transition ${s==="profile"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Profile"]})}),e.jsx("button",{onClick:()=>C("security"),className:`pb-3 px-1 border-b-2 font-medium transition ${s==="security"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Security"]})}),e.jsx("button",{onClick:()=>C("stats"),className:`pb-3 px-1 border-b-2 font-medium transition ${s==="stats"?"border-purple-600 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{className:"h-4 w-4"}),"Statistics"]})})]})}),s==="profile"&&e.jsxs("div",{className:"space-y-6",children:[!t.emailVerified&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Be,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Email Not Verified"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Please verify your email address to access all features."}),e.jsx("button",{onClick:c,disabled:j,className:"mt-2 text-sm text-yellow-800 underline hover:text-yellow-900 disabled:opacity-50",children:"Resend verification email"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"Personal Information"]}),!l&&e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-2 px-4 py-2 text-purple-600 hover:bg-purple-50 rounded-lg transition",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Edit"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),l?e.jsx("input",{type:"text",value:p.firstName,onChange:o=>m({...p,firstName:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}):e.jsx("p",{className:"text-gray-900 py-2",children:t.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),l?e.jsx("input",{type:"text",value:p.lastName,onChange:o=>m({...p,lastName:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}):e.jsx("p",{className:"text-gray-900 py-2",children:t.lastName})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email Address",t.emailVerified&&e.jsxs("span",{className:"ml-2 text-green-600 text-xs inline-flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),"Verified"]})]}),l?e.jsx("input",{type:"email",value:p.email,onChange:o=>m({...p,email:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}):e.jsx("p",{className:"text-gray-900 py-2",children:t.email})]}),l&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>{P(!1),m({firstName:t.firstName,lastName:t.lastName,email:t.email})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center justify-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Cancel"]}),e.jsxs("button",{onClick:y,disabled:j,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(Ot,{className:"h-4 w-4"}),j?"Saving...":"Save Changes"]})]})]})]})]}),s==="security"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(Wt,{className:"h-5 w-5"}),"Change Password"]}),e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),e.jsx("input",{type:"password",value:i.currentPassword,onChange:o=>v({...i,currentPassword:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),e.jsx("input",{type:"password",value:i.newPassword,onChange:o=>v({...i,newPassword:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Must be at least 8 characters long"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:i.confirmPassword,onChange:o=>v({...i,confirmPassword:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsx("button",{onClick:w,disabled:j,className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition disabled:opacity-50",children:j?"Changing Password...":"Change Password"})]})]})}),s==="stats"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Projects"}),e.jsx(zt,{className:"h-5 w-5 text-purple-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:u.totalProjects}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[u.activeProjects," active, ",u.completedProjects," completed"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Pattern Library"}),e.jsx(Je,{className:"h-5 w-5 text-blue-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:u.totalPatterns}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"patterns collected"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Yarn Stash"}),e.jsx(Kt,{className:"h-5 w-5 text-green-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:u.totalYarns}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"skeins in stash"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Account Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Account Status"}),e.jsx("span",{className:"font-medium text-green-600",children:"Active"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"User ID"}),e.jsx("span",{className:"font-mono text-sm text-gray-900",children:t.id})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Email Verification"}),e.jsx("span",{className:`font-medium ${t.emailVerified?"text-green-600":"text-yellow-600"}`,children:t.emailVerified?"Verified":"Not Verified"})]})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading profile..."})]})})}const ln=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function on(){const[t,a]=r.useState(""),[s,C]=r.useState(""),[u,F]=r.useState(!1),[j,k]=r.useState(!1),[l,P]=r.useState({}),p=Ue(),m=Le(d=>d.login),i=()=>{const d={};return t.trim()?ln.test(t)||(d.email="Please enter a valid email address"):d.email="Email is required",s||(d.password="Password is required"),P(d),Object.keys(d).length===0},v=async d=>{var y,w;if(d.preventDefault(),!!i()){k(!0);try{await m(t,s,u),f.success("Login successful!"),p("/dashboard")}catch(c){console.error("Login error:",c);const N=((w=(y=c.response)==null?void 0:y.data)==null?void 0:w.message)||"Login failed. Please check your credentials.";f.error(N)}finally{k(!1)}}};return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-8 transition-colors duration-200",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2",children:"Rowly"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Sign in to your account"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:t,onChange:d=>{a(d.target.value),l.email&&P({...l,email:void 0})},className:`w-full px-4 py-2 border ${l.email?"border-red-500":"border-gray-300 dark:border-gray-600"} bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition`,placeholder:"you@example.com",disabled:j,required:!0}),l.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:l.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:s,onChange:d=>{C(d.target.value),l.password&&P({...l,password:void 0})},className:`w-full px-4 py-2 border ${l.password?"border-red-500":"border-gray-300 dark:border-gray-600"} bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition`,placeholder:"••••••••",disabled:j,required:!0}),l.password&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:l.password})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:d=>F(d.target.checked),className:"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",disabled:j}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Remember me for 30 days"})]}),e.jsx(be,{to:"/forgot-password",className:"text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition",children:"Forgot password?"})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full bg-purple-600 dark:bg-purple-700 text-white py-2 px-4 rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 transition disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:j?"Signing in...":"Sign In"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Don't have an account?"," ",e.jsx(be,{to:"/register",className:"text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 font-medium transition",children:"Sign up"})]})}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["Demo account: ",e.jsx("span",{className:"font-mono",children:"demo@rowlyknit.com"})," / ",e.jsx("span",{className:"font-mono",children:"Demo123!@#"})]})})]})})}function cn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Register"})})}function dn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"ForgotPassword"})})}function un(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"ResetPassword"})})}function mn(){return e.jsx("div",{className:"p-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"VerifyEmail"})})}function xn(){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"mb-8",children:e.jsx("span",{className:"text-9xl font-bold text-gray-200",children:"404"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Oops! The page you're looking for doesn't exist or has been moved. Don't worry, even the best knitters drop a stitch sometimes."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(be,{to:"/",className:"inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium",children:[e.jsx(nr,{size:20}),"Go to Dashboard"]}),e.jsxs("button",{onClick:()=>window.history.back(),className:"inline-flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium",children:[e.jsx(ht,{size:20}),"Go Back"]})]}),e.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Or try one of these:"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 text-sm",children:[e.jsx(be,{to:"/projects",className:"text-blue-600 hover:underline",children:"Projects"}),e.jsx(be,{to:"/patterns",className:"text-blue-600 hover:underline",children:"Patterns"}),e.jsx(be,{to:"/yarn",className:"text-blue-600 hover:underline",children:"Yarn Stash"}),e.jsx(be,{to:"/tools",className:"text-blue-600 hover:underline",children:"Tools"}),e.jsx(be,{to:"/recipients",className:"text-blue-600 hover:underline",children:"Recipients"})]})]})]})})}function gn({children:t}){const{isAuthenticated:a}=Le();return a?e.jsx(e.Fragment,{children:t}):e.jsx(Bt,{to:"/login",replace:!0})}function Ft({children:t}){const{isAuthenticated:a}=Le();return a?e.jsx(Bt,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:t})}function hn(){return e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),e.jsx(Ls,{}),e.jsx(zs,{}),e.jsxs(_s,{children:[e.jsxs(je,{element:e.jsx(fa,{}),children:[e.jsx(je,{path:"/login",element:e.jsx(Ft,{children:e.jsx(on,{})})}),e.jsx(je,{path:"/register",element:e.jsx(Ft,{children:e.jsx(cn,{})})}),e.jsx(je,{path:"/forgot-password",element:e.jsx(Ft,{children:e.jsx(dn,{})})}),e.jsx(je,{path:"/reset-password",element:e.jsx(un,{})}),e.jsx(je,{path:"/verify-email",element:e.jsx(mn,{})})]}),e.jsxs(je,{element:e.jsx(gn,{children:e.jsx(ba,{})}),children:[e.jsx(je,{path:"/",element:e.jsx(Bt,{to:"/dashboard",replace:!0})}),e.jsx(je,{path:"/dashboard",element:e.jsx(ya,{})}),e.jsx(je,{path:"/projects",element:e.jsx(ja,{})}),e.jsx(je,{path:"/projects/:id",element:e.jsx(La,{})}),e.jsx(je,{path:"/patterns",element:e.jsx(Ua,{})}),e.jsx(je,{path:"/patterns/:id",element:e.jsx(Ka,{})}),e.jsx(je,{path:"/patterns/:id/builder",element:e.jsx(ar,{})}),e.jsx(je,{path:"/pattern-builder",element:e.jsx(ar,{})}),e.jsx(je,{path:"/yarn",element:e.jsx(tn,{})}),e.jsx(je,{path:"/tools",element:e.jsx(rn,{})}),e.jsx(je,{path:"/recipients",element:e.jsx(sn,{})}),e.jsx(je,{path:"/profile",element:e.jsx(nn,{})})]}),e.jsx(je,{path:"*",element:e.jsx(xn,{})})]})]})}class pn extends r.Component{constructor(){super(...arguments);Xe(this,"state",{hasError:!1,error:null,errorInfo:null});Xe(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()})}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,C){console.error("ErrorBoundary caught an error:",s,C),this.setState({error:s,errorInfo:C})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-8",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-red-100 dark:bg-red-900/20 rounded-full mx-auto mb-4 md:mb-6",children:e.jsx(_t,{className:"w-8 h-8 md:w-10 md:h-10 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white text-center mb-3 md:mb-4",children:"Something went wrong"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 dark:text-gray-400 text-center mb-6 md:mb-8",children:"We're sorry for the inconvenience. The app encountered an unexpected error."}),!1,e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 px-6 py-3 md:py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors min-h-[56px] md:min-h-[64px]",children:[e.jsx(Tt,{className:"w-5 h-5 md:w-6 md:h-6"}),e.jsx("span",{className:"text-base md:text-lg",children:"Reload App"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 dark:text-gray-400 text-center mt-4 md:mt-6",children:"If this problem persists, please contact support"})]})}):this.props.children}}window.addEventListener("error",t=>{console.error("Global error:",t.error),console.error("Error message:",t.message),console.error("Error source:",t.filename,t.lineno,t.colno)});window.addEventListener("unhandledrejection",t=>{console.error("Unhandled promise rejection:",t.reason)});window.addEventListener("api-error",t=>{const{status:a,message:s}=t.detail;a>=500?f.error(s):a===422&&f.warning(s)});window.addEventListener("rate-limit-exceeded",t=>{const{message:a,retryAfter:s}=t.detail;f.warning(`${a}${s?` Please wait ${s} seconds.`:""}`,{autoClose:s?s*1e3:5e3})});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const t=await navigator.serviceWorker.getRegistrations();for(const s of t)console.log("Unregistering old service worker..."),await s.unregister();if("caches"in window){const s=await caches.keys();for(const C of s)console.log("Deleting cache:",C),await caches.delete(C)}console.log("✅ All service workers unregistered and caches cleared");const a=await navigator.serviceWorker.register("/sw.js");console.log("✅ New ServiceWorker registered:",a)}catch(t){console.error("❌ ServiceWorker error:",t)}});const bn=new Ms({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1,refetchOnWindowFocus:!1}}});try{const t=document.getElementById("root");if(!t)throw new Error("Root element not found! DOM might not be ready.");console.log("Initializing React app..."),console.log("React version:",nt.version),console.log("Environment:","production"),$s.createRoot(t).render(e.jsx(nt.StrictMode,{children:e.jsx(pn,{children:e.jsx(Es,{client:bn,children:e.jsx(Ts,{children:e.jsxs(Na,{children:[e.jsx(hn,{}),e.jsx(Rs,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})})})})),console.log("✅ React app initialized successfully")}catch(t){console.error("❌ Failed to initialize React app:",t);const a=document.getElementById("root");a&&(a.innerHTML=`
      <div style="padding: 20px; font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto;">
        <h1 style="color: #dc2626;">Application Error</h1>
        <p>The application failed to start. Please check the browser console for details.</p>
        <pre style="background: #f3f4f6; padding: 15px; border-radius: 5px; overflow: auto;">
          ${t instanceof Error?t.message:String(t)}
          ${t instanceof Error&&t.stack?`

`+t.stack:""}
        </pre>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer;">
          Reload Page
        </button>
      </div>
    `)}
//# sourceMappingURL=index-f3ME2EaM.js.map
