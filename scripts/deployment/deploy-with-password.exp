#!/usr/bin/expect -f

set timeout 300
set password "1983!@*DrinkBeers"
set server "rowly@165.227.97.4"

# Step 1: Copy environment file
puts "ðŸ“¤ Copying environment file to server..."
spawn scp /Users/jimmitchell/Desktop/rowlyknit/.env.production ${server}:/home/rowly/rowlyknit/backend/.env
expect {
    "password:" { send "$password\r"; exp_continue }
    "yes/no" { send "yes\r"; exp_continue }
    eof
}
puts "âœ… Environment file copied\n"

# Step 2: SSH and deploy
puts "ðŸš€ Connecting to server and deploying..."
spawn ssh ${server} {cd /home/rowly/rowlyknit && git fetch origin && git checkout claude/build-rowly-production-app-011CV32EASvp9cQ2Z8eA8mTy && git pull origin claude/build-rowly-production-app-011CV32EASvp9cQ2Z8eA8mTy && chmod +x DEPLOY_TO_PRODUCTION_NOW.sh && ./DEPLOY_TO_PRODUCTION_NOW.sh}
expect {
    "password:" { send "$password\r"; exp_continue }
    "yes/no" { send "yes\r"; exp_continue }
    timeout { puts "\nDeployment timed out"; exit 1 }
    eof
}

puts "\nðŸŽ‰ Deployment Complete!"
